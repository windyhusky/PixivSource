[
    {
        "bookSourceComment": "ğŸ…¿ï¸ Pixiv å°è¯´ï¼ˆæ›´æ–°ğŸ“†ï¼š2026/02/22ï¼‰\n\nä¹¦æºç‰ˆæœ¬ï¼š262\nä½¿ç”¨è¯´æ˜ï¼šğŸ“Œé˜…è¯» Plus 3.26.0129 ç‰ˆæœ¬å¯ç”¨\nå¯ç”¨åŠŸèƒ½ï¼šâœ…æœç´¢âœ…å‘ç°âœ…æ·»åŠ ç½‘å€âœ…è®¢é˜…æº\næœç´¢å°è¯´ï¼šâœ…å•ç¯‡âœ…ç³»åˆ—âœ…æ ‡ç­¾âœ…ä½œè€…\nå‘ç°å°è¯´ï¼šâœ…å…³æ³¨âœ…è¿½æ›´âœ…æ¨èâœ…å‘ç°\nå‘ç°å°è¯´ï¼šâœ…æ”¶è—âœ…ä¹¦ç­¾âœ…é¦–é¡µâœ…æ’è¡Œ\næ·»åŠ ç½‘å€ï¼šâœ…å°è¯´âœ…ç³»åˆ—âœ…ä½œè€…\nè®¢é˜…ç”¨æ³•ï¼šç‚¹å‡»è®¢é˜…æºæ‰“å¼€å°è¯´/ç³»åˆ—å°è¯´ï¼Œã€åˆ·æ–°ã€‘ï¼Œç‚¹å‡»ã€åŠ å…¥ä¹¦æ¶ã€‘æŒ‰é’®ï¼Œæ·»åŠ åˆ°ä¹¦æ¶\n\nä¹¦æºå‘å¸ƒï¼šPixiv ä¹¦æºé¢‘é“ https://t.me/PixivSource\né¡¹ç›®åœ°å€ï¼šhttps://github.com/DowneyRem/PixivSource\nä½¿ç”¨æ•™ç¨‹ï¼šhttps://pixivsource.pages.dev/Pixiv\n\nâš™ï¸ ä¹¦æºè®¾ç½®ï¼š\n1ï¸âƒ£ ä¹¦æ¶ - é˜…è¯»ç•Œé¢ - Pixiv å°è¯´ - ç™»å½•\n2ï¸âƒ£ æˆ‘çš„ - ä¹¦æºç®¡ç† - Pixiv å°è¯´ - ç™»å½•\nç‚¹å‡»ã€ğŸ‘€ ä¹¦æºè®¾ç½®ã€‘ã€ğŸ‘€ å‘ç°è®¾ç½®ã€‘æ˜¾ç¤ºç›¸å…³è®¾ç½®æŒ‰é’®\n\nâ–¶ï¸ äº’åŠ¨åŠŸèƒ½ã€è‡ªå®šä¹‰åŠŸèƒ½ï¼š\n1ï¸âƒ£ å°è¯´ä¹¦æ¶ - é˜…è¯»ç•Œé¢ - Pixiv å°è¯´ - ç™»å½•\n\nğŸ’¬ å‘é€è¯„è®ºï¼š\n1ï¸âƒ£ æ–‡æœ¬æ¡†å†… è¾“å…¥å†…å®¹ï¼Œç‚¹å‡»ã€âœ… å‘é€è¯„è®ºã€‘\n\nğŸš« å±è”½æ ‡ç­¾/æè¿°(æœ¬åœ°)ï¼š\n1ï¸âƒ£ ç‚¹å‡»ã€ğŸ‘€ æŸ¥çœ‹å±è”½ã€‘ï¼Œåˆ‡æ¢è‡³å±è”½åˆ—è¡¨\n2ï¸âƒ£ æ–‡æœ¬æ¡†å†… è¾“å…¥å†…å®¹ï¼Œç‚¹å‡»ã€ğŸš« åŠ å…¥å±è”½ã€‘\n\nğŸ“Œ å–œæ¬¢æ ‡ç­¾(æœ¬åœ°)ï¼š\n1ï¸âƒ£ æ–‡æœ¬æ¡†å†… è¾“å…¥æ ‡ç­¾ï¼Œç‚¹å‡»ã€ğŸ“Œ å–œæ¬¢æ ‡ç­¾ã€‘\n\nâ¤ï¸ å…³æ³¨ ä»–äººæ”¶è—(æœ¬åœ°)ï¼š\n1ï¸âƒ£ æ–‡æœ¬æ¡†å†… è¾“å…¥ä½œè€…IDï¼Œç‚¹å‡»ã€â¤ï¸ ä»–äººæ”¶è—ã€‘",
        "bookSourceGroup": "ğŸ” Pixiv",
        "bookSourceName": "ğŸ…¿ï¸ Pixiv å°è¯´",
        "bookSourceType": 0,
        "bookSourceUrl": "https://www.pixiv.net/novel",
        "bookUrlPattern": "(https?://)?(www\\.)?pixiv\\.net(/ajax)?/(novel/(show\\.php\\?id=|series/)?|users?/)\\d+.*",
        "concurrentRate": "30/5000",
        "customButton": false,
        "customOrder": 0,
        "enabled": true,
        "enabledCookieJar": true,
        "enabledExplore": true,
        "eventListener": true,
        "exploreUrl": "@js:\nlet settings = getFromCacheObject(\"pixivSettings\")\nif (!settings) settings = setDefaultSettings()\n\nlet li = [\n    {\"â­ï¸ å…³æ³¨\": \"https://www.pixiv.net/ajax/follow_latest/novel?p={{page}}&mode=r18&lang=zh\"},\n    {\"ğŸ“ƒ è¿½æ›´\": \"https://www.pixiv.net/ajax/watch_list/novel?p={{page}}&new=1&lang=zh\"},\n    {\"ğŸ’¯ æ¨è\": \"https://www.pixiv.net/ajax/top/novel?mode=r18&lang=zh\"},\n    {\"ğŸ” å‘ç°\": \"https://www.pixiv.net/ajax/novel/discovery?mode=r18&lang=zh\"},\n    {\"â¤ï¸ æ”¶è—\": \"https://www.pixiv.net/ajax/user/{{cache.get(\\\"pixiv:uid\\\")}}/novels/bookmarks?tag=&offset={{(page-1)*24}}&limit=24&rest=show&lang=zh\"},\n    {\"ãŠ™ï¸ æ”¶è—\": \"https://www.pixiv.net/ajax/user/{{cache.get(\\\"pixiv:uid\\\")}}/novels/bookmarks?tag=&offset={{(page-1)*24}}&limit=24&rest=hide&lang=zh\"},\n    {\"ğŸ·ï¸ ä¹¦ç­¾\": \"https://www.pixiv.net/novel/marker_all.php\"},\n    {\"ğŸ  é¦–é¡µ\": \"https://www.pixiv.net\"},\n]\n\nlet normal = [\n    {\"âœ… å¸¸è§„ å°è¯´ æ¨è âœ…\": \"\"},\n    {\"â­ï¸ å…³æ³¨\": \"https://www.pixiv.net/ajax/follow_latest/novel?p={{page}}&mode=all&lang=zh\"},\n    {\"ğŸ’¯ æ¨è\": \"https://www.pixiv.net/ajax/top/novel?mode=all&lang=zh\"},\n    {\"ğŸ” å‘ç°\": \"https://www.pixiv.net/ajax/novel/discovery?mode=safe&lang=zh\"},\n    {\"ğŸ†™ æ›´æ–°\": \"https://cdn.jsdelivr.net/gh/DowneyRem/PixivSource@main/pixiv.json\"},\n]\n\nlet r18New = [\n    {\"ğŸ†• æœ€æ–° ä¼åˆ’ çº¦ç¨¿ ğŸ’°\": \"\"},\n    {\"ğŸ†• æœ€æ–°\": \"https://www.pixiv.net/ajax/novel/new?lastId=0&limit=20&r18=true&lang=zh\"},\n    {\"ğŸ“‘ ä¼åˆ’\": \"https://www.pixiv.net/ajax/user_event/portal/novels?mode=r18&p={{page}}&lang=zh\"},\n    {\"ğŸ’° çº¦ç¨¿\": \"https://www.pixiv.net/ajax/commission/page/request/complete/novels?mode=r18&p={{page}}&lang=zh\"},\n    {\"ğŸ” å‘ç°\": \"https://www.pixiv.net/ajax/novel/discovery?mode=all&lang=zh\"},\n]\n\nlet generalNew = [\n    {\"âœ… æœ€æ–° ä¼åˆ’ çº¦ç¨¿ âœ…\": \"\"},\n    {\"æœ€æ–°\": \"https://www.pixiv.net/ajax/novel/new?lastId=0&limit=20&r18=false&lang=zh\"},\n    {\"ä¼åˆ’\": \"https://www.pixiv.net/ajax/user_event/portal/novels?mode=all&p={{page}}&lang=zh\"},\n    {\"çº¦ç¨¿\": \"https://www.pixiv.net/ajax/commission/page/request/complete/novels?mode=all&p={{page}}&lang=zh\"},\n    {\"ç¼–è¾‘\": \"https://www.pixiv.net/novel/editors_picks\"},\n]\n\nlet r18Rank = [\n    {\"ğŸ‘‘ æ’è¡Œæ¦œå• ğŸ‘‘\": \"\"},\n    {\"ä»Šæ—¥\": \"https://www.pixiv.net/novel/ranking.php?mode=daily_r18\"},\n    {\"æœ¬å‘¨\": \"https://www.pixiv.net/novel/ranking.php?mode=weekly_r18\"},\n    {\"R18G\": \"https://www.pixiv.net/novel/ranking.php?mode=r18g\"},\n    {\"ç”·æ€§\": \"https://www.pixiv.net/novel/ranking.php?mode=male_r18\"},\n    {\"å¥³æ€§\": \"https://www.pixiv.net/novel/ranking.php?mode=female_r18\"}\n]\n\nlet generalRank = [\n    {\"ğŸ† æ’è¡Œæ¦œå• ğŸ†\": \"\"},\n    {\"ä»Šæ—¥\": \"https://www.pixiv.net/novel/ranking.php?mode=daily\"},\n    {\"æœ¬å‘¨\": \"https://www.pixiv.net/novel/ranking.php?mode=weekly\"},\n    {\"æœ¬æœˆ\": \"https://www.pixiv.net/novel/ranking.php?mode=monthly\"},\n    {\"ç”·æ€§\": \"https://www.pixiv.net/novel/ranking.php?mode=male\"},\n    {\"å¥³æ€§\": \"https://www.pixiv.net/novel/ranking.php?mode=female\"},\n    {\"æ–°äºº\": \"https://www.pixiv.net/novel/ranking.php?mode=rookie\"},\n    {\"åŸåˆ›\": \"https://www.pixiv.net/novel/ranking.php?mode=weekly_original\"},\n    {\"AIç”Ÿæˆ\": \"https://www.pixiv.net/novel/ranking.php?mode=weekly_ai\"}\n]\n\nlet r18Genre = [\n    {\"ğŸ”¥ åŸåˆ›çƒ­é—¨ ğŸ”¥\": \"\"},\n    {\"ç”·æ€§\": \"https://www.pixiv.net/ajax/genre/novel/male?mode=r18&lang=zh\"},\n    {\"å¥³æ€§\": \"https://www.pixiv.net/ajax/genre/novel/female?mode=r18&lang=zh\"},\n    {\"æ‹çˆ±\": \"https://www.pixiv.net/ajax/genre/novel/romance?mode=r18&lang=zh\"},\n    {\"å¼‚ä¸–ç•Œå¥‡å¹»\": \"https://www.pixiv.net/ajax/genre/novel/isekai_fantasy?mode=r18&lang=zh\"},\n    {\"ç°ä»£å¥‡å¹»\": \"https://www.pixiv.net/ajax/genre/novel/contemporary_fantasy?mode=r18&lang=zh\"},\n    {\"æ‚¬ç–‘\": \"https://www.pixiv.net/ajax/genre/novel/mystery?mode=r18&lang=zh\"},\n    {\"ææ€–\": \"https://www.pixiv.net/ajax/genre/novel/horror?mode=r18&lang=zh\"},\n    {\"ç§‘å¹»\": \"https://www.pixiv.net/ajax/genre/novel/sci-fi?mode=r18&lang=zh\"},\n    {\"æ–‡å­¦\": \"https://www.pixiv.net/ajax/genre/novel/literature?mode=r18&lang=zh\"},\n    {\"æƒ…æ„Ÿ\": \"https://www.pixiv.net/ajax/genre/novel/drama?mode=r18&lang=zh\"},\n    {\"å†å²\": \"https://www.pixiv.net/ajax/genre/novel/historical_pieces?mode=r18&lang=zh\"},\n    {\"è€½ç¾\": \"https://www.pixiv.net/ajax/genre/novel/bl?mode=r18&lang=zh\"},\n    {\"ç™¾åˆ\": \"https://www.pixiv.net/ajax/genre/novel/yuri?mode=r18&lang=zh\"},\n    {\"æ•£æ–‡Â·è¯—æ­Œ\": \"https://www.pixiv.net/ajax/genre/novel/poetry?mode=r18&lang=zh\"},\n    {\"éšç¬”Â·çºªå®\": \"https://www.pixiv.net/ajax/genre/novel/non-fiction??mode=r18&lang=zh\"},\n    {\"å‰§æœ¬\": \"https://www.pixiv.net/ajax/genre/novel/screenplays?mode=r18&lang=zh\"},\n    {\"è¯„è®º\": \"https://www.pixiv.net/ajax/genre/novel/reviews?mode=r18&lang=zh\"},\n    {\"å…¶ä»–\": \"https://www.pixiv.net/ajax/genre/novel/other?mode=r18&lang=zh\"}\n]\n\nlet generalGenre = [\n    {\"â¤ï¸â€ğŸ”¥ åŸåˆ›çƒ­é—¨ â¤ï¸â€ğŸ”¥\": \"\"},\n    {\"ç»¼åˆ\": \"https://www.pixiv.net/ajax/genre/novel/all?mode=safe&lang=zh\"},\n    {\"æ‹çˆ±\": \"https://www.pixiv.net/ajax/genre/novel/romance?mode=safe&lang=zh\"},\n    {\"å¼‚ä¸–ç•Œå¥‡å¹»\": \"https://www.pixiv.net/ajax/genre/novel/isekai_fantasy?mode=safe&lang=zh\"},\n    {\"ç°ä»£å¥‡å¹»\": \"https://www.pixiv.net/ajax/genre/novel/contemporary_fantasy?mode=safe&lang=zh\"},\n    {\"æ‚¬ç–‘\": \"https://www.pixiv.net/ajax/genre/novel/mystery?mode=safe&lang=zh\"},\n    {\"ææ€–\": \"https://www.pixiv.net/ajax/genre/novel/horror?mode=safe&lang=zh\"},\n    {\"ç§‘å¹»\": \"https://www.pixiv.net/ajax/genre/novel/sci-fi?mode=safe&lang=zh\"},\n    {\"æ–‡å­¦\": \"https://www.pixiv.net/ajax/genre/novel/literature?mode=safe&lang=zh\"},\n    {\"æƒ…æ„Ÿ\": \"https://www.pixiv.net/ajax/genre/novel/drama?mode=safe&lang=zh\"},\n    {\"å†å²\": \"https://www.pixiv.net/ajax/genre/novel/historical_pieces?mode=safe&lang=zh\"},\n    {\"è€½ç¾\": \"https://www.pixiv.net/ajax/genre/novel/bl?mode=safe&lang=zh\"},\n    {\"ç™¾åˆ\": \"https://www.pixiv.net/ajax/genre/novel/yuri?mode=safe&lang=zh\"},\n    {\"æ•£æ–‡Â·è¯—æ­Œ\": \"https://www.pixiv.net/ajax/genre/novel/poetry?mode=safe&lang=zh\"},\n    {\"éšç¬”Â·çºªå®\": \"https://www.pixiv.net/ajax/genre/novel/non-fiction??mode=safe&lang=zh\"},\n    {\"å‰§æœ¬\": \"https://www.pixiv.net/ajax/genre/novel/screenplays?mode=safe&lang=zh\"},\n    {\"è¯„è®º\": \"https://www.pixiv.net/ajax/genre/novel/reviews?mode=safe&lang=zh\"},\n    {\"å…¶ä»–\": \"https://www.pixiv.net/ajax/genre/novel/other?mode=safe&lang=zh\"}\n]\n\nlet source = [\n    {\"ğŸ“˜ ä¹¦æºç›¸å…³ ğŸ“˜\": \"\"},\n    {\"ğŸ  ä¸»é¡µ\": \"https://pixivsource.pages.dev\"},\n    {\"ğŸ”° æŒ‡å—\": \"https://pixivsource.pages.dev/Pixiv\"},\n    {\"ğŸ åé¦ˆ\": \"https://github.com/DowneyRem/PixivSource/issues\"},\n    {\"ğŸ’° æ‰“èµ\": \"https://pixivsource.pages.dev/Sponsor\"},\n]\n\nlet likeTagLinks = [{\"ğŸ“Œ å–œæ¬¢æ ‡ç­¾ ğŸ“Œ\":\"\"}]\nlet othersBookmarks = [{\"â¤ï¸ ä»–äººæ”¶è— â¤ï¸\": \"\"}]\n\nif (settings.SHOW_GENERAL) li = li.concat(normal)\nif (settings.SHOW_NEW_ADULT) li = li.concat(r18New)\nif (settings.SHOW_NEW_GENERAL) li = li.concat(generalNew)\nif (settings.SHOW_RANK_ADULT)li = li.concat(r18Rank)\nif (settings.SHOW_RANK_GENERAL) li = li.concat(generalRank)\nif (settings.SHOW_GENRE_ADULT) li = li.concat(r18Genre)\nif (settings.SHOW_GENRE_GENERAL) li = li.concat(generalGenre)\nsleepToast('ä½¿ç”¨æŒ‡å—ğŸ”–\\n\\nå‘ç° - æ›´æ–° - ç‚¹å‡»\"ğŸ”° ä½¿ç”¨æŒ‡å—\" - æŸ¥çœ‹')\n\n// æ”¶è—æ ‡ç­¾\nlet likeTags = getFromCacheObject(\"likeTags\")\nif (likeTags && likeTags.length >= 1) {\n    likeTags.forEach(tag => {\n        let tagLink = {}\n        tagLink[tag] = `${urlSearchNovel(tag, \"{{page}}\")}`\n        likeTagLinks.push(tagLink)\n    })\n    li = li.concat(likeTagLinks)\n}\n\n// ä»–äººæ”¶è—\nlet likeAuthors = getFromCacheMap(\"likeAuthors\")\nif (likeAuthors.size > 0) {\n    likeAuthors.forEach((authorName, authorId) => {\n        let bookmark = {}\n        bookmark[authorName] = urlUserBookmarks(authorId)\n        othersBookmarks.push(bookmark)\n    })\n    li = li.concat(othersBookmarks)\n}\n\n// ä¹¦æºç›¸å…³\nli = li.concat(source)\n\n// æ·»åŠ æ ¼å¼\nli.forEach(item => {\n    item.title = Object.keys(item)[0]\n    item.url = Object.values(item)[0]\n    if (item.url.includes(\"https://www.pixiv.net\")) item.url = urlIP(item.url)\n    delete item[Object.keys(item)[0]]\n    item.style = {}\n    item.style.layout_flexGrow = 1\n    item.style.layout_flexShrink = 1\n    item.style.layout_alignSelf = \"auto\"\n    item.style.layout_wrapBefore = \"false\"\n    if (item.url === \"\") {\n        item.style.layout_flexBasisPercent = 1\n    } else {\n        item.style.layout_flexBasisPercent = -1\n    }\n})\n\nJSON.stringify(li)",
        "header": "{\"Referer\":\"https://www.pixiv.net\"}",
        "jsLib": "var checkTimes = 0\nvar cacheSaveSeconds = 30*24*60*60  // é•¿æœŸç¼“å­˜ 30 å¤©\nvar cacheTempSeconds = 10*60*1000   // å†·å´æ—¶é—´ 10 åˆ†é’Ÿ\n\nfunction cacheGetAndSet(key, supplyFunc, requestUpdate) {\n    const {java, cache} = this\n    let timestamp = 0\n    let v = this.getFromCacheObject(key)\n    if (Array.isArray(v)) {\n        try {\n            timestamp = v[0].timestamp\n        } catch (e) {\n            timestamp = 0\n        }\n    } else if (v) {\n        timestamp = v.timestamp\n    }\n\n    const isExpired = v && (new Date().getTime() >= timestamp + cacheTempSeconds)\n    const isError = v && (v.error === true) && isExpired\n    requestUpdate = requestUpdate && isExpired\n\n    if (!v || requestUpdate || isError) {\n        v = supplyFunc()\n        let now = new Date().getTime()\n        // getAjaxJson getWebviewJson æ—¶é—´æˆ³å†™å…¥å¯¹è±¡æœ¬èº«\n        if (!Array.isArray(v)) {\n            v = Object.assign({timestamp: now}, v)\n        }\n        // else {\n        //     // getAjaxAllJson æ—¶é—´æˆ³å†™å…¥ç¬¬ä¸€ä¸ªå…ƒç´ ï¼ˆè¯»å–æ—¶ v[0].timestampï¼‰// ä¸é‡å¤å†™å…¥\n        //     if (v.length > 0) v[0] = Object.assign({timestamp: now}, v[0])\n        // }\n        this.putInCacheObject(key, v, cacheSaveSeconds)\n    }\n    return v\n}\n\nfunction putInCache(name, object, saveSeconds) {\n    const {java, cache} = this\n    if (saveSeconds === undefined) saveSeconds = 0\n    if (object) {\n        cache.put(name, object, saveSeconds)\n    }\n}\nfunction getFromCache(name) {\n    const {java, cache} = this\n    let object = cache.get(name)\n    if (object === undefined) return null  // å…¼å®¹æºé˜…\n    return object\n}\n\nfunction normalizeUrl(url) {\n    if (!url.startsWith(\"https://210.140\")) return url\n    return url.replace(\"210.140.139.155\", \"www.pixiv.net\")\n        .replace(\"210.140.139.133\", \"i.pximg.net\")\n        .split(\",\")[0]\n}\nfunction putInCacheObject(objectName, object, saveSeconds) {\n    const {java, cache} = this\n    if (object === undefined) object = null\n    if (saveSeconds === undefined) saveSeconds = 0\n    if (objectName === \"pixivSettings\") {\n        this._settings = object\n    }\n    cache.put(this.normalizeUrl(objectName), JSON.stringify(object), saveSeconds)\n}\nfunction getFromCacheObject(objectName) {\n    const {java, cache} = this\n    if (objectName === \"pixivSettings\" && this._settings) {\n        return this._settings\n    }\n    let object = cache.get(this.normalizeUrl(objectName))\n    if (object === undefined) return null  // å…¼å®¹æºé˜…ï¼Œé¿å… parse æŠ¥é”™\n    return JSON.parse(object)\n}\n\nfunction putInCacheMap(mapName, mapObject, saveSeconds) {\n    const {java, cache} = this\n    if (saveSeconds === undefined) saveSeconds = 0\n    let orderedArray = []\n    mapObject.forEach((value, key) => {\n        const item = {}\n        item[key] = value\n        orderedArray.push(item)\n    })\n    // [{'key1': 'value1'}, {'key2': 'value2'}]\n    cache.put(mapName, JSON.stringify(orderedArray), saveSeconds)\n}\nfunction getFromCacheMap(mapName) {\n    const {java, cache} = this\n    let cached = cache.get(mapName)\n    let newMap = new Map()\n    if (cached === null || cached === undefined) {\n        return newMap\n    }\n\n    let parsedData\n    try {\n        parsedData = JSON.parse(cached)\n    } catch (e) {\n        return newMap\n    }\n\n    if (Array.isArray(parsedData)) {\n        parsedData.forEach(item => {\n            for (let key in item) {\n                newMap.set(key, item[key])\n            }\n        })\n    } else {\n        for (let key in parsedData) {\n            newMap.set(key, parsedData[key])\n        }\n    }\n    return newMap\n}\n\nfunction isHtmlString(str) {\n    return str.startsWith(\"<!DOCTYPE html>\")\n}\nfunction isJsonString(str) {\n    try {\n        let result = JSON.parse(str)\n        return typeof result === \"object\" && result !== null\n    } catch(e) {\n        return false\n    }\n}\n\nfunction isLogin() {\n    const {java, cache} = this\n    return !!this.getFromCache(\"pixivCsrfToken\")\n}\n\nfunction getAjaxJson(url, requestUpdate) {\n    const {java, cache} = this\n    return this.cacheGetAndSet(url, () => {\n        return JSON.parse(java.ajax(url))\n    }, requestUpdate)\n}\nfunction getAjaxAllJson(urls, requestUpdate) {\n    const {java, cache} = this\n    let batchKey = JSON.stringify(urls)\n    return this.cacheGetAndSet(batchKey, () => {\n        let results = []\n        let now = new Date().getTime()\n        let responses = java.ajaxAll(urls)\n        for (let i in urls) {\n            let data = JSON.parse(responses[i].body())\n            data = Object.assign({timestamp: now}, data)\n            results.push(data)\n            this.putInCacheObject(urls[i], data, cacheSaveSeconds)\n        }\n        return results\n    }, requestUpdate)\n}\nfunction getAjaxParseJson(url, parseFunc, requestUpdate) {\n    const {java, cache} = this\n    return this.cacheGetAndSet(url, () => {\n        let resp = parseFunc(java.ajax(url))\n        if (resp instanceof Object) return resp\n        else return JSON.parse(resp)\n    }, requestUpdate)\n}\nfunction getWebviewJson(url, parseFunc, requestUpdate) {\n    const {java, cache} = this\n    return this.cacheGetAndSet(url, () => {\n        let html = java.webView(null, url, null)\n        return JSON.parse(parseFunc(html))\n    }, requestUpdate)\n}\n\nfunction getWebViewUA() {\n    const {java, cache} = this\n    let userAgent = this.getFromCache(\"userAgent\")\n    if (userAgent) return String(userAgent)\n\n    userAgent = String(java.getWebViewUA())\n    if (userAgent.includes(\"Windows NT 10.0; Win64; x64\")) {\n        userAgent = \"Mozilla/5.0 (Linux; Android 10; K) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/119.0.0.0 Mobile Safari/537.36\"\n    }\n    // java.log(`userAgent=${userAgent}`)\n    this.putInCache(\"userAgent\", userAgent, cacheSaveSeconds/7)\n    return String(userAgent)\n}\nfunction startBrowser(url, title) {\n    const {java, cache} = this\n    if (!title) title = url\n    let msg = \"\"\n    let headers = {}\n    headers[\"User-Agent\"] = this.getWebViewUA()\n\n    if (url.includes(\"https://www.pixiv.net\")) {\n        if (url.includes(\"settings\")) msg += \"âš™ï¸ è´¦å·è®¾ç½®\"\n        else msg += \"â¤´ï¸ åˆ†äº«å°è¯´\"\n        msg += \"\\n\\nå³å°†æ‰“å¼€ Pixiv\\nè¯·ç¡®è®¤å·²å¼€å¯ä»£ç†/æ¢¯å­/VPNç­‰\"\n    } else if (url.includes(\"github.com\") || url.includes(\"github.io\")) {\n        if (url.includes(\"issues\")) msg += \"ğŸ åé¦ˆé—®é¢˜\"\n        msg += \"\\n\\nå³å°†æ‰“å¼€ Github\\nè¯·ç¡®è®¤å·²å¼€å¯ä»£ç†/æ¢¯å­/VPNç­‰\"\n    }\n    this.sleepToast(msg, 0.01)\n    java.startBrowser(`${url}, ${JSON.stringify({headers: headers})}`, title)\n}\n\n// ç›´è¿åŠŸèƒ½å‚è€ƒè‡ª æ´›å¨…æ©™çš„é˜…è¯»ä»“åº“\n// https://github.com/Luoyacheng/yuedu\n// å…¶ç›´è¿åŠŸèƒ½å‚è€ƒè‡ª PixEz Flutter\n// https://github.com/Notsfsssf/pixez-flutter\nfunction urlIP(url) {\n    const {java, cache} = this\n    if (!this._settings) {\n        this._settings = this.getFromCacheObject(\"pixivSettings\") || this.setDefaultSettings()\n    }\n    if (this._settings.IPDirect) {\n        url = url.replace(\"http://\", \"https://\").replace(\"www.pixiv.net\", \"210.140.139.155\")\n        let headers = {\n            \"User-Agent\": \"Mozilla/5.0 (Linux; Android 14)\",\n            \"X-Requested-With\": \"XMLHttpRequest\",\n            \"Host\": \"www.pixiv.net\",\n            \"Referer\": \"https://www.pixiv.net/\",\n            \"X-csrf-token\": this.getFromCache(\"pixivCsrfToken\") || \"\",\n            \"Cookie\": this.getFromCache(\"pixivCookie\") || \"\"\n        }\n        return `${url}, ${JSON.stringify({headers: headers})}`\n    }\n    return url\n}\n\nfunction urlNovelUrl(novelId) {\n    return `https://www.pixiv.net/novel/show.php?id=${novelId}`\n}\nfunction urlNovelDetailed(novelId) {\n    return `https://www.pixiv.net/ajax/novel/${novelId}`\n}\nfunction urlNovelsDetailed(userId, nidList) {\n    return `https://www.pixiv.net/ajax/user/${userId}/novels?${nidList.map(v => `ids[]=${v}`).join(\"&\")}`\n}\nfunction urlNovelBookmarkData(novelId) {\n    return `https://www.pixiv.net/ajax/novel/${novelId}/bookmarkData`\n}\nfunction urlNovelComments(novelId, offset, limit) {\n    return `https://www.pixiv.net/ajax/novels/comments/roots?novel_id=${novelId}&offset=${offset}&limit=${limit}&lang=zh`\n}\nfunction urlNovelCommentsReply(commentId, page) {\n    return `https://www.pixiv.net/ajax/novels/comments/replies?comment_id=${commentId}&page=${page}&lang=zh`\n}\nfunction urlNovelsRecommendInit(novelId, limit) {\n    if (limit === undefined) limit = 9\n    return `https://www.pixiv.net/ajax/novel/${novelId}/recommend/init?limit=${limit}&lang=zh`\n}\nfunction urlNovelsRecommendDetailed(nidList) {\n    if (nidList.length >= 9) nidList.length = 9\n    return `https://www.pixiv.net/ajax/novel/recommend/novels?${nidList.map(v => `novelIds[]=${v}`).join(\"&\")}`\n}\n\nfunction urlSeriesUrl(seriesId) {\n    return `https://www.pixiv.net/novel/series/${seriesId}`\n}\nfunction urlSeriesDetailed(seriesId) {\n    return `https://www.pixiv.net/ajax/novel/series/${seriesId}?lang=zh`\n}\nfunction urlSeriesNovelsTitles(seriesId) {\n    return `https://www.pixiv.net/ajax/novel/series/${seriesId}/content_titles`\n}\nfunction urlSeriesNovels(seriesId, limit, offset) {\n    if (limit > 30) limit = 30\n    if (limit < 10) limit = 10\n    return `https://www.pixiv.net/ajax/novel/series_content/${seriesId}?limit=${limit}&last_order=${offset}&order_by=asc&lang=zh`\n}\n\nfunction urlUserUrl(userID) {\n    return `https://www.pixiv.net/users/${userID}/novels`\n}\nfunction urlUserDetailed(userID) {\n    return `https://www.pixiv.net/ajax/user/${userID}`\n}\nfunction urlUserWorkLatest(userID) {\n    return `https://www.pixiv.net/ajax/user/${userID}/works/latest`\n}\nfunction urlUserAllWorks(userId) {\n    return `https://www.pixiv.net/ajax/user/${userId}/profile/all?lang=zh`\n}\nfunction urlUserBookmarks(userId) {\n    return `https://www.pixiv.net/ajax/user/${userId}/novels/bookmarks?tag=&offset={{(page-1)*30}}&limit=30&rest=show&lang=zh`\n}\n\nfunction urlSearchNovel(novelName, page) {\n    return `https://www.pixiv.net/ajax/search/novels/${encodeURI(novelName)}?word=${encodeURI(novelName)}&order=date_d&mode=all&p=${page}&s_mode=s_tag&lang=zh`\n}\nfunction urlSearchSeries(seriesName, page) {\n    return`https://www.pixiv.net/ajax/search/novels/${encodeURI(seriesName)}?word=${encodeURI(seriesName)}&order=date_d&mode=all&p=${page}&s_mode=s_tag&gs=1&lang=zh`\n}\nfunction urlSearchUser(userName, page, full) {\n    let pageUrl = \"\", fullUrl = \"\"\n    if (full) fullUrl = \"_full\"\n    if (page && page >= 2) pageUrl = `&p=${page}`\n    return `https://www.pixiv.net/search/users?nick=${userName}&s_mode=s_usr${fullUrl}&i=1${pageUrl}`;\n}\n\n// ç›´è¿åŠŸèƒ½å‚è€ƒè‡ª æ´›å¨…æ©™çš„é˜…è¯»ä»“åº“\n// https://github.com/Luoyacheng/yuedu\n// å…¶ç›´è¿åŠŸèƒ½å‚è€ƒè‡ª PixEz Flutter\n// https://github.com/Notsfsssf/pixez-flutter\nfunction urlCoverUrl(url) {\n    const {java, cache} = this\n    if (url && !url.trim()) return \"\"\n    if (!this._settings) {\n        this._settings = this.getFromCacheObject(\"pixivSettings\") || this.setDefaultSettings()\n    }\n    if (!this._settings.IPDirect) return url\n\n    let headers = {\"Referer\": \"https://www.pixiv.net/\"}\n    if (url.trim()) {\n        if (url.includes(\"i.pximg.net\")) {\n            url = url.replace(\"https://i.pximg.net\", \"https://210.140.139.133\")\n            headers.host = \"i.pximg.net\"\n        } else {\n            url = url.replace(\"https://s.pximg.net\", \"https://210.140.139.133\")\n            headers.host = \"s.pximg.net\"\n        }\n    }\n    return `${url}, ${JSON.stringify({headers: headers})}`\n}\nfunction urlIllustUrl(illustId) {\n    return `https://www.pixiv.net/artworks/${illustId}`\n}\nfunction urlIllustDetailed(illustId) {\n    return `https://www.pixiv.net/ajax/illust/${illustId}?lang=zh`\n}\nfunction urlIllustOriginal(illustId, order) {\n    const {java, cache} = this\n    if (!order || order <= 1) order = 1\n    let illustOriginal = \"\"\n\n    let resp = this.getAjaxJson(this.urlIP(urlIllustDetailed(illustId)))\n    try {\n        illustOriginal = resp.body.urls.original\n    } catch (e) {\n        try {\n            let illustThumb = resp.body.userIllusts[illustId].url\n            let date = illustThumb.match(\"\\\\d{4}\\\\/\\\\d{2}\\\\/\\\\d{2}\\\\/\\\\d{2}\\\\/\\\\d{2}\\\\/\\\\d{2}\")[0]\n            illustOriginal = `https://i.pximg.net/img-master/img/${date}/${illustId}_p0_master1200.jpg`\n        } catch (e) {}\n    }\n\n    if (illustOriginal.split(\",\")[0] === \"\") return \"\"\n    return this.urlCoverUrl(illustOriginal.replace(`_p0`, `_p${order - 1}`))\n}\nfunction urlEmojiUrl(emojiId) {\n    return `https://s.pximg.net/common/images/emoji/${emojiId}.png, {'style': 'text'}`\n}\nfunction urlStampUrl(stampId) {\n    return `https://s.pximg.net/common/images/stamp/generated-stamps/${stampId}_s.jpg, {'style': 'text'}`\n}\n\nfunction urlMessageThreadLatest(max) {\n    if (max === undefined || max <= 5) max = 5\n    return `https://www.pixiv.net/rpc/index.php?mode=latest_message_threads2&num=${max}&lang=zh`\n}\nfunction urlMessageThreadContents(threadId, max) {\n    return `https://www.pixiv.net/rpc/index.php?mode=message_thread_contents&thread_id=${threadId}&num=${max}`\n}\nfunction urlMessageThreadDetail(threadId) {\n    return `https://www.pixiv.net/rpc/index.php?mode=message_thread&thread_id=${threadId}`\n}\nfunction urlNotification() {\n    return `https://www.pixiv.net/ajax/notification?lang=zh`\n}\n\nfunction addZero(num) {\n    return String(num).padStart(2, '0')\n}\nfunction dateFormat(str) {\n    let time = new Date(str);\n    let Y = time.getFullYear() + \"å¹´\";\n    let M = this.addZero(time.getMonth() + 1) + \"æœˆ\";\n    let D = this.addZero(time.getDate()) + \"æ—¥\";\n    return Y + M + D;\n}\nfunction timeFormat(str) {\n    let time = new Date(str);\n    let YY = time.getFullYear()\n    let MM = this.addZero(time.getMonth() + 1)\n    let DD = this.addZero(time.getDate())\n    let hh = this.addZero(time.getHours())\n    let mm = this.addZero(time.getMinutes())\n    let ss = this.addZero(time.getSeconds())\n    return `${YY}-${MM}-${DD} ${hh}:${mm}:${ss}`\n}\nfunction timeTextFormat(text) {\n    return `${text.slice(0, 10)} ${text.slice(11, 19)}`\n}\n\nfunction sleep(seconds) {\n    return Packages.java.lang.Thread.sleep(1000*seconds)\n}\nfunction sleepToast(text, seconds) {\n    let {java} = this\n    java.log(text)\n    java.longToast(text)\n    if (seconds === undefined) {seconds = 0.01}\n    this.sleep(seconds)\n}\n\nfunction setDefaultSettings() {\n    const {java, cache} = this\n    let settings = {}\n    settings.SEARCH_AUTHOR = false      // æœç´¢ï¼šé»˜è®¤ä¸æœç´¢ä½œè€…åç§°\n    settings.CONVERT_CHINESE = true     // æœç´¢ï¼šæœç´¢æ—¶è¿›è¡Œç¹ç®€è½¬æ¢\n    settings.HIDE_LIKE_NOVELS = false   // æœç´¢ï¼šæœç´¢ç»“æœ éšè—æ”¶è—å°è¯´\n    settings.HIDE_WATCHED_SERIES = false// æœç´¢ï¼šæœç´¢ç»“æœ éšè—è¿½æ•´ç³»åˆ—\n\n    settings.MORE_INFORMATION = false   // è¯¦æƒ…ï¼šä¹¦ç±ç®€ä»‹æ˜¾ç¤ºæ›´å¤šä¿¡æ¯\n    settings.SHOW_UPDATE_TIME = true    // ç›®å½•ï¼šæ˜¾ç¤ºæ›´æ–°æ—¶é—´ï¼Œä½†ä¼šå¢åŠ å°‘è®¸è¯·æ±‚\n    settings.SHOW_ORIGINAL_LINK = true  // ç›®å½•ï¼šæ˜¾ç¤ºåŸå§‹é“¾æ¥ï¼Œä½†ä¼šå¢åŠ å¤§é‡è¯·æ±‚\n\n    settings.REPLACE_TITLE_MARKS = true // æ­£æ–‡ï¼šæ³¨éŸ³å†…å®¹ä¸ºæ±‰å­—æ—¶ï¼Œæ›¿æ¢ä¸ºä¹¦åå·\n    settings.SHOW_CAPTIONS = true       // æ­£æ–‡ï¼šç« é¦–æ˜¾ç¤ºæè¿°\n    settings.SHOW_COMMENTS = true       // æ­£æ–‡ï¼šç« å°¾æ˜¾ç¤ºè¯„è®ºï¼Œä½†ä¼šå¢åŠ å¤§é‡è¯·æ±‚\n\n    settings.IPDirect = false           // å…¨å±€ï¼šç›´è¿æ¨¡å¼\n    settings.FAST  = false              // å…¨å±€ï¼šå¿«é€Ÿæ¨¡å¼\n    settings.DEBUG = false              // å…¨å±€ï¼šè°ƒè¯•æ¨¡å¼\n\n    settings.SHOW_GENERAL = true        // å‘ç°ï¼šæ˜¾ç¤º å¸¸è§„å°è¯´\n    settings.SHOW_NEW_ADULT = true      // å‘ç°ï¼šæ˜¾ç¤º æœ€æ–°ä¼åˆ’çº¦ç¨¿ R18\n    settings.SHOW_NEW_GENERAL = false   // å‘ç°ï¼šæ˜¾ç¤º æœ€æ–°ä¼åˆ’çº¦ç¨¿ å¸¸è§„\n    settings.SHOW_RANK_ADULT = true     // å‘ç°ï¼šæ˜¾ç¤º æ’è¡Œæ¦œå• R18\n    settings.SHOW_RANK_GENERAL = false  // å‘ç°ï¼šæ˜¾ç¤º æ’è¡Œæ¦œå• å¸¸è§„\n    settings.SHOW_GENRE_ADULT = false   // å‘ç°ï¼šæ˜¾ç¤º åŸåˆ›çƒ­é—¨ R18\n    settings.SHOW_GENRE_GENERAL = false // å‘ç°ï¼šæ˜¾ç¤º åŸåˆ›çƒ­é—¨ å¸¸è§„\n    settings.SHOW_FURRY = false         // å‘ç°ï¼šæ˜¾ç¤º å…½äººå°è¯´æ¨èä½œè€…\n\n    settings.SHOW_SETTINGS = true       // è®¾ç½®ï¼šæ˜¾ç¤º ä¹¦æºè®¾ç½®\n    settings.SHOW_DISCOVER = true       // è®¾ç½®ï¼šæ˜¾ç¤º å‘ç°è®¾ç½®\n    settings.SHOW_SETTINGS2 = false     // è®¾ç½®ï¼šæ˜¾ç¤º ä¹¦æºè®¾ç½®\n    settings.SHOW_DISCOVER2 = false     // è®¾ç½®ï¼šæ˜¾ç¤º å‘ç°è®¾ç½®\n    this.putInCacheObject(\"pixivSettings\", settings)\n    return settings\n}\nfunction checkSettings(settings) {\n    const {java, cache} = this\n    if (!settings) settings = this.getFromCacheObject(\"pixivSettings\")\n    if (!settings) settings = this.setDefaultSettings()\n    if (settings.FAST || settings.IPDirect) {\n        settings.SEARCH_AUTHOR = false        // æœç´¢ï¼šé»˜è®¤ä¸æœç´¢ä½œè€…åç§°\n        settings.SHOW_ORIGINAL_LINK = false   // ç›®å½•ï¼šæ˜¾ç¤ºç« èŠ‚æºé“¾æ¥\n    }\n    if (!settings.FAST && !settings.IPDirect) {\n        // settings.SEARCH_AUTHOR = true         // æœç´¢ï¼šé»˜è®¤ä¸æœç´¢ä½œè€…åç§°\n        settings.SHOW_ORIGINAL_LINK = true    // ç›®å½•ï¼šæ˜¾ç¤ºç« èŠ‚æºé“¾æ¥\n    }\n\n    if (settings.FAST) {\n        settings.SEARCH_AUTHOR = false        // æœç´¢ï¼šé»˜è®¤ä¸æœç´¢ä½œè€…åç§°\n        settings.CONVERT_CHINESE = false      // æœç´¢ï¼šç¹ç®€é€šæœ\n        settings.SHOW_UPDATE_TIME = false     // ç›®å½•ï¼šæ˜¾ç¤ºç« èŠ‚æ›´æ–°æ—¶é—´\n        settings.SHOW_COMMENTS = false        // æ­£æ–‡ï¼šæ˜¾ç¤ºè¯„è®º\n    }\n    this.putInCacheObject(\"pixivSettings\", settings)\n    return settings\n}\n\nfunction updateSource() {\n    const {java, source} = this\n    java.longToast(\"ğŸ†™ æ›´æ–°ä¹¦æº\\n\\nJsdelivr CDN æ›´æ–°æœ‰å»¶è¿Ÿ\\nGithub æ›´æ–°éœ€ä»£ç†\")\n    let onlineSource, comment, sourceName, sourceNameCapitalize, index = 0\n    if (source.bookSourceUrl.includes(\"pixiv\")) sourceName = \"pixiv\"\n    else if (source.bookSourceUrl.includes(\"furrynovel\")) sourceName = \"linpx\"\n    sourceNameCapitalize = sourceName[0].toUpperCase() + sourceName.substring(1)\n\n    if (source.bookSourceName.includes(\"å¤‡ç”¨\")) index = 1\n    else if (source.bookSourceName.includes(\"æ¼«ç”»\")) index = 2\n    if (source.bookSourceUrl.includes(\"furrynovel.com\")) {\n        sourceNameCapitalize = \"FurryNovel\"\n        index = 1\n    }\n\n    try {\n        let updateUrl = `https://cdn.jsdelivr.net/gh/DowneyRem/PixivSource@main/${sourceName}.json`\n        onlineSource = JSON.parse(java.get(updateUrl,{'User-Agent': 'Mozilla/5.0 (Linux; Android 14)','X-Requested-With': 'XMLHttpRequest'}).body())[index]\n    } catch (e) {\n        try {\n            let updateUrl = `https://raw.githubusercontent.com/DowneyRem/PixivSource/main/${sourceName}.json`\n            onlineSource = JSON.parse(java.get(updateUrl,{'User-Agent': 'Mozilla/5.0 (Linux; Android 14)','X-Requested-With': 'XMLHttpRequest'}).body())[index]\n        } catch (e) {\n            onlineSource = {lastUpdateTime: new Date().getTime(), bookSourceComment: source.bookSourceComment}\n        }\n    }\n    comment = onlineSource.bookSourceComment.split(\"\\n\")\n    // onlineSource = source\n    // comment = source.bookSourceComment.split(\"\\n\")\n\n    let htm = `\n<!DOCTYPE html>\n<html lang=\"zh-CN\">\n<head>\n    <meta charset=\"UTF-8\">\n    <meta name=\"viewport\" content=\"width=device-width, initial-scale=1.0\">\n    <title>æ›´æ–° ${source.bookSourceName} ä¹¦æº</title>\n    <style> \n    table { text-align: center; margin: 0 auto; } .ann { display: flex; justify-content: center; align-items: center; height: 5vh; } \n    button { background-color: rgb(76, 175, 80); color: white; border: none; border-radius: 4px; height: 6vh; width: 30vw; overflow: hidden; } \n    button span { cursor: pointer; display: inline-block; position: relative; transition: 0.4s; } \n    button span:after { content: '>'; position: absolute; opacity: 0; top: 0; right: 30px; transition: 0.2s; } \n    button:active span { padding-right: 20px; } \n    button:active span:after { opacity: 1; right: -40px; }\n    </style>\n</head>\n\n<body>\n    <table border=\"1\" cellspacing=\"0\">\n        <th colspan=\"2\"> ${source.bookSourceName} ä¹¦æº \n        <a href=\"https://pixivsource.pages.dev/${sourceNameCapitalize}\">ğŸ”° ä½¿ç”¨æŒ‡å—</a>\n        || <a href=\"https://pixivsource.pages.dev/Sponsor\">â¤ï¸ èµåŠ©å¼€å‘</a>\n        </th>\n        <tr>\n            <td>â˜ï¸ è¿œç¨‹ç‰ˆæœ¬ï¼š${onlineSource.bookSourceComment.split(\"\\n\")[2].replace(\"ä¹¦æºç‰ˆæœ¬ï¼š\", \"\")}</td>\n            <td>ğŸ“† æ›´æ–°ï¼š${timeFormat(onlineSource.lastUpdateTime)}</td>\n        </tr>\n        <tr>\n            <td>ğŸ“¥ æœ¬åœ°ç‰ˆæœ¬ï¼š${source.bookSourceComment.split(\"\\n\")[2].replace(\"ä¹¦æºç‰ˆæœ¬ï¼š\", \"\")}</td>\n            <td>ğŸ“† æ›´æ–°ï¼š${timeFormat(source.lastUpdateTime)}</td>\n        </tr> \n        <tr><td colspan=\"2\" style=\"text-align: left;\">${comment.slice(3, 10).join(\"<br>\")}</td></tr>\n        <tr><td colspan=\"2\" style=\"text-align: left;\">${comment.slice(comment.length-20, comment.length).join(\"<br>\")}</td></tr>\n    </table>\n    \n    <table border=\"0\" cellspacing=\"20\">\n        <th colspan=\"2\"> æ›´æ–° ${source.bookSourceName} ä¹¦æº </th>\n        <tr><td><div class=\"ann\">\n            <a href=\"legado://import/importonline?src=https://cdn.jsdelivr.net/gh/DowneyRem/PixivSource@main/${sourceName}.json\">\n            <button><span>æ›´æ–°ä¹¦æº<br>(Jsdelivr CDN)</span></button>\n            </a></div></td>\n            \n            <td><div class=\"ann\">\n            <a href=\"legado://import/importonline?src=https://cdn.jsdelivr.net/gh/DowneyRem/PixivSource@main/btsrk.json\">\n            <button><span>æ›´æ–°è®¢é˜…<br>(Jsdelivr CDN)</span></button>\n            </a></div></td>\n        </tr>\n        \n        <tr><td><div class=\"ann\">\n            <a href=\"legado://import/importonline?src=https://raw.githubusercontent.com/DowneyRem/PixivSource/main/${sourceName}.json\">\n            <button><span>ä¹¦æºé“¾æ¥<br>(GitHub)</span></button>\n            </a></div></td>\n            \n            <td><div class=\"ann\">\n            <a href=\"legado://import/importonline?src=https://raw.githubusercontent.com/DowneyRem/PixivSource/main/btsrk.json\">\n            <button><span>è®¢é˜…é“¾æ¥<br>(GitHub)</span></button>\n            </a></div></td>\n        </tr>\n        \n        <tr><td><div class=\"ann\">\n            <a href=\"legado://import/importonline?src=https://codeberg.org/DowneyRem/PixivSource/raw/branch/main/${sourceName}.json\">\n            <button><span>å¤‡ç”¨ä¹¦æºé“¾æ¥<br>(Codeberg)</span></button>\n            </a></div></td>\n            \n            <td><div class=\"ann\">\n            <a href=\"legado://import/importonline?src=https://codeberg.org/DowneyRem/PixivSource/raw/branch/main/btsrk.json\">\n            <button><span>å¤‡ç”¨è®¢é˜…é“¾æ¥<br>(Codeberg)</span></button>\n            </a></div></td>\n        </tr>\n    </table>\n</body>\n</html>`\n    java.startBrowser(`data:text/html;charset=utf-8;base64, ${java.base64Encode(htm)}`, 'æ›´æ–°ä¹¦æº')\n    return []\n}\n\nfunction profile(funcName, func) {\n    return function() {\n        var start = Packages.java.lang.System.currentTimeMillis()\n        try {\n            return func.apply(this, arguments)\n        } finally {\n            const {java, cache} = this\n            var end = Packages.java.lang.System.currentTimeMillis()\n            var duration = end - start\n            if (duration >= 5) {\n                java.log(\"â±ï¸ [\" + funcName + \"] è€—æ—¶: \" + duration + \"ms\")\n            }\n        }\n    }\n}\n\n// cacheGetAndSet = profile(\"cacheGetAndSet\", cacheGetAndSet)\n// getAjaxJson = profile(\"getAjaxJson\", getAjaxJson)\n// getAjaxAllJson = profile(\"getAjaxAllJson\", getAjaxAllJson)\n// getWebviewJson = profile(\"getWebviewJson\", getWebviewJson)\n//\n// putInCacheObject = profile(\"putInCacheObject\", putInCacheObject)\n// getFromCacheObject = profile(\"getFromCacheObject\", getFromCacheObject)\n// putInCache = profile(\"putInCache\", putInCache)\n// getFromCache = profile(\"getFromCache\", getFromCache)\n// putInCacheMap= profile(\"putInCacheMap\", putInCacheMap)\n// getFromCacheMap = profile(\"getFromCacheMap\", getFromCacheMap)\n//\n// urlIP = profile(\"urlIP\", urlIP)\n// urlCoverUrl = profile(\"urlCoverUrl\", urlCoverUrl)\n// urlIllustOriginal = profile(\"urlIllustOriginal\", urlIllustOriginal)\n//\n// urlSearchNovel = profile(\"urlSearchNovel\", urlSearchNovel)\n// urlSearchUser = profile(\"urlSearchUser\", urlSearchUser)\n//\n// checkSettings = profile(\"checkSettings\", checkSettings)\n// getWebViewUA = profile(\"getWebViewUA\", getWebViewUA)",
        "lastUpdateTime": 1771689600251,
        "loginCheckJs": "var util = {}\n\nfunction objStringify(obj) {\n    return JSON.stringify(obj, (n, v) => {\n        if (typeof v == \"function\")\n            return v.toString();\n        return v;\n    });\n}\n\n// æ£€æµ‹ æºé˜…\n// å¯ç”¨ java.ajax() ä¸å¯ç”¨ java.webview() java.ajaxAll()\n// å¯ç”¨ java.getCookie() cache.put() cache.get() é»˜è®¤å€¼ä¸º undefined\n// å¯ç”¨ java.startBrowser() ä¸å¯ç”¨ java.startBrowserAwaitAwait\n// å¯ç”¨ source.bookSourceName source.getVariable() source.setVariable()ç­‰\n// java.getUserAgent() java.getWebViewUA() ç›®å‰è¿”å›å†…å®¹ç›¸åŒ\nfunction isSourceRead() {\n    return java.getUserAgent() === java.getWebViewUA()\n}\n// æ­£å¼ç‰ˆ ä¸æ”¯æŒåœ¨ JSlib çš„å‡½æ•°ç›´æ¥è®¾ç½®é»˜è®¤å‚æ•°\n// æ­£å¼ç‰ˆ ä¸æ”¯æŒ a?.b çš„å†™æ³•\n// æ£€æµ‹ é˜…è¯» æ­£å¼ç‰ˆ ä¸ Beta ç‰ˆæœ¬\nfunction isLegadoOfficial() {\n    let isLegadoOfficialStatus\n    try {\n        eval('({})?.value')\n        isLegadoOfficialStatus = false\n    } catch (e) {\n        isLegadoOfficialStatus = true\n    }\n    return isLegadoOfficialStatus\n}\n// æ£€æµ‹ é˜…è¯» Beta ç‰ˆæœ¬ ä¸ LYC ç‰ˆæœ¬\n// LYC ç‰ˆæœ¬æ–°å¢å‡½æ•°\n// java.ajaxTestAll()\n// java.openVideoPlayer(url: String, title: String, float: Boolean)\n// cookie.setWebCookie(url,cookie)\n// source.refreshExplore()\n// source.refreshJSLib()\nfunction isLegadoSigma() {\n    return typeof java.ajaxTestAll === \"function\"\n}\n\nfunction publicFunc() {\n    let u = {}, settings = {}\n\n    let isFirstInit = false;\n    if (!globalThis.ALREADY_LOGGED_INFO) {\n        globalThis.ALREADY_LOGGED_INFO = true\n        isFirstInit = true\n    }\n\n    if (!globalThis.settings) {\n        // cache.delete(\"pixivSettings\")\n        settings = getFromCacheObject(\"pixivSettings\")\n        if (!settings) settings = setDefaultSettings()\n        globalThis.settings = checkSettings(settings)\n    }\n    // ç¯å¢ƒä¿¡æ¯ä¸ä¼šæ”¹å˜ï¼Œå¯ä»¥ä½¿ç”¨ globalThis.environment\n    if (!globalThis.environment) {\n        globalThis.environment = {}\n        globalThis.environment.IS_SOURCEREAD = isSourceRead()\n        globalThis.environment.IS_LEGADO = !isSourceRead()\n        globalThis.environment.IS_LEGADO_OFFICIAL = isLegadoOfficial()\n        globalThis.environment.IS_LEGADO_SIGMA = isLegadoSigma()\n    }\n\n    // åªæœ‰ç¬¬ä¸€æ¬¡åˆå§‹åŒ–æ—¶æ‰è¾“å‡ºæ—¥å¿—\n    if (isFirstInit) {\n        java.log(`${source.bookSourceComment.split(\"\\n\")[0]}`)\n        java.log(`ğŸ“Œ ${source.bookSourceComment.split(\"\\n\")[2]}`)\n        java.log(`ğŸ“† æ›´æ–°æ—¶é—´ï¼š${java.timeFormat(source.lastUpdateTime)}`)\n\n        if (globalThis.environment.IS_SOURCEREAD) {\n            java.log(\"ğŸ“± è½¯ä»¶å¹³å°ï¼šğŸ æºé˜… SourceRead\")\n        } else if (globalThis.environment.IS_LEGADO_SIGMA) {\n            java.log(\"ğŸ“± è½¯ä»¶å¹³å°ï¼šğŸ¤– é˜…è¯» Betaã€æ–°åŒ…åã€‘/ é˜…è¯» Plus\")\n        } else if (globalThis.environment.IS_LEGADO_OFFICIAL) {\n            java.log(\"ğŸ“± è½¯ä»¶å¹³å°ï¼šğŸ¤– é˜…è¯» æ­£å¼ç‰ˆ\")\n            sleepToast(\"\\nâš ï¸å½“å‰è½¯ä»¶ä¸ºï¼šé˜…è¯»ã€æ­£å¼ç‰ˆã€‘\\nã€æ­£å¼ç‰ˆã€‘å·²å¹´ä¹…å¤±ä¿®ï¼Œä¸æ¨èç»§ç»­ä½¿ç”¨\\n\\nä¸ºäº†æ›´å¥½çš„ä½¿ç”¨ä½“éªŒï¼Œè¯·ç”¨ï¼š\\nã€é˜…è¯» Plusã€‘æˆ–ã€é˜…è¯» Beta æ–°åŒ…åã€‘\\n\\nå³å°†ä¸ºæ‚¨æ‰“å¼€ã€é˜…è¯» Plusã€‘ä¸‹è½½ç•Œé¢\")\n            sleep(3);\n            startBrowser(\"https://loyc.xyz/c/legado.html#download\", \"ä¸‹è½½é˜…è¯» Plus\")\n        } else {\n            java.log(\"ğŸ“± è½¯ä»¶å¹³å°ï¼šğŸ¤– é˜…è¯» Betaã€åŸåŒ…åã€‘\")\n            sleepToast(\"\\nâš ï¸å½“å‰è½¯ä»¶ä¸ºï¼šé˜…è¯» Betaã€åŸåŒ…åã€‘\\n\\nä¸ºäº†æ›´å¥½çš„ä½¿ç”¨ä½“éªŒï¼Œè¯·ç”¨ï¼š\\nã€é˜…è¯» Plusã€‘æˆ–ã€é˜…è¯» Beta æ–°åŒ…åã€‘\\n\\nå³å°†ä¸ºæ‚¨æ‰“å¼€ã€é˜…è¯» Plusã€‘ä¸‹è½½ç•Œé¢\")\n            sleep(3);\n            startBrowser(\"https://loyc.xyz/c/legado.html#download\", \"ä¸‹è½½é˜…è¯» Plus\")\n            }\n\n        if (globalThis.settings.IPDirect) {\n            java.log(\"âœˆï¸ ç›´è¿æ¨¡å¼ï¼šâœ… å·²å¼€å¯\")\n        } else {\n            java.log(\"âœˆï¸ ç›´è¿æ¨¡å¼ï¼šâŒ å·²å…³é—­\")\n        }\n    }\n\n    // ä½¿ç”¨ globalThis.settings æ— æ³•è·å–æœ€æ–°çš„è®¾ç½®\n    // ä½¿ç”¨ globalThis.environment å¯èƒ½æ— æ³•å†™å…¥ environment\n    // cache.delete(\"pixivSettings\")\n    settings = getFromCacheObject(\"pixivSettings\")\n    if (!settings) settings = setDefaultSettings()\n    u.settings = checkSettings(settings)\n    putInCacheObject(\"pixivEnvironment\", globalThis.environment)\n\n    u.debugFunc = (func) => {\n        if (util.settings.DEBUG === true) {\n            func()\n        }\n    }\n\n    u.checkStatus = function(status) {\n        if (status === true) return \"âœ… å·²\"\n        else if (status === false) return \"âŒ æœª\"\n        else if (status === undefined) return \"ğŸˆšï¸ æ— æ•°æ®ï¼š\"\n    }\n\n    u.login = function() {\n        let resp = java.startBrowserAwait(`https://accounts.pixiv.net/login,\n    {\"headers\": {\"User-Agent\": \"${java.getWebViewUA()}\"}}`, 'ç™»å½•è´¦å·', false)\n        if (resp.code() === 200) {\n            this.getCsrfToken(); this.getCookie()\n        } else {\n            java.log(resp.code()); sleepToast(\"âš ï¸ ç™»å½•å¤±è´¥\")\n        }\n    }\n\n    u.logout = function() {\n        this.removeCookie()\n        java.startBrowser(\"https://www.pixiv.net/logout.php\", \"é€€å‡ºè´¦å·\")\n        this.removeCookie()\n        sleepToast(`âœ… å·²é€€å‡ºå½“å‰è´¦å·\\n\\né€€å‡ºåè¯·ç‚¹å‡»å³ä¸Šè§’çš„ âœ”ï¸ é€€å‡º\\n\\nç™»å½•è¯·ç‚¹å‡»ã€ç™»å½•è´¦å·ã€‘è¿›è¡Œç™»å½•`)\n    }\n\n    u.getCookie = function() {\n        let pixivCookie = String(java.getCookie(\"https://www.pixiv.net/\", null))\n        if (isLogin()) putInCache(\"pixivCookie\", pixivCookie, 60*60)  // ç¼“å­˜1h\n    }\n\n    u.removeCookie = function() {\n        cookie.removeCookie('https://www.pixiv.net')\n        cookie.removeCookie('https://accounts.pixiv.net')\n        cookie.removeCookie('https://accounts.google.com')\n        cookie.removeCookie('https://api.weibo.com')\n        cache.delete(\"pixivCookie\")\n        cache.delete(\"pixiv:uid\")\n        cache.delete(\"pixivCsrfToken\")  // ä¸ç™»å½•è®¾å¤‡æœ‰å…³\n        cache.delete(\"headers\")\n    }\n\n    // è·å– Csrf Tokenï¼Œä»¥ä¾¿è¿›è¡Œæ”¶è—ç­‰è¯·æ±‚\n    // è·å–æ–¹æ³•æ¥è‡ªè„šæœ¬ Pixiv Previewer\n    // https://github.com/Ocrosoft/PixivPreviewer\n    // https://greasyfork.org/zh-CN/scripts/30766-pixiv-previewer/code\n    u.getCsrfToken = function() {\n        let pixivCsrfToken = getFromCache(\"pixivCsrfToken\")\n        if (!pixivCsrfToken) {\n            let html = java.webView(null, \"https://www.pixiv.net/\", null)\n            try {\n                pixivCsrfToken = html.match(/token\\\\\":\\\\\"([a-z0-9]{32})/)[1]\n                putInCache(\"pixivCsrfToken\", pixivCsrfToken)  // ä¸ç™»å½•è®¾å¤‡æœ‰å…³ï¼Œæ— æ³•å­˜å‚¨ nul\n            } catch (e) {\n                pixivCsrfToken = null\n                cache.delete(\"pixivCsrfToken\")  // ä¸ç™»å½•è®¾å¤‡æœ‰å…³ï¼Œæ— æ³•å­˜å‚¨ nul\n                // sleepToast(\"âš ï¸ æœªç™»å½•è´¦å·(pixivCsrfToken)\")\n            }\n            java.log(`pixivCsrfToken:\\n${pixivCsrfToken}`)\n        }\n        return pixivCsrfToken\n    }\n\n    // å°†å¤šä¸ªé•¿ç¯‡å°è¯´è§£æä¸ºä¸€æœ¬ä¹¦\n    u.combineNovels = function(novels) {\n        return novels.filter(novel => {\n            // å•æœ¬ç›´æ¥è§£æä¸ºä¸€æœ¬ä¹¦\n            if (novel.seriesId === undefined || novel.seriesId === null) {\n                return true\n            }\n            // é›†åˆä¸­æ²¡æœ‰è¯¥ç³»åˆ—è§£æä¸ºä¸€æœ¬ä¹¦\n            if (!seriesSet.has(novel.seriesId)) {\n                seriesSet.add(novel.seriesId)\n                return true\n            }\n            return false\n        })\n    }\n\n    // å±è”½ä½œè€…\n    u.authorFilter = function(novels) {\n        let authors = getFromCacheObject(\"blockAuthorList\")\n        if (Array.isArray(authors) && authors.length >= 0) {\n            java.log(`ğŸš« å±è”½ä½œè€…IDï¼š${JSON.stringify(authors)}`)\n            authors.forEach(author => {\n                novels = novels.filter(novel => {\n                    novel.userId !== String(author)\n                })\n            })\n        }\n        return novels\n    }\n\n\n    // è¿‡æ»¤æ”¶è—ä¸è¿½æ›´\n    u.novelFilter = function(novels) {\n        let novels1 = [], novels2 = [], msg\n        let likeNovels = getFromCacheObject(\"likeNovels\")\n        let watchedSeries = getFromCacheObject(\"watchedSeries\")\n        let novels0 = novels.map(novel => novel.id)\n\n        java.log(`${util.checkStatus(!util.settings.HIDE_LIKE_NOVELS)}æ˜¾ç¤ºæ”¶è—å°è¯´`)\n        if (util.settings.HIDE_LIKE_NOVELS) {\n            novels = novels.filter(novel => !likeNovels.includes(Number(novel.id)))\n            novels1 = novels.map(novel => novel.id)\n            java.log(`â¬ è¿‡æ»¤æ”¶è—ï¼šè¿‡æ»¤å‰${novels0.length}ï¼›è¿‡æ»¤å${novels1.length}`)\n        }\n\n        java.log(`${util.checkStatus(!util.settings.HIDE_WATCHED_SERIES)}æ˜¾ç¤ºè¿½æ›´ç³»åˆ—`)\n        if (util.settings.HIDE_WATCHED_SERIES) {\n            novels = novels.filter(novel => !watchedSeries.includes(Number(novel.seriesId)))\n            novels2 = novels.map(novel => novel.id)\n            if (novels1.length >= 1) novels0 = novels1\n            java.log(`â¬ è¿‡æ»¤è¿½æ›´ï¼šè¿‡æ»¤å‰${novels0.length}ï¼›è¿‡æ»¤å${novels2.length}`)\n        }\n\n        let novels3 = novels.map(novel => novel.id)\n        if (novels0.length >= 1 && novels3.length === 0) {\n            let msg = `â¬ è¿‡æ»¤å°è¯´\\nâš ï¸ è¿‡æ»¤åæ— ç»“æœ\\n\\nè¯·æ ¹æ®éœ€è¦\\n`\n            if (util.settings.HIDE_LIKE_NOVELS) msg += \"å¼€å¯æ˜¾ç¤ºæ”¶è—å°è¯´\\n\"\n            if (util.settings.HIDE_WATCHED_SERIES) msg += \"å¼€å¯æ˜¾ç¤ºè¿½æ›´ç³»åˆ—\"\n            sleepToast(msg, 1)\n        }\n\n        util.debugFunc(() => {\n            // java.log(JSON.stringify(novels0))\n            java.log(JSON.stringify(novels0.length))\n            // java.log(JSON.stringify(novels1))\n            java.log(JSON.stringify(novels1.length))\n            // java.log(JSON.stringify(novels2))\n            java.log(JSON.stringify(novels2.length))\n        })\n        return novels\n    }\n\n    // è¿‡æ»¤æè¿°ä¸æ ‡ç­¾ï¼ˆå±è”½æ ‡ç­¾/å±è”½æè¿°ï¼‰\n    u.novelFilter2 = function(novels) {\n        let novels0 = novels.map(novel => novel.id)\n        let captionBlockWords = getFromCacheObject(\"captionBlockWords\")\n        if (!captionBlockWords) captionBlockWords = []\n        else {\n            // ä»…ä¿ç•™æ²¡æœ‰ä»»ä½•å±è”½è¯çš„å°è¯´\n            // novels = novels.filter(novel => {\n            //     return !captionBlockWords.some(item => {\n            //         if (novel.description !== undefined) return novel.description.includes(item)\n            //     })\n            // })\n            novels = novels.filter(novel => !captionBlockWords.some(item => novel.description.includes(item)))\n            let novels2 = novels.map(novel => novel.id)\n            java.log(`ğŸš« å±è”½æè¿°ï¼š${captionBlockWords.join(\"\\n\")}`)\n            java.log(`ğŸš« å±è”½æè¿°ï¼šè¿‡æ»¤å‰${novels0.length}ï¼›è¿‡æ»¤å${novels2.length}`)\n        }\n\n        let tagsBlockWords = getFromCacheObject(\"tagsBlockWords\")\n        if (!tagsBlockWords) tagsBlockWords = []\n        else {\n            // ä»…ä¿ç•™æ²¡æœ‰ä»»ä½•å±è”½è¯çš„å°è¯´\n            // novels = novels.filter(novel => {\n            //     return !tagsBlockWords.some(item => {\n            //         if (novel.tags !== undefined) return novel.tags.includes(item)\n            //     })\n            // })\n            novels = novels.filter(novel => !tagsBlockWords.some(item => novel.tags.includes(item)))\n            let novels2 = novels.map(novel => novel.id)\n            java.log(`ğŸš« å±è”½æ ‡ç­¾ï¼š${tagsBlockWords.join(\"ã€\")}`)\n            java.log(`ğŸš« å±è”½æ ‡ç­¾ï¼šè¿‡æ»¤å‰${novels0.length}ï¼›è¿‡æ»¤å${novels2.length}`)\n        }\n        return novels\n    }\n\n    // æ”¶è—å°è¯´/è¿½æ›´ç³»åˆ— å†™å…¥ç¼“å­˜\n    u.saveNovels = function(listInCacheName, list) {\n        let listInCache = getFromCacheObject(listInCacheName)\n        if (!listInCache) listInCache = []\n\n        listInCache = listInCache.concat(list)\n        listInCache = Array.from(new Set(listInCache))\n        putInCacheObject(listInCacheName, listInCache)\n\n        if (listInCacheName === \"likeNovels\") listInCacheName = \"â¤ï¸ æ”¶è—å°è¯´ID\"\n        else if (listInCacheName === \"watchedSeries\") listInCacheName = \"ğŸ“ƒ è¿½æ›´ç³»åˆ—ID\"\n        util.debugFunc(() => {\n            java.log(`${listInCacheName}ï¼š${JSON.stringify(listInCache)}`)\n        })\n    }\n\n    u.saveAuthors = function(authors) {\n        let pixivAuthors = getFromCacheObject(\"pixivAuthors\")\n        if (!pixivAuthors) pixivAuthors = {}\n\n        pixivAuthors = Object.assign(pixivAuthors, authors)\n        putInCacheObject(\"pixivAuthors\", pixivAuthors)\n    }\n\n    // å¤„ç† novels åˆ—è¡¨\n    u.handNovels = function(novels, isDetail) {\n        if (!isDetail) isDetail = false\n        let likeNovels = [], watchedSeries = [], authors = {}\n        novels = util.authorFilter(novels)\n        novels.forEach(novel => {\n            // novel.id = novel.id\n            // novel.title = novel.title\n            // novel.userName = novel.userName\n            // novel.userId = novel.userId\n            // novel.tags = novel.tags\n            authors[novel.userName] = novel.userId  // åŠ å…¥ç¼“å­˜ï¼Œä¾¿äºæœç´¢ä½œè€…\n            if (novel.tags === undefined || novel.tags === null) {\n                novel.tags = []\n            }\n            // æœç´¢å•ç¯‡\n            if (novel.isOneshot === undefined) {\n                // novel.seriesId = novel.seriesId\n                // novel.seriesTitle = novel.seriesTitle\n                // novel.textCount = novel.textCount\n                // novel.description = novel.description\n                novel.coverUrl = novel.url\n                // novel.createDate = novel.createDate\n                // novel.updateDate = novel.updateDate\n            }\n\n            // æœç´¢ç³»åˆ—\n            if (novel.isOneshot !== undefined) {\n                if (novel.isOneshot === true) {\n                    novel.seriesId = undefined\n                    novel.id = novel.novelId  // è·å–çœŸæ­£çš„ novelId\n                    novel.seriesTitle = undefined\n                } else {\n                    novel.seriesId = novel.id\n                    novel.id = novel.novelId = novel.latestEpisodeId  // è·å–çœŸæ­£çš„ novelId\n                    novel.seriesTitle = novel.title\n                    // novel.isWatched = novel.isWatched  // æœç´¢ç³»åˆ—å¯è·å–\n                }\n                novel.textCount = novel.textLength\n                novel.description = novel.caption\n                novel.coverUrl = novel.cover.urls[\"480mw\"]\n                novel.createDate = novel.createDateTime\n                novel.updateDate = novel.updateDateTime\n            }\n\n            // å•ç¯‡æ­£æ–‡è¯¦æƒ…é¡µ\n            if (novel.content) {\n                novel.novelId = novel.id\n                novel.tags = novel.tags.tags.map(item => item.tag)\n                novel.textCount = novel.userNovels[`${novel.id}`].textCount\n                // novel.latestChapter = novel.title\n                // novel.description = novel.description\n                novel.coverUrl = novel.userNovels[`${novel.id}`].url\n                // novel.createDate = novel.createDate\n                novel.updateDate = novel.uploadDate\n\n                if (novel.seriesNavData) {\n                    novel.seriesId = novel.seriesNavData.seriesId\n                    novel.seriesTitle = novel.seriesNavData.title\n                }\n            }\n\n            // ç³»åˆ—è¯¦æƒ…\n            if (novel.firstNovelId) {\n                novel.seriesId = novel.id\n                novel.id = novel.novelId = novel.firstNovelId\n                novel.seriesTitle = novel.title\n                novel.coverUrl = novel.cover.urls[\"480mw\"]\n                // novel.isWatched = novel.isWatched  // æœç´¢ç³»åˆ—å¯è·å–\n            }\n\n            // å•ç¯‡åŠ æ›´å¤šä¿¡æ¯\n            if (!novel.seriesId) {\n                novel.tags.unshift(\"å•æœ¬\")\n                novel.latestChapter = novel.title\n                novel.detailedUrl = urlIP(urlNovelDetailed(novel.id))\n                novel.total = 1\n                if (novel.bookmarkData) {\n                    novel.isBookmark = true\n                    putInCache(`collect${novel.id}`, novel.bookmarkData.id)\n                    likeNovels.push(Number(novel.id))\n                } else {\n                    novel.isBookmark = false\n                }\n            }\n\n            if (novel.seriesId && !isDetail) {\n                novel.title = novel.seriesTitle\n                novel.tags.unshift(\"é•¿ç¯‡\")\n                novel.detailedUrl = urlIP(urlSeriesDetailed(novel.seriesId))\n            }\n            // ç³»åˆ—æ·»åŠ æ›´å¤šä¿¡æ¯\n            if (novel.seriesId && isDetail) {\n                let series = getAjaxJson(urlIP(urlSeriesDetailed(novel.seriesId))).body\n                novel.id = series.firstNovelId\n                novel.title = series.title\n                novel.tags = novel.tags.concat(series.tags)\n                novel.tags.unshift(\"é•¿ç¯‡\")\n                novel.textCount = series.publishedTotalCharacterCount\n                novel.description = series.caption\n                novel.coverUrl = series.cover.urls[\"480mw\"]\n                novel.detailedUrl = urlIP(urlSeriesDetailed(novel.seriesId))\n                novel.createDate = series.createDate\n                novel.updateDate = series.updateDate\n                novel.total = series.publishedContentCount\n                novel.isWatched = series.isWatched\n                if (novel.isWatched === true) {\n                    watchedSeries.push(Number(novel.seriesId))\n                }\n\n                // é˜²æ­¢ç³»åˆ—é¦–ç¯‡æ— æƒé™è·å–\n                // å‘é€è¯·æ±‚è·å–ç¬¬ä¸€ç«  è·å–æ ‡ç­¾ä¸ç®€ä»‹\n                let firstNovel = {}\n                try {\n                    firstNovel = getAjaxJson(urlIP(urlSeriesNovels(novel.seriesId, 30, 0))).body.thumbnails.novel[0]\n                    novel.id = novel.firstNovelId = firstNovel.id\n                    novel.tags = novel.tags.concat(firstNovel.tags)\n                } catch (e) { // é˜²æ­¢ç³»åˆ—é¦–ç¯‡æ— æƒé™è·å–\n                    firstNovel = {}\n                    firstNovel.description = \"\"\n                }\n                novel.tags.unshift(\"é•¿ç¯‡\")\n                if (novel.description === \"\") {\n                    novel.description = firstNovel.description\n                }\n            }\n        })\n        // æ”¶è—å°è¯´/è¿½æ›´ç³»åˆ— å†™å…¥ç¼“å­˜\n        util.saveNovels(\"likeNovels\", likeNovels)\n        util.saveNovels(\"watchedSeries\", watchedSeries)\n        util.saveAuthors(authors)\n        util.debugFunc(() => {\n            java.log(`å¤„ç†å°è¯´å®Œæˆ`)\n        })\n        return novels\n    }\n\n    // å°è¯´ä¿¡æ¯æ ¼å¼åŒ–\n    u.formatNovels = function(novels) {\n        novels = util.novelFilter(novels)\n        novels.forEach(novel => {\n            novel.title = novel.title.trim()\n            if (!novel.userName.startsWith(\"@\")) novel.userName = `@${novel.userName}`\n            novel.coverUrl = urlCoverUrl(novel.coverUrl)\n            novel.readingTime = `${novel.readingTime / 60} åˆ†é’Ÿ`\n            novel.createDate = dateFormat(novel.createDate)\n            novel.updateDate = dateFormat(novel.updateDate)\n\n            novel.tags2 = []\n            for (let i in novel.tags) {\n                let tag = novel.tags[i]\n                if (tag.includes(\"/\")) {\n                    let tags = tag.split(\"/\")\n                    novel.tags2 = novel.tags2.concat(tags)\n                } else {\n                    novel.tags2.push(tag)\n                }\n            }\n            novel.tags = Array.from(new Set(novel.tags2))\n            novel.tags = novel.tags.join(\",\")\n            if (novel.seriesId) {\n                collectMsg = `ğŸ“ƒ è¿½æ›´ï¼š${util.checkStatus(novel.isWatched)}è¿½æ›´ç³»åˆ—`\n            } else {\n                collectMsg = `â¤ï¸ æ”¶è—ï¼š${util.checkStatus(novel.isBookmark)}åŠ å…¥æ”¶è—`\n            }\n\n            if (util.settings.MORE_INFORMATION) {\n                novel.description = `\\nğŸ…¿ï¸ ç™»å½•ï¼š${util.checkStatus(isLogin())}ç™»å½•è´¦å·\n                ${collectMsg}\\nğŸ“– ä¹¦åï¼š${novel.title}\\nğŸ‘¤ ä½œè€…ï¼š${novel.userName}\n                #ï¸ æ ‡ç­¾ï¼š${novel.tags}\\nâ¬†ï¸ ä¸Šä¼ ï¼š${novel.createDate}\n                ğŸ”„ æ›´æ–°ï¼š${novel.updateDate}\\nğŸ“„ ç®€ä»‹ï¼š${novel.description}`\n            } else {\n                novel.description = `\\nğŸ…¿ï¸ ç™»å½•ï¼š${util.checkStatus(isLogin())}ç™»å½•è´¦å·\n                ${collectMsg}\\nâ¬†ï¸ ä¸Šä¼ ï¼š${novel.createDate}\\nğŸ”„ æ›´æ–°ï¼š${novel.updateDate}\n                ğŸ“„ ç®€ä»‹ï¼š${novel.description}`\n            }\n        })\n        novels = util.novelFilter2(novels)\n        return novels\n    }\n\n    // æ­£æ–‡ï¼Œè¯¦æƒ…ï¼Œæœç´¢ï¼šä»ç½‘å€è·å–idï¼Œè¿”å›å•ç¯‡å°è¯´ resï¼Œç³»åˆ—è¿”å›é¦–ç¯‡å°è¯´ res\n    // pixiv é»˜è®¤åˆ†äº«ä¿¡æ¯ä¸­æœ‰#å·ï¼Œä¸ä¼šè¢«è¯†åˆ«æˆé“¾æ¥ï¼Œæ— æ³•ä½¿ç”¨æ·»åŠ ç½‘å€\n    u.getNovelResFirst = function(result) {\n        let novelId = 0, res = {\"body\": {}}\n        let isJson = isJsonString(result)\n        let isHtml = isHtmlString(result)\n\n        if (!isJson && isHtml) {\n            let id = baseUrl.match(new RegExp(\"\\\\d+\"))[0]\n            let pattern = \"(https?://)?(www\\\\.)?pixiv\\\\.net(/ajax)?/users?/\\\\d+\"\n            let isAuthor = baseUrl.match(new RegExp(pattern))\n            if (isAuthor) {\n                java.log(`ä½œè€…IDï¼š${id}`)\n                novelId = Object.keys(getAjaxJson(urlIP(urlUserWorkLatest(id))).body.novels).reverse()[0]\n            }\n\n            pattern = \"(https?://)?(www\\\\.)?pixiv\\\\.net/novel/series/\\\\d+\"\n            let isSeries = baseUrl.match(new RegExp(pattern))\n            if (isSeries) {\n                java.log(`ç³»åˆ—IDï¼š${id}`)\n                novelId = getAjaxJson(urlIP(urlSeriesNovels(id, 30, 0))).body.thumbnails.novel[0].id\n            } else {\n                let pattern = \"(https?://)?(www\\\\.)?pixiv\\\\.net/novel/(show\\\\.php\\\\?id=)?\\\\d+\"\n                let isNovel = baseUrl.match(new RegExp(pattern))\n                if (isNovel) {\n                    novelId = id\n                }\n            }\n        }\n        if (isJson) {\n            res = JSON.parse(result)\n        }\n\n        if (novelId) {\n            java.log(`åŒ¹é…å°è¯´IDï¼š${novelId}`)\n            res = getAjaxJson(urlIP(urlNovelDetailed(novelId)))\n        }\n        if (res.error === true) {\n            java.log(`æ— æ³•ä» Pixiv è·å–å½“å‰å°è¯´`)\n            java.log(JSON.stringify(res))\n        }\n        return res.body\n    }\n\n    // ç›®å½•ï¼šä»ç½‘å€è·å–idï¼Œå°½å¯èƒ½è¿”å›ç³»åˆ— resï¼Œå•ç¯‡å°è¯´è¿”å›å°è¯´ res\n    u.getNovelResSeries = function(result) {\n        let seriesId = 0, res = {\"body\": {}}\n        let isJson = isJsonString(result)\n        let isHtml = isHtmlString(result)\n\n        if (!isJson && isHtml) {\n            let id = baseUrl.match(new RegExp(\"\\\\d+\"))[0]\n            let pattern = \"(https?://)?(www\\\\.)?pixiv\\\\.net/novel/series/\\\\d+\"\n            let isSeries = baseUrl.match(new RegExp(pattern))\n            if (isSeries) {\n                seriesId = id\n            } else {\n                let pattern = \"(https?://)?(www\\\\.)?pixiv\\\\.net/novel/(show\\\\.php\\\\?id=)?\\\\d+\"\n                let isNovel = baseUrl.match(new RegExp(pattern))\n                if (isNovel) {\n                    java.log(`åŒ¹é…å°è¯´IDï¼š${id}`)\n                    res = getAjaxJson(urlIP(urlNovelDetailed(id)))\n                }\n            }\n        }\n        if (isJson) {\n            res = JSON.parse(result)\n        }\n\n        if (res.body && res.body.seriesNavData) {\n            seriesId = res.body.seriesNavData.seriesId\n        }\n        if (seriesId) {\n            java.log(`ç³»åˆ—IDï¼š${seriesId}`)\n            res = getAjaxJson(urlIP(urlSeriesDetailed(seriesId)))\n        }\n        if (res.error === true) {\n            java.log(`æ— æ³•ä» Pixiv è·å–å½“å‰å°è¯´`)\n            java.log(JSON.stringify(res))\n        }\n        return res.body\n    }\n\n    util = u\n    java.put(\"util\", objStringify(u))\n}\n\nfunction checkMessageThread(checkTimes) {\n    if (checkTimes === undefined) {\n        checkTimes = Number(getFromCache(\"checkTimes\"))\n    }\n    if (checkTimes === 0 && isLogin()) {\n        let latestMsg = getAjaxJson(urlIP(urlMessageThreadLatest(5)))\n        if (latestMsg.error === true) {\n            java.log(JSON.stringify(latestMsg))\n        } else if (latestMsg.body.total >= 1) {\n            let msg = latestMsg.body.message_threads.filter(item => item.thread_name === \"pixiväº‹å‹™å±€\")[0]\n            if (msg && new Date().getTime()- 1000*msg.modified_at <= 3*24*60*60*1000) { // 3å¤©å†…è¿›è¡Œæç¤º\n                sleepToast(`æ‚¨äº ${timeFormat(1000*msg.modified_at)} è§¦å‘ Pixiv ã€è¿‡åº¦è®¿é—®ã€‘ï¼Œè¯·ä¿®æ”¹å¯†ç å¹¶é‡æ–°ç™»å½•ã€‚\\nå¦‚å·²ä¿®æ”¹è¯·å¿½ç•¥`, 3)\n                sleepToast(`${msg.latest_content}`, 5)\n                java.startBrowser(\"https://accounts.pixiv.net/password/change\",'ä¿®æ”¹å¯†ç ')\n            }\n        }\n    }\n    putInCache(\"checkTimes\", checkTimes + 1, 4*60*60)  // ç¼“å­˜4hï¼Œæ¯4hæé†’ä¸€æ¬¡\n    // putInCache(\"checkTimes\", checkTimes + 1, 60)  // æµ‹è¯•ç”¨ï¼Œç¼“å­˜60sï¼Œæ¯åˆ†é’Ÿæé†’ä¸€æ¬¡\n    // java.log(checkTimes + 1)\n}\n\n// è·å–è¯·æ±‚çš„user idæ–¹ä¾¿å…¶ä»–ajaxè¯·æ±‚æ„é€ \nfunction getPixivUid() {\n    let uid = getFromCache(\"pixiv:uid\")\n    if (!uid || String(uid) === \"null\") {\n        let html = java.webView(null, \"https://www.pixiv.net/\", null)\n        try {\n            uid = html.match(/user_id:'(\\d+)'/)[1]\n        } catch (e) {\n            uid = null\n        }\n        putInCache(\"pixiv:uid\", String(uid))\n    }\n}\n\nfunction getHeaders() {\n    let headers = {\n        \"accept\": \"application/json\",\n        \"accept-encoding\": \"gzip, deflate, br, zstd\",\n        \"accept-language\": \"zh-CN\",\n        // \"content-type\": \"application/json; charset=utf-8\",\n        // \"content-type\": \"application/x-www-form-urlencoded; charset=utf-8\",\n        \"origin\": \"https//www.pixiv.net\",\n        \"Referer\": \"https://www.pixiv.net/\",\n        // \"sec-ch-ua\": `\"Not/A)Brand\";v=\"8\", \"Chromium\";v=\"132\", \"Google Chrome\";v=\"132\"`,\n        // \"sec-ch-ua-mobile\": \"?0\",\n        // \"sec-ch-ua-platform\": \"Windows\",\n        // \"sec-fetch-dest\": \"empty\",\n        // \"sec-fetch-mode\": \"cors\",\n        // \"sec-fetch-site\": \"same-origin\",\n        \"user-agent\": getFromCache(\"userAgent\") || \"\",\n        \"x-csrf-token\": getFromCache(\"pixivCsrfToken\") || \"\",\n        \"Cookie\": getFromCache(\"pixivCookie\") || \"\"\n    }\n    putInCacheObject(\"headers\", headers)\n    return headers\n}\n\npublicFunc()\nif (result.code() === 200) {\n    getPixivUid(); getWebViewUA(); util.getCookie(); util.getCsrfToken(); getHeaders()\n    if (!util.settings.FAST) checkMessageThread()   // æ£€æµ‹è¿‡åº¦è®¿é—®\n}\n\nutil.debugFunc(() => {\n    java.log(`DEBUG = ${util.settings.DEBUG}\\n`)\n    java.log(JSON.stringify(util.settings, null, 4))\n    java.log(`${getWebViewUA()}\\n`)\n    java.log(`${getFromCache(\"pixivCsrfToken\")}\\n`)\n    java.log(`${getFromCache(\"pixivCookie\")}\\n`)\n    java.log(`${getFromCache(\"headers\")}\\n`)\n})\n\njava.getStrResponse(null, null)",
        "loginUi": "@js:\nlet pixivSettings = getFromCacheObject(\"pixivSettings\")\nif (!pixivSettings) pixivSettings = setDefaultSettings()\n\nlet source = [\n    {\"ğŸ…¿ï¸ ç™»å½•è´¦å·\": \"login()\" },\n    {\"âš™ï¸ è´¦å·è®¾ç½®\": \"startPixivSettings()\" },\n    {\"ğŸ”™ é€€å‡ºè´¦å·\": \"logout()\" },\n\n    {\"ğŸ†™ æ›´æ–°ä¹¦æº\": \"updateSource()\" },\n    {\"ğŸ”° ä½¿ç”¨æŒ‡å—\": \"startGithubReadme()\" },\n    {\"ğŸ åé¦ˆé—®é¢˜\": \"startGithubIssue()\" },\n]\n\nlet methord = \"\"\nif (book) methord = 2\nlet settingsBase = [\n    {\"ğŸ‘€ ä¹¦æºè®¾ç½®\": `editSettings('SHOW_SETTINGS${methord}')` },\n    {\"ğŸ‘€ å‘ç°è®¾ç½®\": `editSettings('SHOW_DISCOVER${methord}')` },\n    {\"ğŸš« âœˆï¸ ç›´è¿æ¨¡å¼\": \"editSettings('IPDirect')\" },\n]\n\nlet novel = [\n    {\"ç« èŠ‚åç§°\": \"text\" },\n    {\"â¤ï¸ ãŠ™ï¸ æ”¶è—æœ¬ç« \": \"novelBookmarkAdd()\" },\n    {\"ğŸ“ƒ ğŸš« è¿½æ›´ç³»åˆ—\": \"seriesWatchFactory()\" },\n    {\"â¤ï¸ æ”¶è—ç³»åˆ—\": \"novelsBookmarkAdd()\" },\n\n    {\"ğŸ–¤ å–æ¶ˆæ”¶è—\": \"novelsBookmarkDelete()\" },\n    {\"â­ï¸ âš«ï¸ å…³æ³¨ä½œè€…\": \"userFollowFactory()\"},\n    {\"ğŸš« â­•ï¸ å±è”½ä½œè€…\": \"userBlock()\"},\n]\n\nlet comment = [\n    {\"æ–‡æœ¬æ¡†\": \"text\" },\n    {\"âœ… å‘é€è¯„è®º\": \"novelCommentAdd()\" },\n    {\"ğŸ—‘ï¸ åˆ é™¤è¯„è®º\": \"novelCommentDelete()\" },\n    {\"ğŸ”„ åˆ·æ–°æœ¬ç« \": \"cleanCache()\" },\n\n    {\"ğŸš« æ·»åŠ å±è”½\": \"blockAddFactory()\" },\n    {\"â­•ï¸ åˆ é™¤å±è”½\": \"blockDeleteFactory()\" },\n    {\"ğŸ‘€ æŸ¥çœ‹å±è”½\": \"blockShowFactory()\" },\n\n    {\"ğŸ“Œ å–œæ¬¢æ ‡ç­¾\": \"likeTagsAdd()\" },\n    {\"ğŸ—‘ï¸ åˆ é™¤æ ‡ç­¾\": \"likeTagsDelete()\" },\n    {\"ğŸ‘€ æŸ¥çœ‹æ ‡ç­¾\": \"likeTagsShow()\" },\n\n    {\"â¤ï¸ ä»–äººæ”¶è—\": \"likeAuthorsAdd()\" },\n    {\"ğŸ–¤ å–æ¶ˆæ”¶è—\": \"likeAuthorsDelete()\" },\n    {\"ğŸ‘€ æŸ¥çœ‹æ”¶è—\": \"likeAuthorsShow()\" },\n]\n\nlet settings = [\n    {\"ä¹¦æºè®¾ç½®\": \"text\" },\n    {\"âš™ï¸ å½“å‰è®¾ç½®\": \"showSettings()\" },\n    {\"ğŸ”§ é»˜è®¤è®¾ç½®\": \"setDefaultSettingsLoginUrl()\" },\n    {\"ğŸš« ğŸ‘¤ æœç´¢ä½œè€…\": \"editSettings('SEARCH_AUTHOR')\" },\n\n    {\"ğŸ€„ ğŸš« ç¹ç®€é€šæœ\": \"editSettings('CONVERT_CHINESE')\" },\n    {\"ğŸš« ğŸ“– æ›´å¤šç®€ä»‹\": \"editSettings('MORE_INFORMATION')\" },\n    {\"ğŸ“… ğŸš« æ›´æ–°æ—¶é—´\": \"editSettings('SHOW_UPDATE_TIME')\" },\n\n    {\"ğŸ”— ğŸš« åŸå§‹é“¾æ¥\": \"editSettings('SHOW_ORIGINAL_LINK')\" },\n    {\"ğŸ“š ğŸš« æ¢å¤ã€Šã€‹\": \"editSettings('REPLACE_TITLE_MARKS')\" },\n    {\"ğŸ–¼ï¸ ğŸš« æ˜¾ç¤ºæè¿°\": \"editSettings('SHOW_CAPTIONS')\" },\n\n    {\"ğŸ’¬ ğŸš« æ˜¾ç¤ºè¯„è®º\": \"editSettings('SHOW_COMMENTS')\" },\n    {\"ğŸš« â¤ï¸ éšè—æ”¶è—\": \"editSettings('HIDE_LIKE_NOVELS')\" },\n    {\"ğŸš« ğŸ“ƒ éšè—è¿½æ›´\": \"editSettings('HIDE_WATCHED_SERIES')\" },\n\n    {\"ğŸš« â© å¿«é€Ÿæ¨¡å¼\": \"editSettings('FAST')\" },\n    {\"ğŸš« ğŸ è°ƒè¯•æ¨¡å¼\": \"editSettings('DEBUG')\" },\n    // {\"ğŸ” æœç´¢è¯´æ˜\": \"readMeSearch()\" },\n    {\"ğŸº å…½äººä½œè€…\": \"updatePixivAuthors()\" },\n]\n\nlet discoverSettings = [\n    {\"å‘ç°è®¾ç½®\": \"text\" },\n    {\"ğŸ” å½“å‰å‘ç°\": \"showSettingsDiscover()\" },\n    {\"ğŸ†— å¸¸è§„å°è¯´\": \"editSettings('SHOW_GENERAL')\" },\n    {\"ğŸ” æœ€æ–°ä¼åˆ’\": \"editSettings('SHOW_NEW_ADULT')\" },\n\n    {\"ğŸ†— æœ€æ–°ä¼åˆ’\": \"editSettings('SHOW_NEW_GENERAL')\" },\n    {\"ğŸ” æ’è¡Œæ¦œå•\": \"editSettings('SHOW_RANK_ADULT')\" },\n    {\"ğŸ†— æ’è¡Œæ¦œå•\": \"editSettings('SHOW_RANK_GENERAL')\" },\n\n    {\"ğŸ” åŸåˆ›çƒ­é—¨\": \"editSettings('SHOW_GENRE_ADULT')\" },\n    {\"ğŸ†— åŸåˆ›çƒ­é—¨\": \"editSettings('SHOW_GENRE_GENERAL')\" },\n    {\"ğŸº å…½äººå°è¯´\": \"editSettings('SHOW_FURRY')\" },\n]\n\nlet li = []\ntry {\n    if (book) {\n        li = settingsBase.concat(novel).concat(comment)\n        if (pixivSettings.SHOW_SETTINGS2) li = li.concat(settings)\n        if (pixivSettings.SHOW_DISCOVER2) li = li.concat(discoverSettings)\n    } else {\n        li = source.concat(settingsBase)\n        if (pixivSettings.SHOW_SETTINGS) li = li.concat(settings)\n        if (pixivSettings.SHOW_DISCOVER) li = li.concat(discoverSettings)\n    }\n} catch (e) {}\n\n// å¤„ç†æŒ‰é’®\nli.forEach(item => {\n    item.name = Object.keys(item)[0]\n    let list = item.name.split(\" \")\n    if (list.length === 1 ) {\n        item.type = \"text\"\n    } else if (list.length === 2) {\n        item.type = \"button\"\n        item.action = Object.values(item)[0]\n    } else {\n        item.name = list[list.length - 1]\n        item.type = \"toggle\"\n        item.default = `${list[0]} `\n        list.length = list.length - 1\n        item.chars = list.map(char => `${char} `)\n        item.action = Object.values(item)[0]\n    }\n    delete item[Object.keys(item)[0]]\n    // æ·»åŠ æ ¼å¼\n    if (item.type === \"button\" || item.type === \"toggle\") {\n        item.style = {}\n        item.style.layout_flexGrow = 1\n        item.style.layout_flexBasisPercent = -1\n    }\n})\n\nJSON.stringify(li)",
        "loginUrl": "function login() {\n    sleepToast(\"ğŸ”„ æ­£åœ¨æ£€æµ‹ç™»é™†çŠ¶æ€ï¼Œè¯·ç¨å€™\")\n    if (isLogin()) {\n        sleepToast(\"ï¸ğŸ…¿ï¸ ç™»å½•è´¦å·\\nâœ… å·²ç»ç™»å½•è¿‡è´¦å·äº†\\n\\nå¯ä»¥ç‚¹å‡»ã€ğŸ”™ é€€å‡ºè´¦å·ã€‘æ¥åˆ‡æ¢è´¦å·\")\n        return false\n    }\n\n    let resp = java.startBrowserAwait(`https://accounts.pixiv.net/login,\n    {\"headers\": {\"User-Agent\": ${getWebViewUA()}}}`, 'ç™»å½•è´¦å·', false)\n    if (resp.code() === 200) {\n        getCsrfToken(); getCookie()\n        return true\n    } else {\n        java.log(resp.code()); sleepToast(\"ğŸ…¿ï¸ ç™»å½•è´¦å·\\n\\nâš ï¸ ç™»å½•å¤±è´¥\")\n        return false\n    }\n}\n\nfunction logout() {\n    removeCookie()\n    java.startBrowser(\"https://www.pixiv.net/logout.php\", \"é€€å‡ºè´¦å·\")\n    removeCookie(); removeLikeDataCache(); removeSettingsCache()\n    sleepToast(`âœ… å·²é€€å‡ºå½“å‰è´¦å·\\n\\né€€å‡ºåè¯·ç‚¹å‡»å³ä¸Šè§’çš„ âœ”ï¸ é€€å‡º\\n\\nç™»å½•è¯·ç‚¹å‡»ã€ç™»å½•è´¦å·ã€‘è¿›è¡Œç™»å½•`)\n}\n\nfunction removeCookie() {\n    cookie.removeCookie('https://www.pixiv.net')\n    cookie.removeCookie('https://accounts.pixiv.net')\n    cookie.removeCookie('https://accounts.google.com')\n    cookie.removeCookie('https://api.weibo.com')\n    cache.delete(\"pixivCookie\")\n    cache.delete(\"pixiv:uid\")\n    cache.delete(\"pixivCsrfToken\")  // ä¸ç™»å½•è®¾å¤‡æœ‰å…³\n    cache.delete(\"headers\")\n}\n\nfunction removeCacheList(listName) {\n    let list = getFromCacheObject(listName)\n    list.forEach(item => cache.delete(`collect${item}`))\n    if (listName !== \"blockAuthorList\") cache.delete(listName)\n}\n\nfunction removeLikeDataCache() {\n    // åˆ é™¤ likeNovels ä¸ watchedSeries\n    removeCacheList(\"likeNovels\")\n    removeCacheList(\"watchedSeries\")\n}\n\nfunction removeSettingsCache() {\n    // åˆ é™¤ å±è”½ä½œè€…åå•\n    // removeCacheList(\"blockAuthorList\")\n    // åˆ é™¤  å±è”½å…³é”®è¯\n    // cache.delete(\"tagsBlockWords\")\n    // cache.delete(\"captionBlockWords\")\n}\n\nfunction getCookie() {\n    let pixivCookie = String(java.getCookie(\"https://www.pixiv.net/\", null))\n    if (isLogin()) putInCache(\"pixivCookie\", pixivCookie, 60*60)\n}\n\n// è·å– Csrf Tokenï¼Œä»¥ä¾¿è¿›è¡Œæ”¶è—ç­‰è¯·æ±‚\n// è·å–æ–¹æ³•æ¥è‡ªè„šæœ¬ Pixiv Previewer\n// https://github.com/Ocrosoft/PixivPreviewer\n// https://greasyfork.org/zh-CN/scripts/30766-pixiv-previewer/code\nfunction getCsrfToken() {\n    let pixivCsrfToken = getFromCache(\"pixivCsrfToken\")\n    if (!pixivCsrfToken) {\n        let html = java.webView(null, \"https://www.pixiv.net/\", null)\n        try {\n            pixivCsrfToken = html.match(/token\\\\\":\\\\\"([a-z0-9]{32})/)[1]\n            putInCache(\"pixivCsrfToken\", pixivCsrfToken)  // ä¸ç™»å½•è®¾å¤‡æœ‰å…³ï¼Œæ— æ³•å­˜å‚¨ nul\n        } catch (e) {\n            pixivCsrfToken = null\n            cache.delete(\"pixivCsrfToken\")  // ä¸ç™»å½•è®¾å¤‡æœ‰å…³ï¼Œæ— æ³•å­˜å‚¨ nul\n            // sleepToast(\"âš ï¸ æœªç™»å½•è´¦å·(pixivCsrfToken)\")\n        }\n        java.log(`pixivCsrfToken:\\n${pixivCsrfToken}`)\n    }\n    return pixivCsrfToken\n}\n\nfunction getNovel() {\n    let environment = getFromCacheObject(\"pixivEnvironment\")\n    if (environment.IS_LEGADO_SIGMA) {\n        try {\n            let novel = {}\n            try {\n                novel.id = chapter.url.match(/\\d+/)[0]\n            } catch(e){\n                novel.id = chapter.url.match(/novel\\/(\\d+)/)[1]  // ç›´è¿æ¨¡å¼\n            }\n            novel.title = chapter.title\n            novel.userName = book.author.replace(\"@\", \"\")\n            if (book.bookUrl.includes(\"series\")) {\n                novel.seriesId = book.bookUrl.match(/\\d+/)[0]\n                novel.seriesTitle = book.name\n            } else {\n                novel.seriesId = 0\n                novel.seriesTitle = \"\"\n            }\n\n            let resp = getAjaxJson(urlIP(urlNovelDetailed(novel.id))).body\n            novel.userId = resp.userId\n            if (resp.pollData) {\n                novel.pollChoicesCount = resp.pollData.choices.length\n            } else {\n                novel.pollChoicesCount = 0\n            }\n            // java.log(JSON.stringify(novel))\n            return novel\n        } catch (e) {\n            // æ— æ³•é˜»æ­¢åç»­å‡½æ•°åœ¨æ—¥å¿—ä¸­æŠ¥é”™\n            return sleepToast(\"ğŸ”° åŠŸèƒ½æç¤º\\n\\nâš ï¸ è¯·åœ¨ã€å°è¯´æ­£æ–‡ã€‘ä½¿ç”¨è¯¥åŠŸèƒ½\")\n        }\n    } else {  // å…¼å®¹ç”¨\n        let novel = source.getLoginInfoMap()\n        if (!novel) novel = getFromCacheObject(\"novel\")\n        return novel\n    }\n}\n\nfunction getPostBody(url, body, headers) {\n    if (headers === undefined) headers = getFromCacheObject(\"headers\")\n    if (isJsonString(body)) {\n        headers[\"content-type\"] = \"application/json; charset=utf-8\"\n    } else if (typeof body === \"string\") {\n        headers[\"content-type\"] = \"application/x-www-form-urlencoded; charset=utf-8\"\n    }\n    try {\n        java.log(`getPostBody(${url}, ${body}, ${headers})`)\n        // java.log(`getPostBody(${url}, ${body}, ${JSON.stringify(headers)})`)\n        return JSON.parse(java.post(url, body, headers).body())\n    } catch (e) {\n        e = String(e)\n        // sleepToast(e)\n        // sleepToast(JSON.stringify(headers))\n        if (e.includes(\"400\")) sleepToast(`ğŸ“¤ getPostBody\\n\\nâš ï¸ ç¼ºå°‘ headers`, 1)\n        else if (e.includes(\"403\")) sleepToast(`ğŸ“¤ getPostBody\\n\\nâš ï¸ ç¼ºå°‘ cookie æˆ– cookie è¿‡æœŸ`, 1)\n        else if (e.includes(\"404\")) sleepToast(`ğŸ“¤ getPostBody\\n\\nâš ï¸ 404 ç¼ºå°‘ pixivCsrfToken `, 1)\n        else if (e.includes(\"422\")) sleepToast(`ğŸ“¤ getPostBody\\n\\nâš ï¸ è¯·æ±‚ä¿¡æ¯æœ‰è¯¯`, 1)\n        return {error: true, errMsg:e}\n    }\n}\n\nfunction novelBookmarkAdd() {\n    let restrict = 0\n    let novel = getNovel()\n    let novelObj = getAjaxJson(urlNovelDetailed(novel.id), true)\n    if (novelObj.body.bookmarkData && novelObj.body.bookmarkData.private === false) restrict = 1\n    let resp = getPostBody(\n        \"https://www.pixiv.net/ajax/novels/bookmarks/add\",\n        JSON.stringify({\"novel_id\": novel.id, \"restrict\": restrict, \"comment\":\"\", \"tags\":[]})\n    )\n    if (resp.error === true) {\n        sleepToast(`â¤ï¸ æ”¶è—å°è¯´\\n\\nâš ï¸ æ”¶è—ã€${novel.title}ã€‘å¤±è´¥`)\n        shareFactory(\"novel\")\n    } else {\n        putInCacheObject(`collect${novel.id}`, resp.body)\n        let likeNovels = getFromCacheObject(\"likeNovels\")\n        likeNovels.push(Number(novel.id))\n        putInCacheObject(\"likeNovels\", likeNovels)\n\n        let novelObj = getAjaxJson(urlNovelDetailed(novel.id))\n        novelObj.body.isBookmark = true\n        putInCacheObject(urlNovelDetailed(novel.id), novelObj, cacheSaveSeconds)\n    }\n\n    if (restrict === 1) {\n        sleepToast(`ãŠ™ï¸ ç§å¯†æ”¶è—\\n\\nâœ… å·²ç§å¯†æ”¶è—\\n${novel.title}`)\n    } else {\n        sleepToast(`â¤ï¸ å…¬å¼€æ”¶è—\\n\\nâœ… å·²å…¬å¼€æ”¶è—\\n${novel.title}`)\n    }\n}\n\nfunction getNovelBookmarkId(novelId) {\n    let bookmarkId = getFromCacheObject(`collect${novelId}`)\n    if (bookmarkId === null) {\n        try {\n            bookmarkId = getAjaxJson(urlNovelBookmarkData(novelId), true).body.bookmarkData.id\n        } catch (e) {\n            bookmarkId = 0\n        }\n    }\n    return bookmarkId\n}\n\nfunction novelBookmarkDelete() {\n    let novel = getNovel()\n    let bookmarkId = getNovelBookmarkId(novel.id)\n    if (bookmarkId === 0) return sleepToast(`ğŸ–¤ å–æ¶ˆæ”¶è—\\n\\nâœ… å·²ç»å–æ¶ˆæ”¶è—\\n${novel.title}`)\n\n    let resp = getPostBody(\n        \"https://www.pixiv.net/ajax/novels/bookmarks/delete\",\n        `del=1&book_id=${bookmarkId}`\n    )\n    if (resp.error === true) {\n        sleepToast(`ğŸ–¤ å–æ¶ˆæ”¶è—\\n\\nâš ï¸ å–æ¶ˆæ”¶è—å¤±è´¥\\n${novel.title}`)\n        shareFactory(\"novel\")\n    } else {\n        cache.delete(`collect${novel.id}`)\n        sleepToast(`ğŸ–¤ å–æ¶ˆæ”¶è—\\n\\nâœ… å·²ç»å–æ¶ˆæ”¶è—\\n${novel.title}`)\n\n        let likeNovels = getFromCacheObject(\"likeNovels\")\n        likeNovels = likeNovels.filter(item => item !== Number(novel.id))\n        putInCacheObject(\"likeNovels\", likeNovels)\n\n        let novelObj = getAjaxJson(urlNovelDetailed(novel.id))\n        novelObj.body.isBookmark = false\n        putInCacheObject(urlNovelDetailed(novel.id), novelObj, cacheSaveSeconds)\n    }\n}\n\nfunction novelsBookmarkDelete() {\n    let novel = getNovel()\n    if (!isLongClick) {\n        if (!novel.seriesId) sleepToast(`ğŸ–¤ å–æ¶ˆæ”¶è—\\n\\næ­£åœ¨å–æ¶ˆæ”¶è—ã€æœ¬ç« ã€‘`)\n        else sleepToast(`ğŸ–¤ å–æ¶ˆæ”¶è—\\n\\næ­£åœ¨å–æ¶ˆæ”¶è—ã€æœ¬ç« ã€‘\\né•¿æŒ‰å¯å–æ¶ˆæ”¶è—ã€æ•´ä¸ªç³»åˆ—ã€‘`)\n        return novelBookmarkDelete(0)\n    }\n    if (isLongClick && !novel.seriesId) {\n        return (`ğŸ–¤ å–æ¶ˆæ”¶è—ç³»åˆ—\\n\\nâš ï¸ ã€${novel.title}ã€‘éç³»åˆ—å°è¯´`)\n    }\n    sleepToast(`ğŸ–¤ å–æ¶ˆæ”¶è—ç³»åˆ—\\n\\nğŸ”„ æ­£åœ¨å–æ¶ˆæ”¶è—ç³»åˆ—ï¼Œè¯·ç¨åâ€¦â€¦`, 2)\n\n    let bookmarkIds = []\n    let novelIds = getFromCacheObject(`novelIds${novel.seriesId}`)\n    novelIds.forEach(novelId => {\n        let bookmarkId = getNovelBookmarkId(novelId)\n        if (bookmarkId) bookmarkIds.push(getNovelBookmarkId(novelId))\n    })\n    let resp = getPostBody(\n        \"https://www.pixiv.net/ajax/novels/bookmarks/remove\",\n        JSON.stringify({\"bookmarkIds\": bookmarkIds})\n    )\n    if (resp.error === true) {\n        sleepToast(`ğŸ–¤ å–æ¶ˆæ”¶è—ç³»åˆ—\\n\\nâš ï¸ å–æ¶ˆæ”¶è—ã€${novel.seriesTitle}ã€‘çš„ç¯‡ç›®å¤±è´¥`, 2)\n        shareFactory(\"series\")\n    } else {\n        sleepToast(`ğŸ–¤ å–æ¶ˆæ”¶è—ç³»åˆ—\\n\\nâœ… å·²å–æ¶ˆæ”¶è—ã€${novel.seriesTitle}ã€‘çš„å…¨éƒ¨ç¯‡ç›®`)\n        novelIds.forEach(novelId => {cache.delete(`collect${novelId}`)})\n\n        let likeNovels = getFromCacheObject(\"likeNovels\")\n        likeNovels = likeNovels.filter(item => !novelIds.includes(Number(item)))\n        putInCacheObject(\"likeNovels\", likeNovels)\n\n        novelIds.forEach(novelId => {\n            let novelObj = getAjaxJson(urlNovelDetailed(novelId))\n            novelObj.body.isBookmark = false\n            putInCacheObject(urlNovelDetailed(novelId), novelObj, cacheSaveSeconds)\n        })\n    }\n}\n\nfunction novelsBookmarkAdd() {\n    let novel = getNovel()\n    if (!novel.seriesId) {\n        sleepToast(`â¤ï¸ æ”¶è—ç³»åˆ—\\n\\nâš ï¸ ã€${novel.title}ã€‘éç³»åˆ—å°è¯´ï¼Œç°å·²æ”¶è—æœ¬ç¯‡å°è¯´`)\n        return novelBookmarkAdd(0)\n    } else {\n        sleepToast(`â¤ï¸ æ”¶è—ç³»åˆ—\\n\\nğŸ”„ æ­£åœ¨æ”¶è—ç³»åˆ—ã€${novel.seriesTitle}ã€‘ï¼Œè¯·ç¨åâ€¦â€¦`, 2)\n    }\n\n    let novelIds = getFromCacheObject(`novelIds${novel.seriesId}`)\n    let likeNovels = getFromCacheObject(\"likeNovels\")\n    if (likeNovels === null) likeNovels = []\n    novelIds.forEach(novelId => {\n        if (likeNovels && !likeNovels.includes(Number(novelId))) {\n            sleep(0.5 * 1000 * Math.random())\n            let resp = getPostBody(\n                \"https://www.pixiv.net/ajax/novels/bookmarks/add\",\n                JSON.stringify({\"novel_id\": novelId, \"restrict\": 0, \"comment\": \"\", \"tags\": []})\n            )\n\n            if (resp.error === true) {\n                sleepToast(`â¤ï¸ æ”¶è—ç³»åˆ—\\n\\nâš ï¸ æ”¶è—ã€${novelId}ã€‘å¤±è´¥`)\n                shareFactory(\"series\")\n            } else if (resp.body === null) {\n                // sleepToast(`â¤ï¸ æ”¶è—å°è¯´\\n\\nâœ… å·²ç»æ”¶è—ã€${novel.title}ã€‘äº†`)\n            } else {\n                putInCacheObject(`collect${novelId}`, resp.body)\n                likeNovels.push(Number(novelId))\n\n                let novelObj = getAjaxJson(urlNovelDetailed(novelId))\n                novelObj.body.isBookmark = true\n                putInCacheObject(urlNovelDetailed(novelId), novelObj, cacheSaveSeconds)\n            }\n        }\n    })\n    putInCacheObject(\"likeNovels\", likeNovels)\n    sleepToast(`â¤ï¸ æ”¶è—ç³»åˆ—\\n\\nâœ… å·²ç»æ”¶è—ã€${novel.seriesTitle}ã€‘å…¨éƒ¨ç« èŠ‚`)\n}\n\nfunction novelMarker(page) {\n    if (page === undefined) page = 1\n    let novel = getNovel()\n    let lastMarker = getFromCacheObject(`marker${novel.id}`)\n    if (lastMarker === true) page = 0\n\n    let resp = getPostBody(\n        \"https://www.pixiv.net/novel/rpc_marker.php\",\n        `mode=save&i_id=${novel.id}&u_id=${getFromCacheObject(\"pixiv:uid\")}&page=${page}`\n    )\n    java.log(`mode=save&i_id=${novel.id}&u_id=${getFromCacheObject(\"pixiv:uid\")}&page=${page}`)\n    if (resp.error === true) {\n        sleepToast(\"ğŸ·ï¸ æ·»åŠ ä¹¦ç­¾\\n\\nâš ï¸ æ“ä½œå¤±è´¥\", 1)\n        shareFactory(\"novel\")\n    } else if (lastMarker === true) {\n        putInCache(`marker${novel.id}`, false)\n        sleepToast(`ğŸ·ï¸ æ·»åŠ ä¹¦ç­¾\\n\\nâœ… å·²åˆ é™¤ä¹¦ç­¾`)\n    } else {\n        putInCache(`marker${novel.id}`, true)\n        sleepToast(`ğŸ·ï¸ æ·»åŠ ä¹¦ç­¾\\n\\nâœ… å·²åŠ å…¥ä¹¦ç­¾`)\n    }\n}\n\nfunction seriesWatch() {\n    let novel = getNovel()\n    let resp = getPostBody(\n        `https://www.pixiv.net/ajax/novel/series/${novel.seriesId}/watch`,\n        \"{}\"\n    )\n    if (resp.error === true) {\n        sleepToast(`ğŸ“ƒ è¿½æ›´ç³»åˆ—\\n\\nâš ï¸ è¿½æ›´ã€${novel.seriesTitle}ã€‘å¤±è´¥`, 1)\n        shareFactory(\"series\")\n    } else {\n        putInCache(`watch${novel.seriesId}`, true)\n        sleepToast(`ğŸ“ƒ è¿½æ›´ç³»åˆ—\\n\\nâœ… å·²è¿½æ›´ã€${novel.seriesTitle}ã€‘`)\n\n        let watchedSeries = getFromCacheObject(\"watchedSeries\")\n        watchedSeries.push(Number(novel.seriesId))\n        putInCacheObject(\"watchedSeries\", watchedSeries)\n\n        let novelObj = getAjaxJson(urlSeriesDetailed(novel.seriesId))\n        novelObj.body.isWatched = true\n        putInCacheObject(urlSeriesDetailed(novel.seriesId), novelObj, cacheSaveSeconds)\n    }\n}\n\nfunction seriesUnWatch() {\n    let novel = getNovel()\n    let resp = getPostBody(\n        `https://www.pixiv.net/ajax/novel/series/${novel.seriesId}/unwatch`,\n        \"{}\"\n    )\n    if (resp.error === true) {\n        sleepToast(`ğŸ“ƒ è¿½æ›´ç³»åˆ—\\n\\nâš ï¸ å–æ¶ˆè¿½æ›´ã€${novel.seriesTitle}ã€‘å¤±è´¥`, 1)\n        shareFactory(\"series\")\n    } else {\n        cache.delete(`watch${novel.seriesId}`)\n        sleepToast(`ğŸ“ƒ è¿½æ›´ç³»åˆ—\\n\\nâœ… å·²å–æ¶ˆè¿½æ›´ã€${novel.seriesTitle}ã€‘`)\n\n        let watchedSeries = getFromCacheObject(\"watchedSeries\")\n        watchedSeries = watchedSeries.filter(item => item !== Number(novel.seriesId))\n        putInCacheObject(\"watchedSeries\", watchedSeries)\n\n        let novelObj = getAjaxJson(urlSeriesDetailed(novel.seriesId))\n        novelObj.body.isWatched = false\n        putInCacheObject(urlSeriesDetailed(novel.seriesId), novelObj, cacheSaveSeconds)\n    }\n}\n\nfunction seriesWatchFactory(code) {\n    if (code === undefined) code = 1\n    let novel = getNovel()\n    if (!novel.seriesId) {\n        return sleepToast(`ğŸ“ƒ è¿½æ›´ç³»åˆ—\\n\\nâš ï¸ ã€${novel.title}ã€‘éç³»åˆ—å°è¯´ï¼Œæ— æ³•åŠ å…¥è¿½æ›´åˆ—è¡¨`)\n    }\n\n    let lastStatus = getFromCacheObject(`watch${novel.seriesId}`)\n    if (lastStatus === true) code = 0\n    if (code === 0) seriesUnWatch()\n    else if (code === 1) seriesWatch()\n}\n\nfunction userFollow(restrict) {\n    if (restrict === undefined) restrict = 0\n    let novel = getNovel()\n    let resp = getPostBody(\n        \"https://www.pixiv.net/bookmark_add.php\",\n        `mode=add&type=user&user_id=${novel.userId}&tag=\"\"&restrict=${restrict}&format=json`\n    )\n    if (resp.error === true) {\n        sleepToast(`â­ï¸ å…³æ³¨ä½œè€…\\n\\nâš ï¸ å…³æ³¨ã€${novel.userName}ã€‘å¤±è´¥`, 1)\n\n        java.startBrowserAwait(`${urlUserUrl(novel.userId)},\n    {\"headers\": {\"User-Agent\": \"Mozilla/5.0 (Linux; Android 10; K) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/119.0.0.0 Mobile Safari/537.36\" }}`, `å…³æ³¨${novel.userName}`, false)\n        let lastStatus = getAjaxJson(urlUserDetailed(novel.userId), true).body.isFollowed\n        if (lastStatus) sleepToast(`â­ï¸ å…³æ³¨ä½œè€…\\n\\nâœ… å·²å…³æ³¨ã€${novel.userName}ã€‘`)\n\n    } else {\n        sleepToast(`â­ï¸ å…³æ³¨ä½œè€…\\n\\nâœ… å·²å…³æ³¨ã€${novel.userName}ã€‘`)\n    }\n}\n\nfunction userUnFollow() {\n    let novel = getNovel()\n    let resp = getPostBody(\n        \"https://www.pixiv.net/rpc_group_setting.php\",\n        `mode=del&type=bookuser&id=${novel.userId}`\n    )\n    if (resp.error === true) {\n        sleepToast(`â­ï¸ å…³æ³¨ä½œè€…\\n\\nâš ï¸ å–æ¶ˆå…³æ³¨ã€${novel.userName}ã€‘å¤±è´¥`, 1)\n        shareFactory(\"author\")\n    } else {\n        sleepToast(`â­ï¸ å…³æ³¨ä½œè€…\\n\\nâœ… å·²å–æ¶ˆå…³æ³¨ã€${novel.userName}ã€‘`)\n    }\n}\n\nfunction userFollowFactory(code) {\n    if (code === undefined) code = 1\n    let novel = getNovel()\n\n    let lastStatus = getAjaxJson(urlUserDetailed(novel.userId), true).body.isFollowed\n    if (lastStatus) userUnFollow()\n    else userFollow()\n}\n\nfunction userBlock() {\n    let authors = getFromCacheObject(\"blockAuthorList\")\n    if (!authors) authors = []\n    let authorsMap = getFromCacheMap(\"blockAuthorMap\")\n    if (!authorsMap || authorsMap.size === 0) {\n        authorsMap = new Map()\n        authors.forEach(author => {\n            authorsMap.set(author, getAjaxJson(urlUserDetailed(author)).body.name)\n        })\n    }\n\n    let novel = getNovel()\n    if (authorsMap.has(String(novel.userId))) {\n        authorsMap.delete(String(novel.userId))\n        sleepToast(`ğŸš« å±è”½ä½œè€…\\n\\nâœ… å·²å–æ¶ˆå±è”½ã€${novel.userName}ã€‘\\nç°å·²æ¢å¤æ˜¾ç¤ºå…¶å°è¯´`)\n    } else if (!!novel.userId) {\n        authorsMap.set(String(novel.userId), novel.userName)\n        sleepToast(`ğŸš« å±è”½ä½œè€…\\n\\nâœ… æœ¬åœ°å·²å±è”½ã€${novel.userName}ã€‘\\nä»Šåä¸å†æ˜¾ç¤ºå…¶å°è¯´`)\n    }\n\n    authors = Array.from(authorsMap.keys())\n    putInCacheObject(\"blockAuthorList\", authors)\n    putInCacheMap(\"blockAuthorMap\", authorsMap)\n    // source.setVariable(authors.toString())\n    // sleepToast(JSON.stringify(authors))\n}\n\n// æ‹†åˆ†é•¿è¯„è®º\nfunction splitComments(text) {\n    if (!text) return []\n    let limit = 140\n\n    // 1. é¢„ç•™åºå·ç©ºé—´ï¼ˆä¾‹å¦‚ \" (10/10)\" å  8 ä¸ªå­—ç¬¦ï¼Œé¢„ç•™ 10 ä¸ªä»¥é˜²ä¸‡ä¸€ï¼‰\n    const reservedSpace = 10\n    const safeLimit = limit - reservedSpace\n\n    // 2. æ ¸å¿ƒæ‹†åˆ†é€»è¾‘\n    let chars = Array.from(text.trim())\n    let tempSegments = []\n\n    const strongPunc = /[ã€‚ï¼ï¼Ÿâ€¦\\uff0e\\uff01\\uff1f!?.â€¦]/ // å¼ºæ–­å¥æ ‡ç‚¹\n    const weakPunc = /[\\uff0c\\uff1b,;]/                // å¼±æ–­å¥æ ‡ç‚¹\n\n    while (chars.length > 0) {\n        if (chars.length <= safeLimit) {\n            tempSegments.push(chars.join('').trim())\n            break\n        }\n\n        let chunk = chars.slice(0, safeLimit)\n        let splitIndex = -1\n\n        // ä¼˜å…ˆçº§ 1: æ¢è¡Œç¬¦\n        for (let i = chunk.length - 1; i >= 0; i--) {\n            if (chunk[i] === '\\n') {\n                splitIndex = i\n                break\n            }\n        }\n\n        // ä¼˜å…ˆçº§ 2: å¼ºæ ‡ç‚¹ï¼ˆã€‚ï¼ï¼Ÿç­‰ï¼‰\n        if (splitIndex === -1) {\n            for (let i = chunk.length - 1; i >= 0; i--) {\n                if (strongPunc.test(chunk[i])) {\n                    splitIndex = i\n                    break\n                }\n            }\n        }\n\n        // ä¼˜å…ˆçº§ 3: å¼±æ ‡ç‚¹ï¼ˆä»…åœ¨æ²¡æ‰¾åˆ°å¼ºæ ‡ç‚¹æ—¶ä½¿ç”¨é€—å·ï¼‰\n        if (splitIndex === -1) {\n            for (let i = chunk.length - 1; i >= 0; i--) {\n                if (weakPunc.test(chunk[i])) {\n                    splitIndex = i\n                    break\n                }\n            }\n        }\n\n        // å…œåº•: ç¡¬æˆªæ–­\n        if (splitIndex === -1) {\n            splitIndex = safeLimit - 1\n        }\n\n        // æˆªå–å¹¶æ¸…ç†\n        let segment = chars.slice(0, splitIndex + 1).join('').trim();\n        if (segment) tempSegments.push(segment)\n\n        // ç§»é™¤å·²å¤„ç†å­—ç¬¦å¹¶è·³è¿‡å¼€å¤´çš„ç©ºç™½\n        chars = chars.slice(splitIndex + 1);\n        while (chars.length > 0 && (chars[0] === '\\n' || chars[0] === ' ')) {\n            chars.shift()\n        }\n    }\n\n    // 3. æ³¨å…¥åºå·\n    const total = tempSegments.length;\n    if (total <= 1) return tempSegments;\n    return tempSegments.map((content, i) => `${content} (${i + 1}/${total})`).reverse();\n}\n\nfunction novelCommentAdd() {\n    let resp, novel = getNovel()\n    let userId = getFromCacheObject(\"pixiv:uid\")\n    let comment = String(result.get(\"æ–‡æœ¬æ¡†\")).trim()\n    if (comment === \"\") {\n        return sleepToast(`âœ… å‘é€è¯„è®º\\nâš ï¸ è¯·åœ¨ã€æ–‡æœ¬æ¡†ã€‘å†…è¾“å…¥è¯„è®º\\n\\nè¾“å…¥ã€è¯„è®ºå†…å®¹ï¼›è¯„è®ºIDã€‘å¯å›å¤è¯¥æ¡è¯„è®ºï¼Œå¦‚ã€éå¸¸å–œæ¬¢ï¼›123456ã€‘`)\n    }\n\n    let comments = splitComments(comment)\n    if (comments.length >= 2) sleepToast(\"âœ… å‘é€è¯„è®º\\n\\næ­£åœ¨æ‹†åˆ†é•¿è¯„è®ºï¼Œå³å°†é€æ¡å‘é€\")\n    comments.forEach(comment => {\n        sleep(0.5 * 1000 * Math.random())\n        let matched = comment.match(RegExp(/(ï¼›|;\\s*)\\d{8,}/))\n        if (matched) {\n            let commentId = comment.match(new RegExp(/ï¼›(\\d{8,})/))[1]\n            comment = comment.replace(new RegExp(`(ï¼›|;\\s*)${commentId}`), \"\")\n            resp = getPostBody(\n                \"https://www.pixiv.net/novel/rpc/post_comment.php\",\n                `type=comment&novel_id=${novel.id}&author_user_id=${userId}&comment=${encodeURI(comment)}&parent_id=${commentId}`)\n        } else {\n            resp = getPostBody(\n                \"https://www.pixiv.net/novel/rpc/post_comment.php\",\n                `type=comment&novel_id=${novel.id}&author_user_id=${userId}&comment=${encodeURI(comment)}`\n            )\n        }\n\n        if (resp.error === true) {\n            sleepToast(\"âœ… å‘é€è¯„è®º\\n\\nâš ï¸ è¯„è®ºå¤±è´¥\", 1)\n            shareFactory(\"novel\")\n        } else {\n            sleepToast(`âœ… å‘é€è¯„è®º\\n\\nâœ… å·²åœ¨ã€${novel.title}ã€‘å‘å¸ƒè¯„è®ºï¼š\\n${comment}`, 1)\n        }\n    })\n    try {java.refreshContent()} catch(err) {}\n    if (comments.length >= 2) sleepToast(\"âœ… å‘é€è¯„è®º\\n\\nâœ… é•¿è¯„è®ºå·²å‘é€å®Œæ¯•\", 1)\n}\n\nfunction getNovelCommentID(novelId, commentText) {\n    let list = [], uid = String(getFromCacheObject(\"pixiv:uid\"))\n    let resp = getAjaxJson(urlNovelComments(novelId, 0, 50), true)\n    resp.body.comments.forEach(comment => {\n        if (comment.userId === uid && comment.comment === commentText) list.push(comment.id)\n\n        if (comment.hasReplies === true) {\n            let resp = getAjaxJson(urlNovelCommentsReply(comment.id, 1), true)\n            resp.body.comments.forEach(comment => {\n                if (comment.userId === uid && comment.comment === commentText) list.push(comment.id)\n            })\n        }\n    })\n    // java.log(JSON.stringify(list))\n    return list\n}\n\nfunction novelCommentDelete() {\n    let commentIDs, novel = getNovel()\n    let comment = String(result.get(\"æ–‡æœ¬æ¡†\")).trim()\n    if (comment === \"\") {\n        return sleepToast(`ğŸ—‘ åˆ é™¤è¯„è®º\\nâš ï¸ è¯·åœ¨ã€æ–‡æœ¬æ¡†ã€‘å†…è¾“å…¥éœ€è¦åˆ é™¤çš„ã€è¯„è®ºIDã€‘ï¼Œä»¥åˆ†å·é—´éš”\\næˆ–è¾“å…¥éœ€è¦åˆ é™¤çš„ã€è¯„è®ºå†…å®¹ã€‘\\n\\nå¦‚ï¼šã€123ï¼›456ï¼›789ã€‘\\næˆ–ã€æ¨¡æ‹Ÿè¯„è®ºå†…å®¹ã€‘`)\n    }\n\n    if (RegExp(/[ï¼›;]/).test(comment)) {\n        commentIDs = comment.split(/[ï¼›;]/)\n            .map(item => item.trim())         // å»é™¤æ¯ä¸ªå…ƒç´ å‰åçš„ç©ºæ ¼\n            .filter(item => item !== \"\")     // è¿‡æ»¤æ‰å› ä¸ºæœ«å°¾åˆ†å·äº§ç”Ÿçš„ç©ºé¡¹\n    } else if (RegExp(/\\d{8,}/).test(comment)) {\n        let matched = comment.match(/\\d{8,}/g)\n        commentIDs = Array.from(matched || [])\n    } else {\n        commentIDs = getNovelCommentID(novel.id, comment)\n        // java.log(JSON.stringify(commentIDs))\n        if (commentIDs.length === 0) {\n            return sleepToast(`ğŸ—‘ åˆ é™¤è¯„è®º\\n\\nâš ï¸ æœªèƒ½æ‰¾åˆ°è¿™æ¡è¯„è®º\\nè¯·æ£€æŸ¥æ˜¯å¦æœ‰é”™åˆ«å­—æˆ–æ ‡ç‚¹ç¬¦å·æ˜¯å¦ä¸€è‡´`)\n        }\n    }\n\n    commentIDs.forEach(commentID =>{\n        sleep(0.5 * 1000 * Math.random())\n        let resp = getPostBody(\n            \"https://www.pixiv.net/novel/rpc_delete_comment.php\",\n            `i_id=${novel.id}&del_id=${commentID}`\n        )\n        // java.log(JSON.stringify(resp))\n        if (resp.error === true) {\n            sleepToast(\"ğŸ—‘ åˆ é™¤è¯„è®º\\n\\nâš ï¸ è¯„è®ºåˆ é™¤å¤±è´¥\", 1)\n            shareFactory(\"novel\")\n        } else {\n            let isCommentText = !RegExp(/[ï¼›;]/).test(comment) && !RegExp(/\\d{8,}/).test(comment)\n            let toastComment = isCommentText ? comment : commentID\n            sleepToast(`ğŸ—‘ åˆ é™¤è¯„è®º\\n\\nâœ… å·²åœ¨ã€${novel.title}ã€‘åˆ é™¤è¯„è®ºï¼š\\n${toastComment}`, 1)\n        }\n    })\n    try {java.refreshContent()} catch(err) {}\n    if (comments.length >= 2) sleepToast(\"ğŸ—‘ åˆ é™¤è¯„è®º\\n\\nâœ… è¯„è®ºå·²åˆ é™¤å®Œæ¯•\", 1)\n}\n\nfunction novelPollAnswer() {\n    let novel = getNovel()\n    // novel.pollChoicesCount = getAjaxJson(urlNovelDetailed(novel.id)).body.pollData.selectedValue\n    if (!novel.pollChoicesCount) {\n        return sleepToast(`ğŸ“ƒ å°è¯´æŠ•ç¥¨\\n\\nâš ï¸ è¯¥å°è¯´ã€${novel.title}ã€‘æ— æŠ•ç¥¨ä¿¡æ¯ï¼Œå»ºè®®ã€æ¸…é™¤ç¼“å­˜ã€‘ã€åˆ·æ–°ã€‘åé‡è¯•`)\n    }\n\n    let choiceId = String(result.get(\"æ–‡æœ¬æ¡†\")).trim()\n    if (!choiceId) {\n        return sleepToast(`ğŸ“ƒ å°è¯´æŠ•ç¥¨\\n\\nâš ï¸ æŠ•ç¥¨å¤±è´¥ï¼šè¯·åœ¨ã€æ–‡æœ¬æ¡†ã€‘å†…è¾“å…¥æŠ•ç¥¨é€‰é¡¹(æ•°å­—)`)\n    } else if (Number(choiceId) > novel.pollData.selectedValue) {\n        return sleepToast(`ğŸ“ƒ å°è¯´æŠ•ç¥¨\\n\\nâš ï¸ æŠ•ç¥¨å¤±è´¥ï¼šé€‰é¡¹${choiceId}è¶…å‡ºèŒƒå›´`)\n    } else if (Number(choiceId) <= 0 || Number(choiceId) > novel.pollChoicesCount) {\n        return sleepToast(`ğŸ“ƒ å°è¯´æŠ•ç¥¨\\n\\nâš ï¸ æŠ•ç¥¨å¤±è´¥ï¼šé€‰é¡¹${choiceId}è¶…å‡ºèŒƒå›´`)\n    }\n\n    let resp = getPostBody(\n        `https://www.pixiv.net/ajax/novel/${novel.id}/poll/answer`,\n        JSON.stringify({\"choice_id\": choiceId})\n    )\n    // 200 æˆåŠŸï¼Œ403 é‡å¤æŠ•ç¥¨ï¼Œ400 é€‰é¡¹è¶…è¿‡èŒƒå›´\n    if (resp.error === true) {\n        if (resp.errMsg.includes(\"403\")) {\n            sleepToast(`ğŸ“ƒ å°è¯´æŠ•ç¥¨\\n\\nâœ… å·²ç»æŠ•è¿‡ç¥¨äº†`)\n        } else {\n            sleepToast(`ğŸ“ƒ å°è¯´æŠ•ç¥¨\\n\\nâš ï¸ æŠ•ç¥¨å¤±è´¥`)\n            shareFactory(\"novel\")\n        }\n    } else {\n        sleepToast(`ğŸ“ƒ å°è¯´æŠ•ç¥¨\\n\\nâœ… æŠ•ç¥¨æˆåŠŸ`)\n    }\n}\n\nlet wordsType = {\n    \"caption\": \"ğŸ“ƒ ç®€ä»‹å±è”½åˆ—è¡¨\",\n    \"tags\": \"#ï¸ æ ‡ç­¾å±è”½åˆ—è¡¨\",\n    \"authors\": \"ğŸ‘¤ ä½œè€…å±è”½åˆ—è¡¨\"\n}\n\nfunction printAuthorMap(map) {\n    let text = \"\"\n    map.forEach((value, key) => {\n        text += `@${value} ${key}\\n`\n    })\n    return text.trim()\n}\n\nfunction blockShowFactory() {\n    let keys = Object.keys(wordsType)\n    let key = getFromCacheObject(\"wordsType\")\n\n    // åˆ‡æ¢å±è”½åˆ—è¡¨\n    let index = keys.indexOf(key) + 1\n    if (index === keys.length) index = 0\n    key = keys[index]\n    putInCacheObject(\"wordsType\", key)\n\n    if (key === \"authors\") {\n        let words = printAuthorMap(getFromCacheMap(\"blockAuthorMap\"))\n        if (!words) words = \"\"\n        sleepToast(`ğŸ‘€ æŸ¥çœ‹å±è”½\\n${wordsType[key]}\\n\\n${words}`, 2)\n    } else {\n        let words = getFromCacheObject(`${key}BlockWords`)\n        if (!words) words = []\n        sleepToast(`ğŸ‘€ æŸ¥çœ‹å±è”½\\n${wordsType[key]}\\n\\n${words.join(\"\\n\")}`, 2)\n    }\n}\n\nfunction blockWordAdd() {\n    let method = getFromCacheObject(\"wordsType\")\n    let blockWords = getFromCacheObject(`${method}BlockWords`)\n    if (blockWords === null) blockWords = []\n\n    let word = String(result.get(\"æ–‡æœ¬æ¡†\")).trim()\n    if (word === \"\") {\n        sleepToast(`ğŸš« æ·»åŠ å±è”½\\n${wordsType[method]}\\n\\nâš ï¸ è¯·åœ¨ã€æ–‡æœ¬æ¡†ã€‘å†…è¾“å…¥å±è”½è¯`)\n    } else if (blockWords.includes(word)) {\n        sleepToast(`ğŸš« æ·»åŠ å±è”½\\n${wordsType[method]}\\n\\nâœ… ã€${word}ã€‘å·²ç»åŠ å…¥å±è”½åˆ—è¡¨äº†`)\n    } else {\n        blockWords.push(word)\n        putInCacheObject(`${method}BlockWords`, blockWords)\n        sleepToast(`ğŸš« æ·»åŠ å±è”½\\n${wordsType[method]}\\n\\nâœ… å·²å°†ã€${word}ã€‘åŠ å…¥å±è”½åˆ—è¡¨ä¸­`)\n    }\n}\n\nfunction blockWordDelete() {\n    let method = getFromCacheObject(\"wordsType\")\n    let blockWords = getFromCacheObject(`${method}BlockWords`)\n    if (blockWords === null) blockWords = []\n\n    let word = String(result.get(\"æ–‡æœ¬æ¡†\")).trim()\n    if (word === \"\") {\n        sleepToast(`â­•ï¸ åˆ é™¤å±è”½\\n${wordsType[method]}\\n\\nâš ï¸ è¯·åœ¨ã€æ–‡æœ¬æ¡†ã€‘å†…è¾“å…¥å±è”½è¯`)\n    } else if (!blockWords.includes(word)) {\n        sleepToast(`â­•ï¸ åˆ é™¤å±è”½\\n${wordsType[method]}\\n\\nâš ï¸ ã€${word}ã€‘ä¸åœ¨å±è”½åˆ—è¡¨\\nè¯·æ£€æŸ¥æ˜¯å¦æœ‰é”™åˆ«å­—æˆ–æ ‡ç‚¹ç¬¦å·æ˜¯å¦ä¸€è‡´`)\n    } else {\n        blockWords = blockWords.filter(item => item !== word)\n        putInCacheObject(`${method}BlockWords`, blockWords)\n        sleepToast(`â­•ï¸ åˆ é™¤å±è”½\\n${wordsType[method]}\\n\\nâœ… å·²åˆ é™¤å±è”½è¯ã€${word}ã€‘`)\n    }\n}\n\nfunction blockAuthorAdd() {\n    let method = getFromCacheObject(\"wordsType\")\n    let blockAuthors = getFromCacheMap(`blockAuthorMap`)\n\n    let word = String(result.get(\"æ–‡æœ¬æ¡†\")).trim()\n    if (word === \"\") {\n        sleepToast(`ğŸš« æ·»åŠ å±è”½\\n${wordsType[method]}\\n\\nâš ï¸ è¯·åœ¨ã€æ–‡æœ¬æ¡†ã€‘å†…è¾“å…¥ã€ä½œè€…IDã€‘\\næˆ–ä½¿ç”¨ä¸Šæ–¹ ğŸš« å±è”½ä½œè€…`)\n    } else if (blockAuthors.has(word)) {\n        let text = `${blockAuthors.get(word)} ${word}`\n        sleepToast(`ğŸš« æ·»åŠ å±è”½\\n${wordsType[method]}\\n\\nâœ… ã€${text}ã€‘å·²ç»åŠ å…¥å±è”½åˆ—è¡¨äº†`)\n    }\n    // è¾“å…¥çº¯æ•°å­—ï¼Œæ·»åŠ å¯¹åº”IDçš„ä½œè€…\n    else if (!isNaN(word)) {\n        let user = getAjaxJson(urlUserDetailed(word)).body\n        blockAuthors.set(user.userId, user.name)\n        let text = `@${user.name} ${user.userId}`\n        sleepToast(`ğŸš« æ·»åŠ å±è”½\\n${wordsType[method]}\\n\\nâœ… å·²å°†ã€${text}ã€‘åŠ å…¥å±è”½åˆ—è¡¨ä¸­`)\n    }\n    else if (word) {\n        sleepToast(`ğŸš« æ·»åŠ å±è”½\\n${wordsType[method]}\\n\\nâš ï¸ è¾“å…¥ã€ç”¨æˆ·IDã€‘å¯å±è”½è¯¥ä½œè€…`)\n    }\n    putInCacheMap(`blockAuthorMap`, blockAuthors)\n}\n\nfunction blockAuthorDelete() {\n    let method = getFromCacheObject(\"wordsType\")\n    let blockAuthors = getFromCacheMap(`blockAuthorMap`)\n\n    let word = String(result.get(\"æ–‡æœ¬æ¡†\")).trim()\n    if (word === \"\") {\n        sleepToast(`â­•ï¸ åˆ é™¤å±è”½\\n${wordsType[method]}\\n\\nâš ï¸ è¯·åœ¨ã€æ–‡æœ¬æ¡†ã€‘å†…è¾“å…¥ã€ä½œè€…IDã€‘\\næˆ–ä½¿ç”¨ä¸Šæ–¹ ğŸš« å±è”½ä½œè€…`)\n    }\n    // è¾“å…¥çº¯æ•°å­—ï¼Œåˆ é™¤å¯¹åº”IDçš„ä½œè€…\n    else if (!isNaN(word) && blockAuthors.has(word)) {\n        let text = `@${blockAuthors.get(word)} ${word}`\n        blockAuthors.delete(word)\n        sleepToast(`â­•ï¸ åˆ é™¤å±è”½\\n${wordsType[method]}\\n\\nâœ… å·²åˆ é™¤ã€${text}ã€‘`)\n    }\n    //ä½œè€…åç§°\n    else if (Array.from(blockAuthors.values()).includes(word)) {\n        let index = Array.from(blockAuthors.values()).indexOf(word)\n        let key = Array.from(blockAuthors.keys())[index]\n        let text = `@${blockAuthors.get(key)} ${key}`\n        blockAuthors.delete(key)\n        sleepToast(`â­•ï¸ åˆ é™¤å±è”½\\n${wordsType[method]}\\n\\nâœ… å·²åˆ é™¤ã€${text}ã€‘`)\n    }\n    else if (word) {\n        sleepToast(`â­•ï¸ åˆ é™¤å±è”½\\n${wordsType[method]}\\n\\nâš ï¸ è¾“å…¥ã€ç”¨æˆ·IDã€‘å¯å±è”½è¯¥ä½œè€…`)\n    }\n    putInCacheMap(`blockAuthorMap`, blockAuthors)\n}\n\nfunction blockAddFactory() {\n    if (getFromCacheObject(\"wordsType\") === \"authors\") return blockAuthorAdd()\n    else return blockWordAdd()\n}\n\nfunction blockDeleteFactory() {\n    if (getFromCacheObject(\"wordsType\") === \"authors\") return blockAuthorDelete()\n    else return blockWordDelete()\n}\n\n\nfunction likeTagsShow() {\n    let likeTags = getFromCacheObject(`likeTags`)\n    if (likeTags === null) likeTags = []\n    sleepToast(`ğŸ‘€ æŸ¥çœ‹æ ‡ç­¾\\nğŸ“Œ å–œæ¬¢æ ‡ç­¾\\n\\n${likeTags.join(\"ã€\")}`, 5)\n}\n\nfunction likeTagsAdd() {\n    let likeTags = getFromCacheObject(`likeTags`)\n    if (likeTags === null) likeTags = []\n\n    let word = String(result.get(\"æ–‡æœ¬æ¡†\")).trim()\n    if (word === \"\") {\n        sleepToast(`ğŸ“Œ å–œæ¬¢æ ‡ç­¾\\nğŸ“Œ æ·»åŠ æ ‡ç­¾\\n\\nâš ï¸ è¯·åœ¨ã€æ–‡æœ¬æ¡†ã€‘å†…ç›´æ¥è¾“å…¥æ ‡ç­¾å†…å®¹`)\n    } else if (word.startsWith(\"@\") || word.startsWith(\"ï¼ \")) {\n        sleepToast(`ğŸ“Œ å–œæ¬¢æ ‡ç­¾\\nğŸ“Œ æ·»åŠ æ ‡ç­¾\\n\\nâš ï¸ ä»…æ”¯æŒæ·»åŠ ã€æ ‡ç­¾ã€‘\\nä¸æ”¯æŒæ·»åŠ  @ä½œè€…åç§°`)\n    } else if (word.startsWith(\"#\") || word.startsWith(\"ï¼ƒ\")) {\n        sleepToast(`ğŸ“Œ å–œæ¬¢æ ‡ç­¾\\nğŸ“Œ æ·»åŠ æ ‡ç­¾\\n\\nâš ï¸ ä»…æ”¯æŒæ·»åŠ ã€æ ‡ç­¾ã€‘\\nä¸æ”¯æŒæ·»åŠ  #æ ‡ç­¾åç§°`)\n    } else if (likeTags.includes(word)) {\n        sleepToast(`ğŸ“Œ å–œæ¬¢æ ‡ç­¾\\nğŸ“Œ æ·»åŠ æ ‡ç­¾\\n\\nâœ… ã€${word}ã€‘å·²ç»åŠ å…¥å–œæ¬¢æ ‡ç­¾äº†\\nè¯·äºå‘ç°é¡µåˆ·æ–°åæŸ¥çœ‹`)\n    } else {\n        likeTags.push(word)\n        putInCacheObject(`likeTags`, likeTags)\n        sleepToast(`ğŸ“Œ å–œæ¬¢æ ‡ç­¾\\nğŸ“Œ æ·»åŠ æ ‡ç­¾\\n\\nâœ… å·²å°†ã€${word}ã€‘åŠ å…¥å–œæ¬¢æ ‡ç­¾äº†`)\n        try {source.refreshExplore()} catch (e) {}\n    }\n}\n\nfunction likeTagsDelete() {\n    let likeTags = getFromCacheObject(`likeTags`)\n    if (likeTags === null) likeTags = []\n\n    let word = String(result.get(\"æ–‡æœ¬æ¡†\")).trim()\n    if (word === \"\") {\n        sleepToast(`ğŸ“Œ å–œæ¬¢æ ‡ç­¾\\nğŸ—‘ åˆ é™¤æ ‡ç­¾\\n\\nâš ï¸ è¯·åœ¨ã€æ–‡æœ¬æ¡†ã€‘å†…ç›´æ¥è¾“å…¥æ ‡ç­¾å†…å®¹`)\n    } else if (!likeTags.includes(word)) {\n        sleepToast(`ğŸ“Œ å–œæ¬¢æ ‡ç­¾\\nğŸ—‘ åˆ é™¤æ ‡ç­¾\\n\\nâš ï¸ ã€${word}ã€‘ä¸åœ¨å–œæ¬¢æ ‡ç­¾\\nè¯·æ£€æŸ¥æ˜¯å¦æœ‰é”™åˆ«å­—`)\n    } else {\n        likeTags = likeTags.filter(item => item !== word)\n        putInCacheObject(`likeTags`, likeTags)\n        sleepToast(`ğŸ“Œ å–œæ¬¢æ ‡ç­¾\\nğŸ—‘ åˆ é™¤æ ‡ç­¾\\n\\nâœ… å·²åˆ é™¤è¯¥æ ‡ç­¾ã€${word}ã€‘`)\n        try {source.refreshExplore()} catch (e) {}\n    }\n}\n\n\nfunction likeAuthorsShow() {\n    let text = printAuthorMap(getFromCacheMap(`likeAuthors`))\n    sleepToast(`ğŸ‘€ æŸ¥çœ‹æ”¶è—\\nâ¤ï¸ ä»–äººæ”¶è—\\n\\n${text.trim()}`, 2)\n}\n\nfunction likeAuthorsAdd() {\n    let likeAuthors = getFromCacheMap(`likeAuthors`)\n    let word = String(result.get(\"æ–‡æœ¬æ¡†\")).trim()\n    if (word.startsWith(\"@\") || word.startsWith(\"ï¼ \")) {\n        return sleepToast(`â¤ï¸ ä»–äººæ”¶è—\\nâ¤ï¸ æ·»åŠ æ”¶è—\\n\\nâš ï¸ ä»…æ”¯æŒé€šè¿‡ã€ä½œè€…IDã€‘å…³æ³¨\\nä¸æ”¯æŒæ·»åŠ  @ä½œè€…åç§°`)\n    } else if (word.startsWith(\"#\") || word.startsWith(\"ï¼ƒ\")) {\n        return sleepToast(`â¤ï¸ ä»–äººæ”¶è—\\nâ¤ï¸ æ·»åŠ æ”¶è—\\n\\nâš ï¸ ä»…æ”¯æŒé€šè¿‡ã€ä½œè€…IDã€‘å…³æ³¨\\nä¸æ”¯æŒæ·»åŠ  #æ ‡ç­¾åç§°`)\n    } else if (likeAuthors.has(word)) {\n        let text = `${likeAuthors.get(word)} ${word}`\n        sleepToast(`â¤ï¸ ä»–äººæ”¶è—\\nâ¤ï¸ æ·»åŠ æ”¶è—\\n\\nâœ… ã€${text}ã€‘å·²ç»åŠ å…¥æ”¶è—åˆ—è¡¨äº†ï¼Œè¯·äºå‘ç°é¡µæŸ¥çœ‹`)\n    }\n\n    // æ— è¾“å…¥å†…å®¹ï¼Œæ·»åŠ å½“å‰å°è¯´çš„ä½œè€…\n    if (word === \"\") {\n        let novel = getNovel()\n        likeAuthors.set(String(novel.userId), novel.userName)\n        let text = `@${novel.userName} ${novel.userId}`\n        sleepToast(`â¤ï¸ ä»–äººæ”¶è—\\nâ¤ï¸ æ·»åŠ æ”¶è—\\n\\nâœ… å·²å°†ã€${text}ã€‘åŠ å…¥ä»–äººæ”¶è—åˆ—è¡¨äº†ï¼Œè¯·äºå‘ç°é¡µæŸ¥çœ‹\\n\\nğŸ“Œ ã€æ–‡æœ¬æ¡†ã€‘å†…è¾“å…¥ã€ç”¨æˆ·IDã€‘å¯å…³æ³¨å…¶ä»–ç”¨æˆ·çš„æ”¶è—`)\n    }\n    // è¾“å…¥çº¯æ•°å­—ï¼Œæ·»åŠ å¯¹åº”IDçš„ä½œè€…\n    else if (!isNaN(word)) {\n        let user = getAjaxJson(urlUserDetailed(word)).body\n        likeAuthors.set(user.userId, user.name)\n        let text = `@${user.name} ${user.userId}`\n        sleepToast(`â¤ï¸ ä»–äººæ”¶è—\\nï¸ æ·»åŠ æ”¶è—\\n\\nâœ… å·²å°†ã€${text}ã€‘åŠ å…¥ä»–äººæ”¶è—åˆ—è¡¨äº†ï¼Œè¯·äºå‘ç°é¡µæŸ¥çœ‹`)\n    }\n\n    else if (word) {\n        sleepToast(`â¤ï¸ ä»–äººæ”¶è—\\nâ¤ï¸ æ·»åŠ æ”¶è—\\n\\nğŸ“Œ ã€æ–‡æœ¬æ¡†ã€‘å†…è¾“å…¥ã€ç”¨æˆ·IDã€‘å¯å…³æ³¨å…¶ä»–ç”¨æˆ·çš„æ”¶è—`)\n    }\n    putInCacheMap(`likeAuthors`, likeAuthors)\n    try {source.refreshExplore()} catch (e) {}\n}\n\nfunction likeAuthorsDelete() {\n    let likeAuthors = getFromCacheMap(`likeAuthors`)\n    let word = String(result.get(\"æ–‡æœ¬æ¡†\")).trim()\n    if (word.startsWith(\"@\") || word.startsWith(\"ï¼ \")) {\n        return sleepToast(`â¤ï¸ ä»–äººæ”¶è—\\nğŸ–¤ å–æ¶ˆæ”¶è—\\n\\nâš ï¸ ä»…æ”¯æŒé€šè¿‡ã€ä½œè€…ID/ä½œè€…åç§°ã€‘å–å…³\\nä¸æ”¯æŒè¾“å…¥ @ä½œè€…åç§°`)\n    } else if (word.startsWith(\"#\") || word.startsWith(\"ï¼ƒ\")) {\n        return sleepToast(`â¤ï¸ ä»–äººæ”¶è—\\nğŸ–¤ å–æ¶ˆæ”¶è—\\n\\nâš ï¸ ä»…æ”¯æŒé€šè¿‡ã€ä½œè€…ID/ä½œè€…åç§°ã€‘å–å…³\\nä¸æ”¯æŒè¾“å…¥ #æ ‡ç­¾åç§°`)\n    }\n\n    if (word === \"\") {\n        let novel = getNovel()\n        likeAuthors.delete(novel.userId)\n        let text = `@${novel.userName} ${novel.userId}`\n        sleepToast(`â¤ï¸ ä»–äººæ”¶è—\\nğŸ–¤ å–æ¶ˆæ”¶è—\\n\\nâœ… å·²å°†ã€${text}ã€‘ç§»å‡ºä»–äººæ”¶è—åˆ—è¡¨äº†\\n\\nğŸ“Œ ã€æ–‡æœ¬æ¡†ã€‘å†…è¾“å…¥ã€ç”¨æˆ·IDã€‘å¯å–æ¶ˆå…³æ³¨å…¶ä»–ç”¨æˆ·çš„æ”¶è—`)\n\n    // è¾“å…¥çº¯æ•°å­—ï¼Œåˆ é™¤å¯¹åº”IDçš„ä½œè€…\n    } else if (!isNaN(word) && likeAuthors.has(word)) {\n        let text = `@${likeAuthors.get(word)} ${word}`\n        likeAuthors.delete(word)\n        sleepToast(`â¤ï¸ ä»–äººæ”¶è—\\nğŸ–¤ å–æ¶ˆæ”¶è—\\n\\nâœ… å·²å–å…³ã€${text}ã€‘`)\n\n    //ä½œè€…åç§°\n    } else if (Array.from(likeAuthors.values()).includes(word)) {\n        let index = Array.from(likeAuthors.values()).indexOf(word)\n        let key = Array.from(likeAuthors.keys())[index]\n        let text = `@${likeAuthors.get(key)} ${key}`\n        likeAuthors.delete(key)\n        sleepToast(`â¤ï¸ ä»–äººæ”¶è—\\nğŸ–¤ å–æ¶ˆæ”¶è—\\n\\nâœ… å·²å–å…³ã€${text}ã€‘`)\n    }\n    else if (word) {\n        sleepToast(`â¤ï¸ ä»–äººæ”¶è—\\nğŸ–¤ å–æ¶ˆæ”¶è—\\n\\nğŸ“Œ ã€æ–‡æœ¬æ¡†ã€‘å†…è¾“å…¥ã€ç”¨æˆ·IDã€‘å¯å–å…³å…¶ä»–ç”¨æˆ·çš„æ”¶è—`)\n    }\n    putInCacheMap(`likeAuthors`, likeAuthors)\n    try {source.refreshExplore()} catch (e) {}\n}\n\nfunction shareFactory(type) {\n    let novel = getNovel()\n    if (novel === undefined || novel === null) return sleepToast(\"âš ï¸ è¯·åœ¨å°è¯´é˜…è¯»é¡µé¢ï¼Œä½¿ç”¨æœ¬åŠŸèƒ½\")\n    if (type.includes(\"author\")) {\n        startBrowser(urlUserUrl(novel.userId), novel.userName)\n    }\n    else if (type.includes(\"novel\") || (!novel.seriesId)) {\n        startBrowser(urlNovelUrl(novel.id), novel.title)\n    }\n    else if (type.includes(\"series\") && novel.seriesId) {\n        startBrowser(urlSeriesUrl(novel.seriesId), novel.seriesTitle)\n    }\n}\n\nfunction startPixivSettings() {\n    startBrowser(\"https://www.pixiv.net/settings/viewing\", \"è´¦å·è®¾ç½®\")\n}\nfunction startGithubReadme() {\n    startBrowser(\"https://pixivsource.pages.dev/Pixiv\", \"ä½¿ç”¨æŒ‡å—\")\n}\nfunction startGithubIssue() {\n    startBrowser(\"https://github.com/DowneyRem/PixivSource/issues\", \"åé¦ˆé—®é¢˜\")\n}\n\nfunction checkStatus(status) {\n    if (eval(String(status)) === true) return \"â¤ï¸\"\n    else return \"ğŸ–¤\"\n}\n\nfunction readMeSearch() {\n    return sleepToast(`ğŸ” æœç´¢è¯´æ˜\\n\n    æ ‡ç­¾ä¹‹é—´éœ€è¦ä»¥ã€ç©ºæ ¼ã€‘é—´éš”\n    â– æ’é™¤æ ‡ç­¾ï¼š#æ ‡ç­¾1 -æ ‡ç­¾2\n    ğŸ‘¤ ä½œè€…ä¸“æœï¼š@æœç´¢ä½œè€…åç§°\n    #ï¸ æ ‡ç­¾ä¸“æœï¼š#æ ‡ç­¾1 æ ‡ç­¾2 \n    â¬ å­—æ•°ç­›é€‰1ï¼š#æ ‡ç­¾1 æ ‡ç­¾2 å­—æ•°3k5\n    â¬ å­—æ•°ç­›é€‰2ï¼š@ä½œè€…çš„åç§° å­—æ•°3w5`.replace(\"    \",\"\"), 5)\n}\n\nlet settingsName = {\n    \"SEARCH_AUTHOR\": \"ğŸ” æœç´¢ä½œè€…\",\n    \"SHOW_ORIGINAL_LINK\": \"ğŸ”— åŸå§‹é“¾æ¥\",\n    \"CONVERT_CHINESE\": \"ğŸ€„ï¸ ç¹ç®€é€šæœ\",\n    \"SHOW_UPDATE_TIME\": \"ğŸ“… æ›´æ–°æ—¶é—´\",\n    \"SHOW_COMMENTS\": \"ğŸ’¬ æ˜¾ç¤ºè¯„è®º\",\n    \"MORE_INFORMATION\": \"ğŸ“– æ›´å¤šç®€ä»‹\",\n    \"REPLACE_TITLE_MARKS\": \"ğŸ“š æ¢å¤ã€Šã€‹\",\n    \"SHOW_CAPTIONS\": \"ğŸ–¼ï¸ æ˜¾ç¤ºæè¿°\",\n    \"HIDE_LIKE_NOVELS\": \"â¤ï¸ éšè—æ”¶è—\",\n    \"HIDE_WATCHED_SERIES\": \"ğŸ“ƒ éšè—è¿½æ›´\",\n    \"IPDirect\": \"âœˆï¸ ç›´è¿æ¨¡å¼\",\n    \"FAST\": \"â© å¿«é€Ÿæ¨¡å¼\",\n    \"DEBUG\": \"ğŸ è°ƒè¯•æ¨¡å¼\",\n    \"SHOW_GENERAL\": \"ğŸ†— å¸¸è§„å°è¯´\",\n    \"SHOW_NEW_ADULT\": \"ğŸ” æœ€æ–°ä¼åˆ’\",\n    \"SHOW_NEW_GENERAL\": \"ğŸ†— æœ€æ–°ä¼åˆ’\",\n    \"SHOW_RANK_ADULT\": \"ğŸ” æ’è¡Œæ¦œå•\",\n    \"SHOW_RANK_GENERAL\": \"ğŸ†— æ’è¡Œæ¦œå•\",\n    \"SHOW_GENRE_ADULT\": \"ğŸ” åŸåˆ›çƒ­é—¨\",\n    \"SHOW_GENRE_GENERAL\": \"ğŸ†— åŸåˆ›çƒ­é—¨\",\n    \"SHOW_FURRY\": \"ğŸº å…½äººå°è¯´\",\n    \"SHOW_DISCOVER\": \"âš™ï¸ å‘ç°è®¾ç½®\\nï¼ˆä¹¦æºç¼–è¾‘ç•Œé¢ï¼‰\",\n    \"SHOW_SETTINGS\": \"âš™ï¸ ä¹¦æºè®¾ç½®\\nï¼ˆä¹¦æºç¼–è¾‘ç•Œé¢ï¼‰\",\n    \"SHOW_DISCOVER2\": \"âš™ï¸ å‘ç°è®¾ç½®\\nï¼ˆå°è¯´é˜…è¯»ç•Œé¢ï¼‰\",\n    \"SHOW_SETTINGS2\": \"âš™ï¸ ä¹¦æºè®¾ç½®\\nï¼ˆå°è¯´é˜…è¯»ç•Œé¢ï¼‰\",\n}\n\nfunction statusMsg(status) {\n    if (status === true) return \"âœ… å·²å¼€å¯\"\n    else if (status === false) return \"ğŸš« å·²å…³é—­\"\n    else return \"ğŸˆšï¸ æœªè®¾ç½®\"\n}\n\n// æ£€æµ‹å¿«é€Ÿæ¨¡å¼ä¿®æ”¹çš„4ä¸ªè®¾ç½®\nfunction getSettingStatus(mode) {\n    if (mode === undefined) mode = \"\"\n    let keys = [], msgList = []\n    let settings = getFromCacheObject(\"pixivSettings\")\n    if (mode === \"FAST\") {\n        keys = Object.keys(settingsName).slice(0, 5)\n    } else if (mode === \"IPDirect\") {\n        keys = Object.keys(settingsName).slice(0, 2)\n    } else if (mode.includes(\"DISCOVER\")) {\n        keys = Object.keys(settingsName).slice(13, 21)\n    } else {\n        keys = Object.keys(settingsName).slice(0, 13)\n    }\n    for (let i in keys) {\n        msgList.push(`${statusMsg(settings[keys[i]])}ã€€${settingsName[keys[i]]}`)\n    }\n    return msgList.join(\"\\n\").trim()\n}\n\nfunction showSettings() {\n    sleepToast(`\\nâš™ï¸ å½“å‰è®¾ç½®\\n\\n${getSettingStatus()}`)\n}\nfunction showSettingsDiscover() {\n    sleepToast(`\\nâš™ï¸ å½“å‰å‘ç°è®¾ç½®\\n\\n${getSettingStatus(\"DISCOVER\")}`)\n}\n\nfunction setDefaultSettingsLoginUrl() {\n    setDefaultSettings()\n    sleepToast(`\\nâœ… å·²æ¢å¤ã€€ğŸ”§ é»˜è®¤è®¾ç½®\\n\\n${getSettingStatus()}`)\n}\n\nfunction editSettings(settingName) {\n    let msg, status\n    let settings = getFromCacheObject(\"pixivSettings\")\n    if (!settings) settings = setDefaultSettings()\n    if (!!settings[settingName]) {\n        status = settings[settingName] = !settings[settingName]\n    } else {\n        status = settings[settingName] = true\n    }\n    putInCacheObject(\"pixivSettings\", settings)\n\n    if (settingName === \"FAST\") {\n        checkSettings(settings)\n        msg = `\\n\\n${statusMsg(status)}ã€€${settingsName[settingName]}\\n\\n${getSettingStatus(settingName)}`\n    } else if (settingName === \"IPDirect\") {\n        if (settings.IPDirect && !isLogin()) {\n            msg = \"âœˆï¸ ç›´è¿æ¨¡å¼\\n\\nâœˆï¸ ç›´è¿æ¨¡å¼ éœ€ç™»å½•è´¦å·\\nå½“å‰æœªç™»å½•è´¦å·ï¼Œç°å·²å…³é—­ç›´è¿æ¨¡å¼\"\n            settings.IPDirect = false\n            checkSettings(settings)\n        } else {\n            checkSettings(settings)\n            msg = `\\n\\n${statusMsg(status)}ã€€${settingsName[settingName]}\\n\\n${getSettingStatus(settingName)}`\n        }\n        try {source.refreshExplore()} catch (e) {}\n    } else {\n        msg = `\\n\\n${statusMsg(status)}ã€€${settingsName[settingName]}`\n        if (settingName.startsWith(\"SHOW\")) try {source.refreshExplore()} catch (e) {}\n    }\n    sleepToast(msg)\n}\n\nfunction cleanCache() {\n    let novel = getNovel()\n    cache.delete(`${urlNovelUrl(novel.id)}`)\n    cache.delete(`${urlNovelDetailed(novel.id)}`)\n    try {java.refreshContent()} catch(err) {}\n    sleepToast(`ğŸ”„ åˆ·æ–°æœ¬ç« \\n\\nè‹¥æ­£æ–‡æœªæ›´æ–°ï¼Œè¯·æ‰‹åŠ¨åˆ·æ–°`, 5)\n}\n\nfunction getFurryAuthors() {\n    cache.delete(\"https://api.furrynovel.ink/fav/user/cache\")  // åˆ é™¤ç¼“å­˜å®æ—¶è¯·æ±‚æ•°æ®\n    let furryAuthorsMap = {}\n    let authorsListLinpx = getAjaxJson(\"https://api.furrynovel.ink/fav/user/cache\")\n    authorsListLinpx.forEach(author => {\n        furryAuthorsMap[author.name] = author.id || author._id\n    })\n\n    // let authorsMapFurryReading = getAjaxJson(\"\")\n    // furryAuthorsMap = Object.assign(furryAuthorsMap, authorsMapFurryReading)\n    putInCacheObject(\"furryAuthors\", furryAuthorsMap)\n    return furryAuthorsMap\n}\n\nfunction updatePixivAuthors() {\n    let furryAuthors = getFurryAuthors()\n    let pixivAuthors = getFromCacheObject(\"pixivAuthors\")\n    if (!pixivAuthors) pixivAuthors = {}\n    pixivAuthors = Object.assign(pixivAuthors, furryAuthors)\n    putInCacheObject(\"pixivAuthors\", pixivAuthors, cacheSaveSeconds)\n    sleepToast(\"\\nğŸº å…½äººä½œè€…æœç´¢ä¼˜åŒ– \\n\\n âœ… å·²å¯¼å…¥ Linpx æ¨èä½œè€…\", 1)\n    return pixivAuthors\n}",
        "respondTime": 180000,
        "ruleBookInfo": {
            "author": "userName",
            "canReName": "true",
            "coverUrl": "coverUrl",
            "init": "@js:\nvar util = objParse(String(java.get(\"util\")))\n\nfunction objParse(obj) {\n    return JSON.parse(obj, (n, v) => {\n        if (typeof v == \"string\" && v.match(\"()\")) {\n            return eval(`(${v})`)\n        }\n        return v;\n    })\n}\n\nfunction novelHandler(novel){\n    novel = util.formatNovels(util.handNovels([novel], true))[0]\n    if (novel.seriesId === undefined || novel.seriesId === null) {\n        book.bookUrl = novel.detailedUrl = urlNovelUrl(novel.id)\n        book.tocUrl = novel.catalogUrl = urlIP(urlNovelDetailed(novel.id))\n    } else {\n        book.bookUrl = novel.detailedUrl = urlSeriesUrl(novel.seriesId)\n        book.tocUrl = novel.catalogUrl = urlIP(urlSeriesDetailed(novel.seriesId))\n    }\n    // æ”¾å…¥ä¿¡æ¯ä»¥ä¾¿ç™»é™†ç•Œé¢ä½¿ç”¨\n    source.putLoginInfo(JSON.stringify(novel))\n    putInCacheObject(\"novel\", novel)\n    return novel\n}\n\n(() => {\n    return novelHandler(util.getNovelResFirst(result))\n})()",
            "intro": "description",
            "kind": "tags",
            "lastChapter": "latestChapter",
            "name": "title",
            "tocUrl": "catalogUrl",
            "wordCount": "textCount"
        },
        "ruleContent": {
            "content": "@js:\nvar util = objParse(String(java.get(\"util\")))\nlet emoji = {\n    \"normal\": 101, \"surprise\": 102, \"series\": 103, \"heaven\": 104, \"happy\": 105,\n    \"excited\": 106, \"sing\": 107, \"cry\": 108, \"normal2\": 201, \"shame2\": 202,\n    \"love2\": 203, \"interesting2\": 204, \"blush2\": 205, \"fire2\": 206, \"angry2\": 207,\n    \"shine2\": 208, \"panic2\": 209, \"normal3\": 301, \"satisfaction3\": 302, \"surprise3\": 303,\n    \"smile3\": 304, \"shock3\": 305, \"gaze3\": 306, \"wink3\": 307, \"happy3\": 308,\n    \"excited3\": 309, \"love3\": 310, \"normal4\": 401, \"surprise4\": 402, \"series4\": 403,\n    \"love4\": 404, \"shine4\": 405, \"sweet4\": 406, \"shame4\": 407, \"sleep4\": 408,\n    \"heart\": 501, \"teardrop\": 502, \"star\": 503\n}\n\nfunction objParse(obj) {\n    return JSON.parse(obj, (n, v) => {\n        if (typeof v == \"string\" && v.match(\"()\")) {\n            return eval(`(${v})`)\n        }\n        return v;\n    })\n}\n\nfunction getNovelInfo(res) {\n    // æ”¾å…¥å°è¯´ä¿¡æ¯ä»¥ä¾¿ç™»é™†ç•Œé¢ä½¿ç”¨\n    let novel = source.getLoginInfoMap()\n    if (!novel) novel = getFromCacheObject(\"novel\")\n    if (res && res.error === true) return\n    novel.id = Number(res.id)\n    novel.title = res.title\n    novel.userId = res.userId\n    novel.userName = res.userName\n\n    if (res.bookmarkData) {\n        novel.isBookmark = true\n        putInCache(`collect${novel.id}`, res.bookmarkData.id)\n        util.saveNovels(\"likeNovels\", [Number(novel.id)])\n    } else {\n        novel.isBookmark = false\n    }\n\n    if (res.seriesNavData) {\n        novel.seriesId = Number(res.seriesNavData.seriesId)\n        novel.seriesTitle = res.seriesNavData.title\n        novel.isWatched = res.seriesNavData.isWatched\n        util.saveNovels(\"watchedSeries\", [Number(novel.seriesId)])\n    } else {\n        novel.seriesId = null\n        novel.seriesTitle = \"\"\n        novel.isWatched = false\n    }\n\n    // ç³»åˆ— + é˜…è¯»ï¼Œä½¿ç”¨å½“å‰ç« èŠ‚åç§°\n    if (novel.seriesId && globalThis.environment.IS_LEGADO) {\n        let novelIds = getFromCacheObject(`novelIds${novel.seriesId}`)\n        novel.id = novelIds[book.durChapterIndex]\n        novel.title = book.durChapterTitle\n        let bookmarkId = getFromCacheObject(`collect${novel.id}`)\n        novel.isBookmark = !!bookmarkId\n    }\n\n    // æ·»åŠ æŠ•ç¥¨ä¿¡æ¯\n    if (res.pollData) novel.pollChoicesCount = res.pollData.choices.length\n    else novel.pollChoicesCount = 0\n    novel[\"ç« èŠ‚åç§°\"] = novel.title\n    source.putLoginInfo(JSON.stringify(novel))\n    putInCacheObject(\"novel\", novel)\n}\n\nfunction getCaptions(res, content)ã€€{\n    // åœ¨æ­£æ–‡å†…éƒ¨æ·»åŠ å°è¯´æè¿°\n    if (globalThis.settings.SHOW_CAPTIONS && res.description !== \"\") {\n        content = res.description + \"\\n\" + \"â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”\\n\".repeat(2) + content\n    }\n    return content\n}\n\nfunction replaceUploadedImage(res, content) {\n    // è·å– [uploadedimage:] çš„å›¾ç‰‡é“¾æ¥\n    if (res.textEmbeddedImages) {\n        Object.keys(res.textEmbeddedImages).forEach((key) => {\n            content = content.replace(`[uploadedimage:${key}]`, `<img src=\"${urlCoverUrl(res.textEmbeddedImages[key].urls.original)}\">`)\n        })\n    }\n    return content\n}\n\nfunction replacePixivImage(content) {\n    // è·å– [pixivimage:] çš„å›¾ç‰‡é“¾æ¥ [pixivimage:1234] [pixivimage:1234-1]\n    let matched = content.match(RegExp(/\\[pixivimage:(\\d+)-?(\\d+)]/gm))\n    if (matched) {\n        matched.forEach(pixivimage => {\n            let matched2, illustId, order = 0\n            if (pixivimage.includes(\"-\")) {\n                matched2 = pixivimage.match(RegExp(\"(\\\\d+)-(\\\\d+)\"))\n                illustId = matched2[1]; order = matched2[2]\n            } else {\n                matched2 = pixivimage.match(RegExp(\"\\\\d+\"))\n                illustId = matched2[0];\n            }\n            if (urlIllustOriginal(illustId, order)) {\n                content = content.replace(`${pixivimage}`, `<img src=\"${urlIllustOriginal(illustId, order)}\">`)\n            } else {\n                content = content.replace(`${pixivimage}`, ``)\n            }\n        })\n    }\n    return content\n}\n\nfunction replaceNewPage(content) {\n    // æ›¿æ¢ Pixiv åˆ†é¡µæ ‡è®°ç¬¦å· [newpage]\n    if (!globalThis.environment.IS_LEGADO_SIGMA) {\n        let matched = content.match(RegExp(/[ ã€€]*\\[newpage][ ã€€]*/gm))\n        if (matched) {\n            for (let i in matched) {\n                content = content.replace(`${matched[i]}`, `${\"<p>â€‹<p/>\".repeat(3)}`)\n            }\n        }\n    }\n    return content\n}\n\nfunction replaceChapter(content) {\n    // æ›¿æ¢ Pixiv ç« èŠ‚æ ‡è®°ç¬¦å· [chapter:]\n    let matched = content.match(RegExp(/\\[chapter:(.*?)]/gm))\n    if (matched) {\n        for (let i in matched) {\n            let matched2 = matched[i].match(/\\[chapter:(.*?)]/m)\n            let chapter = matched2[1].trim()\n            // æ›¿æ¢ Pixiv åˆ†é¡µæ ‡è®°ç¬¦å· [newpage]\n            if (globalThis.environment.IS_LEGADO_SIGMA) {\n                content = content.replace(`${matched[i]}`, `<usehtml><h3>${chapter}</h3></usehtml>`)\n            } else {\n                content = content.replace(`${matched[i]}`, `${chapter}<p>â€‹<p/>`)\n            }\n        }\n    }\n    return content\n}\n\nfunction replaceJumpPage(content) {\n    // æ›¿æ¢ Pixiv è·³è½¬é¡µé¢æ ‡è®°ç¬¦å· [[jump:]]\n    let matched = content.match(RegExp(/\\[jump:(\\d+)]/gm))\n    if (matched) {\n        for (let i in matched) {\n            let page = matched[i].match(/\\d+/)\n            content = content.replace(`${matched[i]}`, `\\n\\nè·³è½¬è‡³ç¬¬${page}èŠ‚`)\n        }\n    }\n    return content\n}\n\nfunction replaceJumpUrl(content) {\n    // æ›¿æ¢ Pixiv é“¾æ¥æ ‡è®°ç¬¦å· [[jumpuri: > ]]\n    let matched = content.match(RegExp(/\\[\\[jumpuri:(.*?)>(.*?)]]/gm))\n    if (matched) {\n        for (let i in matched) {\n            let matched2 = matched[i].match(/\\[\\[jumpuri:(.*?)>(.*?)]]/m)\n            let matchedText = matched2[0]\n            let urlName = matched2[1].trim()\n            let urlLink = matched2[2].trim()\n\n            if (globalThis.environment.IS_LEGADO_SIGMA) {\n                content = content.replace(`${matchedText}`, `<usehtml><p>ã€€ã€€<a href=${urlLink}>${urlName}</a></p></usehtml>`)\n            } else {\n                if (urlLink === urlName) {\n                    content = content.replace(`${matchedText}`, `${urlName}`)\n                } else {\n                    content = content.replace(`${matchedText}`, `${urlName}: ${urlLink}`)\n                }\n            }\n        }\n    }\n    return content\n}\n\nfunction replaceRb(content) {\n    // æ›¿æ¢ Pixiv æ³¨éŸ³æ ‡è®°ç¬¦å· [[rb: > ]]\n    let matched = content.match(RegExp(/\\[\\[rb:(.*?)>(.*?)]]/gm))\n    if (matched) {\n        for (let i in matched) {\n            let matched2 = matched[i].match(/\\[\\[rb:(.*?)>(.*?)]]/m)\n            let matchedText = matched2[0]\n            let kanji = matched2[1].trim()\n            let kana = matched2[2].trim()\n\n            if (!globalThis.settings.REPLACE_TITLE_MARKS) {\n                // é»˜è®¤æ›¿æ¢æˆï¼ˆæ‹¬å·ï¼‰\n                content = content.replace(`${matchedText}`, `${kanji}ï¼ˆ${kana}ï¼‰`)\n            } else {\n                let reg = RegExp(\"[\\\\u4E00-\\\\u9FFF]+\", \"g\");\n                if (reg.test(kana)) {\n                    // kanaä¸ºä¸­æ–‡ï¼Œåˆ™æ›¿æ¢å›ã€Šä¹¦åå·ã€‹\n                    content = content.replace(`${matchedText}`, `${kanji}ã€Š${kana}ã€‹`)\n                } else {\n                    // é˜…è¯»ä¸æ”¯æŒ <ruby> <rt> æ³¨éŸ³\n                    // content = content.replace(`${matchedText}`, `<ruby>${kanji}<rt>${kana}</rt></ruby>`)\n                    content = content.replace(`${matchedText}`, `${kanji}ï¼ˆ${kana}ï¼‰`)\n                }\n            }\n        }\n    }\n    return content\n}\n\nfunction getPollData(res, content) {\n    // æ·»åŠ æŠ•ç¥¨\n    if (res.pollData) {\n        let poll = `ğŸ“ƒ æŠ•ç¥¨(âœ…${res.pollData.total}å·²æŠ•)ï¼š\\n${res.pollData.question}\\n`\n        res.pollData.choices.forEach(choice => {\n            poll += `é€‰é¡¹${choice.id}ï¼š${choice.text}(âœ…${choice.count})\\n`\n        })\n        content += \"\\n\" + \"â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”\\n\".repeat(2) + poll\n    }\n    return content\n}\n\nfunction processComment(item) {\n    let text = item.comment || \"\"\n    if (text === \"\" && item.stampId) {\n        return `<img src=\"${urlStampUrl(item.stampId)}\">`\n    }\n    return text.replace(/\\(([^)]+)\\)/g, (match, key) => {\n        if (emoji.hasOwnProperty(key)) {\n            return `<img src=\"${urlEmojiUrl(emoji[key])}\" >`\n        }\n        return match\n    })\n}\n\nfunction formatComment(item, replyToName = null) {\n    const content = processComment(item)\n    const isMyComment = item.userId === String(getFromCache(\"pixiv:uid\"))\n    const commentId = isMyComment ? `(${item.id})` : \"\"\n    const name = replyToName ? `@${item.userName}(â¤´ï¸@${replyToName})` : `@${item.userName}`\n    return `${name}ï¼š${content}(${item.commentDate})${commentId}\\n`\n}\n\nfunction getComment(res, content) {\n    if (!globalThis.settings.SHOW_COMMENTS || res.commentCount === 0) return content\n\n    const limit = 50\n    let comments = [], commentUrls = [];\n    let maxPage = Math.ceil(res.commentCount / limit)\n    if (maxPage >= 2 && globalThis.environment.IS_LEGADO) {\n        for (let i = 0; i < maxPage; i++) {\n            commentUrls.push(urlIP(urlNovelComments(res.id, i * limit, limit)))\n        }\n        comments = getAjaxAllJson(commentUrls).map(resp => resp.body.comments).flat()\n    } else {\n        for (let i = 0; i < maxPage; i++) {\n            let result = getAjaxJson(urlIP(urlNovelComments(res.id, i * limit, limit)), true)\n            if (result && !result.error && result.body && result.body.comments) {\n                comments = comments.concat(result.body.comments)\n            }\n        }\n    }\n\n    let commentText = `ğŸ’¬ è¯„è®º(å…±è®¡${comments.length}æ¡)ï¼š\\n`\n    comments.forEach(comment => {\n        commentText += formatComment(comment)\n        if (comment.hasReplies) {\n            let resp = getAjaxJson(urlIP(urlNovelCommentsReply(comment.id, 1)), true)\n            if (resp && !resp.error && resp.body && resp.body.comments) {\n                resp.body.comments.reverse().forEach(reply => {\n                    commentText += formatComment(reply, reply.replyToUserName)\n                })\n            }\n            commentText += \"â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”\\n\"\n        }\n    })\n    return content + \"\\n\" + \"â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”\\n\".repeat(2) + commentText\n}\n\nfunction getContent(res) {\n    getNovelInfo(res)  // æ”¾å…¥ä¿¡æ¯ä»¥ä¾¿ç™»é™†ç•Œé¢ä½¿ç”¨\n    let content = String(res.content)\n    // let content = \"undefined\"\n    if (content.includes(\"undefined\")) {\n        return checkContent()\n    }\n\n    content = getCaptions(res, content)\n    content = replaceUploadedImage(res, content)\n    content = replacePixivImage(content)\n    content = replaceNewPage(content)\n    content = replaceChapter(content)\n    content = replaceJumpPage(content)\n    content = replaceJumpUrl(content)\n    content = replaceRb(content)\n    content = getPollData(res, content)\n    content = getComment(res, content)\n    return content\n}\n\nfunction checkContent() {\n    let latestMsg = getAjaxJson(urlMessageThreadLatest(5))\n    if (latestMsg.error === true) {\n        java.log(JSON.stringify(latestMsg))\n\n    } else if (latestMsg.body.total >= 1) {\n        let msg = latestMsg.body.message_threads.filter(item => item.thread_name === \"pixiväº‹å‹™å±€\")[0]\n        if (msg === undefined) {\n            sleepToast(`æ‚¨äº ${java.timeFormat(new Date().getTime())} è§¦å‘ Pixiv ã€è¯·æ±‚é™åˆ¶ã€‘ï¼Œå»ºè®®ç¨å€™/é‡æ–°ç™»å½•å†ç»§ç»­`, 3)\n            // java.startBrowser(\"https://www.pixiv.net\", 'é€€å‡ºç™»å½•')\n            // java.startBrowser(\"https://www.pixiv.net/logout.php\",'é€€å‡ºç™»å½•')  // ä¸æ¸…é™¤ WebView ç¼“å­˜æ— æ³•é‡æ–°ç™»å½•\n\n        } else if (new Date().getTime()- 1000*msg.modified_at <= 3*24*60*60*1000) { // 3*24hå†…æé†’\n            sleepToast(`æ‚¨äº ${java.timeFormat(1000*msg.modified_at)} è§¦å‘ Pixiv ã€è¿‡åº¦è®¿é—®ã€‘ï¼Œè¯·ä¿®æ”¹å¯†ç å¹¶é‡æ–°ç™»å½•`, 3)\n            sleepToast(`${msg.latest_content}`, 5)\n            java.startBrowser(\"https://accounts.pixiv.net/password/change\",'ä¿®æ”¹å¯†ç ')\n        }\n    }\n}\n\n(() => {\n    return getContent(util.getNovelResFirst(result))\n})()",
            "title": "",
            "imageStyle": "FULL",
            "callBackJs": "function getNovel() {\n    let novel = {}\n    novel.author = novel.userName = book.author.replace(\"@\", \"\")\n    if (book.bookUrl.includes(\"series\")) {\n        novel.seriesId = book.bookUrl.match(/\\d+/)[0]\n        novel.seriesTitle = book.name\n\n        let novelIds = getFromCacheObject(`novelIds${novel.seriesId}`)\n        novel.id = novelIds[book.durChapterIndex]\n        novel.title = book.durChapterTitle\n    } else {\n        novel.seriesId = 0\n        novel.seriesTitle = \"\"\n        novel.id = book.bookUrl.match(/\\d+/)[0]\n        novel.title = book.name\n    }\n    return novel\n}\n\nfunction shareBook() {\n    let text = `æˆ‘æ­£åœ¨çœ‹ï¼šã€${book.author.replace(\"@\", \"\")}ã€‘åˆ›ä½œçš„ã€Š${book.name}ã€‹`\n    if (!!book.durChapterTitle && String(book.name) !== String(book.durChapterTitle)) {\n        text += `çš„ ã€${book.durChapterTitle}ã€‘`\n    }\n    text += `\\n\\nå°è¯´é“¾æ¥ï¼š\\n${book.bookUrl}\\n\\nåˆ†äº«è‡ªã€å¼€æºé˜…è¯»ã€‘Pixivä¹¦æºã€‚ä½¿ç”¨æ·»åŠ ç½‘å€ï¼Œå¿«é€Ÿæ·»åŠ æœ¬æ–‡`\n    java.copyText(text)\n    return true\n}\n\nfunction clearCache() {\n    let novel = getNovel()\n    cache.delete(`${urlNovelUrl(novel.id)}`)\n    cache.delete(`${urlNovelDetailed(novel.id)}`)\n    cache.delete(`${urlSearchNovel(novel.title, 1)}`)\n    if (novel.seriesId) {\n        cache.delete(`${urlSeriesUrl(novel.seriesId)}`)\n        cache.delete(`${urlSeriesDetailed(novel.seriesId)}`)\n        cache.delete(`${urlSearchSeries(novel.seriesTitle, 1)}`)\n\n        let novelIds = getFromCacheObject(`novelIds${novel.seriesId}`)\n        novelIds.forEach(novelId => {\n            cache.delete(`${urlNovelUrl(novelId)}`)\n            cache.delete(`${urlNovelDetailed(novelId)}`)\n        })\n    }\n    return true\n}\n\nfunction copyBookUrl() {\n    java.copyText(book.bookUrl)\n    return true\n}\nfunction copyTocUrl() {\n    java.copyText(book.tocUrl)\n    return true\n}\n\n// ä¿å­˜é˜…è¯»ï¼Œæ›´æ–°ç™»å½•ç•Œé¢çš„ç« èŠ‚åç§°\nfunction saveRead() {\n    source.putLoginInfo(JSON.stringify({\"ç« èŠ‚åç§°\": book.durChapterTitle}))\n}\n\nfunction startShelfRefresh() {\n    source.putConcurrent(\"18/30000\")\n}\n\nfunction endShelfRefresh() {\n    source.putConcurrent(\"25/5000\")\n}\n\nfunction callBackFactory(event) {\n    switch (event) {\n        // case \"clickBookName\":\n        //     return clickBookName()\n        // case \"longClickBookName\":\n        //     return longClickBookName()\n        // case \"clickAuthor\":\n        //     return clickAuthor()\n        // case \"longClickAuthor\":\n        //     return longClickAuthor()\n        // case \"clickCustomButton\":\n        //     return customButton()\n        // case \"longClickCustomButton\":\n        //     return longcustomButton()\n\n        case \"clickShareBook\":\n            return shareBook()\n        case \"clickClearCache\":\n            return clearCache()\n        case \"clickCopyBookUrl\":\n            return copyBookUrl()\n        case \"clickCopyTocUrl\":\n            return copyTocUrl()\n\n        // ä¸‹é¢çš„äº‹ä»¶æ— æ³•è¢«å›è°ƒç»“æœæ¶ˆè´¹\n        // case \"addBookShelf\":\n        //     return addBookShelf()\n        // case \"delBookShelf\":\n        //     return delBookShelf()\n        case \"saveRead\":\n            return saveRead()\n        // case \"startRead\":\n        //     return startRead()\n        // case \"endRead\":\n        //     return endRead()\n        case \"startShelfRefresh\":\n            return startShelfRefresh()\n        case \"endShelfRefresh\":\n            return endShelfRefresh()\n    }\n}\n\n(() => {\n    return callBackFactory(event)\n})()"
        },
        "ruleExplore": {
            "author": "userName",
            "bookList": "@js:\nvar util = objParse(String(java.get(\"util\")))\nvar seriesSet = new Set();  // å­˜å‚¨seriesID æœ‰BUGæ— æ³•å¤„ç†ç¿»é¡µ\n\nfunction objParse(obj) {\n    return JSON.parse(obj, (n, v) => {\n        if (typeof v == \"string\" && v.match(\"()\")) {\n            return eval(`(${v})`)\n        }\n        return v;\n    })\n}\n\nfunction handlerFactory() {\n    if (baseUrl.includes(\"https://cdn.jsdelivr.net\")) {\n        return () => {updateSource(); return []}\n    }\n    if (baseUrl.includes(\"github\")) {\n        return () => {startBrowser(baseUrl, \"\"); return []}\n    }\n    if (!isLogin()) {\n        return handlerNoLogin()\n    }\n    if (baseUrl.includes(\"/bookmark\")) {\n        return handlerBookMarks()\n    }\n    if (baseUrl.includes(\"/top\")) {\n        return handlerRecommend()\n    }\n    if (baseUrl.includes(\"/follow_latest\")) {\n        return handlerFollowLatest()\n    }\n    if (baseUrl.includes(\"/watch_list\")) {\n        return handlerWatchList()\n    }\n    if (baseUrl.includes(\"/discovery\")) {\n        return handlerDiscovery()\n    }\n    if (baseUrl.includes(\"/new\")) {\n        return handlerDiscovery()\n    }\n    if (baseUrl.includes(\"/commission/\")) {\n        return handlerFollowLatest()\n    }\n    if (baseUrl.includes(\"/user_event/portal\")) {\n        return handlerFollowLatest()\n    }\n    if (baseUrl.includes(\"/genre\")) {\n        return handlerWatchList()\n    }\n    // æ­£åˆ™åŒ¹é…ç½‘å€å†…å®¹\n    if (baseUrl.includes(\"/ranking\")) {\n        return handlerRanking()\n    }\n    if (baseUrl.includes(\"/marker_all\")) {\n        return handlerRanking()\n    }\n    if (baseUrl.includes(\"/editors_picks\")) {\n        return handlerRanking()\n    }\n    if (baseUrl.includes(\"/ajax/search/novels\")) {\n        return handlerSearch()\n    }\n    if (baseUrl.startsWith(\"https://www.pixiv.net\")) {\n        return handlerRanking()\n    }\n    else {\n        return () => {startBrowser(baseUrl, \"\"); return []}\n    }\n}\n\nfunction handlerNoLogin() {\n    return () => {\n        sleepToast(\"âš ï¸ å½“å‰æœªç™»å½•è´¦å·\\n\\nè¯·ç™»å½• Pixiv è´¦å·\", 1.5)\n        util.removeCookie(); util.login()\n        sleepToast(\"ç™»å½•æˆåŠŸåï¼Œè¯·é‡æ–°è¿›å…¥å‘ç°\", 2)\n        return []\n    }\n}\n\n// æ¨èå°è¯´\nfunction handlerRecommend() {\n    return () => {\n        let res = JSON.parse(result)\n        const recommend = res.body.page.recommend\n        const novels = res.body.thumbnails.novel\n        let nidSet = new Set(recommend.ids)\n        // java.log(nidSet.size)\n        let list = novels.filter(novel => nidSet.has(String(novel.id)))\n        // java.log(`è¿‡æ»¤ç»“æœ:${JSON.stringify(list)}`)\n        return util.formatNovels(util.handNovels(util.combineNovels(list)))\n    }\n}\n\n// æ”¶è—å°è¯´ï¼Œä»–äººæ”¶è—\nfunction handlerBookMarks() {\n    return () => {\n        let res = JSON.parse(result).body.works\n        if (res === undefined || res.length === 0) {\n            //æµç¨‹æ— æ³•æœ¬ç¯èŠ‚ä¸­æ­¢ åªèƒ½äº¤ç»™ä¸‹ä¸€æµç¨‹å¤„ç†\n            return []\n        }\n        return util.formatNovels(util.handNovels(res))\n    }\n}\n\n//å…³æ³¨ä½œè€…ï¼Œå°è¯´å§”æ‰˜ï¼Œå°è¯´ä¼åˆ’\nfunction handlerFollowLatest() {\n    return () => {\n        let res = JSON.parse(result)\n        return util.formatNovels(util.handNovels(util.combineNovels(res.body.thumbnails.novel)))\n    }\n}\n\n//æ¨èå°è¯´ï¼Œæœ€è¿‘å°è¯´\nfunction handlerDiscovery() {\n    return () => {\n        let res = JSON.parse(result)\n        return util.formatNovels(util.handNovels(util.combineNovels(res.body.novels)))\n    }\n}\n\n// æœç´¢æ ‡ç­¾\nfunction handlerSearch() {\n    return () => {\n        let res = JSON.parse(result)\n        return util.formatNovels(util.handNovels(util.combineNovels(res.body.novel.data)))\n    }\n}\n\n// è¿½æ›´åˆ—è¡¨ï¼Œçƒ­é—¨åˆ†ç±»\nfunction handlerWatchList() {\n    return () => {\n        let res = JSON.parse(result)\n        return util.formatNovels(util.handNovels(res.body.thumbnails.novelSeries))\n    }\n}\n\n// æ’è¡Œæ¦œï¼Œä¹¦ç­¾ï¼Œé¦–é¡µï¼Œç¼–è¾‘éƒ¨æ¨èï¼Œé¡ºåºç›¸åŒ\nfunction handlerRanking() {\n    if (globalThis.environment.IS_LEGADO) return handlerRankingAjaxAll()\n    // else if (globalThis.environment.IS_SOURCE_READ) return handlerRankingWebview()\n    else if (globalThis.environment.IS_SOURCE_READ) return handlerRankingAjax()\n    else return []\n}\n\n// æ’è¡Œæ¦œï¼Œä¹¦ç­¾ï¼Œé¦–é¡µï¼Œç¼–è¾‘éƒ¨æ¨èï¼Œé¡ºåºç›¸åŒ\nfunction handlerRankingAjaxAll() {\n    return () => {\n        let  novelIds = [], novelUrls = []\n        // let result = result + java.ajax(`${baseUrl}&p=2`)  // æ­£åˆ™è·å–ç½‘å€ä¸­çš„ novelId\n        let matched = result.match(RegExp(/\\/novel\\/show\\.php\\?id=\\d{5,}/gm))\n        for (let i in matched) {\n            let novelId = matched[i].match(RegExp(/\\d{5,}/))[0]\n            if (novelIds.indexOf(novelId) === -1) {\n                novelIds.push(novelId)\n                novelUrls.push(urlNovelDetailed(novelId))\n            }\n        }\n        // java.log(JSON.stringify(novelIds))\n        let novels = getAjaxAllJson(novelUrls).map(resp => resp.body)\n        return util.formatNovels(util.handNovels(util.combineNovels(novels)))\n    }\n}\n\n// æ’è¡Œæ¦œï¼Œä¹¦ç­¾ï¼Œé¦–é¡µ\nfunction handlerRankingWebview() {\n    return () => {\n        let novelIds = []  // æ­£åˆ™è·å–ç½‘å€ä¸­çš„ novelId\n        // let result = result + java.ajax(`${baseUrl}&p=2`)  // æ­£åˆ™è·å–ç½‘å€ä¸­çš„ novelId\n        let matched = result.match(RegExp(/\\/novel\\/show\\.php\\?id=\\d{5,}/gm))\n        for (let i in matched) {\n            let novelId = matched[i].match(RegExp(/\\d{5,}/))[0]\n            if (novelIds.indexOf(novelId) === -1) {\n                novelIds.push(novelId)\n            }\n        }\n        // java.log(JSON.stringify(novelIds))\n        let userNovels = getWebviewJson(\n            urlNovelsDetailed(getFromCache(\"pixiv:uid\"), novelIds), html => {\n                return (html.match(new RegExp(\">\\\\{.*?}<\"))[0].replace(\">\", \"\").replace(\"<\", \"\"))\n            }).body\n        return util.formatNovels(util.handNovels(util.combineNovels(Object.values(userNovels))))\n    }\n}\n\n// æ’è¡Œæ¦œï¼Œä¹¦ç­¾ï¼Œé¡ºåºç›¸åŒ\nfunction handlerRankingAjax() {\n    return () => {\n        let novels = [], novelIds = []\n        // let result = result + java.ajax(`${baseUrl}&p=2`)  // æ­£åˆ™è·å–ç½‘å€ä¸­çš„ novelId\n        let matched = result.match(RegExp(/\\/novel\\/show\\.php\\?id=\\d{5,}/gm))\n        for (let i in matched) {\n            let novelId = matched[i].match(RegExp(/\\d{5,}/))[0]\n            if (novelIds.indexOf(novelId) === -1) {\n                novelIds.push(novelId)\n                // java.log(urlNovelDetailed(novelId))\n                let res = getAjaxJson(urlNovelDetailed(novelId))\n                if (res.error !== true) {\n                    novels.push(res.body)\n                } else {\n                    java.log(JSON.stringify(res))\n                }\n            }\n        }\n        return util.formatNovels(util.handNovels(util.combineNovels(novels)))\n    }\n}\n\n(() => {\n    return handlerFactory()()\n})()",
            "bookUrl": "detailedUrl",
            "coverUrl": "coverUrl",
            "intro": "description",
            "kind": "tags",
            "lastChapter": "latestChapter",
            "name": "title",
            "wordCount": "textCount"
        },
        "ruleSearch": {
            "author": "userName",
            "bookList": "@js:\nvar util = objParse(String(java.get(\"util\")))\n\nfunction objParse(obj) {\n    return JSON.parse(obj, (n, v) => {\n        if (typeof v == \"string\" && v.match(\"()\")) {\n            return eval(`(${v})`)\n        }\n        return v;\n    })\n}\n\nvar first = true;\n// å­˜å‚¨seriesID\nvar seriesSet = {\n    keywords: \"Pixiv:Search\",\n    has: (value) => {\n        let page = Number(java.get(\"page\"))\n        if (page === 1 && first) {\n            first = false\n            cache.deleteMemory(this.keywords)\n            return false\n        }\n\n        let v = cache.getFromMemory(this.keywords)\n        if (v === undefined || v === null) {\n            return false\n        }\n        let set = new Set(JSON.parse(v))\n        return set.has(value)\n    },\n\n    add: (value) => {\n        let v = cache.getFromMemory(this.keywords)\n        if (v === undefined || v === null) {\n            cache.putMemory(this.keywords, JSON.stringify([value]))\n\n        } else {\n            let arr = JSON.parse(v)\n            if (typeof arr === \"string\") {\n                arr = Array(arr)\n            }\n            arr.push(value)\n            cache.putMemory(this.keywords, JSON.stringify(arr))\n        }\n    },\n};\n\nfunction getUserIdCache() {\n    let userId\n    let userName = String(java.get(\"keyword\"))\n    //cache.delete(\"pixivAuthors\")\n    let pixivAuthors = getFromCacheObject(\"pixivAuthors\")\n    // java.log(JSON.stringify(pixivAuthors))\n    if (pixivAuthors) userId = pixivAuthors[userName]\n    if (userId) {\n        java.log(`ğŸ‘¤ ç¼“å­˜ä½œè€…IDï¼š${userId}`)\n        return [userId]\n    }\n}\n\nfunction getUserIdOnline(full) {\n    let userName = String(java.get(\"keyword\"))\n    let page = Number(java.get(\"page\"))\n    let userIds = getAjaxParseJson(urlSearchUser(userName, page, full), html => {\n            let resp = JSON.parse(html.match(/<script id=\"__NEXT_DATA__\"[^>]*>([\\s\\S]*?)<\\/script>/)[1])\n            return resp.props.pageProps.userIds\n        }\n    )\n\n    let tempUids = []\n    for (let i in userIds) {\n        let userId = userIds[i]\n        let resp = getAjaxJson(urlIP(urlUserAllWorks(userId)), true)\n        // java.log(urlIP(urlUserAllWorks(userId)))\n        if (resp.error === false) {\n            // ä»…è·å–æœ‰å°è¯´çš„ä½œè€…\n            let novelIds = Object.keys(resp.body.novels)\n            // java.log(`${userId}-${novelIds.length}`)\n            if (novelIds.length >= 1) tempUids.push(userId)\n        }\n    }\n    java.log(`ğŸ‘¤ è·å–ä½œè€…IDï¼š${JSON.stringify(tempUids)}`)\n    return tempUids\n}\n\nfunction getUserNovels() {\n    let page = Number(java.get(\"page\"))\n    let uidList = getUserIdCache()\n    if (!uidList) uidList = getUserIdOnline()\n    // if (!uidList) uidList = getUserIdOnline(true)\n\n    let novels = []\n    for (let i in uidList) {\n        let uid = uidList[i]\n        let resp = getAjaxJson(urlIP(urlUserAllWorks(uid)))\n        // java.log(urlIP(urlUserAllWorks(id)))\n\n        // è·å–ç³»åˆ—å°è¯´ï¼Œä¸ util.handnovels ç³»åˆ—è¯¦æƒ…å…¼å®¹\n        let seriesIds = []\n        if (resp.body.novelSeries.length >= 1) {\n            resp.body.novelSeries.forEach(novel =>{\n                seriesIds.push(novel.id)\n                novel.textCount = novel.publishedTotalCharacterCount\n                novel.description = novel.caption\n            })\n            novels = novels.concat(resp.body.novelSeries)\n        }\n\n        // è·å–æ‰€æœ‰ç³»åˆ—å†…éƒ¨çš„å°è¯´ ID\n        let seriesNovelIds = []\n        if (globalThis.environment.IS_LEGADO) {\n            let seriesUrls = seriesIds.map(seriesId => urlIP(urlSeriesNovelsTitles(seriesId)))\n            // let resp = getAjaxAllJson(seriesUrls).map(resp => resp.body)\n            // seriesNovelIds = resp.flat().map(item => item.id)\n            seriesNovelIds = getAjaxAllJson(seriesUrls).flatMap(resp => resp.body.map(item => item.id))\n        }\n\n        if (globalThis.environment.IS_SOURCEREAD) {\n            seriesIds.forEach(seriesId => {\n                let novels = getAjaxJson(urlIP(urlSeriesNovelsTitles(seriesId))).body\n                seriesNovelIds.push.apply(seriesNovelIds, novels.map(novel => novel.id))\n            })\n        }\n        // java.log(`æœ‰ç³»åˆ—çš„å°è¯´IDï¼š${JSON.stringify(seriesNovelIds)}`)\n        // java.log(JSON.stringify(seriesNovelIds.length))\n\n        // è·å–å•ç¯‡å°è¯´\n        let novelIds = Object.keys(resp.body.novels)\n        novelIds = novelIds.filter(novelId => (!seriesNovelIds.includes(novelId)))\n        novelIds = novelIds.reverse().slice((page - 1) * 20, page * 20)\n        // java.log(`çœŸå•ç¯‡çš„å°è¯´IDï¼š${JSON.stringify(novelIds)}`)\n        // java.log(JSON.stringify(novelIds.length))\n\n        if (globalThis.environment.IS_LEGADO) {\n            let novelUrls = novelIds.map(novelId => urlIP(urlNovelDetailed(novelId)))\n            // java.log(JSON.stringify(novelUrls))\n            // cache.delete(novelUrls)\n            novels = novels.concat(getAjaxAllJson(novelUrls).map(resp => resp.body))\n        }\n\n        if (globalThis.environment.IS_SOURCEREAD) {\n            novelIds.forEach(novelId => {\n                // java.log(urlIP(urlNovelDetailed(novelId)))\n                let res = getAjaxJson(urlIP(urlNovelDetailed(novelId)))\n                if (res.error !== true) {\n                    novels.push(res.body)\n                } else {\n                    java.log(JSON.stringify(res))\n                }\n            })\n        }\n    }\n    \n    util.debugFunc(() => {\n        java.log(`è·å–ç”¨æˆ·æœç´¢å°è¯´ç»“æŸ`)\n    })\n    return novels\n}\n\nfunction search(name, type, page) {\n    let resp = {}\n    if (type.includes(\"novel\")) {\n        resp = getAjaxJson(urlIP(urlSearchNovel(name, page)))\n        java.log(urlIP(urlSearchNovel(name, page)))\n    }\n    if (type.includes(\"series\")) {\n        resp = getAjaxJson(urlIP(urlSearchSeries(name, page)))\n        java.log(urlIP(urlSearchSeries(name, page)))\n    }\n    if (resp.error === true || resp.total === 0) {\n        return {\"data\": [], \"total\":0, \"lastPage\": 0}\n    }\n    return resp.body.novel\n}\n\nfunction getSeries() {\n    let resp = JSON.parse(result)\n    if (resp.error === true) {\n        return []\n    }\n    let name = String(java.get(\"keyword\"))\n    let page = Number(java.get(\"page\"))\n    java.log(urlIP(urlSearchSeries(name, page)))\n    putInCacheObject(urlIP(urlSearchSeries(name, page)), resp, cacheSaveSeconds)  // åŠ å…¥ç¼“å­˜\n    return resp.body.novel.data\n}\n\nfunction getNovels() {\n    let name = String(java.get(\"keyword\"))\n    let page = Number(java.get(\"page\"))\n    let resp = search(name, \"novel\", page)\n    return util.combineNovels(resp.data)\n}\n\nfunction getConvertNovels() {\n    let novels = []\n    let name = String(java.get(\"keyword\"))\n    let page = Number(java.get(\"page\"))\n    let name1 = String(java.s2t(name))\n    let name2 = String(java.t2s(name))\n    if (name1 !== name) novels = novels.concat(search(name1, \"novel\", page).data)\n    if (name2 !== name) novels = novels.concat(search(name2, \"novel\", page).data)\n    novels = util.combineNovels(novels)\n    if (name1 !== name) novels = novels.concat(search(name1, \"series\", page).data)\n    if (name2 !== name) novels = novels.concat(search(name2, \"series\", page).data)\n    return novels\n}\n\nfunction novelFilter(novels) {\n    let textCount = 0, tags = []\n    let limitedTextCount = String(java.get(\"limitedTextCount\")).replace(\"å­—æ•°\", \"\").replace(\"å­—æ•¸\", \"\")\n    // limitedTextCount = `3w 3k 3w5 3k5`.[0]\n    if (limitedTextCount.includes(\"w\") || limitedTextCount.includes(\"W\")) {\n        let num = limitedTextCount.toLowerCase().split(\"w\")\n        textCount = 10000 * num[0] + 1000 * num[1]\n    } else if (limitedTextCount.includes(\"k\") || limitedTextCount.includes(\"K\")) {\n        let num = limitedTextCount.toLowerCase().split(\"k\")\n        textCount = 1000 * num[0] + 100 * num[1]\n    }\n\n    let novels0 = novels.map(novel => novel.id)\n    if (textCount >= 1) {\n        novels = novels.filter(novel => novel.textCount >= textCount)\n        let novels1 = novels.map(novel => novel.id)\n        java.log(`ğŸ”¢ å­—æ•°é™åˆ¶ï¼š${limitedTextCount}`)\n        java.log(`â¬ å­—æ•°é™åˆ¶ï¼šè¿‡æ»¤å‰${novels0.length}ï¼›è¿‡æ»¤å${novels1.length}`)\n    }\n\n    let inputTags = String(java.get(\"inputTags\")).split(\" \")\n    for (let i in inputTags) {\n        let tag = inputTags[i].trim()\n        if (tag !== \"\") tags.push(`${tag}`)\n    }\n\n    if (tags.length >= 1) {\n        // ä»…ä¿ç•™å«æœ‰æ‰€æœ‰æ ‡ç­¾çš„å°è¯´\n        // novels = novels.filter(novel => {\n        //     // java.log(`${JSON.stringify(novel.tags)}\\n${tags.every(item => novel.tags.includes(item))}`)\n        //     return tags.every(item => novel.tags.includes(item))\n        // })\n        novels = novels.filter(novel => tags.every(item => novel.tags.includes(item)))\n        let novels2 = novels.map(novel => novel.id)\n        java.log(`#ï¸âƒ£ è¿‡æ»¤æ ‡ç­¾ï¼š${tags.join(\"ã€\")}`)\n        java.log(`#ï¸âƒ£ è¿‡æ»¤æ ‡ç­¾ï¼šè¿‡æ»¤å‰${novels0.length}ï¼›è¿‡æ»¤å${novels2.length}`)\n    }\n\n    let inputAuthor = String(java.get(\"inputAuthor\")).trim()\n    if (inputAuthor) {\n        // novels = novels.filter(novel => {\n        //     java.log(`${novel.userName}-${novel.userName.includes(inputAuthor)}`)\n        //     return novel.userName.includes(inputAuthor)\n        // })\n        novels = novels.filter(novel => novel.userName.includes(inputAuthor))\n        let novels2 = novels.map(novel => novel.id)\n        java.log(`ğŸ‘¤ è¿‡æ»¤ä½œè€…ï¼š${inputAuthor.join(\"ã€\")}`)\n        java.log(`ğŸ‘¤ è¿‡æ»¤ä½œè€…ï¼šè¿‡æ»¤å‰${novels0.length}ï¼›è¿‡æ»¤å${novels2.length}`)\n    }\n    return novels\n}\n\n(() => {\n    let novels = []\n    let keyword = String(java.get(\"keyword\"))\n    if (keyword.startsWith(\"@\")) {\n        java.put(\"keyword\", keyword.slice(1))\n        novels = novels.concat(getUserNovels())\n    } else if (keyword.startsWith(\"#\")) {\n        java.put(\"keyword\", keyword.slice(1))\n        novels = novels.concat(getSeries())\n        novels = novels.concat(getNovels())\n    } else {\n        if (!isLogin()) {\n            sleepToast(\"ğŸ” æœç´¢å°è¯´\\n\\nâš ï¸ å½“å‰æœªç™»å½•è´¦å·\\nè¯·ç™»å½• Pixiv è´¦å·\", 1.5)\n            util.removeCookie(); util.login()\n            sleepToast(\"ğŸ” æœç´¢å°è¯´\\n\\nç™»å½•æˆåŠŸåï¼Œè¯·é‡æ–°æœç´¢\", 2)\n            return []\n        }\n        novels = novels.concat(getSeries())\n        novels = novels.concat(getNovels())\n        if (util.settings.SEARCH_AUTHOR) novels = novels.concat(getUserNovels())\n        if (util.settings.CONVERT_CHINESE) novels = novels.concat(getConvertNovels())\n    }\n    // java.log(JSON.stringify(novels))\n    // è¿”å›ç©ºåˆ—è¡¨ä¸­æ­¢æµç¨‹\n    if (novels.length === 0) {\n        return []\n    }\n    return novelFilter(util.formatNovels(util.handNovels(novels)))\n})()",
            "bookUrl": "detailedUrl",
            "checkKeyWord": "#æµ‹è¯•é¡µé¢",
            "coverUrl": "coverUrl",
            "intro": "description",
            "kind": "tags",
            "lastChapter": "latestChapter",
            "name": "title",
            "wordCount": "textCount"
        },
        "ruleToc": {
            "chapterList": "@js:\nvar util = objParse(String(java.get(\"util\")))\n\nfunction objParse(obj) {\n    return JSON.parse(obj, (n, v) => {\n        if (typeof v == \"string\" && v.match(\"()\")) {\n            return eval(`(${v})`)\n        }\n        return v;\n    })\n}\n\nfunction urlNovel(novelId){\n    if (util.settings.SHOW_ORIGINAL_LINK) {\n        return urlNovelUrl(novelId)\n    } else {\n        return urlNovelDetailed(novelId)\n    }\n}\n\nfunction oneShotHandler(res) {\n    res.textCount = res.userNovels[`${res.id}`].textCount\n    res.createDate = timeTextFormat(res.createDate)\n    return [{\n        title: res.title.trim(),\n        chapterUrl: urlIP(urlNovel(res.id)),\n        chapterInfo: `${res.createDate}ã€€ã€€${res.textCount}å­—`\n    }]\n}\n\nfunction seriesHandler(res) {\n    const limit = 30\n    let returnList = [], novelIds = []\n    let seriesID = res.id, allChaptersCount = res.total\n    util.debugFunc(() => {\n        java.log(`æœ¬ç³»åˆ— ${seriesID} ä¸€å…±æœ‰${allChaptersCount}ç« `);\n    })\n\n    //å‘é€è¯·æ±‚è·å¾—ç›¸åº”æ•°é‡çš„ç›®å½•åˆ—è¡¨\n    function sendAjaxForGetChapters(lastIndex) {\n        resp = getAjaxJson(urlIP(urlSeriesNovels(seriesID, limit, lastIndex)), true)\n        res = resp.body.thumbnails.novel\n        // res = resp.body.page.seriesContents\n        res.forEach(v => {\n            v.title = v.title.trim()\n            v.chapterUrl = urlIP(urlNovel(v.id))\n            novelIds.push(v.id)\n            if (v.updateDate !== undefined) {\n                v.updateDate = timeTextFormat(v.createDate)\n                v.chapterInfo = `${v.updateDate}ã€€ã€€${v.textCount}å­—`\n            } else {\n                v.updateDate = java.timeFormat(v.uploadTimestamp)\n                v.chapterInfo = `${v.updateDate}ã€€ã€€${v.textLength}å­—`\n            }\n            util.debugFunc(() => {\n                java.log(`${v.title}`)\n            })\n        })\n        return res;\n    }\n\n    if (!util.settings.SHOW_UPDATE_TIME) {\n        returnList = getAjaxJson(urlIP(urlSeriesNovelsTitles(seriesID)), true).body\n        returnList.forEach(v => {\n            v.title = v.title.trim()\n            v.chapterUrl = urlIP(urlNovel(v.id))\n            novelIds.push(v.id)\n        })\n    } else {\n        //é€»è¾‘æ§åˆ¶è€… ä¹Ÿå°±æ˜¯ä½¿ç”¨ä¸Šé¢å®šä¹‰çš„ä¸¤ä¸ªå‡½æ•°æ¥åšå¯¹åº”åŠŸèƒ½\n        //è¦çˆ¬å–çš„æ€»æ¬¡æ•°\n        let max = Math.ceil(allChaptersCount / limit)\n        for (let i = 0; i < max; i++) {\n            //java.log(\"içš„å€¼:\"+i)\n            let list = sendAjaxForGetChapters(i * limit);\n            //å–å‡ºæ¯ä¸ªå€¼\n            returnList = returnList.concat(list)\n        }\n    }\n    // æ”¾å…¥å°è¯´ä¿¡æ¯ä»¥ä¾¿ç™»é™†ç•Œé¢ä½¿ç”¨\n    let novel = source.getLoginInfoMap()\n    if (novel === undefined) novel = getFromCacheObject(\"novel\")\n    novel.novelIds = novelIds\n    putInCacheObject(`novelIds${seriesID}`, novelIds, cacheSaveSeconds)\n    // java.log(JSON.stringify(returnList))\n    source.putLoginInfo(JSON.stringify(novel))\n    putInCacheObject(\"novel\", novel)\n    return returnList\n}\n\n(function (res) {\n    res = util.getNovelResSeries(result)\n    if (res.firstNovelId === undefined || res.seriesNavData === null) {\n        return oneShotHandler(res)\n    } else {\n        return seriesHandler(res)\n    }\n})()",
            "chapterName": "title",
            "chapterUrl": "chapterUrl",
            "isPay": "",
            "isVip": "",
            "updateTime": "chapterInfo"
        },
        "searchUrl": "@js:\njava.put(\"key\", key)\njava.put(\"page\", page)\nlet keyword = key.split(\" \")\nlet limitedTextCount\nif (key.includes(\"å­—æ•°\") || key.includes(\"å­—æ•¸\") ) {\n    limitedTextCount = keyword.pop()\n    keyword = keyword.join(\" \")\n} else {\n    limitedTextCount = \"\"\n    keyword = key\n}\njava.put(\"keyword\", keyword)\njava.put(\"limitedTextCount\", limitedTextCount)\n\nif (keyword.startsWith(\"@\") || keyword.startsWith(\"ï¼ \")) {\n    keyword = keyword.slice(1)\n    if (keyword.includes(\"#\") || keyword.includes(\"ï¼ƒ\")) {\n        let author = keyword.split(\" \")[0]\n        let tags = keyword.replace(author, \"\").trim().slice(1)\n        java.put(\"keyword\", `@${author}`)\n        java.put(\"inputTags\", tags)\n        java.log(`ğŸ‘¤ æœç´¢ä½œè€…ï¼š${author} #ï¸âƒ£ è¿‡æ»¤æ ‡ç­¾ï¼š${tags.replace(\" \", \"ã€\")}`)\n    } else {\n        java.put(\"keyword\", `@${keyword}`)\n        java.log(`ğŸ‘¤ æœç´¢ä½œè€…ï¼š${keyword}`)\n    }\n\n} else if (keyword.startsWith(\"#\") || keyword.startsWith(\"ï¼ƒ\")) {\n    keyword = keyword.slice(1)\n    java.log(`#ï¸âƒ£ æœç´¢æ ‡ç­¾ï¼š${keyword}`)\n    java.put(\"keyword\", `#${keyword}`)\n\n} else {\n    java.log(`ğŸ” æœç´¢å†…å®¹ï¼š${keyword}`)\n}\nurlIP(urlSearchSeries(keyword, page))",
        "variableComment": "âš™ï¸ ä¹¦æºè®¾ç½®ï¼š\n1ï¸âƒ£ ä¹¦æ¶ - é˜…è¯»ç•Œé¢ - Pixiv å°è¯´ - ç™»å½•\n2ï¸âƒ£ æˆ‘çš„ - ä¹¦æºç®¡ç† - Pixiv å°è¯´ - ç™»å½•\nç‚¹å‡»ã€ğŸ‘€ ä¹¦æºè®¾ç½®ã€‘ã€ğŸ‘€ å‘ç°è®¾ç½®ã€‘æ˜¾ç¤ºç›¸å…³è®¾ç½®æŒ‰é’®\n\nâ–¶ï¸ è‡ªå®šåŠŸèƒ½ï¼š\nå°è¯´ä¹¦æ¶ - é˜…è¯»ç•Œé¢ - Pixiv å°è¯´ - ç™»å½•\n\nğŸ’¬ å‘é€è¯„è®ºï¼š\n1ï¸âƒ£ æ–‡æœ¬æ¡†å†… è¾“å…¥å†…å®¹ï¼Œç‚¹å‡»ã€âœ… å‘é€è¯„è®ºã€‘\n\nğŸš« å±è”½æ ‡ç­¾/æè¿°(æœ¬åœ°)ï¼š\n1ï¸âƒ£ ç‚¹å‡»ã€ğŸ‘€ æŸ¥çœ‹å±è”½ã€‘ï¼Œåˆ‡æ¢è‡³å±è”½åˆ—è¡¨\n2ï¸âƒ£ æ–‡æœ¬æ¡†å†… è¾“å…¥å†…å®¹ï¼Œç‚¹å‡»ã€ğŸš« åŠ å…¥å±è”½ã€‘\n\nğŸ“Œ å–œæ¬¢æ ‡ç­¾(æœ¬åœ°)ï¼š\n1ï¸âƒ£ æ–‡æœ¬æ¡†å†… è¾“å…¥æ ‡ç­¾ï¼Œç‚¹å‡»ã€ğŸ“Œ å–œæ¬¢æ ‡ç­¾ã€‘\n\nâ¤ï¸ å…³æ³¨ ä»–äººæ”¶è—(æœ¬åœ°)ï¼š\n1ï¸âƒ£ æ–‡æœ¬æ¡†å†… è¾“å…¥ä½œè€…IDï¼Œç‚¹å‡»ã€â¤ï¸ ä»–äººæ”¶è—ã€‘\n\n",
        "weight": 0
    },
    {
        "bookSourceComment": "ğŸ…¿ï¸ Pixiv å°è¯´å¤‡ç”¨ï¼ˆæ›´æ–°ğŸ“†ï¼š2026/02/22ï¼‰\n\nä¹¦æºç‰ˆæœ¬ï¼š262\nä½¿ç”¨è¯´æ˜ï¼šğŸ“Œé˜…è¯»æ­£å¼ç‰ˆ 3.25 å¯ç”¨\nå¯ç”¨åŠŸèƒ½ï¼šâœ…æœç´¢âœ…å‘ç°âœ…æ·»åŠ ç½‘å€âœ…è®¢é˜…æº\næœç´¢å°è¯´ï¼šâœ…å•ç¯‡âœ…ç³»åˆ—âœ…æ ‡ç­¾âœ…ä½œè€…\nå‘ç°å°è¯´ï¼šâœ…å…³æ³¨âœ…è¿½æ›´âœ…æ¨èâœ…å‘ç°\nå‘ç°å°è¯´ï¼šâœ…æ”¶è—âœ…ä¹¦ç­¾âœ…é¦–é¡µâœ…æ’è¡Œ\næ·»åŠ ç½‘å€ï¼šâœ…å°è¯´âœ…ç³»åˆ—âœ…ä½œè€…\nè®¢é˜…ç”¨æ³•ï¼šç‚¹å‡»è®¢é˜…æºæ‰“å¼€å°è¯´/ç³»åˆ—å°è¯´ï¼Œã€åˆ·æ–°ã€‘ï¼Œç‚¹å‡»ã€åŠ å…¥ä¹¦æ¶ã€‘æŒ‰é’®ï¼Œæ·»åŠ åˆ°ä¹¦æ¶\n\nä¹¦æºå‘å¸ƒï¼šPixiv ä¹¦æºé¢‘é“ https://t.me/PixivSource\né¡¹ç›®åœ°å€ï¼šhttps://github.com/DowneyRem/PixivSource\nä½¿ç”¨æ•™ç¨‹ï¼šhttps://pixivsource.pages.dev/Pixiv\n\nâš™ï¸ ä¹¦æºè®¾ç½®ï¼š\n1ï¸âƒ£ ä¹¦æ¶ - é˜…è¯»ç•Œé¢ - Pixiv å°è¯´ - ç™»å½•\n2ï¸âƒ£ æˆ‘çš„ - ä¹¦æºç®¡ç† - Pixiv å°è¯´ - ç™»å½•\nç‚¹å‡»ã€ğŸ‘€ ä¹¦æºè®¾ç½®ã€‘ã€ğŸ‘€ å‘ç°è®¾ç½®ã€‘æ˜¾ç¤ºç›¸å…³è®¾ç½®æŒ‰é’®",
        "bookSourceGroup": "ğŸ” Pixiv",
        "bookSourceName": "ğŸ…¿ï¸ Pixiv å°è¯´å¤‡ç”¨",
        "bookSourceType": 0,
        "bookSourceUrl": "https://www.pixiv.net",
        "bookUrlPattern": "(https?://)?(www\\.)?pixiv\\.net(/ajax)?/(novel/(show\\.php\\?id=|series/)?|users?/)\\d+.*",
        "concurrentRate": "30/5000",
        "customButton": false,
        "customOrder": 1,
        "enabled": false,
        "enabledCookieJar": true,
        "enabledExplore": false,
        "eventListener": false,
        "exploreUrl": "@js:\nlet SHOW_R18_GENRE, SHOW_GENERAL_NEW, SHOW_GENERAL_RANK, SHOW_GENERAL_GENRE\ntry {\n    settings = JSON.parse(String(source.variableComment).match(RegExp(/{([\\s\\S]*?)}/gm)))\n    SHOW_R18_GENRE = settings.SHOW_R18_GENRE         // å‘ç°ï¼šçƒ­é—¨åˆ†ç±»æ˜¾ç¤ºR18å°è¯´\n    SHOW_GENERAL_NEW = settings.SHOW_GENERAL_NEW     // å‘ç°ï¼šæœ€æ–°ã€ä¼åˆ’ã€çº¦ç¨¿æ˜¾ç¤ºä¸€èˆ¬å°è¯´\n    SHOW_GENERAL_RANK = settings.SHOW_GENERAL_RANK   // å‘ç°ï¼šæ’è¡Œæ¦œæ˜¾ç¤ºä¸€èˆ¬å°è¯´\n    SHOW_GENERAL_GENRE = settings.SHOW_GENERAL_GENRE // å‘ç°ï¼šçƒ­é—¨åˆ†ç±»æ˜¾ç¤ºä¸€èˆ¬å°è¯´\n} catch (e) {\n    SHOW_R18_GENRE = false\n    SHOW_GENERAL_NEW = false\n    SHOW_GENERAL_RANK = false\n    SHOW_GENERAL_GENRE = false\n}\n\nlet li = [\n    {\"â­ï¸ å…³æ³¨\": \"https://www.pixiv.net/ajax/follow_latest/novel?p={{page}}&mode=r18&lang=zh\"},\n    {\"ğŸ“ƒ è¿½æ›´\": \"https://www.pixiv.net/ajax/watch_list/novel?p={{page}}&new=1&lang=zh\"},\n    {\"ğŸ’¯ æ¨è\": \"https://www.pixiv.net/ajax/top/novel?mode=r18&lang=zh\"},\n    {\"ğŸ” å‘ç°\": \"https://www.pixiv.net/ajax/novel/discovery?mode=r18&lang=zh\"},\n    {\"â¤ï¸ æ”¶è—\": \"https://www.pixiv.net/ajax/user/{{cache.get(\\\"pixiv:uid\\\")}}/novels/bookmarks?tag=&offset={{(page-1)*24}}&limit=24&rest=show&lang=zh\"},\n    {\"ãŠ™ï¸ æ”¶è—\": \"https://www.pixiv.net/ajax/user/{{cache.get(\\\"pixiv:uid\\\")}}/novels/bookmarks?tag=&offset={{(page-1)*24}}&limit=24&rest=hide&lang=zh\"},\n    {\"ğŸ·ï¸ ä¹¦ç­¾\": \"https://www.pixiv.net/novel/marker_all.php\"},\n    {\"ğŸ  é¦–é¡µ\": \"https://www.pixiv.net\"},\n]\n\nlet normal = [\n    {\"âœ… å¸¸è§„ å°è¯´ æ¨è âœ…\": \"\"},\n    {\"â­ï¸ å…³æ³¨\": \"https://www.pixiv.net/ajax/follow_latest/novel?p={{page}}&mode=all&lang=zh\"},\n    {\"ğŸ’¯ æ¨è\": \"https://www.pixiv.net/ajax/top/novel?mode=all&lang=zh\"},\n    {\"ğŸ” å‘ç°\": \"https://www.pixiv.net/ajax/novel/discovery?mode=safe&lang=zh\"},\n    {\"ğŸ†™ æ›´æ–°\": \"https://cdn.jsdelivr.net/gh/DowneyRem/PixivSource@main/pixiv.json\"},\n]\n\nlet r18New = [\n    {\"ğŸ†• æœ€æ–° ä¼åˆ’ çº¦ç¨¿ ğŸ’°\": \"\"},\n    {\"ğŸ†• æœ€æ–°\": \"https://www.pixiv.net/ajax/novel/new?lastId=0&limit=20&r18=true&lang=zh\"},\n    {\"ğŸ“‘ ä¼åˆ’\": \"https://www.pixiv.net/ajax/user_event/portal/novels?mode=r18&p={{page}}&lang=zh\"},\n    {\"ğŸ’° çº¦ç¨¿\": \"https://www.pixiv.net/ajax/commission/page/request/complete/novels?mode=r18&p={{page}}&lang=zh\"},\n    {\"ğŸ” å‘ç°\": \"https://www.pixiv.net/ajax/novel/discovery?mode=all&lang=zh\"},\n]\n\nlet generalNew = [\n    {\"âœ… æœ€æ–° ä¼åˆ’ çº¦ç¨¿ âœ…\": \"\"},\n    {\"æœ€æ–°\": \"https://www.pixiv.net/ajax/novel/new?lastId=0&limit=20&r18=false&lang=zh\"},\n    {\"ä¼åˆ’\": \"https://www.pixiv.net/ajax/user_event/portal/novels?mode=all&p={{page}}&lang=zh\"},\n    {\"çº¦ç¨¿\": \"https://www.pixiv.net/ajax/commission/page/request/complete/novels?mode=all&p={{page}}&lang=zh\"},\n    {\"ç¼–è¾‘\": \"https://www.pixiv.net/novel/editors_picks\"},\n]\n\nlet r18Rank = [\n    {\"ğŸ‘‘ æ’è¡Œæ¦œå• ğŸ‘‘\": \"\"},\n    {\"ä»Šæ—¥\": \"https://www.pixiv.net/novel/ranking.php?mode=daily_r18\"},\n    {\"æœ¬å‘¨\": \"https://www.pixiv.net/novel/ranking.php?mode=weekly_r18\"},\n    {\"R18G\": \"https://www.pixiv.net/novel/ranking.php?mode=r18g\"},\n    {\"ç”·æ€§\": \"https://www.pixiv.net/novel/ranking.php?mode=male_r18\"},\n    {\"å¥³æ€§\": \"https://www.pixiv.net/novel/ranking.php?mode=female_r18\"}\n]\n\nlet generalRank = [\n    {\"ğŸ† æ’è¡Œæ¦œå• ğŸ†\": \"\"},\n    {\"ä»Šæ—¥\": \"https://www.pixiv.net/novel/ranking.php?mode=daily\"},\n    {\"æœ¬å‘¨\": \"https://www.pixiv.net/novel/ranking.php?mode=weekly\"},\n    {\"æœ¬æœˆ\": \"https://www.pixiv.net/novel/ranking.php?mode=monthly\"},\n    {\"ç”·æ€§\": \"https://www.pixiv.net/novel/ranking.php?mode=male\"},\n    {\"å¥³æ€§\": \"https://www.pixiv.net/novel/ranking.php?mode=female\"},\n    {\"æ–°äºº\": \"https://www.pixiv.net/novel/ranking.php?mode=rookie\"},\n    {\"åŸåˆ›\": \"https://www.pixiv.net/novel/ranking.php?mode=weekly_original\"},\n    {\"AIç”Ÿæˆ\": \"https://www.pixiv.net/novel/ranking.php?mode=weekly_ai\"}\n]\n\nlet r18Genre = [\n    {\"ğŸ”¥ åŸåˆ›çƒ­é—¨ ğŸ”¥\": \"\"},\n    {\"ç”·æ€§\": \"https://www.pixiv.net/ajax/genre/novel/male?mode=r18&lang=zh\"},\n    {\"å¥³æ€§\": \"https://www.pixiv.net/ajax/genre/novel/female?mode=r18&lang=zh\"},\n    {\"æ‹çˆ±\": \"https://www.pixiv.net/ajax/genre/novel/romance?mode=r18&lang=zh\"},\n    {\"å¼‚ä¸–ç•Œå¥‡å¹»\": \"https://www.pixiv.net/ajax/genre/novel/isekai_fantasy?mode=r18&lang=zh\"},\n    {\"ç°ä»£å¥‡å¹»\": \"https://www.pixiv.net/ajax/genre/novel/contemporary_fantasy?mode=r18&lang=zh\"},\n    {\"æ‚¬ç–‘\": \"https://www.pixiv.net/ajax/genre/novel/mystery?mode=r18&lang=zh\"},\n    {\"ææ€–\": \"https://www.pixiv.net/ajax/genre/novel/horror?mode=r18&lang=zh\"},\n    {\"ç§‘å¹»\": \"https://www.pixiv.net/ajax/genre/novel/sci-fi?mode=r18&lang=zh\"},\n    {\"æ–‡å­¦\": \"https://www.pixiv.net/ajax/genre/novel/literature?mode=r18&lang=zh\"},\n    {\"æƒ…æ„Ÿ\": \"https://www.pixiv.net/ajax/genre/novel/drama?mode=r18&lang=zh\"},\n    {\"å†å²\": \"https://www.pixiv.net/ajax/genre/novel/historical_pieces?mode=r18&lang=zh\"},\n    {\"è€½ç¾\": \"https://www.pixiv.net/ajax/genre/novel/bl?mode=r18&lang=zh\"},\n    {\"ç™¾åˆ\": \"https://www.pixiv.net/ajax/genre/novel/yuri?mode=r18&lang=zh\"},\n    {\"æ•£æ–‡Â·è¯—æ­Œ\": \"https://www.pixiv.net/ajax/genre/novel/poetry?mode=r18&lang=zh\"},\n    {\"éšç¬”Â·çºªå®\": \"https://www.pixiv.net/ajax/genre/novel/non-fiction??mode=r18&lang=zh\"},\n    {\"å‰§æœ¬\": \"https://www.pixiv.net/ajax/genre/novel/screenplays?mode=r18&lang=zh\"},\n    {\"è¯„è®º\": \"https://www.pixiv.net/ajax/genre/novel/reviews?mode=r18&lang=zh\"},\n    {\"å…¶ä»–\": \"https://www.pixiv.net/ajax/genre/novel/other?mode=r18&lang=zh\"}\n]\n\nlet generalGenre = [\n    {\"â¤ï¸â€ğŸ”¥ åŸåˆ›çƒ­é—¨ â¤ï¸â€ğŸ”¥\": \"\"},\n    {\"ç»¼åˆ\": \"https://www.pixiv.net/ajax/genre/novel/all?mode=safe&lang=zh\"},\n    {\"æ‹çˆ±\": \"https://www.pixiv.net/ajax/genre/novel/romance?mode=safe&lang=zh\"},\n    {\"å¼‚ä¸–ç•Œå¥‡å¹»\": \"https://www.pixiv.net/ajax/genre/novel/isekai_fantasy?mode=safe&lang=zh\"},\n    {\"ç°ä»£å¥‡å¹»\": \"https://www.pixiv.net/ajax/genre/novel/contemporary_fantasy?mode=safe&lang=zh\"},\n    {\"æ‚¬ç–‘\": \"https://www.pixiv.net/ajax/genre/novel/mystery?mode=safe&lang=zh\"},\n    {\"ææ€–\": \"https://www.pixiv.net/ajax/genre/novel/horror?mode=safe&lang=zh\"},\n    {\"ç§‘å¹»\": \"https://www.pixiv.net/ajax/genre/novel/sci-fi?mode=safe&lang=zh\"},\n    {\"æ–‡å­¦\": \"https://www.pixiv.net/ajax/genre/novel/literature?mode=safe&lang=zh\"},\n    {\"æƒ…æ„Ÿ\": \"https://www.pixiv.net/ajax/genre/novel/drama?mode=safe&lang=zh\"},\n    {\"å†å²\": \"https://www.pixiv.net/ajax/genre/novel/historical_pieces?mode=safe&lang=zh\"},\n    {\"è€½ç¾\": \"https://www.pixiv.net/ajax/genre/novel/bl?mode=safe&lang=zh\"},\n    {\"ç™¾åˆ\": \"https://www.pixiv.net/ajax/genre/novel/yuri?mode=safe&lang=zh\"},\n    {\"æ•£æ–‡Â·è¯—æ­Œ\": \"https://www.pixiv.net/ajax/genre/novel/poetry?mode=safe&lang=zh\"},\n    {\"éšç¬”Â·çºªå®\": \"https://www.pixiv.net/ajax/genre/novel/non-fiction??mode=safe&lang=zh\"},\n    {\"å‰§æœ¬\": \"https://www.pixiv.net/ajax/genre/novel/screenplays?mode=safe&lang=zh\"},\n    {\"è¯„è®º\": \"https://www.pixiv.net/ajax/genre/novel/reviews?mode=safe&lang=zh\"},\n    {\"å…¶ä»–\": \"https://www.pixiv.net/ajax/genre/novel/other?mode=safe&lang=zh\"}\n]\n\nlet source = [\n    {\"ğŸ“˜ ä¹¦æºç›¸å…³ ğŸ“˜\": \"\"},\n    {\"ğŸ  ä¸»é¡µ\": \"https://pixivsource.pages.dev\"},\n    {\"ğŸ”° æŒ‡å—\": \"https://pixivsource.pages.dev/Pixiv\"},\n    {\"ğŸ åé¦ˆ\": \"https://github.com/DowneyRem/PixivSource/issues\"},\n    {\"ğŸ’° æ‰“èµ\": \"https://pixivsource.pages.dev/Sponsor\"},\n]\n\nlet likeTagLinks = [{\"ğŸ“Œ å–œæ¬¢æ ‡ç­¾ ğŸ“Œ\":\"\"}]\nlet othersBookmarks = [{\"â¤ï¸ ä»–äººæ”¶è— â¤ï¸\": \"\"}]\n\nli = li.concat(normal)\nli = li.concat(r18New)\nif (SHOW_GENERAL_NEW) li = li.concat(generalNew)\nli = li.concat(r18Rank)\nif (SHOW_GENERAL_RANK) li = li.concat(generalRank)\nif (SHOW_R18_GENRE) li = li.concat(r18Genre)\nif (SHOW_GENERAL_GENRE) li = li.concat(generalGenre)\nsleepToast('ä½¿ç”¨æŒ‡å—ğŸ”–\\n\\nå‘ç° - æ›´æ–° - ç‚¹å‡»\"ğŸ”° ä½¿ç”¨æŒ‡å—\" - æŸ¥çœ‹')\n\n// æ”¶è—æ ‡ç­¾\nlet likeTags = getFromCacheObject(\"likeTags\")\nif (likeTags && likeTags.length >= 1) {\n    likeTags.forEach(tag => {\n        let tagLink = {}\n        tagLink[tag] = `${urlSearchNovel(tag, \"{{page}}\")}`\n        likeTagLinks.push(tagLink)\n    })\n    li = li.concat(likeTagLinks)\n}\n\n// ä»–äººæ”¶è—\nlet likeAuthors = getFromCacheMap(\"likeAuthors\")\nif (likeAuthors.size > 0) {\n    likeAuthors.forEach((authorName, authorId) => {\n        let bookmark = {}\n        bookmark[authorName] = urlUserBookmarks(authorId)\n        othersBookmarks.push(bookmark)\n    })\n    li = li.concat(othersBookmarks)\n}\n\n// ä¹¦æºç›¸å…³\nli = li.concat(source)\n\n// æ·»åŠ æ ¼å¼\nli.forEach(item => {\n    item.title = Object.keys(item)[0]\n    item.url = Object.values(item)[0]\n    if (item.url.includes(\"https://www.pixiv.net\")) item.url = urlIP(item.url)\n    delete item[Object.keys(item)[0]]\n    item.style = {}\n    item.style.layout_flexGrow = 1\n    item.style.layout_flexShrink = 1\n    item.style.layout_alignSelf = \"auto\"\n    item.style.layout_wrapBefore = \"false\"\n    if (item.url === \"\") {\n        item.style.layout_flexBasisPercent = 1\n    } else {\n        item.style.layout_flexBasisPercent = -1\n    }\n})\n\nJSON.stringify(li)",
        "header": "{\"Referer\":\"https://www.pixiv.net\"}",
        "jsLib": "var cacheSaveSeconds = 30*24*60*60  // é•¿æœŸç¼“å­˜ 30 å¤©\nvar cacheTempSeconds = 10*60*1000   // å†·å´æ—¶é—´ 10 åˆ†é’Ÿ\n\nfunction cacheGetAndSet(key, supplyFunc, requestUpdate) {\n    const {java, cache} = this\n    let timestamp = 0\n    let v = this.getFromCacheObject(key)\n    if (Array.isArray(v)) {\n        try {\n            timestamp = v[0].timestamp\n        } catch (e) {\n            timestamp = 0\n        }\n    } else if (v) {\n        timestamp = v.timestamp\n    }\n\n    const isExpired = v && (new Date().getTime() >= timestamp + cacheTempSeconds)\n    const isError = v && (v.error === true) && isExpired\n    requestUpdate = requestUpdate && isExpired\n\n    if (!v || requestUpdate || isError) {\n        v = supplyFunc()\n        let now = new Date().getTime()\n        // getAjaxJson getWebviewJson æ—¶é—´æˆ³å†™å…¥å¯¹è±¡æœ¬èº«\n        if (!Array.isArray(v)) {\n            v = Object.assign({timestamp: now}, v)\n        }\n        // else {\n        //     // getAjaxAllJson æ—¶é—´æˆ³å†™å…¥ç¬¬ä¸€ä¸ªå…ƒç´ ï¼ˆè¯»å–æ—¶ v[0].timestampï¼‰// ä¸é‡å¤å†™å…¥\n        //     if (v.length > 0) v[0] = Object.assign({timestamp: now}, v[0])\n        // }\n        this.putInCacheObject(key, v, cacheSaveSeconds)\n    }\n    return v\n}\n\nfunction putInCache(name, object, saveSeconds) {\n    const {java, cache} = this\n    if (saveSeconds === undefined) saveSeconds = 0\n    if (object) {\n        cache.put(name, object, saveSeconds)\n    }\n}\nfunction getFromCache(name) {\n    const {java, cache} = this\n    let object = cache.get(name)\n    if (object === undefined) return null  // å…¼å®¹æºé˜…\n    return object\n}\n\nfunction normalizeUrl(url) {\n    if (!url.startsWith(\"https://210.140\")) return url\n    return url.replace(\"210.140.139.155\", \"www.pixiv.net\")\n        .replace(\"210.140.139.133\", \"i.pximg.net\")\n        .split(\",\")[0]\n}\nfunction putInCacheObject(objectName, object, saveSeconds) {\n    const {java, cache} = this\n    if (object === undefined) object = null\n    if (saveSeconds === undefined) saveSeconds = 0\n    // if (objectName === \"pixivSettings\") {\n    //     this._settings = object\n    // }\n    cache.put(this.normalizeUrl(objectName), JSON.stringify(object), saveSeconds)\n}\nfunction getFromCacheObject(objectName) {\n    const {java, cache} = this\n    // if (objectName === \"pixivSettings\" && this._settings) {\n    //     return this._settings\n    // }\n    let object = cache.get(this.normalizeUrl(objectName))\n    if (object === undefined) return null  // å…¼å®¹æºé˜…ï¼Œé¿å… parse æŠ¥é”™\n    return JSON.parse(object)\n}\n\nfunction putInCacheMap(mapName, mapObject, saveSeconds) {\n    const {java, cache} = this\n    if (saveSeconds === undefined) saveSeconds = 0\n    let orderedArray = []\n    mapObject.forEach((value, key) => {\n        const item = {}\n        item[key] = value\n        orderedArray.push(item)\n    })\n    // [{'key1': 'value1'}, {'key2': 'value2'}]\n    cache.put(mapName, JSON.stringify(orderedArray), saveSeconds)\n}\nfunction getFromCacheMap(mapName) {\n    const {java, cache} = this\n    let cached = cache.get(mapName)\n    let newMap = new Map()\n    if (cached === null || cached === undefined) {\n        return newMap\n    }\n\n    let parsedData\n    try {\n        parsedData = JSON.parse(cached)\n    } catch (e) {\n        return newMap\n    }\n\n    if (Array.isArray(parsedData)) {\n        parsedData.forEach(item => {\n            for (let key in item) {\n                newMap.set(key, item[key])\n            }\n        })\n    } else {\n        for (let key in parsedData) {\n            newMap.set(key, parsedData[key])\n        }\n    }\n    return newMap\n}\n\nfunction isHtmlString(str) {\n    return str.startsWith(\"<!DOCTYPE html>\")\n}\nfunction isJsonString(str) {\n    try {\n        let result = JSON.parse(str)\n        return typeof result === \"object\" && result !== null\n    } catch(e) {\n        return false\n    }\n}\n\nfunction isLogin() {\n    const {java, cache} = this\n    return !!this.getFromCache(\"pixivCsrfToken\")\n}\n\nfunction getAjaxJson(url, requestUpdate) {\n    const {java, cache} = this\n    return this.cacheGetAndSet(url, () => {\n        return JSON.parse(java.ajax(url))\n    }, requestUpdate)\n}\nfunction getAjaxAllJson(urls, requestUpdate) {\n    const {java, cache} = this\n    let batchKey = JSON.stringify(urls)\n    return this.cacheGetAndSet(batchKey, () => {\n        let results = []\n        let now = new Date().getTime()\n        let responses = java.ajaxAll(urls)\n        for (let i in urls) {\n            let data = JSON.parse(responses[i].body())\n            data = Object.assign({timestamp: now}, data)\n            results.push(data)\n            this.putInCacheObject(urls[i], data, cacheSaveSeconds)\n        }\n        return results\n    }, requestUpdate)\n}\nfunction getAjaxParseJson(url, parseFunc, requestUpdate) {\n    const {java, cache} = this\n    return this.cacheGetAndSet(url, () => {\n        let resp = parseFunc(java.ajax(url))\n        if (resp instanceof Object) return resp\n        else return JSON.parse(resp)\n    }, requestUpdate)\n}\nfunction getWebviewJson(url, parseFunc, requestUpdate) {\n    const {java, cache} = this\n    return this.cacheGetAndSet(url, () => {\n        let html = java.webView(null, url, null)\n        return JSON.parse(parseFunc(html))\n    }, requestUpdate)\n}\n\nfunction getWebViewUA() {\n    const {java, cache} = this\n    let userAgent = this.getFromCache(\"userAgent\")\n    if (userAgent) return String(userAgent)\n\n    userAgent = String(java.getWebViewUA())\n    if (userAgent.includes(\"Windows NT 10.0; Win64; x64\")) {\n        userAgent = \"Mozilla/5.0 (Linux; Android 10; K) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/119.0.0.0 Mobile Safari/537.36\"\n    }\n    // java.log(`userAgent=${userAgent}`)\n    this.putInCache(\"userAgent\", userAgent, cacheSaveSeconds/7)\n    return String(userAgent)\n}\nfunction startBrowser(url, title) {\n    const {java, cache} = this\n    if (!title) title = url\n    let msg = \"\"\n    let headers = {}\n    headers[\"User-Agent\"] = this.getWebViewUA()\n\n    if (url.includes(\"https://www.pixiv.net\")) {\n        if (url.includes(\"settings\")) msg += \"âš™ï¸ è´¦å·è®¾ç½®\"\n        else msg += \"â¤´ï¸ åˆ†äº«å°è¯´\"\n        msg += \"\\n\\nå³å°†æ‰“å¼€ Pixiv\\nè¯·ç¡®è®¤å·²å¼€å¯ä»£ç†/æ¢¯å­/VPNç­‰\"\n    } else if (url.includes(\"github.com\") || url.includes(\"github.io\")) {\n        if (url.includes(\"issues\")) msg += \"ğŸ åé¦ˆé—®é¢˜\"\n        msg += \"\\n\\nå³å°†æ‰“å¼€ Github\\nè¯·ç¡®è®¤å·²å¼€å¯ä»£ç†/æ¢¯å­/VPNç­‰\"\n    }\n    this.sleepToast(msg, 0.01)\n    java.startBrowser(`${url}, ${JSON.stringify({headers: headers})}`, title)\n}\n\n// ç›´è¿åŠŸèƒ½å‚è€ƒè‡ª æ´›å¨…æ©™çš„é˜…è¯»ä»“åº“\n// https://github.com/Luoyacheng/yuedu\n// å…¶ç›´è¿åŠŸèƒ½å‚è€ƒè‡ª PixEz Flutter\n// https://github.com/Notsfsssf/pixez-flutter\nfunction urlIP(url) {\n    const {java, cache} = this\n    let settings = this.getFromCacheObject(\"pixivSettings\")\n    if (!settings) settings = this.setDefaultSettings()\n    if (settings.IPDirect) {\n        url = url.replace(\"http://\", \"https://\").replace(\"www.pixiv.net\", \"210.140.139.155\")\n        let headers = {\n            \"User-Agent\": \"Mozilla/5.0 (Linux; Android 14)\",\n            \"X-Requested-With\": \"XMLHttpRequest\",\n            \"Host\": \"www.pixiv.net\",\n            \"Referer\": \"https://www.pixiv.net/\",\n            \"X-csrf-token\": this.getFromCache(\"pixivCsrfToken\") || \"\",\n            \"Cookie\": this.getFromCache(\"pixivCookie\") || \"\"\n        }\n        return `${url}, ${JSON.stringify({headers: headers})}`\n    }\n    return url\n}\n\nfunction urlNovelUrl(novelId) {\n    return `https://www.pixiv.net/novel/show.php?id=${novelId}`\n}\nfunction urlNovelDetailed(novelId) {\n    return `https://www.pixiv.net/ajax/novel/${novelId}`\n}\nfunction urlNovelsDetailed(userId, nidList) {\n    return `https://www.pixiv.net/ajax/user/${userId}/novels?${nidList.map(v => `ids[]=${v}`).join(\"&\")}`\n}\nfunction urlNovelBookmarkData(novelId) {\n    return `https://www.pixiv.net/ajax/novel/${novelId}/bookmarkData`\n}\nfunction urlNovelComments(novelId, offset, limit) {\n    return `https://www.pixiv.net/ajax/novels/comments/roots?novel_id=${novelId}&offset=${offset}&limit=${limit}&lang=zh`\n}\nfunction urlNovelCommentsReply(commentId, page) {\n    return `https://www.pixiv.net/ajax/novels/comments/replies?comment_id=${commentId}&page=${page}&lang=zh`\n}\nfunction urlNovelsRecommendInit(novelId, limit) {\n    if (limit === undefined) limit = 9\n    return `https://www.pixiv.net/ajax/novel/${novelId}/recommend/init?limit=${limit}&lang=zh`\n}\nfunction urlNovelsRecommendDetailed(nidList) {\n    if (nidList.length >= 9) nidList.length = 9\n    return `https://www.pixiv.net/ajax/novel/recommend/novels?${nidList.map(v => `novelIds[]=${v}`).join(\"&\")}`\n}\n\nfunction urlSeriesUrl(seriesId) {\n    return `https://www.pixiv.net/novel/series/${seriesId}`\n}\nfunction urlSeriesDetailed(seriesId) {\n    return `https://www.pixiv.net/ajax/novel/series/${seriesId}?lang=zh`\n}\nfunction urlSeriesNovelsTitles(seriesId) {\n    return `https://www.pixiv.net/ajax/novel/series/${seriesId}/content_titles`\n}\nfunction urlSeriesNovels(seriesId, limit, offset) {\n    if (limit > 30) limit = 30\n    if (limit < 10) limit = 10\n    return `https://www.pixiv.net/ajax/novel/series_content/${seriesId}?limit=${limit}&last_order=${offset}&order_by=asc&lang=zh`\n}\n\nfunction urlUserUrl(userID) {\n    return `https://www.pixiv.net/users/${userID}/novels`\n}\nfunction urlUserDetailed(userID) {\n    return `https://www.pixiv.net/ajax/user/${userID}`\n}\nfunction urlUserWorkLatest(userID) {\n    return `https://www.pixiv.net/ajax/user/${userID}/works/latest`\n}\nfunction urlUserAllWorks(userId) {\n    return `https://www.pixiv.net/ajax/user/${userId}/profile/all?lang=zh`\n}\nfunction urlUserBookmarks(userId) {\n    return `https://www.pixiv.net/ajax/user/${userId}/novels/bookmarks?tag=&offset={{(page-1)*30}}&limit=30&rest=show&lang=zh`\n}\n\nfunction urlSearchNovel(novelName, page) {\n    return `https://www.pixiv.net/ajax/search/novels/${encodeURI(novelName)}?word=${encodeURI(novelName)}&order=date_d&mode=all&p=${page}&s_mode=s_tag&lang=zh`\n}\nfunction urlSearchSeries(seriesName, page) {\n    return`https://www.pixiv.net/ajax/search/novels/${encodeURI(seriesName)}?word=${encodeURI(seriesName)}&order=date_d&mode=all&p=${page}&s_mode=s_tag&gs=1&lang=zh`\n}\nfunction urlSearchUser(userName, page, full) {\n    let pageUrl = \"\", fullUrl = \"\"\n    if (full) fullUrl = \"_full\"\n    if (page && page >= 2) pageUrl = `&p=${page}`\n    return `https://www.pixiv.net/search/users?nick=${userName}&s_mode=s_usr${fullUrl}&i=1${pageUrl}`;\n}\n\n// ç›´è¿åŠŸèƒ½å‚è€ƒè‡ª æ´›å¨…æ©™çš„é˜…è¯»ä»“åº“\n// https://github.com/Luoyacheng/yuedu\n// å…¶ç›´è¿åŠŸèƒ½å‚è€ƒè‡ª PixEz Flutter\n// https://github.com/Notsfsssf/pixez-flutter\nfunction urlCoverUrl(url) {\n    const {java, cache} = this\n    if (url && !url.trim()) return \"\"\n    let headers = {\"Referer\": \"https://www.pixiv.net/\"}\n\n    let settings = this.getFromCacheObject(\"pixivSettings\")\n    if (!settings) settings = this.setDefaultSettings()\n    if (!settings.IPDirect) return url\n\n    if (settings.IPDirect && url.trim()) {\n        if (url.includes(\"i.pximg.net\")) {\n            url = url.replace(\"https://i.pximg.net\", \"https://210.140.139.133\")\n            headers.host = \"i.pximg.net\"\n        } else {\n            url = url.replace(\"https://s.pximg.net\", \"https://210.140.139.133\")\n            headers.host = \"s.pximg.net\"\n        }\n    }\n    return `${url}, ${JSON.stringify({headers: headers})}`\n}\nfunction urlIllustUrl(illustId) {\n    return `https://www.pixiv.net/artworks/${illustId}`\n}\nfunction urlIllustDetailed(illustId) {\n    return `https://www.pixiv.net/ajax/illust/${illustId}?lang=zh`\n}\nfunction urlIllustOriginal(illustId, order) {\n    const {java, cache} = this\n    if (!order || order <= 1) order = 1\n    let illustOriginal = \"\"\n\n    let resp = this.getAjaxJson(this.urlIP(urlIllustDetailed(illustId)))\n    try {\n        illustOriginal = resp.body.urls.original\n    } catch (e) {\n        try {\n            let illustThumb = resp.body.userIllusts[illustId].url\n            let date = illustThumb.match(\"\\\\d{4}\\\\/\\\\d{2}\\\\/\\\\d{2}\\\\/\\\\d{2}\\\\/\\\\d{2}\\\\/\\\\d{2}\")[0]\n            illustOriginal = `https://i.pximg.net/img-master/img/${date}/${illustId}_p0_master1200.jpg`\n        } catch (e) {}\n    }\n\n    if (illustOriginal.split(\",\")[0] === \"\") return \"\"\n    return this.urlCoverUrl(illustOriginal.replace(`_p0`, `_p${order - 1}`))\n}\nfunction urlEmojiUrl(emojiId) {\n    return `https://s.pximg.net/common/images/emoji/${emojiId}.png, {'style': 'text'}`\n}\nfunction urlStampUrl(stampId) {\n    return `https://s.pximg.net/common/images/stamp/generated-stamps/${stampId}_s.jpg, {'style': 'text'}`\n}\n\nfunction urlMessageThreadLatest(max) {\n    if (max === undefined || max <= 5) max = 5\n    return `https://www.pixiv.net/rpc/index.php?mode=latest_message_threads2&num=${max}&lang=zh`\n}\nfunction urlMessageThreadContents(threadId, max) {\n    return `https://www.pixiv.net/rpc/index.php?mode=message_thread_contents&thread_id=${threadId}&num=${max}`\n}\nfunction urlMessageThreadDetail(threadId) {\n    return `https://www.pixiv.net/rpc/index.php?mode=message_thread&thread_id=${threadId}`\n}\nfunction urlNotification() {\n    return `https://www.pixiv.net/ajax/notification?lang=zh`\n}\n\nfunction addZero(num) {\n    return String(num).padStart(2, '0')\n}\nfunction dateFormat(str) {\n    let time = new Date(str);\n    let Y = time.getFullYear() + \"å¹´\";\n    let M = this.addZero(time.getMonth() + 1) + \"æœˆ\";\n    let D = this.addZero(time.getDate()) + \"æ—¥\";\n    return Y + M + D;\n}\nfunction timeFormat(str) {\n    let time = new Date(str);\n    let YY = time.getFullYear()\n    let MM = this.addZero(time.getMonth() + 1)\n    let DD = this.addZero(time.getDate())\n    let hh = this.addZero(time.getHours())\n    let mm = this.addZero(time.getMinutes())\n    let ss = this.addZero(time.getSeconds())\n    return `${YY}-${MM}-${DD} ${hh}:${mm}:${ss}`\n}\nfunction timeTextFormat(text) {\n    return `${text.slice(0, 10)} ${text.slice(11, 19)}`\n}\n\nfunction sleep(seconds) {\n    return Packages.java.lang.Thread.sleep(1000*seconds)\n}\nfunction sleepToast(text, seconds) {\n    let {java} = this\n    java.log(text)\n    java.longToast(text)\n    if (seconds === undefined) {seconds = 0.01}\n    this.sleep(seconds)\n}\n\nfunction setDefaultSettings() {\n    const {java, cache} = this\n    let settings = {}\n    settings.SEARCH_AUTHOR = false      // æœç´¢ï¼šé»˜è®¤ä¸æœç´¢ä½œè€…åç§°\n    settings.CONVERT_CHINESE = true     // æœç´¢ï¼šæœç´¢æ—¶è¿›è¡Œç¹ç®€è½¬æ¢\n    settings.HIDE_LIKE_NOVELS = false   // æœç´¢ï¼šæœç´¢ç»“æœ éšè—æ”¶è—å°è¯´\n    settings.HIDE_WATCHED_SERIES = false// æœç´¢ï¼šæœç´¢ç»“æœ éšè—è¿½æ•´ç³»åˆ—\n\n    settings.MORE_INFORMATION = false   // è¯¦æƒ…ï¼šä¹¦ç±ç®€ä»‹æ˜¾ç¤ºæ›´å¤šä¿¡æ¯\n    settings.SHOW_UPDATE_TIME = true    // ç›®å½•ï¼šæ˜¾ç¤ºæ›´æ–°æ—¶é—´ï¼Œä½†ä¼šå¢åŠ å°‘è®¸è¯·æ±‚\n    settings.SHOW_ORIGINAL_LINK = true  // ç›®å½•ï¼šæ˜¾ç¤ºåŸå§‹é“¾æ¥ï¼Œä½†ä¼šå¢åŠ å¤§é‡è¯·æ±‚\n\n    settings.REPLACE_TITLE_MARKS = true // æ­£æ–‡ï¼šæ³¨éŸ³å†…å®¹ä¸ºæ±‰å­—æ—¶ï¼Œæ›¿æ¢ä¸ºä¹¦åå·\n    settings.SHOW_CAPTIONS = true       // æ­£æ–‡ï¼šç« é¦–æ˜¾ç¤ºæè¿°\n    settings.SHOW_COMMENTS = true       // æ­£æ–‡ï¼šç« å°¾æ˜¾ç¤ºè¯„è®ºï¼Œä½†ä¼šå¢åŠ å¤§é‡è¯·æ±‚\n\n    settings.IPDirect = false           // å…¨å±€ï¼šç›´è¿æ¨¡å¼\n    settings.FAST  = false              // å…¨å±€ï¼šå¿«é€Ÿæ¨¡å¼\n    settings.DEBUG = false              // å…¨å±€ï¼šè°ƒè¯•æ¨¡å¼\n\n    settings.SHOW_GENERAL = true        // å‘ç°ï¼šæ˜¾ç¤º å¸¸è§„å°è¯´\n    settings.SHOW_NEW_ADULT = true      // å‘ç°ï¼šæ˜¾ç¤º æœ€æ–°ä¼åˆ’çº¦ç¨¿ R18\n    settings.SHOW_NEW_GENERAL = false   // å‘ç°ï¼šæ˜¾ç¤º æœ€æ–°ä¼åˆ’çº¦ç¨¿ å¸¸è§„\n    settings.SHOW_RANK_ADULT = true     // å‘ç°ï¼šæ˜¾ç¤º æ’è¡Œæ¦œå• R18\n    settings.SHOW_RANK_GENERAL = false  // å‘ç°ï¼šæ˜¾ç¤º æ’è¡Œæ¦œå• å¸¸è§„\n    settings.SHOW_GENRE_ADULT = false   // å‘ç°ï¼šæ˜¾ç¤º åŸåˆ›çƒ­é—¨ R18\n    settings.SHOW_GENRE_GENERAL = false // å‘ç°ï¼šæ˜¾ç¤º åŸåˆ›çƒ­é—¨ å¸¸è§„\n    settings.SHOW_FURRY = false         // å‘ç°ï¼šæ˜¾ç¤º å…½äººå°è¯´æ¨èä½œè€…\n\n    settings.SHOW_SETTINGS = true       // è®¾ç½®ï¼šæ˜¾ç¤º ä¹¦æºè®¾ç½®\n    settings.SHOW_DISCOVER = true       // è®¾ç½®ï¼šæ˜¾ç¤º å‘ç°è®¾ç½®\n    settings.SHOW_SETTINGS2 = false     // è®¾ç½®ï¼šæ˜¾ç¤º ä¹¦æºè®¾ç½®\n    settings.SHOW_DISCOVER2 = false     // è®¾ç½®ï¼šæ˜¾ç¤º å‘ç°è®¾ç½®\n    this.putInCacheObject(\"pixivSettings\", settings)\n    return settings\n}\nfunction checkSettings(settings) {\n    const {java, cache} = this\n    if (!settings) settings = this.getFromCacheObject(\"pixivSettings\")\n    if (!settings) settings = this.setDefaultSettings()\n    if (settings.FAST || settings.IPDirect) {\n        settings.SEARCH_AUTHOR = false        // æœç´¢ï¼šé»˜è®¤ä¸æœç´¢ä½œè€…åç§°\n        settings.SHOW_ORIGINAL_LINK = false   // ç›®å½•ï¼šæ˜¾ç¤ºç« èŠ‚æºé“¾æ¥\n    }\n    if (!settings.FAST && !settings.IPDirect) {\n        // settings.SEARCH_AUTHOR = true         // æœç´¢ï¼šé»˜è®¤ä¸æœç´¢ä½œè€…åç§°\n        settings.SHOW_ORIGINAL_LINK = true    // ç›®å½•ï¼šæ˜¾ç¤ºç« èŠ‚æºé“¾æ¥\n    }\n\n    if (settings.FAST) {\n        settings.SEARCH_AUTHOR = false        // æœç´¢ï¼šé»˜è®¤ä¸æœç´¢ä½œè€…åç§°\n        settings.CONVERT_CHINESE = false      // æœç´¢ï¼šç¹ç®€é€šæœ\n        settings.SHOW_UPDATE_TIME = false     // ç›®å½•ï¼šæ˜¾ç¤ºç« èŠ‚æ›´æ–°æ—¶é—´\n        settings.SHOW_COMMENTS = false        // æ­£æ–‡ï¼šæ˜¾ç¤ºè¯„è®º\n    }\n    this.putInCacheObject(\"pixivSettings\", settings)\n    return settings\n}\n\nfunction updateSource() {\n    const {java, source} = this\n    java.longToast(\"ğŸ†™ æ›´æ–°ä¹¦æº\\n\\nJsdelivr CDN æ›´æ–°æœ‰å»¶è¿Ÿ\\nGithub æ›´æ–°éœ€ä»£ç†\")\n    let onlineSource, comment, sourceName, sourceNameCapitalize, index = 0\n    if (source.bookSourceUrl.includes(\"pixiv\")) sourceName = \"pixiv\"\n    else if (source.bookSourceUrl.includes(\"furrynovel\")) sourceName = \"linpx\"\n    sourceNameCapitalize = sourceName[0].toUpperCase() + sourceName.substring(1)\n\n    if (source.bookSourceName.includes(\"å¤‡ç”¨\")) index = 1\n    else if (source.bookSourceName.includes(\"æ¼«ç”»\")) index = 2\n    if (source.bookSourceUrl.includes(\"furrynovel.com\")) {\n        sourceNameCapitalize = \"FurryNovel\"\n        index = 1\n    }\n\n    try {\n        let updateUrl = `https://cdn.jsdelivr.net/gh/DowneyRem/PixivSource@main/${sourceName}.json`\n        onlineSource = JSON.parse(java.get(updateUrl,{'User-Agent': 'Mozilla/5.0 (Linux; Android 14)','X-Requested-With': 'XMLHttpRequest'}).body())[index]\n    } catch (e) {\n        try {\n            let updateUrl = `https://raw.githubusercontent.com/DowneyRem/PixivSource/main/${sourceName}.json`\n            onlineSource = JSON.parse(java.get(updateUrl,{'User-Agent': 'Mozilla/5.0 (Linux; Android 14)','X-Requested-With': 'XMLHttpRequest'}).body())[index]\n        } catch (e) {\n            onlineSource = {lastUpdateTime: new Date().getTime(), bookSourceComment: source.bookSourceComment}\n        }\n    }\n    comment = onlineSource.bookSourceComment.split(\"\\n\")\n    // onlineSource = source\n    // comment = source.bookSourceComment.split(\"\\n\")\n\n    let htm = `\n<!DOCTYPE html>\n<html lang=\"zh-CN\">\n<head>\n    <meta charset=\"UTF-8\">\n    <meta name=\"viewport\" content=\"width=device-width, initial-scale=1.0\">\n    <title>æ›´æ–° ${source.bookSourceName} ä¹¦æº</title>\n    <style> \n    table { text-align: center; margin: 0 auto; } .ann { display: flex; justify-content: center; align-items: center; height: 5vh; } \n    button { background-color: rgb(76, 175, 80); color: white; border: none; border-radius: 4px; height: 6vh; width: 30vw; overflow: hidden; } \n    button span { cursor: pointer; display: inline-block; position: relative; transition: 0.4s; } \n    button span:after { content: '>'; position: absolute; opacity: 0; top: 0; right: 30px; transition: 0.2s; } \n    button:active span { padding-right: 20px; } \n    button:active span:after { opacity: 1; right: -40px; }\n    </style>\n</head>\n\n<body>\n    <table border=\"1\" cellspacing=\"0\">\n        <th colspan=\"2\"> ${source.bookSourceName} ä¹¦æº \n        <a href=\"https://pixivsource.pages.dev/${sourceNameCapitalize}\">ğŸ”° ä½¿ç”¨æŒ‡å—</a>\n        || <a href=\"https://pixivsource.pages.dev/Sponsor\">â¤ï¸ èµåŠ©å¼€å‘</a>\n        </th>\n        <tr>\n            <td>â˜ï¸ è¿œç¨‹ç‰ˆæœ¬ï¼š${onlineSource.bookSourceComment.split(\"\\n\")[2].replace(\"ä¹¦æºç‰ˆæœ¬ï¼š\", \"\")}</td>\n            <td>ğŸ“† æ›´æ–°ï¼š${timeFormat(onlineSource.lastUpdateTime)}</td>\n        </tr>\n        <tr>\n            <td>ğŸ“¥ æœ¬åœ°ç‰ˆæœ¬ï¼š${source.bookSourceComment.split(\"\\n\")[2].replace(\"ä¹¦æºç‰ˆæœ¬ï¼š\", \"\")}</td>\n            <td>ğŸ“† æ›´æ–°ï¼š${timeFormat(source.lastUpdateTime)}</td>\n        </tr> \n        <tr><td colspan=\"2\" style=\"text-align: left;\">${comment.slice(3, 10).join(\"<br>\")}</td></tr>\n        <tr><td colspan=\"2\" style=\"text-align: left;\">${comment.slice(comment.length-3, comment.length).join(\"<br>\")}</td></tr>\n    </table>\n    \n    <table border=\"0\" cellspacing=\"20\">\n        <th colspan=\"2\"> æ›´æ–° ${source.bookSourceName} ä¹¦æº </th>\n        <tr><td><div class=\"ann\">\n            <a href=\"legado://import/importonline?src=https://cdn.jsdelivr.net/gh/DowneyRem/PixivSource@main/${sourceName}.json\">\n            <button><span>æ›´æ–°ä¹¦æº<br>(Jsdelivr CDN)</span></button>\n            </a></div></td>\n            \n            <td><div class=\"ann\">\n            <a href=\"legado://import/importonline?src=https://cdn.jsdelivr.net/gh/DowneyRem/PixivSource@main/btsrk.json\">\n            <button><span>æ›´æ–°è®¢é˜…<br>(Jsdelivr CDN)</span></button>\n            </a></div></td>\n        </tr>\n        \n        <tr><td><div class=\"ann\">\n            <a href=\"legado://import/importonline?src=https://raw.githubusercontent.com/DowneyRem/PixivSource/main/${sourceName}.json\">\n            <button><span>ä¹¦æºé“¾æ¥<br>(GitHub)</span></button>\n            </a></div></td>\n            \n            <td><div class=\"ann\">\n            <a href=\"legado://import/importonline?src=https://raw.githubusercontent.com/DowneyRem/PixivSource/main/btsrk.json\">\n            <button><span>è®¢é˜…é“¾æ¥<br>(GitHub)</span></button>\n            </a></div></td>\n        </tr>\n        \n        <tr><td><div class=\"ann\">\n            <a href=\"legado://import/importonline?src=https://codeberg.org/DowneyRem/PixivSource/raw/branch/main/${sourceName}.json\">\n            <button><span>å¤‡ç”¨ä¹¦æºé“¾æ¥<br>(Codeberg)</span></button>\n            </a></div></td>\n            \n            <td><div class=\"ann\">\n            <a href=\"legado://import/importonline?src=https://codeberg.org/DowneyRem/PixivSource/raw/branch/main/btsrk.json\">\n            <button><span>å¤‡ç”¨è®¢é˜…é“¾æ¥<br>(Codeberg)</span></button>\n            </a></div></td>\n        </tr>\n    </table>\n</body>\n</html>`\n    java.startBrowser(`data:text/html;charset=utf-8;base64, ${java.base64Encode(htm)}`, 'æ›´æ–°ä¹¦æº')\n    return []\n}",
        "lastUpdateTime": 1771689600251,
        "loginCheckJs": "var util = {}\n\nfunction objStringify(obj) {\n    return JSON.stringify(obj, (n, v) => {\n        if (typeof v == \"function\")\n            return v.toString();\n        return v;\n    });\n}\n\n// æ£€æµ‹ æºé˜…\n// å¯ç”¨ java.ajax() ä¸å¯ç”¨ java.webview() java.ajaxAll()\n// å¯ç”¨ java.getCookie() cache.put() cache.get() é»˜è®¤å€¼ä¸º undefined\n// å¯ç”¨ java.startBrowser() ä¸å¯ç”¨ java.startBrowserAwaitAwait\n// å¯ç”¨ source.bookSourceName source.getVariable() source.setVariable()ç­‰\n// java.getUserAgent() java.getWebViewUA() ç›®å‰è¿”å›å†…å®¹ç›¸åŒ\nfunction isSourceRead() {\n    return java.getUserAgent() === java.getWebViewUA()\n}\n// æ­£å¼ç‰ˆ ä¸æ”¯æŒåœ¨ JSlib çš„å‡½æ•°ç›´æ¥è®¾ç½®é»˜è®¤å‚æ•°\n// æ­£å¼ç‰ˆ ä¸æ”¯æŒ a?.b çš„å†™æ³•\n// æ£€æµ‹ é˜…è¯» æ­£å¼ç‰ˆ ä¸ Beta ç‰ˆæœ¬\nfunction isLegadoOfficial() {\n    let isLegadoOfficialStatus\n    try {\n        eval('({})?.value')\n        isLegadoOfficialStatus = false\n    } catch (e) {\n        isLegadoOfficialStatus = true\n    }\n    return isLegadoOfficialStatus\n}\n// æ£€æµ‹ é˜…è¯» Beta ç‰ˆæœ¬ ä¸ LYC ç‰ˆæœ¬\n// LYC ç‰ˆæœ¬æ–°å¢å‡½æ•°\n// java.ajaxTestAll()\n// java.openVideoPlayer(url: String, title: String, float: Boolean)\n// cookie.setWebCookie(url,cookie)\n// source.refreshExplore()\n// source.refreshJSLib()\nfunction isLegadoSigma() {\n    return typeof java.ajaxTestAll === \"function\"\n}\n\nfunction publicFunc() {\n    let u = {}, settings\n    // è¾“å‡ºä¹¦æºä¿¡æ¯\n    java.log(`${source.bookSourceComment.split(\"\\n\")[0]}`)\n    java.log(`ğŸ“Œ ${source.bookSourceComment.split(\"\\n\")[2]}`)\n    java.log(`ğŸ“† æ›´æ–°æ—¶é—´ï¼š${java.timeFormat(source.lastUpdateTime)}`)\n\n    // è®¾ç½®å†™å…¥ç¼“å­˜\n    u.settings = getFromCacheObject(\"pixivSettings\")\n    if (!u.settings) u.settings = setDefaultSettings()\n    u.settings = checkSettings()\n    putInCacheObject(\"pixivSettings\", u.settings)\n\n    // ç¯å¢ƒå†™å…¥ç¼“å­˜\n    u.environment = {}\n    u.environment.IS_SOURCEREAD = isSourceRead()\n    u.environment.IS_LEGADO = !isSourceRead()\n    u.environment.IS_LEGADO_SIGMA = isLegadoSigma()\n    putInCacheObject(\"pixivEnvironment\", u.environment)\n\n    // è¾“å‡ºç¯å¢ƒä¿¡æ¯\n    if (u.environment.IS_SOURCEREAD) {\n        java.log(\"ğŸ“± è½¯ä»¶å¹³å°ï¼šğŸ æºé˜… SourceRead\")\n    } else if (u.environment.IS_LEGADO_SIGMA) {\n        java.log(\"ğŸ“± è½¯ä»¶å¹³å°ï¼šğŸ¤– é˜…è¯» Betaã€æ–°åŒ…åã€‘/ é˜…è¯» Plus\")\n    } else if (u.environment.IS_LEGADO_OFFICIAL) {\n        java.log(\"ğŸ“± è½¯ä»¶å¹³å°ï¼šğŸ¤– é˜…è¯» æ­£å¼ç‰ˆ\")\n        // sleepToast(\"\\nâš ï¸å½“å‰è½¯ä»¶ä¸ºï¼šé˜…è¯»ã€æ­£å¼ç‰ˆã€‘\\nã€æ­£å¼ç‰ˆã€‘å·²å¹´ä¹…å¤±ä¿®ï¼Œä¸æ¨èç»§ç»­ä½¿ç”¨\\n\\nä¸ºäº†æ›´å¥½çš„ä½¿ç”¨ä½“éªŒï¼Œè¯·ç”¨ï¼š\\nã€é˜…è¯» Plusã€‘æˆ–ã€é˜…è¯» Beta æ–°åŒ…åã€‘\\n\\nå³å°†ä¸ºæ‚¨æ‰“å¼€ã€é˜…è¯» Plusã€‘ä¸‹è½½ç•Œé¢\")\n        // sleep(3);\n        // startBrowser(\"https://loyc.xyz/c/legado.html#download\", \"ä¸‹è½½é˜…è¯» Plus\")\n    } else {\n        java.log(\"ğŸ“± è½¯ä»¶å¹³å°ï¼šğŸ¤– é˜…è¯» Betaã€åŸåŒ…åã€‘\")\n        // sleepToast(\"\\nâš ï¸å½“å‰è½¯ä»¶ä¸ºï¼šé˜…è¯» Betaã€åŸåŒ…åã€‘\\n\\nä¸ºäº†æ›´å¥½çš„ä½¿ç”¨ä½“éªŒï¼Œè¯·ç”¨ï¼š\\nã€é˜…è¯» Plusã€‘æˆ–ã€é˜…è¯» Beta æ–°åŒ…åã€‘\\n\\nå³å°†ä¸ºæ‚¨æ‰“å¼€ã€é˜…è¯» Plusã€‘ä¸‹è½½ç•Œé¢\")\n        // sleep(3);\n        // startBrowser(\"https://loyc.xyz/c/legado.html#download\", \"ä¸‹è½½é˜…è¯» Plus\")\n    }\n    if (u.settings.IPDirect) {\n        java.log(\"âœˆï¸ ç›´è¿æ¨¡å¼ï¼šâœ… å·²å¼€å¯\")\n    } else {\n        java.log(\"âœˆï¸ ç›´è¿æ¨¡å¼ï¼šâŒ å·²å…³é—­\")\n    }\n\n    u.debugFunc = (func) => {\n        if (util.settings.DEBUG === true) {\n            func()\n        }\n    }\n\n    u.checkStatus = function(status) {\n        if (status === true) return \"âœ… å·²\"\n        else if (status === false) return \"âŒ æœª\"\n        else if (status === undefined) return \"ğŸˆšï¸ æ— æ•°æ®ï¼š\"\n    }\n\n    u.login = function() {\n        let resp = java.startBrowserAwait(`https://accounts.pixiv.net/login,\n    {\"headers\": {\"User-Agent\": \"${java.getWebViewUA()}\"}}`, 'ç™»å½•è´¦å·', false)\n        if (resp.code() === 200) {\n            this.getCsrfToken(); this.getCookie()\n        } else {\n            java.log(resp.code()); sleepToast(\"âš ï¸ ç™»å½•å¤±è´¥\")\n        }\n    }\n\n    u.logout = function() {\n        this.removeCookie()\n        java.startBrowser(\"https://www.pixiv.net/logout.php\", \"é€€å‡ºè´¦å·\")\n        this.removeCookie()\n        sleepToast(`âœ… å·²é€€å‡ºå½“å‰è´¦å·\\n\\né€€å‡ºåè¯·ç‚¹å‡»å³ä¸Šè§’çš„ âœ”ï¸ é€€å‡º\\n\\nç™»å½•è¯·ç‚¹å‡»ã€ç™»å½•è´¦å·ã€‘è¿›è¡Œç™»å½•`)\n    }\n\n    u.getCookie = function() {\n        let pixivCookie = String(java.getCookie(\"https://www.pixiv.net/\", null))\n        if (isLogin()) putInCache(\"pixivCookie\", pixivCookie, 60*60)  // ç¼“å­˜1h\n    }\n\n    u.removeCookie = function() {\n        cookie.removeCookie('https://www.pixiv.net')\n        cookie.removeCookie('https://accounts.pixiv.net')\n        cookie.removeCookie('https://accounts.google.com')\n        cookie.removeCookie('https://api.weibo.com')\n        cache.delete(\"pixivCookie\")\n        cache.delete(\"pixiv:uid\")\n        cache.delete(\"pixivCsrfToken\")  // ä¸ç™»å½•è®¾å¤‡æœ‰å…³\n        cache.delete(\"headers\")\n    }\n\n    // è·å– Csrf Tokenï¼Œä»¥ä¾¿è¿›è¡Œæ”¶è—ç­‰è¯·æ±‚\n    // è·å–æ–¹æ³•æ¥è‡ªè„šæœ¬ Pixiv Previewer\n    // https://github.com/Ocrosoft/PixivPreviewer\n    // https://greasyfork.org/zh-CN/scripts/30766-pixiv-previewer/code\n    u.getCsrfToken = function() {\n        let pixivCsrfToken = getFromCache(\"pixivCsrfToken\")\n        if (!pixivCsrfToken) {\n            let html = java.webView(null, \"https://www.pixiv.net/\", null)\n            try {\n                pixivCsrfToken = html.match(/token\\\\\":\\\\\"([a-z0-9]{32})/)[1]\n                putInCache(\"pixivCsrfToken\", pixivCsrfToken)  // ä¸ç™»å½•è®¾å¤‡æœ‰å…³ï¼Œæ— æ³•å­˜å‚¨ nul\n            } catch (e) {\n                pixivCsrfToken = null\n                cache.delete(\"pixivCsrfToken\")  // ä¸ç™»å½•è®¾å¤‡æœ‰å…³ï¼Œæ— æ³•å­˜å‚¨ nul\n                // sleepToast(\"âš ï¸ æœªç™»å½•è´¦å·(pixivCsrfToken)\")\n            }\n            java.log(`pixivCsrfToken:\\n${pixivCsrfToken}`)\n        }\n        return pixivCsrfToken\n    }\n\n    // å°†å¤šä¸ªé•¿ç¯‡å°è¯´è§£æä¸ºä¸€æœ¬ä¹¦\n    u.combineNovels = function(novels) {\n        return novels.filter(novel => {\n            // å•æœ¬ç›´æ¥è§£æä¸ºä¸€æœ¬ä¹¦\n            if (novel.seriesId === undefined || novel.seriesId === null) {\n                return true\n            }\n            // é›†åˆä¸­æ²¡æœ‰è¯¥ç³»åˆ—è§£æä¸ºä¸€æœ¬ä¹¦\n            if (!seriesSet.has(novel.seriesId)) {\n                seriesSet.add(novel.seriesId)\n                return true\n            }\n            return false\n        })\n    }\n\n    // å±è”½ä½œè€…\n    u.authorFilter = function(novels) {\n        let authors = getFromCacheObject(\"blockAuthorList\")\n        if (Array.isArray(authors) && authors.length >= 0) {\n            java.log(`ğŸš« å±è”½ä½œè€…IDï¼š${JSON.stringify(authors)}`)\n            authors.forEach(author => {\n                novels = novels.filter(novel => {\n                    novel.userId !== String(author)\n                })\n            })\n        }\n        return novels\n    }\n\n\n    // è¿‡æ»¤æ”¶è—ä¸è¿½æ›´\n    u.novelFilter = function(novels) {\n        let novels1 = [], novels2 = [], msg\n        let likeNovels = getFromCacheObject(\"likeNovels\")\n        let watchedSeries = getFromCacheObject(\"watchedSeries\")\n        let novels0 = novels.map(novel => novel.id)\n\n        java.log(`${util.checkStatus(!util.settings.HIDE_LIKE_NOVELS)}æ˜¾ç¤ºæ”¶è—å°è¯´`)\n        if (util.settings.HIDE_LIKE_NOVELS) {\n            novels = novels.filter(novel => !likeNovels.includes(Number(novel.id)))\n            novels1 = novels.map(novel => novel.id)\n            java.log(`â¬ è¿‡æ»¤æ”¶è—ï¼šè¿‡æ»¤å‰${novels0.length}ï¼›è¿‡æ»¤å${novels1.length}`)\n        }\n\n        java.log(`${util.checkStatus(!util.settings.HIDE_WATCHED_SERIES)}æ˜¾ç¤ºè¿½æ›´ç³»åˆ—`)\n        if (util.settings.HIDE_WATCHED_SERIES) {\n            novels = novels.filter(novel => !watchedSeries.includes(Number(novel.seriesId)))\n            novels2 = novels.map(novel => novel.id)\n            if (novels1.length >= 1) novels0 = novels1\n            java.log(`â¬ è¿‡æ»¤è¿½æ›´ï¼šè¿‡æ»¤å‰${novels0.length}ï¼›è¿‡æ»¤å${novels2.length}`)\n        }\n\n        let novels3 = novels.map(novel => novel.id)\n        if (novels0.length >= 1 && novels3.length === 0) {\n            let msg = `â¬ è¿‡æ»¤å°è¯´\\nâš ï¸ è¿‡æ»¤åæ— ç»“æœ\\n\\nè¯·æ ¹æ®éœ€è¦\\n`\n            if (util.settings.HIDE_LIKE_NOVELS) msg += \"å¼€å¯æ˜¾ç¤ºæ”¶è—å°è¯´\\n\"\n            if (util.settings.HIDE_WATCHED_SERIES) msg += \"å¼€å¯æ˜¾ç¤ºè¿½æ›´ç³»åˆ—\"\n            sleepToast(msg, 1)\n        }\n\n        util.debugFunc(() => {\n            // java.log(JSON.stringify(novels0))\n            java.log(JSON.stringify(novels0.length))\n            // java.log(JSON.stringify(novels1))\n            java.log(JSON.stringify(novels1.length))\n            // java.log(JSON.stringify(novels2))\n            java.log(JSON.stringify(novels2.length))\n        })\n        return novels\n    }\n\n    // è¿‡æ»¤æè¿°ä¸æ ‡ç­¾ï¼ˆå±è”½æ ‡ç­¾/å±è”½æè¿°ï¼‰\n    u.novelFilter2 = function(novels) {\n        let novels0 = novels.map(novel => novel.id)\n        let captionBlockWords = getFromCacheObject(\"captionBlockWords\")\n        if (!captionBlockWords) captionBlockWords = []\n        else {\n            // ä»…ä¿ç•™æ²¡æœ‰ä»»ä½•å±è”½è¯çš„å°è¯´\n            // novels = novels.filter(novel => {\n            //     return !captionBlockWords.some(item => {\n            //         if (novel.description !== undefined) return novel.description.includes(item)\n            //     })\n            // })\n            novels = novels.filter(novel => !captionBlockWords.some(item => novel.description.includes(item)))\n            let novels2 = novels.map(novel => novel.id)\n            java.log(`ğŸš« å±è”½æè¿°ï¼š${captionBlockWords.join(\"\\n\")}`)\n            java.log(`ğŸš« å±è”½æè¿°ï¼šè¿‡æ»¤å‰${novels0.length}ï¼›è¿‡æ»¤å${novels2.length}`)\n        }\n\n        let tagsBlockWords = getFromCacheObject(\"tagsBlockWords\")\n        if (!tagsBlockWords) tagsBlockWords = []\n        else {\n            // ä»…ä¿ç•™æ²¡æœ‰ä»»ä½•å±è”½è¯çš„å°è¯´\n            // novels = novels.filter(novel => {\n            //     return !tagsBlockWords.some(item => {\n            //         if (novel.tags !== undefined) return novel.tags.includes(item)\n            //     })\n            // })\n            novels = novels.filter(novel => !tagsBlockWords.some(item => novel.tags.includes(item)))\n            let novels2 = novels.map(novel => novel.id)\n            java.log(`ğŸš« å±è”½æ ‡ç­¾ï¼š${tagsBlockWords.join(\"ã€\")}`)\n            java.log(`ğŸš« å±è”½æ ‡ç­¾ï¼šè¿‡æ»¤å‰${novels0.length}ï¼›è¿‡æ»¤å${novels2.length}`)\n        }\n        return novels\n    }\n\n    // æ”¶è—å°è¯´/è¿½æ›´ç³»åˆ— å†™å…¥ç¼“å­˜\n    u.saveNovels = function(listInCacheName, list) {\n        let listInCache = getFromCacheObject(listInCacheName)\n        if (!listInCache) listInCache = []\n\n        listInCache = listInCache.concat(list)\n        listInCache = Array.from(new Set(listInCache))\n        putInCacheObject(listInCacheName, listInCache)\n\n        if (listInCacheName === \"likeNovels\") listInCacheName = \"â¤ï¸ æ”¶è—å°è¯´ID\"\n        else if (listInCacheName === \"watchedSeries\") listInCacheName = \"ğŸ“ƒ è¿½æ›´ç³»åˆ—ID\"\n        util.debugFunc(() => {\n            java.log(`${listInCacheName}ï¼š${JSON.stringify(listInCache)}`)\n        })\n    }\n\n    u.saveAuthors = function(authors) {\n        let pixivAuthors = getFromCacheObject(\"pixivAuthors\")\n        if (!pixivAuthors) pixivAuthors = {}\n\n        pixivAuthors = Object.assign(pixivAuthors, authors)\n        putInCacheObject(\"pixivAuthors\", pixivAuthors)\n    }\n\n    // å¤„ç† novels åˆ—è¡¨\n    u.handNovels = function(novels, isDetail) {\n        if (!isDetail) isDetail = false\n        let likeNovels = [], watchedSeries = [], authors = {}\n        novels = util.authorFilter(novels)\n        novels.forEach(novel => {\n            // novel.id = novel.id\n            // novel.title = novel.title\n            // novel.userName = novel.userName\n            // novel.userId = novel.userId\n            // novel.tags = novel.tags\n            authors[novel.userName] = novel.userId  // åŠ å…¥ç¼“å­˜ï¼Œä¾¿äºæœç´¢ä½œè€…\n            if (novel.tags === undefined || novel.tags === null) {\n                novel.tags = []\n            }\n            // æœç´¢å•ç¯‡\n            if (novel.isOneshot === undefined) {\n                // novel.seriesId = novel.seriesId\n                // novel.seriesTitle = novel.seriesTitle\n                // novel.textCount = novel.textCount\n                // novel.description = novel.description\n                novel.coverUrl = novel.url\n                // novel.createDate = novel.createDate\n                // novel.updateDate = novel.updateDate\n            }\n\n            // æœç´¢ç³»åˆ—\n            if (novel.isOneshot !== undefined) {\n                if (novel.isOneshot === true) {\n                    novel.seriesId = undefined\n                    novel.id = novel.novelId  // è·å–çœŸæ­£çš„ novelId\n                    novel.seriesTitle = undefined\n                } else {\n                    novel.seriesId = novel.id\n                    novel.id = novel.novelId = novel.latestEpisodeId  // è·å–çœŸæ­£çš„ novelId\n                    novel.seriesTitle = novel.title\n                    // novel.isWatched = novel.isWatched  // æœç´¢ç³»åˆ—å¯è·å–\n                }\n                novel.textCount = novel.textLength\n                novel.description = novel.caption\n                novel.coverUrl = novel.cover.urls[\"480mw\"]\n                novel.createDate = novel.createDateTime\n                novel.updateDate = novel.updateDateTime\n            }\n\n            // å•ç¯‡æ­£æ–‡è¯¦æƒ…é¡µ\n            if (novel.content) {\n                novel.novelId = novel.id\n                novel.tags = novel.tags.tags.map(item => item.tag)\n                novel.textCount = novel.userNovels[`${novel.id}`].textCount\n                // novel.latestChapter = novel.title\n                // novel.description = novel.description\n                novel.coverUrl = novel.userNovels[`${novel.id}`].url\n                // novel.createDate = novel.createDate\n                novel.updateDate = novel.uploadDate\n\n                if (novel.seriesNavData) {\n                    novel.seriesId = novel.seriesNavData.seriesId\n                    novel.seriesTitle = novel.seriesNavData.title\n                }\n            }\n\n            // ç³»åˆ—è¯¦æƒ…\n            if (novel.firstNovelId) {\n                novel.seriesId = novel.id\n                novel.id = novel.novelId = novel.firstNovelId\n                novel.seriesTitle = novel.title\n                novel.coverUrl = novel.cover.urls[\"480mw\"]\n                // novel.isWatched = novel.isWatched  // æœç´¢ç³»åˆ—å¯è·å–\n            }\n\n            // å•ç¯‡åŠ æ›´å¤šä¿¡æ¯\n            if (!novel.seriesId) {\n                novel.tags.unshift(\"å•æœ¬\")\n                novel.latestChapter = novel.title\n                novel.detailedUrl = urlIP(urlNovelDetailed(novel.id))\n                novel.total = 1\n                if (novel.bookmarkData) {\n                    novel.isBookmark = true\n                    putInCache(`collect${novel.id}`, novel.bookmarkData.id)\n                    likeNovels.push(Number(novel.id))\n                } else {\n                    novel.isBookmark = false\n                }\n            }\n\n            if (novel.seriesId && !isDetail) {\n                novel.title = novel.seriesTitle\n                novel.tags.unshift(\"é•¿ç¯‡\")\n                novel.detailedUrl = urlIP(urlSeriesDetailed(novel.seriesId))\n            }\n            // ç³»åˆ—æ·»åŠ æ›´å¤šä¿¡æ¯\n            if (novel.seriesId && isDetail) {\n                let series = getAjaxJson(urlIP(urlSeriesDetailed(novel.seriesId))).body\n                novel.id = series.firstNovelId\n                novel.title = series.title\n                novel.tags = novel.tags.concat(series.tags)\n                novel.tags.unshift(\"é•¿ç¯‡\")\n                novel.textCount = series.publishedTotalCharacterCount\n                novel.description = series.caption\n                novel.coverUrl = series.cover.urls[\"480mw\"]\n                novel.detailedUrl = urlIP(urlSeriesDetailed(novel.seriesId))\n                novel.createDate = series.createDate\n                novel.updateDate = series.updateDate\n                novel.total = series.publishedContentCount\n                novel.isWatched = series.isWatched\n                if (novel.isWatched === true) {\n                    watchedSeries.push(Number(novel.seriesId))\n                }\n\n                // é˜²æ­¢ç³»åˆ—é¦–ç¯‡æ— æƒé™è·å–\n                // å‘é€è¯·æ±‚è·å–ç¬¬ä¸€ç«  è·å–æ ‡ç­¾ä¸ç®€ä»‹\n                let firstNovel = {}\n                try {\n                    firstNovel = getAjaxJson(urlIP(urlSeriesNovels(novel.seriesId, 30, 0))).body.thumbnails.novel[0]\n                    novel.id = novel.firstNovelId = firstNovel.id\n                    novel.tags = novel.tags.concat(firstNovel.tags)\n                } catch (e) { // é˜²æ­¢ç³»åˆ—é¦–ç¯‡æ— æƒé™è·å–\n                    firstNovel = {}\n                    firstNovel.description = \"\"\n                }\n                novel.tags.unshift(\"é•¿ç¯‡\")\n                if (novel.description === \"\") {\n                    novel.description = firstNovel.description\n                }\n            }\n        })\n        // æ”¶è—å°è¯´/è¿½æ›´ç³»åˆ— å†™å…¥ç¼“å­˜\n        util.saveNovels(\"likeNovels\", likeNovels)\n        util.saveNovels(\"watchedSeries\", watchedSeries)\n        util.saveAuthors(authors)\n        util.debugFunc(() => {\n            java.log(`å¤„ç†å°è¯´å®Œæˆ`)\n        })\n        return novels\n    }\n\n    // å°è¯´ä¿¡æ¯æ ¼å¼åŒ–\n    u.formatNovels = function(novels) {\n        novels = util.novelFilter(novels)\n        novels.forEach(novel => {\n            novel.title = novel.title.trim()\n            if (!novel.userName.startsWith(\"@\")) novel.userName = `@${novel.userName}`\n            novel.coverUrl = urlCoverUrl(novel.coverUrl)\n            novel.readingTime = `${novel.readingTime / 60} åˆ†é’Ÿ`\n            novel.createDate = dateFormat(novel.createDate)\n            novel.updateDate = dateFormat(novel.updateDate)\n\n            novel.tags2 = []\n            for (let i in novel.tags) {\n                let tag = novel.tags[i]\n                if (tag.includes(\"/\")) {\n                    let tags = tag.split(\"/\")\n                    novel.tags2 = novel.tags2.concat(tags)\n                } else {\n                    novel.tags2.push(tag)\n                }\n            }\n            novel.tags = Array.from(new Set(novel.tags2))\n            novel.tags = novel.tags.join(\",\")\n            if (novel.seriesId) {\n                collectMsg = `è¿½æ›´ï¼š${util.checkStatus(novel.isWatched)}è¿½æ›´ç³»åˆ—`\n            } else {\n                collectMsg = `æ”¶è—ï¼š${util.checkStatus(novel.isBookmark)}åŠ å…¥æ”¶è—`\n            }\n\n            if (util.settings.MORE_INFORMATION) {\n                novel.description = `\\nç™»å½•ï¼š${util.checkStatus(isLogin())}ç™»å½•è´¦å·\n                ${collectMsg}\\nä¹¦åï¼š${novel.title}\\nä½œè€…ï¼š${novel.userName}\n                æ ‡ç­¾ï¼š${novel.tags}\\nä¸Šä¼ ï¼š${novel.createDate}\n                æ›´æ–°ï¼š${novel.updateDate}\\nç®€ä»‹ï¼š${novel.description}`\n            } else {\n                novel.description = `\\nç™»å½•ï¼š${util.checkStatus(isLogin())}ç™»å½•è´¦å·\n                ${collectMsg}\\nä¸Šä¼ ï¼š${novel.createDate}\\næ›´æ–°ï¼š${novel.updateDate}\n                ç®€ä»‹ï¼š${novel.description}`\n            }\n        })\n        novels = util.novelFilter2(novels)\n        return novels\n    }\n\n    // æ­£æ–‡ï¼Œè¯¦æƒ…ï¼Œæœç´¢ï¼šä»ç½‘å€è·å–idï¼Œè¿”å›å•ç¯‡å°è¯´ resï¼Œç³»åˆ—è¿”å›é¦–ç¯‡å°è¯´ res\n    // pixiv é»˜è®¤åˆ†äº«ä¿¡æ¯ä¸­æœ‰#å·ï¼Œä¸ä¼šè¢«è¯†åˆ«æˆé“¾æ¥ï¼Œæ— æ³•ä½¿ç”¨æ·»åŠ ç½‘å€\n    u.getNovelResFirst = function(result) {\n        let novelId = 0, res = {\"body\": {}}\n        let isJson = isJsonString(result)\n        let isHtml = isHtmlString(result)\n\n        if (!isJson && isHtml) {\n            let id = baseUrl.match(new RegExp(\"\\\\d+\"))[0]\n            let pattern = \"(https?://)?(www\\\\.)?pixiv\\\\.net(/ajax)?/users?/\\\\d+\"\n            let isAuthor = baseUrl.match(new RegExp(pattern))\n            if (isAuthor) {\n                java.log(`ä½œè€…IDï¼š${id}`)\n                novelId = Object.keys(getAjaxJson(urlIP(urlUserWorkLatest(id))).body.novels).reverse()[0]\n            }\n\n            pattern = \"(https?://)?(www\\\\.)?pixiv\\\\.net/novel/series/\\\\d+\"\n            let isSeries = baseUrl.match(new RegExp(pattern))\n            if (isSeries) {\n                java.log(`ç³»åˆ—IDï¼š${id}`)\n                novelId = getAjaxJson(urlIP(urlSeriesNovels(id, 30, 0))).body.thumbnails.novel[0].id\n            } else {\n                let pattern = \"(https?://)?(www\\\\.)?pixiv\\\\.net/novel/(show\\\\.php\\\\?id=)?\\\\d+\"\n                let isNovel = baseUrl.match(new RegExp(pattern))\n                if (isNovel) {\n                    novelId = id\n                }\n            }\n        }\n        if (isJson) {\n            res = JSON.parse(result)\n        }\n\n        if (novelId) {\n            java.log(`åŒ¹é…å°è¯´IDï¼š${novelId}`)\n            res = getAjaxJson(urlIP(urlNovelDetailed(novelId)))\n        }\n        if (res.error === true) {\n            java.log(`æ— æ³•ä» Pixiv è·å–å½“å‰å°è¯´`)\n            java.log(JSON.stringify(res))\n        }\n        return res.body\n    }\n\n    // ç›®å½•ï¼šä»ç½‘å€è·å–idï¼Œå°½å¯èƒ½è¿”å›ç³»åˆ— resï¼Œå•ç¯‡å°è¯´è¿”å›å°è¯´ res\n    u.getNovelResSeries = function(result) {\n        let seriesId = 0, res = {\"body\": {}}\n        let isJson = isJsonString(result)\n        let isHtml = isHtmlString(result)\n\n        if (!isJson && isHtml) {\n            let id = baseUrl.match(new RegExp(\"\\\\d+\"))[0]\n            let pattern = \"(https?://)?(www\\\\.)?pixiv\\\\.net/novel/series/\\\\d+\"\n            let isSeries = baseUrl.match(new RegExp(pattern))\n            if (isSeries) {\n                seriesId = id\n            } else {\n                let pattern = \"(https?://)?(www\\\\.)?pixiv\\\\.net/novel/(show\\\\.php\\\\?id=)?\\\\d+\"\n                let isNovel = baseUrl.match(new RegExp(pattern))\n                if (isNovel) {\n                    java.log(`åŒ¹é…å°è¯´IDï¼š${id}`)\n                    res = getAjaxJson(urlIP(urlNovelDetailed(id)))\n                }\n            }\n        }\n        if (isJson) {\n            res = JSON.parse(result)\n        }\n\n        if (res.body && res.body.seriesNavData) {\n            seriesId = res.body.seriesNavData.seriesId\n        }\n        if (seriesId) {\n            java.log(`ç³»åˆ—IDï¼š${seriesId}`)\n            res = getAjaxJson(urlIP(urlSeriesDetailed(seriesId)))\n        }\n        if (res.error === true) {\n            java.log(`æ— æ³•ä» Pixiv è·å–å½“å‰å°è¯´`)\n            java.log(JSON.stringify(res))\n        }\n        return res.body\n    }\n\n    util = u\n    java.put(\"util\", objStringify(u))\n}\n\nfunction checkMessageThread(checkTimes) {\n    if (checkTimes === undefined) {\n        checkTimes = Number(getFromCache(\"checkTimes\"))\n    }\n    if (checkTimes === 0 && isLogin()) {\n        let latestMsg = getAjaxJson(urlIP(urlMessageThreadLatest(5)))\n        if (latestMsg.error === true) {\n            java.log(JSON.stringify(latestMsg))\n        } else if (latestMsg.body.total >= 1) {\n            let msg = latestMsg.body.message_threads.filter(item => item.thread_name === \"pixiväº‹å‹™å±€\")[0]\n            if (msg && new Date().getTime()- 1000*msg.modified_at <= 3*24*60*60*1000) { // 3å¤©å†…è¿›è¡Œæç¤º\n                sleepToast(`æ‚¨äº ${timeFormat(1000*msg.modified_at)} è§¦å‘ Pixiv ã€è¿‡åº¦è®¿é—®ã€‘ï¼Œè¯·ä¿®æ”¹å¯†ç å¹¶é‡æ–°ç™»å½•ã€‚\\nå¦‚å·²ä¿®æ”¹è¯·å¿½ç•¥`, 3)\n                sleepToast(`${msg.latest_content}`, 5)\n                java.startBrowser(\"https://accounts.pixiv.net/password/change\",'ä¿®æ”¹å¯†ç ')\n            }\n        }\n    }\n    putInCache(\"checkTimes\", checkTimes + 1, 4*60*60)  // ç¼“å­˜4hï¼Œæ¯4hæé†’ä¸€æ¬¡\n    // putInCache(\"checkTimes\", checkTimes + 1, 60)  // æµ‹è¯•ç”¨ï¼Œç¼“å­˜60sï¼Œæ¯åˆ†é’Ÿæé†’ä¸€æ¬¡\n    // java.log(checkTimes + 1)\n}\n\n// è·å–è¯·æ±‚çš„user idæ–¹ä¾¿å…¶ä»–ajaxè¯·æ±‚æ„é€ \nfunction getPixivUid() {\n    let uid = getFromCache(\"pixiv:uid\")\n    if (!uid || String(uid) === \"null\") {\n        let html = java.webView(null, \"https://www.pixiv.net/\", null)\n        try {\n            uid = html.match(/user_id:'(\\d+)'/)[1]\n        } catch (e) {\n            uid = null\n        }\n        putInCache(\"pixiv:uid\", String(uid))\n    }\n}\n\nfunction getHeaders() {\n    let headers = {\n        \"accept\": \"application/json\",\n        \"accept-encoding\": \"gzip, deflate, br, zstd\",\n        \"accept-language\": \"zh-CN\",\n        // \"content-type\": \"application/json; charset=utf-8\",\n        // \"content-type\": \"application/x-www-form-urlencoded; charset=utf-8\",\n        \"origin\": \"https//www.pixiv.net\",\n        \"Referer\": \"https://www.pixiv.net/\",\n        // \"sec-ch-ua\": `\"Not/A)Brand\";v=\"8\", \"Chromium\";v=\"132\", \"Google Chrome\";v=\"132\"`,\n        // \"sec-ch-ua-mobile\": \"?0\",\n        // \"sec-ch-ua-platform\": \"Windows\",\n        // \"sec-fetch-dest\": \"empty\",\n        // \"sec-fetch-mode\": \"cors\",\n        // \"sec-fetch-site\": \"same-origin\",\n        \"user-agent\": getFromCache(\"userAgent\") || \"\",\n        \"x-csrf-token\": getFromCache(\"pixivCsrfToken\") || \"\",\n        \"Cookie\": getFromCache(\"pixivCookie\") || \"\"\n    }\n    putInCacheObject(\"headers\", headers)\n    return headers\n}\n\npublicFunc()\nif (result.code() === 200) {\n    getPixivUid(); getWebViewUA(); util.getCookie(); util.getCsrfToken(); getHeaders()\n    if (!util.settings.FAST) checkMessageThread()   // æ£€æµ‹è¿‡åº¦è®¿é—®\n}\njava.getStrResponse(null, null)",
        "loginUi": "[\n    {\n        \"name\": \"ğŸ…¿ï¸ ç™»å½•è´¦å·\",\n        \"type\": \"button\",\n        \"action\": \"login()\",\n        \"style\": {\n            \"layout_flexGrow\": 1,\n            \"layout_flexBasisPercent\": -1\n        }\n    },\n    {\n        \"name\": \"âš™ï¸ è´¦å·è®¾ç½®\",\n        \"type\": \"button\",\n        \"action\": \"startPixivSettings()\",\n        \"style\": {\n            \"layout_flexGrow\": 1,\n            \"layout_flexBasisPercent\": -1\n        }\n    },\n    {\n        \"name\": \"ğŸ”™ é€€å‡ºè´¦å·\",\n        \"type\": \"button\",\n        \"action\": \"logout()\",\n        \"style\": {\n            \"layout_flexGrow\": 1,\n            \"layout_flexBasisPercent\": -1\n        }\n    },\n    {\n        \"name\": \"ğŸ†™ æ›´æ–°ä¹¦æº\",\n        \"type\": \"button\",\n        \"action\": \"updateSource()\",\n        \"style\": {\n            \"layout_flexGrow\": 1,\n            \"layout_flexBasisPercent\": -1\n        }\n    },\n    {\n        \"name\": \"ğŸ”° ä½¿ç”¨æŒ‡å—\",\n        \"type\": \"button\",\n        \"action\": \"startGithubReadme()\",\n        \"style\": {\n            \"layout_flexGrow\": 1,\n            \"layout_flexBasisPercent\": -1\n        }\n    },\n    {\n        \"name\": \"âœˆï¸ ç›´è¿æ¨¡å¼\",\n        \"type\": \"button\",\n        \"action\": \"editSettings('IPDirect')\",\n        \"style\": {\n            \"layout_flexGrow\": 1,\n            \"layout_flexBasisPercent\": -1\n        }\n    },\n    {\n        \"name\": \"ç« èŠ‚åç§°\",\n        \"type\": \"text\"\n    },\n    {\n        \"name\": \"â¤ï¸ æ”¶è—æœ¬ç« \",\n        \"type\": \"button\",\n        \"action\": \"novelBookmarkFactory(1)\",\n        \"style\": {\n            \"layout_flexGrow\": 1,\n            \"layout_flexBasisPercent\": -1\n        }\n    },\n    {\n        \"name\": \"ğŸ“ƒ è¿½æ›´ç³»åˆ—\",\n        \"type\": \"button\",\n        \"action\": \"seriesWatchFactory()\",\n        \"style\": {\n            \"layout_flexGrow\": 1,\n            \"layout_flexBasisPercent\": -1\n        }\n    },\n    {\n        \"name\": \"â¤ï¸ æ”¶è—ç³»åˆ—\",\n        \"type\": \"button\",\n        \"action\": \"novelsBookmarkAdd()\",\n        \"style\": {\n            \"layout_flexGrow\": 1,\n            \"layout_flexBasisPercent\": -1\n        }\n    },\n    {\n        \"name\": \"ğŸ–¤ å–æ¶ˆæ”¶è—\",\n        \"type\": \"button\",\n        \"action\": \"novelsBookmarkDelete()\",\n        \"style\": {\n            \"layout_flexGrow\": 1,\n            \"layout_flexBasisPercent\": -1\n        }\n    },\n    {\n        \"name\": \"â­ï¸ å…³æ³¨ä½œè€…\",\n        \"type\": \"button\",\n        \"action\": \"userFollowFactory()\",\n        \"style\": {\n            \"layout_flexGrow\": 1,\n            \"layout_flexBasisPercent\": -1\n        }\n    },\n    {\n        \"name\": \"ğŸš« å±è”½ä½œè€…\",\n        \"type\": \"button\",\n        \"action\": \"userBlock()\",\n        \"style\": {\n            \"layout_flexGrow\": 1,\n            \"layout_flexBasisPercent\": -1\n        }\n    },\n\n    {\n        \"name\": \"è¾“å…¥å†…å®¹\",\n        \"type\": \"text\"\n    },\n    {\n        \"name\": \"âœ… å‘é€è¯„è®º\",\n        \"type\": \"button\",\n        \"action\": \"novelCommentAdd()\",\n        \"style\": {\n            \"layout_flexGrow\": 1,\n            \"layout_flexBasisPercent\": -1\n        }\n    },\n    {\n        \"name\": \"ğŸ—‘ï¸ åˆ é™¤è¯„è®º\",\n        \"type\": \"button\",\n        \"action\": \"novelCommentDelete()\",\n        \"style\": {\n            \"layout_flexGrow\": 1,\n            \"layout_flexBasisPercent\": -1\n        }\n    },\n    {\n        \"name\": \"ğŸ”„ åˆ·æ–°æœ¬ç« \",\n        \"type\": \"button\",\n        \"action\": \"cleanCache()\",\n        \"style\": {\n            \"layout_flexGrow\": 1,\n            \"layout_flexBasisPercent\": -1\n        }\n    },\n\n    {\n        \"name\": \"ğŸš« æ·»åŠ å±è”½\",\n        \"type\": \"button\",\n        \"action\": \"blockAddFactory()\",\n        \"style\": {\n            \"layout_flexGrow\": 1,\n            \"layout_flexBasisPercent\": -1\n        }\n    },\n    {\n        \"name\": \"â­•ï¸ åˆ é™¤å±è”½\",\n        \"type\": \"button\",\n        \"action\": \"blockDeleteFactory()\",\n        \"style\": {\n            \"layout_flexGrow\": 1,\n            \"layout_flexBasisPercent\": -1\n        }\n    },\n    {\n        \"name\": \"ğŸ‘€ æŸ¥çœ‹å±è”½\",\n        \"type\": \"button\",\n        \"action\": \"blockShowFactory()\",\n        \"style\": {\n            \"layout_flexGrow\": 1,\n            \"layout_flexBasisPercent\": -1\n        }\n    },\n\n    {\n        \"name\": \"ğŸ“Œ å–œæ¬¢æ ‡ç­¾\",\n        \"type\": \"button\",\n        \"action\": \"likeTagsAdd()\",\n        \"style\": {\n            \"layout_flexGrow\": 1,\n            \"layout_flexBasisPercent\": -1\n        }\n    },\n    {\n        \"name\": \"ğŸ—‘ï¸ åˆ é™¤æ ‡ç­¾\",\n        \"type\": \"button\",\n        \"action\": \"likeTagsDelete()\",\n        \"style\": {\n            \"layout_flexGrow\": 1,\n            \"layout_flexBasisPercent\": -1\n        }\n    },\n    {\n        \"name\": \"ğŸ‘€ æŸ¥çœ‹æ ‡ç­¾\",\n        \"type\": \"button\",\n        \"action\": \"likeTagsShow()\",\n        \"style\": {\n            \"layout_flexGrow\": 1,\n            \"layout_flexBasisPercent\": -1\n        }\n    },\n\n    {\n        \"name\": \"â¤ï¸ ä»–äººæ”¶è—\",\n        \"type\": \"button\",\n        \"action\": \"likeAuthorsAdd()\",\n        \"style\": {\n            \"layout_flexGrow\": 1,\n            \"layout_flexBasisPercent\": -1\n        }\n    },\n    {\n        \"name\": \"ğŸ–¤ å–æ¶ˆæ”¶è—\",\n        \"type\": \"button\",\n        \"action\": \"likeAuthorsDelete()\",\n        \"style\": {\n            \"layout_flexGrow\": 1,\n            \"layout_flexBasisPercent\": -1\n        }\n    },\n    {\n        \"name\": \"ğŸ‘€ æŸ¥çœ‹æ”¶è—\",\n        \"type\": \"button\",\n        \"action\": \"likeAuthorsShow()\",\n        \"style\": {\n            \"layout_flexGrow\": 1,\n            \"layout_flexBasisPercent\": -1\n        }\n    },\n\n    {\n        \"name\": \"ä¹¦æºè®¾ç½®\",\n        \"type\": \"text\"\n    },\n    {\n        \"name\": \"âš™ï¸ å½“å‰è®¾ç½®\",\n        \"type\": \"button\",\n        \"action\": \"showSettings()\",\n        \"style\": {\n            \"layout_flexGrow\": 1,\n            \"layout_flexBasisPercent\": -1\n        }\n    },\n    {\n        \"name\": \"ğŸ”§ é»˜è®¤è®¾ç½®\",\n        \"type\": \"button\",\n        \"action\": \"setDefaultSettingsLoginUrl()\",\n        \"style\": {\n            \"layout_flexGrow\": 1,\n            \"layout_flexBasisPercent\": -1\n        }\n    },\n    {\n        \"name\": \"ğŸ‘¤ æœç´¢ä½œè€…\",\n        \"type\": \"button\",\n        \"action\": \"editSettings('SEARCH_AUTHOR')\",\n        \"style\": {\n            \"layout_flexGrow\": 1,\n            \"layout_flexBasisPercent\": -1\n        }\n    },\n    {\n        \"name\": \"ğŸ€„ ç¹ç®€é€šæœ\",\n        \"type\": \"button\",\n        \"action\": \"editSettings('CONVERT_CHINESE')\",\n        \"style\": {\n            \"layout_flexGrow\": 1,\n            \"layout_flexBasisPercent\": -1\n        }\n    },\n    {\n        \"name\": \"ğŸ“– æ›´å¤šç®€ä»‹\",\n        \"type\": \"button\",\n        \"action\": \"editSettings('MORE_INFORMATION')\",\n        \"style\": {\n            \"layout_flexGrow\": 1,\n            \"layout_flexBasisPercent\": -1\n        }\n    },\n    {\n        \"name\": \"ğŸ“… æ›´æ–°æ—¶é—´\",\n        \"type\": \"button\",\n        \"action\": \"editSettings('SHOW_UPDATE_TIME')\",\n        \"style\": {\n            \"layout_flexGrow\": 1,\n            \"layout_flexBasisPercent\": -1\n        }\n    },\n    {\n        \"name\": \"ğŸ”— åŸå§‹é“¾æ¥\",\n        \"type\": \"button\",\n        \"action\": \"editSettings('SHOW_ORIGINAL_LINK')\",\n        \"style\": {\n            \"layout_flexGrow\": 1,\n            \"layout_flexBasisPercent\": -1\n        }\n    },\n    {\n        \"name\": \"ğŸ“š æ¢å¤ã€Šã€‹\",\n        \"type\": \"button\",\n        \"action\": \"editSettings('REPLACE_TITLE_MARKS')\",\n        \"style\": {\n            \"layout_flexGrow\": 1,\n            \"layout_flexBasisPercent\": -1\n        }\n    },\n    {\n        \"name\": \"ğŸ–¼ï¸ æ˜¾ç¤ºæè¿°\",\n        \"type\": \"button\",\n        \"action\": \"editSettings('SHOW_CAPTIONS')\",\n        \"style\": {\n            \"layout_flexGrow\": 1,\n            \"layout_flexBasisPercent\": -1\n        }\n    },\n    {\n        \"name\": \"ğŸ’¬ æ˜¾ç¤ºè¯„è®º\",\n        \"type\": \"button\",\n        \"action\": \"editSettings('SHOW_COMMENTS')\",\n        \"style\": {\n            \"layout_flexGrow\": 1,\n            \"layout_flexBasisPercent\": -1\n        }\n    },\n    {\n        \"name\": \"â¤ï¸ éšè—æ”¶è—\",\n        \"type\": \"button\",\n        \"action\": \"editSettings('HIDE_LIKE_NOVELS')\",\n        \"style\": {\n            \"layout_flexGrow\": 1,\n            \"layout_flexBasisPercent\": -1\n        }\n    },\n    {\n        \"name\": \"ğŸ“ƒ éšè—è¿½æ›´\",\n        \"type\": \"button\",\n        \"action\": \"editSettings('HIDE_WATCHED_SERIES')\",\n        \"style\": {\n            \"layout_flexGrow\": 1,\n            \"layout_flexBasisPercent\": -1\n        }\n    },\n    {\n        \"name\": \"â© å¿«é€Ÿæ¨¡å¼\",\n        \"type\": \"button\",\n        \"action\": \"editSettings('FAST')\",\n        \"style\": {\n            \"layout_flexGrow\": 1,\n            \"layout_flexBasisPercent\": -1\n        }\n    },\n    {\n        \"name\": \"ğŸ è°ƒè¯•æ¨¡å¼\",\n        \"type\": \"button\",\n        \"action\": \"editSettings('DEBUG')\",\n        \"style\": {\n            \"layout_flexGrow\": 1,\n            \"layout_flexBasisPercent\": -1\n        }\n    },\n    {\n        \"name\": \"ğŸº å…½äººä½œè€…\",\n        \"type\": \"button\",\n        \"action\": \"updatePixivAuthors()\",\n        \"style\": {\n            \"layout_flexGrow\": 1,\n            \"layout_flexBasisPercent\": -1\n        }\n    },\n\n    {\n        \"name\": \"ä¹¦æºè®¾ç½®\",\n        \"type\": \"text\"\n    },\n    {\n        \"name\": \"ğŸ” å½“å‰å‘ç°\",\n        \"type\": \"button\",\n        \"action\": \"showSettingsDiscover()\",\n        \"style\": {\n            \"layout_flexGrow\": 1,\n            \"layout_flexBasisPercent\": -1\n        }\n    },\n    {\n        \"name\": \"ğŸ†— å¸¸è§„å°è¯´\",\n        \"type\": \"button\",\n        \"action\": \"editSettings('SHOW_GENERAL')\",\n        \"style\": {\n            \"layout_flexGrow\": 1,\n            \"layout_flexBasisPercent\": -1\n        }\n    },\n    {\n        \"name\": \"ğŸ” æœ€æ–°ä¼åˆ’\",\n        \"type\": \"button\",\n        \"action\": \"editSettings('SHOW_NEW_ADULT')\",\n        \"style\": {\n            \"layout_flexGrow\": 1,\n            \"layout_flexBasisPercent\": -1\n        }\n    },\n    {\n        \"name\": \"ğŸ†— æœ€æ–°ä¼åˆ’\",\n        \"type\": \"button\",\n        \"action\": \"editSettings('SHOW_NEW_GENERAL')\",\n        \"style\": {\n            \"layout_flexGrow\": 1,\n            \"layout_flexBasisPercent\": -1\n        }\n    },\n    {\n        \"name\": \"ğŸ” æ’è¡Œæ¦œå•\",\n        \"type\": \"button\",\n        \"action\": \"editSettings('SHOW_RANK_ADULT')\",\n        \"style\": {\n            \"layout_flexGrow\": 1,\n            \"layout_flexBasisPercent\": -1\n        }\n    },\n    {\n        \"name\": \"ğŸ†— æ’è¡Œæ¦œå•\",\n        \"type\": \"button\",\n        \"action\": \"editSettings('SHOW_RANK_GENERAL')\",\n        \"style\": {\n            \"layout_flexGrow\": 1,\n            \"layout_flexBasisPercent\": -1\n        }\n    },\n    {\n        \"name\": \"ğŸ” åŸåˆ›çƒ­é—¨\",\n        \"type\": \"button\",\n        \"action\": \"editSettings('SHOW_GENRE_ADULT')\",\n        \"style\": {\n            \"layout_flexGrow\": 1,\n            \"layout_flexBasisPercent\": -1\n        }\n    },\n    {\n        \"name\": \"ğŸ†— åŸåˆ›çƒ­é—¨\",\n        \"type\": \"button\",\n        \"action\": \"editSettings('SHOW_GENRE_GENERAL')\",\n        \"style\": {\n            \"layout_flexGrow\": 1,\n            \"layout_flexBasisPercent\": -1\n        }\n    },\n    {\n        \"name\": \"ğŸº å…½äººå°è¯´\",\n        \"type\": \"button\",\n        \"action\": \"editSettings('SHOW_FURRY')\",\n        \"style\": {\n            \"layout_flexGrow\": 1,\n            \"layout_flexBasisPercent\": -1\n        }\n    }\n]",
        "loginUrl": "function login() {\n    let resp = java.startBrowserAwait(`https://accounts.pixiv.net/login,\n    {\"headers\": {\"User-Agent\": ${getWebViewUA()}}}`, 'ç™»å½•è´¦å·', false)\n    if (resp.code() === 200) {\n        getCsrfToken(); getCookie()\n        return true\n    } else {\n        java.log(resp.code()); sleepToast(\"ğŸ…¿ï¸ ç™»å½•è´¦å·\\n\\nâš ï¸ ç™»å½•å¤±è´¥\")\n        return false\n    }\n}\n\nfunction logout() {\n    removeCookie()\n    java.startBrowser(\"https://www.pixiv.net/logout.php\", \"é€€å‡ºè´¦å·\")\n    removeCookie(); removeLikeDataCache(); removeSettingsCache()\n    sleepToast(`âœ… å·²é€€å‡ºå½“å‰è´¦å·\\n\\né€€å‡ºåè¯·ç‚¹å‡»å³ä¸Šè§’çš„ âœ”ï¸ é€€å‡º\\n\\nç™»å½•è¯·ç‚¹å‡»ã€ç™»å½•è´¦å·ã€‘è¿›è¡Œç™»å½•`)\n}\n\nfunction removeCookie() {\n    cookie.removeCookie('https://www.pixiv.net')\n    cookie.removeCookie('https://accounts.pixiv.net')\n    cookie.removeCookie('https://accounts.google.com')\n    cookie.removeCookie('https://api.weibo.com')\n    cache.delete(\"pixivCookie\")\n    cache.delete(\"pixiv:uid\")\n    cache.delete(\"pixivCsrfToken\")  // ä¸ç™»å½•è®¾å¤‡æœ‰å…³\n    cache.delete(\"headers\")\n}\n\nfunction removeCacheList(listName) {\n    let list = getFromCacheObject(listName)\n    list.forEach(item => cache.delete(`collect${item}`))\n    if (listName !== \"blockAuthorList\") cache.delete(listName)\n}\n\nfunction removeLikeDataCache() {\n    // åˆ é™¤ likeNovels ä¸ watchedSeries\n    removeCacheList(\"likeNovels\")\n    removeCacheList(\"watchedSeries\")\n}\n\nfunction removeSettingsCache() {\n    // åˆ é™¤ å±è”½ä½œè€…åå•\n    // removeCacheList(\"blockAuthorList\")\n    // åˆ é™¤  å±è”½å…³é”®è¯\n    // cache.delete(\"tagsBlockWords\")\n    // cache.delete(\"captionBlockWords\")\n}\n\nfunction getCookie() {\n    let pixivCookie = String(java.getCookie(\"https://www.pixiv.net/\", null))\n    if (isLogin()) putInCache(\"pixivCookie\", pixivCookie, 60*60)\n}\n\n// è·å– Csrf Tokenï¼Œä»¥ä¾¿è¿›è¡Œæ”¶è—ç­‰è¯·æ±‚\n// è·å–æ–¹æ³•æ¥è‡ªè„šæœ¬ Pixiv Previewer\n// https://github.com/Ocrosoft/PixivPreviewer\n// https://greasyfork.org/zh-CN/scripts/30766-pixiv-previewer/code\nfunction getCsrfToken() {\n    let pixivCsrfToken = getFromCache(\"pixivCsrfToken\")\n    if (!pixivCsrfToken) {\n        let html = java.webView(null, \"https://www.pixiv.net/\", null)\n        try {\n            pixivCsrfToken = html.match(/token\\\\\":\\\\\"([a-z0-9]{32})/)[1]\n            putInCache(\"pixivCsrfToken\", pixivCsrfToken)  // ä¸ç™»å½•è®¾å¤‡æœ‰å…³ï¼Œæ— æ³•å­˜å‚¨ nul\n        } catch (e) {\n            pixivCsrfToken = null\n            cache.delete(\"pixivCsrfToken\")  // ä¸ç™»å½•è®¾å¤‡æœ‰å…³ï¼Œæ— æ³•å­˜å‚¨ nul\n            // sleepToast(\"âš ï¸ æœªç™»å½•è´¦å·(pixivCsrfToken)\")\n        }\n        java.log(`pixivCsrfToken:\\n${pixivCsrfToken}`)\n    }\n    return pixivCsrfToken\n}\n\nfunction getNovel() {\n    let environment = getFromCacheObject(\"pixivEnvironment\")\n    if (environment.IS_LEGADO_SIGMA) {\n        try {\n            let novel = {}\n            try {\n                novel.id = chapter.url.match(/\\d+/)[0]\n            } catch(e){\n                novel.id = chapter.url.match(/novel\\/(\\d+)/)[1]  // ç›´è¿æ¨¡å¼\n            }\n            novel.title = chapter.title\n            novel.userName = book.author.replace(\"@\", \"\")\n            if (book.bookUrl.includes(\"series\")) {\n                novel.seriesId = book.bookUrl.match(/\\d+/)[0]\n                novel.seriesTitle = book.name\n            } else {\n                novel.seriesId = 0\n                novel.seriesTitle = \"\"\n            }\n\n            let resp = getAjaxJson(urlIP(urlNovelDetailed(novel.id))).body\n            novel.userId = resp.userId\n            if (resp.pollData) {\n                novel.pollChoicesCount = resp.pollData.choices.length\n            } else {\n                novel.pollChoicesCount = 0\n            }\n            // java.log(JSON.stringify(novel))\n            return novel\n        } catch (e) {\n            // æ— æ³•é˜»æ­¢åç»­å‡½æ•°åœ¨æ—¥å¿—ä¸­æŠ¥é”™\n            return sleepToast(\"ğŸ”° åŠŸèƒ½æç¤º\\n\\nâš ï¸ è¯·åœ¨ã€å°è¯´æ­£æ–‡ã€‘ä½¿ç”¨è¯¥åŠŸèƒ½\")\n        }\n    } else {  // å…¼å®¹ç”¨\n        let novel = source.getLoginInfoMap()\n        if (!novel) novel = getFromCacheObject(\"novel\")\n        return novel\n    }\n}\n\nfunction getPostBody(url, body, headers) {\n    if (headers === undefined) headers = getFromCacheObject(\"headers\")\n    if (isJsonString(body)) {\n        headers[\"content-type\"] = \"application/json; charset=utf-8\"\n    } else if (typeof body === \"string\") {\n        headers[\"content-type\"] = \"application/x-www-form-urlencoded; charset=utf-8\"\n    }\n    try {\n        java.log(`getPostBody(${url}, ${body}, ${headers})`)\n        // java.log(`getPostBody(${url}, ${body}, ${JSON.stringify(headers)})`)\n        return JSON.parse(java.post(url, body, headers).body())\n    } catch (e) {\n        e = String(e)\n        // sleepToast(e)\n        // sleepToast(JSON.stringify(headers))\n        if (e.includes(\"400\")) sleepToast(`ğŸ“¤ getPostBody\\n\\nâš ï¸ ç¼ºå°‘ headers`, 1)\n        else if (e.includes(\"403\")) sleepToast(`ğŸ“¤ getPostBody\\n\\nâš ï¸ ç¼ºå°‘ cookie æˆ– cookie è¿‡æœŸ`, 1)\n        else if (e.includes(\"404\")) sleepToast(`ğŸ“¤ getPostBody\\n\\nâš ï¸ 404 ç¼ºå°‘ pixivCsrfToken `, 1)\n        else if (e.includes(\"422\")) sleepToast(`ğŸ“¤ getPostBody\\n\\nâš ï¸ è¯·æ±‚ä¿¡æ¯æœ‰è¯¯`, 1)\n        return {error: true, errMsg:e}\n    }\n}\n\nfunction novelBookmarkAdd() {\n    let restrict = 0\n    let novel = getNovel()\n    let novelObj = getAjaxJson(urlNovelDetailed(novel.id), true)\n    if (novelObj.body.bookmarkData && novelObj.body.bookmarkData.private === false) restrict = 1\n    let resp = getPostBody(\n        \"https://www.pixiv.net/ajax/novels/bookmarks/add\",\n        JSON.stringify({\"novel_id\": novel.id, \"restrict\": restrict, \"comment\":\"\", \"tags\":[]})\n    )\n    if (resp.error === true) {\n        sleepToast(`â¤ï¸ æ”¶è—å°è¯´\\n\\nâš ï¸ æ”¶è—ã€${novel.title}ã€‘å¤±è´¥`)\n        shareFactory(\"novel\")\n    } else {\n        putInCacheObject(`collect${novel.id}`, resp.body)\n        let likeNovels = getFromCacheObject(\"likeNovels\")\n        likeNovels.push(Number(novel.id))\n        putInCacheObject(\"likeNovels\", likeNovels)\n\n        let novelObj = getAjaxJson(urlNovelDetailed(novel.id))\n        novelObj.body.isBookmark = true\n        putInCacheObject(urlNovelDetailed(novel.id), novelObj, cacheSaveSeconds)\n    }\n\n    if (restrict === 1) {\n        sleepToast(`ãŠ™ï¸ ç§å¯†æ”¶è—\\n\\nâœ… å·²ç§å¯†æ”¶è—\\n${novel.title}`)\n    } else {\n        sleepToast(`â¤ï¸ å…¬å¼€æ”¶è—\\n\\nâœ… å·²å…¬å¼€æ”¶è—\\n${novel.title}`)\n    }\n}\n\nfunction getNovelBookmarkId(novelId) {\n    let bookmarkId = getFromCacheObject(`collect${novelId}`)\n    if (bookmarkId === null) {\n        try {\n            bookmarkId = getAjaxJson(urlNovelBookmarkData(novelId), true).body.bookmarkData.id\n        } catch (e) {\n            bookmarkId = 0\n        }\n    }\n    return bookmarkId\n}\n\nfunction novelBookmarkDelete() {\n    let novel = getNovel()\n    let bookmarkId = getNovelBookmarkId(novel.id)\n    if (bookmarkId === 0) return sleepToast(`ğŸ–¤ å–æ¶ˆæ”¶è—\\n\\nâœ… å·²ç»å–æ¶ˆæ”¶è—\\n${novel.title}`)\n\n    let resp = getPostBody(\n        \"https://www.pixiv.net/ajax/novels/bookmarks/delete\",\n        `del=1&book_id=${bookmarkId}`\n    )\n    if (resp.error === true) {\n        sleepToast(`ğŸ–¤ å–æ¶ˆæ”¶è—\\n\\nâš ï¸ å–æ¶ˆæ”¶è—å¤±è´¥\\n${novel.title}`)\n        shareFactory(\"novel\")\n    } else {\n        cache.delete(`collect${novel.id}`)\n        sleepToast(`ğŸ–¤ å–æ¶ˆæ”¶è—\\n\\nâœ… å·²ç»å–æ¶ˆæ”¶è—\\n${novel.title}`)\n\n        let likeNovels = getFromCacheObject(\"likeNovels\")\n        likeNovels = likeNovels.filter(item => item !== Number(novel.id))\n        putInCacheObject(\"likeNovels\", likeNovels)\n\n        let novelObj = getAjaxJson(urlNovelDetailed(novel.id))\n        novelObj.body.isBookmark = false\n        putInCacheObject(urlNovelDetailed(novel.id), novelObj, cacheSaveSeconds)\n    }\n}\n\nfunction novelsBookmarkDelete() {\n    let novel = getNovel()\n    if (!isLongClick) {\n        if (!novel.seriesId) sleepToast(`ğŸ–¤ å–æ¶ˆæ”¶è—\\n\\næ­£åœ¨å–æ¶ˆæ”¶è—ã€æœ¬ç« ã€‘`)\n        else sleepToast(`ğŸ–¤ å–æ¶ˆæ”¶è—\\n\\næ­£åœ¨å–æ¶ˆæ”¶è—ã€æœ¬ç« ã€‘\\né•¿æŒ‰å¯å–æ¶ˆæ”¶è—ã€æ•´ä¸ªç³»åˆ—ã€‘`)\n        return novelBookmarkDelete(0)\n    }\n    if (isLongClick && !novel.seriesId) {\n        return (`ğŸ–¤ å–æ¶ˆæ”¶è—ç³»åˆ—\\n\\nâš ï¸ ã€${novel.title}ã€‘éç³»åˆ—å°è¯´`)\n    }\n    sleepToast(`ğŸ–¤ å–æ¶ˆæ”¶è—ç³»åˆ—\\n\\nğŸ”„ æ­£åœ¨å–æ¶ˆæ”¶è—ç³»åˆ—ï¼Œè¯·ç¨åâ€¦â€¦`, 2)\n\n    let bookmarkIds = []\n    let novelIds = getFromCacheObject(`novelIds${novel.seriesId}`)\n    novelIds.forEach(novelId => {\n        let bookmarkId = getNovelBookmarkId(novelId)\n        if (bookmarkId) bookmarkIds.push(getNovelBookmarkId(novelId))\n    })\n    let resp = getPostBody(\n        \"https://www.pixiv.net/ajax/novels/bookmarks/remove\",\n        JSON.stringify({\"bookmarkIds\": bookmarkIds})\n    )\n    if (resp.error === true) {\n        sleepToast(`ğŸ–¤ å–æ¶ˆæ”¶è—ç³»åˆ—\\n\\nâš ï¸ å–æ¶ˆæ”¶è—ã€${novel.seriesTitle}ã€‘çš„ç¯‡ç›®å¤±è´¥`, 2)\n        shareFactory(\"series\")\n    } else {\n        sleepToast(`ğŸ–¤ å–æ¶ˆæ”¶è—ç³»åˆ—\\n\\nâœ… å·²å–æ¶ˆæ”¶è—ã€${novel.seriesTitle}ã€‘çš„å…¨éƒ¨ç¯‡ç›®`)\n        novelIds.forEach(novelId => {cache.delete(`collect${novelId}`)})\n\n        let likeNovels = getFromCacheObject(\"likeNovels\")\n        likeNovels = likeNovels.filter(item => !novelIds.includes(Number(item)))\n        putInCacheObject(\"likeNovels\", likeNovels)\n\n        novelIds.forEach(novelId => {\n            let novelObj = getAjaxJson(urlNovelDetailed(novelId))\n            novelObj.body.isBookmark = false\n            putInCacheObject(urlNovelDetailed(novelId), novelObj, cacheSaveSeconds)\n        })\n    }\n}\n\nfunction novelsBookmarkAdd() {\n    let novel = getNovel()\n    if (!novel.seriesId) {\n        sleepToast(`â¤ï¸ æ”¶è—ç³»åˆ—\\n\\nâš ï¸ ã€${novel.title}ã€‘éç³»åˆ—å°è¯´ï¼Œç°å·²æ”¶è—æœ¬ç¯‡å°è¯´`)\n        return novelBookmarkAdd(0)\n    } else {\n        sleepToast(`â¤ï¸ æ”¶è—ç³»åˆ—\\n\\nğŸ”„ æ­£åœ¨æ”¶è—ç³»åˆ—ã€${novel.seriesTitle}ã€‘ï¼Œè¯·ç¨åâ€¦â€¦`, 2)\n    }\n\n    let novelIds = getFromCacheObject(`novelIds${novel.seriesId}`)\n    let likeNovels = getFromCacheObject(\"likeNovels\")\n    if (likeNovels === null) likeNovels = []\n    novelIds.forEach(novelId => {\n        if (likeNovels && !likeNovels.includes(Number(novelId))) {\n            sleep(0.5 * 1000 * Math.random())\n            let resp = getPostBody(\n                \"https://www.pixiv.net/ajax/novels/bookmarks/add\",\n                JSON.stringify({\"novel_id\": novelId, \"restrict\": 0, \"comment\": \"\", \"tags\": []})\n            )\n\n            if (resp.error === true) {\n                sleepToast(`â¤ï¸ æ”¶è—ç³»åˆ—\\n\\nâš ï¸ æ”¶è—ã€${novelId}ã€‘å¤±è´¥`)\n                shareFactory(\"series\")\n            } else if (resp.body === null) {\n                // sleepToast(`â¤ï¸ æ”¶è—å°è¯´\\n\\nâœ… å·²ç»æ”¶è—ã€${novel.title}ã€‘äº†`)\n            } else {\n                putInCacheObject(`collect${novelId}`, resp.body)\n                likeNovels.push(Number(novelId))\n\n                let novelObj = getAjaxJson(urlNovelDetailed(novelId))\n                novelObj.body.isBookmark = true\n                putInCacheObject(urlNovelDetailed(novelId), novelObj, cacheSaveSeconds)\n            }\n        }\n    })\n    putInCacheObject(\"likeNovels\", likeNovels)\n    sleepToast(`â¤ï¸ æ”¶è—ç³»åˆ—\\n\\nâœ… å·²ç»æ”¶è—ã€${novel.seriesTitle}ã€‘å…¨éƒ¨ç« èŠ‚`)\n}\n\nfunction novelMarker(page) {\n    if (page === undefined) page = 1\n    let novel = getNovel()\n    let lastMarker = getFromCacheObject(`marker${novel.id}`)\n    if (lastMarker === true) page = 0\n\n    let resp = getPostBody(\n        \"https://www.pixiv.net/novel/rpc_marker.php\",\n        `mode=save&i_id=${novel.id}&u_id=${getFromCacheObject(\"pixiv:uid\")}&page=${page}`\n    )\n    java.log(`mode=save&i_id=${novel.id}&u_id=${getFromCacheObject(\"pixiv:uid\")}&page=${page}`)\n    if (resp.error === true) {\n        sleepToast(\"ğŸ·ï¸ æ·»åŠ ä¹¦ç­¾\\n\\nâš ï¸ æ“ä½œå¤±è´¥\", 1)\n        shareFactory(\"novel\")\n    } else if (lastMarker === true) {\n        putInCache(`marker${novel.id}`, false)\n        sleepToast(`ğŸ·ï¸ æ·»åŠ ä¹¦ç­¾\\n\\nâœ… å·²åˆ é™¤ä¹¦ç­¾`)\n    } else {\n        putInCache(`marker${novel.id}`, true)\n        sleepToast(`ğŸ·ï¸ æ·»åŠ ä¹¦ç­¾\\n\\nâœ… å·²åŠ å…¥ä¹¦ç­¾`)\n    }\n}\n\nfunction seriesWatch() {\n    let novel = getNovel()\n    let resp = getPostBody(\n        `https://www.pixiv.net/ajax/novel/series/${novel.seriesId}/watch`,\n        \"{}\"\n    )\n    if (resp.error === true) {\n        sleepToast(`ğŸ“ƒ è¿½æ›´ç³»åˆ—\\n\\nâš ï¸ è¿½æ›´ã€${novel.seriesTitle}ã€‘å¤±è´¥`, 1)\n        shareFactory(\"series\")\n    } else {\n        putInCache(`watch${novel.seriesId}`, true)\n        sleepToast(`ğŸ“ƒ è¿½æ›´ç³»åˆ—\\n\\nâœ… å·²è¿½æ›´ã€${novel.seriesTitle}ã€‘`)\n\n        let watchedSeries = getFromCacheObject(\"watchedSeries\")\n        watchedSeries.push(Number(novel.seriesId))\n        putInCacheObject(\"watchedSeries\", watchedSeries)\n\n        let novelObj = getAjaxJson(urlSeriesDetailed(novel.seriesId))\n        novelObj.body.isWatched = true\n        putInCacheObject(urlSeriesDetailed(novel.seriesId), novelObj, cacheSaveSeconds)\n    }\n}\n\nfunction seriesUnWatch() {\n    let novel = getNovel()\n    let resp = getPostBody(\n        `https://www.pixiv.net/ajax/novel/series/${novel.seriesId}/unwatch`,\n        \"{}\"\n    )\n    if (resp.error === true) {\n        sleepToast(`ğŸ“ƒ è¿½æ›´ç³»åˆ—\\n\\nâš ï¸ å–æ¶ˆè¿½æ›´ã€${novel.seriesTitle}ã€‘å¤±è´¥`, 1)\n        shareFactory(\"series\")\n    } else {\n        cache.delete(`watch${novel.seriesId}`)\n        sleepToast(`ğŸ“ƒ è¿½æ›´ç³»åˆ—\\n\\nâœ… å·²å–æ¶ˆè¿½æ›´ã€${novel.seriesTitle}ã€‘`)\n\n        let watchedSeries = getFromCacheObject(\"watchedSeries\")\n        watchedSeries = watchedSeries.filter(item => item !== Number(novel.seriesId))\n        putInCacheObject(\"watchedSeries\", watchedSeries)\n\n        let novelObj = getAjaxJson(urlSeriesDetailed(novel.seriesId))\n        novelObj.body.isWatched = false\n        putInCacheObject(urlSeriesDetailed(novel.seriesId), novelObj, cacheSaveSeconds)\n    }\n}\n\nfunction seriesWatchFactory(code) {\n    if (code === undefined) code = 1\n    let novel = getNovel()\n    if (!novel.seriesId) {\n        return sleepToast(`ğŸ“ƒ è¿½æ›´ç³»åˆ—\\n\\nâš ï¸ ã€${novel.title}ã€‘éç³»åˆ—å°è¯´ï¼Œæ— æ³•åŠ å…¥è¿½æ›´åˆ—è¡¨`)\n    }\n\n    let lastStatus = getFromCacheObject(`watch${novel.seriesId}`)\n    if (lastStatus === true) code = 0\n    if (code === 0) seriesUnWatch()\n    else if (code === 1) seriesWatch()\n}\n\nfunction userFollow(restrict) {\n    if (restrict === undefined) restrict = 0\n    let novel = getNovel()\n    let resp = getPostBody(\n        \"https://www.pixiv.net/bookmark_add.php\",\n        `mode=add&type=user&user_id=${novel.userId}&tag=\"\"&restrict=${restrict}&format=json`\n    )\n    if (resp.error === true) {\n        sleepToast(`â­ï¸ å…³æ³¨ä½œè€…\\n\\nâš ï¸ å…³æ³¨ã€${novel.userName}ã€‘å¤±è´¥`, 1)\n\n        java.startBrowserAwait(`${urlUserUrl(novel.userId)},\n    {\"headers\": {\"User-Agent\": \"Mozilla/5.0 (Linux; Android 10; K) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/119.0.0.0 Mobile Safari/537.36\" }}`, `å…³æ³¨${novel.userName}`, false)\n        let lastStatus = getAjaxJson(urlUserDetailed(novel.userId), true).body.isFollowed\n        if (lastStatus) sleepToast(`â­ï¸ å…³æ³¨ä½œè€…\\n\\nâœ… å·²å…³æ³¨ã€${novel.userName}ã€‘`)\n\n    } else {\n        sleepToast(`â­ï¸ å…³æ³¨ä½œè€…\\n\\nâœ… å·²å…³æ³¨ã€${novel.userName}ã€‘`)\n    }\n}\n\nfunction userUnFollow() {\n    let novel = getNovel()\n    let resp = getPostBody(\n        \"https://www.pixiv.net/rpc_group_setting.php\",\n        `mode=del&type=bookuser&id=${novel.userId}`\n    )\n    if (resp.error === true) {\n        sleepToast(`â­ï¸ å…³æ³¨ä½œè€…\\n\\nâš ï¸ å–æ¶ˆå…³æ³¨ã€${novel.userName}ã€‘å¤±è´¥`, 1)\n        shareFactory(\"author\")\n    } else {\n        sleepToast(`â­ï¸ å…³æ³¨ä½œè€…\\n\\nâœ… å·²å–æ¶ˆå…³æ³¨ã€${novel.userName}ã€‘`)\n    }\n}\n\nfunction userFollowFactory(code) {\n    if (code === undefined) code = 1\n    let novel = getNovel()\n\n    let lastStatus = getAjaxJson(urlUserDetailed(novel.userId), true).body.isFollowed\n    if (lastStatus) userUnFollow()\n    else userFollow()\n}\n\nfunction userBlock() {\n    let authors = getFromCacheObject(\"blockAuthorList\")\n    if (!authors) authors = []\n    let authorsMap = getFromCacheMap(\"blockAuthorMap\")\n    if (!authorsMap || authorsMap.size === 0) {\n        authorsMap = new Map()\n        authors.forEach(author => {\n            authorsMap.set(author, getAjaxJson(urlUserDetailed(author)).body.name)\n        })\n    }\n\n    let novel = getNovel()\n    if (authorsMap.has(String(novel.userId))) {\n        authorsMap.delete(String(novel.userId))\n        sleepToast(`ğŸš« å±è”½ä½œè€…\\n\\nâœ… å·²å–æ¶ˆå±è”½ã€${novel.userName}ã€‘\\nç°å·²æ¢å¤æ˜¾ç¤ºå…¶å°è¯´`)\n    } else if (!!novel.userId) {\n        authorsMap.set(String(novel.userId), novel.userName)\n        sleepToast(`ğŸš« å±è”½ä½œè€…\\n\\nâœ… æœ¬åœ°å·²å±è”½ã€${novel.userName}ã€‘\\nä»Šåä¸å†æ˜¾ç¤ºå…¶å°è¯´`)\n    }\n\n    authors = Array.from(authorsMap.keys())\n    putInCacheObject(\"blockAuthorList\", authors)\n    putInCacheMap(\"blockAuthorMap\", authorsMap)\n    // source.setVariable(authors.toString())\n    // sleepToast(JSON.stringify(authors))\n}\n\n// æ‹†åˆ†é•¿è¯„è®º\nfunction splitComments(text) {\n    if (!text) return []\n    let limit = 140\n\n    // 1. é¢„ç•™åºå·ç©ºé—´ï¼ˆä¾‹å¦‚ \" (10/10)\" å  8 ä¸ªå­—ç¬¦ï¼Œé¢„ç•™ 10 ä¸ªä»¥é˜²ä¸‡ä¸€ï¼‰\n    const reservedSpace = 10\n    const safeLimit = limit - reservedSpace\n\n    // 2. æ ¸å¿ƒæ‹†åˆ†é€»è¾‘\n    let chars = Array.from(text.trim())\n    let tempSegments = []\n\n    const strongPunc = /[ã€‚ï¼ï¼Ÿâ€¦\\uff0e\\uff01\\uff1f!?.â€¦]/ // å¼ºæ–­å¥æ ‡ç‚¹\n    const weakPunc = /[\\uff0c\\uff1b,;]/                // å¼±æ–­å¥æ ‡ç‚¹\n\n    while (chars.length > 0) {\n        if (chars.length <= safeLimit) {\n            tempSegments.push(chars.join('').trim())\n            break\n        }\n\n        let chunk = chars.slice(0, safeLimit)\n        let splitIndex = -1\n\n        // ä¼˜å…ˆçº§ 1: æ¢è¡Œç¬¦\n        for (let i = chunk.length - 1; i >= 0; i--) {\n            if (chunk[i] === '\\n') {\n                splitIndex = i\n                break\n            }\n        }\n\n        // ä¼˜å…ˆçº§ 2: å¼ºæ ‡ç‚¹ï¼ˆã€‚ï¼ï¼Ÿç­‰ï¼‰\n        if (splitIndex === -1) {\n            for (let i = chunk.length - 1; i >= 0; i--) {\n                if (strongPunc.test(chunk[i])) {\n                    splitIndex = i\n                    break\n                }\n            }\n        }\n\n        // ä¼˜å…ˆçº§ 3: å¼±æ ‡ç‚¹ï¼ˆä»…åœ¨æ²¡æ‰¾åˆ°å¼ºæ ‡ç‚¹æ—¶ä½¿ç”¨é€—å·ï¼‰\n        if (splitIndex === -1) {\n            for (let i = chunk.length - 1; i >= 0; i--) {\n                if (weakPunc.test(chunk[i])) {\n                    splitIndex = i\n                    break\n                }\n            }\n        }\n\n        // å…œåº•: ç¡¬æˆªæ–­\n        if (splitIndex === -1) {\n            splitIndex = safeLimit - 1\n        }\n\n        // æˆªå–å¹¶æ¸…ç†\n        let segment = chars.slice(0, splitIndex + 1).join('').trim();\n        if (segment) tempSegments.push(segment)\n\n        // ç§»é™¤å·²å¤„ç†å­—ç¬¦å¹¶è·³è¿‡å¼€å¤´çš„ç©ºç™½\n        chars = chars.slice(splitIndex + 1);\n        while (chars.length > 0 && (chars[0] === '\\n' || chars[0] === ' ')) {\n            chars.shift()\n        }\n    }\n\n    // 3. æ³¨å…¥åºå·\n    const total = tempSegments.length;\n    if (total <= 1) return tempSegments;\n    return tempSegments.map((content, i) => `${content} (${i + 1}/${total})`).reverse();\n}\n\nfunction novelCommentAdd() {\n    let resp, novel = getNovel()\n    let userId = getFromCacheObject(\"pixiv:uid\")\n    let comment = String(result.get(\"æ–‡æœ¬æ¡†\")).trim()\n    if (comment === \"\") {\n        return sleepToast(`âœ… å‘é€è¯„è®º\\nâš ï¸ è¯·åœ¨ã€æ–‡æœ¬æ¡†ã€‘å†…è¾“å…¥è¯„è®º\\n\\nè¾“å…¥ã€è¯„è®ºå†…å®¹ï¼›è¯„è®ºIDã€‘å¯å›å¤è¯¥æ¡è¯„è®ºï¼Œå¦‚ã€éå¸¸å–œæ¬¢ï¼›123456ã€‘`)\n    }\n\n    let comments = splitComments(comment)\n    if (comments.length >= 2) sleepToast(\"âœ… å‘é€è¯„è®º\\n\\næ­£åœ¨æ‹†åˆ†é•¿è¯„è®ºï¼Œå³å°†é€æ¡å‘é€\")\n    comments.forEach(comment => {\n        sleep(0.5 * 1000 * Math.random())\n        let matched = comment.match(RegExp(/(ï¼›|;\\s*)\\d{8,}/))\n        if (matched) {\n            let commentId = comment.match(new RegExp(/ï¼›(\\d{8,})/))[1]\n            comment = comment.replace(new RegExp(`(ï¼›|;\\s*)${commentId}`), \"\")\n            resp = getPostBody(\n                \"https://www.pixiv.net/novel/rpc/post_comment.php\",\n                `type=comment&novel_id=${novel.id}&author_user_id=${userId}&comment=${encodeURI(comment)}&parent_id=${commentId}`)\n        } else {\n            resp = getPostBody(\n                \"https://www.pixiv.net/novel/rpc/post_comment.php\",\n                `type=comment&novel_id=${novel.id}&author_user_id=${userId}&comment=${encodeURI(comment)}`\n            )\n        }\n\n        if (resp.error === true) {\n            sleepToast(\"âœ… å‘é€è¯„è®º\\n\\nâš ï¸ è¯„è®ºå¤±è´¥\", 1)\n            shareFactory(\"novel\")\n        } else {\n            sleepToast(`âœ… å‘é€è¯„è®º\\n\\nâœ… å·²åœ¨ã€${novel.title}ã€‘å‘å¸ƒè¯„è®ºï¼š\\n${comment}`, 1)\n        }\n    })\n    try {java.refreshContent()} catch(err) {}\n    if (comments.length >= 2) sleepToast(\"âœ… å‘é€è¯„è®º\\n\\nâœ… é•¿è¯„è®ºå·²å‘é€å®Œæ¯•\", 1)\n}\n\nfunction getNovelCommentID(novelId, commentText) {\n    let list = [], uid = String(getFromCacheObject(\"pixiv:uid\"))\n    let resp = getAjaxJson(urlNovelComments(novelId, 0, 50), true)\n    resp.body.comments.forEach(comment => {\n        if (comment.userId === uid && comment.comment === commentText) list.push(comment.id)\n\n        if (comment.hasReplies === true) {\n            let resp = getAjaxJson(urlNovelCommentsReply(comment.id, 1), true)\n            resp.body.comments.forEach(comment => {\n                if (comment.userId === uid && comment.comment === commentText) list.push(comment.id)\n            })\n        }\n    })\n    // java.log(JSON.stringify(list))\n    return list\n}\n\nfunction novelCommentDelete() {\n    let commentIDs, novel = getNovel()\n    let comment = String(result.get(\"æ–‡æœ¬æ¡†\")).trim()\n    if (comment === \"\") {\n        return sleepToast(`ğŸ—‘ åˆ é™¤è¯„è®º\\nâš ï¸ è¯·åœ¨ã€æ–‡æœ¬æ¡†ã€‘å†…è¾“å…¥éœ€è¦åˆ é™¤çš„ã€è¯„è®ºIDã€‘ï¼Œä»¥åˆ†å·é—´éš”\\næˆ–è¾“å…¥éœ€è¦åˆ é™¤çš„ã€è¯„è®ºå†…å®¹ã€‘\\n\\nå¦‚ï¼šã€123ï¼›456ï¼›789ã€‘\\næˆ–ã€æ¨¡æ‹Ÿè¯„è®ºå†…å®¹ã€‘`)\n    }\n\n    if (RegExp(/[ï¼›;]/).test(comment)) {\n        commentIDs = comment.split(/[ï¼›;]/)\n            .map(item => item.trim())         // å»é™¤æ¯ä¸ªå…ƒç´ å‰åçš„ç©ºæ ¼\n            .filter(item => item !== \"\")     // è¿‡æ»¤æ‰å› ä¸ºæœ«å°¾åˆ†å·äº§ç”Ÿçš„ç©ºé¡¹\n    } else if (RegExp(/\\d{8,}/).test(comment)) {\n        let matched = comment.match(/\\d{8,}/g)\n        commentIDs = Array.from(matched || [])\n    } else {\n        commentIDs = getNovelCommentID(novel.id, comment)\n        // java.log(JSON.stringify(commentIDs))\n        if (commentIDs.length === 0) {\n            return sleepToast(`ğŸ—‘ åˆ é™¤è¯„è®º\\n\\nâš ï¸ æœªèƒ½æ‰¾åˆ°è¿™æ¡è¯„è®º\\nè¯·æ£€æŸ¥æ˜¯å¦æœ‰é”™åˆ«å­—æˆ–æ ‡ç‚¹ç¬¦å·æ˜¯å¦ä¸€è‡´`)\n        }\n    }\n\n    commentIDs.forEach(commentID =>{\n        sleep(0.5 * 1000 * Math.random())\n        let resp = getPostBody(\n            \"https://www.pixiv.net/novel/rpc_delete_comment.php\",\n            `i_id=${novel.id}&del_id=${commentID}`\n        )\n        // java.log(JSON.stringify(resp))\n        if (resp.error === true) {\n            sleepToast(\"ğŸ—‘ åˆ é™¤è¯„è®º\\n\\nâš ï¸ è¯„è®ºåˆ é™¤å¤±è´¥\", 1)\n            shareFactory(\"novel\")\n        } else {\n            let isCommentText = !RegExp(/[ï¼›;]/).test(comment) && !RegExp(/\\d{8,}/).test(comment)\n            let toastComment = isCommentText ? comment : commentID\n            sleepToast(`ğŸ—‘ åˆ é™¤è¯„è®º\\n\\nâœ… å·²åœ¨ã€${novel.title}ã€‘åˆ é™¤è¯„è®ºï¼š\\n${toastComment}`, 1)\n        }\n    })\n    try {java.refreshContent()} catch(err) {}\n    if (comments.length >= 2) sleepToast(\"ğŸ—‘ åˆ é™¤è¯„è®º\\n\\nâœ… è¯„è®ºå·²åˆ é™¤å®Œæ¯•\", 1)\n}\n\nfunction novelPollAnswer() {\n    let novel = getNovel()\n    // novel.pollChoicesCount = getAjaxJson(urlNovelDetailed(novel.id)).body.pollData.selectedValue\n    if (!novel.pollChoicesCount) {\n        return sleepToast(`ğŸ“ƒ å°è¯´æŠ•ç¥¨\\n\\nâš ï¸ è¯¥å°è¯´ã€${novel.title}ã€‘æ— æŠ•ç¥¨ä¿¡æ¯ï¼Œå»ºè®®ã€æ¸…é™¤ç¼“å­˜ã€‘ã€åˆ·æ–°ã€‘åé‡è¯•`)\n    }\n\n    let choiceId = String(result.get(\"æ–‡æœ¬æ¡†\")).trim()\n    if (!choiceId) {\n        return sleepToast(`ğŸ“ƒ å°è¯´æŠ•ç¥¨\\n\\nâš ï¸ æŠ•ç¥¨å¤±è´¥ï¼šè¯·åœ¨ã€æ–‡æœ¬æ¡†ã€‘å†…è¾“å…¥æŠ•ç¥¨é€‰é¡¹(æ•°å­—)`)\n    } else if (Number(choiceId) > novel.pollData.selectedValue) {\n        return sleepToast(`ğŸ“ƒ å°è¯´æŠ•ç¥¨\\n\\nâš ï¸ æŠ•ç¥¨å¤±è´¥ï¼šé€‰é¡¹${choiceId}è¶…å‡ºèŒƒå›´`)\n    } else if (Number(choiceId) <= 0 || Number(choiceId) > novel.pollChoicesCount) {\n        return sleepToast(`ğŸ“ƒ å°è¯´æŠ•ç¥¨\\n\\nâš ï¸ æŠ•ç¥¨å¤±è´¥ï¼šé€‰é¡¹${choiceId}è¶…å‡ºèŒƒå›´`)\n    }\n\n    let resp = getPostBody(\n        `https://www.pixiv.net/ajax/novel/${novel.id}/poll/answer`,\n        JSON.stringify({\"choice_id\": choiceId})\n    )\n    // 200 æˆåŠŸï¼Œ403 é‡å¤æŠ•ç¥¨ï¼Œ400 é€‰é¡¹è¶…è¿‡èŒƒå›´\n    if (resp.error === true) {\n        if (resp.errMsg.includes(\"403\")) {\n            sleepToast(`ğŸ“ƒ å°è¯´æŠ•ç¥¨\\n\\nâœ… å·²ç»æŠ•è¿‡ç¥¨äº†`)\n        } else {\n            sleepToast(`ğŸ“ƒ å°è¯´æŠ•ç¥¨\\n\\nâš ï¸ æŠ•ç¥¨å¤±è´¥`)\n            shareFactory(\"novel\")\n        }\n    } else {\n        sleepToast(`ğŸ“ƒ å°è¯´æŠ•ç¥¨\\n\\nâœ… æŠ•ç¥¨æˆåŠŸ`)\n    }\n}\n\nlet wordsType = {\n    \"caption\": \"ğŸ“ƒ ç®€ä»‹å±è”½åˆ—è¡¨\",\n    \"tags\": \"#ï¸ æ ‡ç­¾å±è”½åˆ—è¡¨\",\n    \"authors\": \"ğŸ‘¤ ä½œè€…å±è”½åˆ—è¡¨\"\n}\n\nfunction printAuthorMap(map) {\n    let text = \"\"\n    map.forEach((value, key) => {\n        text += `@${value} ${key}\\n`\n    })\n    return text.trim()\n}\n\nfunction blockShowFactory() {\n    let keys = Object.keys(wordsType)\n    let key = getFromCacheObject(\"wordsType\")\n\n    // åˆ‡æ¢å±è”½åˆ—è¡¨\n    let index = keys.indexOf(key) + 1\n    if (index === keys.length) index = 0\n    key = keys[index]\n    putInCacheObject(\"wordsType\", key)\n\n    if (key === \"authors\") {\n        let words = printAuthorMap(getFromCacheMap(\"blockAuthorMap\"))\n        if (!words) words = \"\"\n        sleepToast(`ğŸ‘€ æŸ¥çœ‹å±è”½\\n${wordsType[key]}\\n\\n${words}`, 2)\n    } else {\n        let words = getFromCacheObject(`${key}BlockWords`)\n        if (!words) words = []\n        sleepToast(`ğŸ‘€ æŸ¥çœ‹å±è”½\\n${wordsType[key]}\\n\\n${words.join(\"\\n\")}`, 2)\n    }\n}\n\nfunction blockWordAdd() {\n    let method = getFromCacheObject(\"wordsType\")\n    let blockWords = getFromCacheObject(`${method}BlockWords`)\n    if (blockWords === null) blockWords = []\n\n    let word = String(result.get(\"æ–‡æœ¬æ¡†\")).trim()\n    if (word === \"\") {\n        sleepToast(`ğŸš« æ·»åŠ å±è”½\\n${wordsType[method]}\\n\\nâš ï¸ è¯·åœ¨ã€æ–‡æœ¬æ¡†ã€‘å†…è¾“å…¥å±è”½è¯`)\n    } else if (blockWords.includes(word)) {\n        sleepToast(`ğŸš« æ·»åŠ å±è”½\\n${wordsType[method]}\\n\\nâœ… ã€${word}ã€‘å·²ç»åŠ å…¥å±è”½åˆ—è¡¨äº†`)\n    } else {\n        blockWords.push(word)\n        putInCacheObject(`${method}BlockWords`, blockWords)\n        sleepToast(`ğŸš« æ·»åŠ å±è”½\\n${wordsType[method]}\\n\\nâœ… å·²å°†ã€${word}ã€‘åŠ å…¥å±è”½åˆ—è¡¨ä¸­`)\n    }\n}\n\nfunction blockWordDelete() {\n    let method = getFromCacheObject(\"wordsType\")\n    let blockWords = getFromCacheObject(`${method}BlockWords`)\n    if (blockWords === null) blockWords = []\n\n    let word = String(result.get(\"æ–‡æœ¬æ¡†\")).trim()\n    if (word === \"\") {\n        sleepToast(`â­•ï¸ åˆ é™¤å±è”½\\n${wordsType[method]}\\n\\nâš ï¸ è¯·åœ¨ã€æ–‡æœ¬æ¡†ã€‘å†…è¾“å…¥å±è”½è¯`)\n    } else if (!blockWords.includes(word)) {\n        sleepToast(`â­•ï¸ åˆ é™¤å±è”½\\n${wordsType[method]}\\n\\nâš ï¸ ã€${word}ã€‘ä¸åœ¨å±è”½åˆ—è¡¨\\nè¯·æ£€æŸ¥æ˜¯å¦æœ‰é”™åˆ«å­—æˆ–æ ‡ç‚¹ç¬¦å·æ˜¯å¦ä¸€è‡´`)\n    } else {\n        blockWords = blockWords.filter(item => item !== word)\n        putInCacheObject(`${method}BlockWords`, blockWords)\n        sleepToast(`â­•ï¸ åˆ é™¤å±è”½\\n${wordsType[method]}\\n\\nâœ… å·²åˆ é™¤å±è”½è¯ã€${word}ã€‘`)\n    }\n}\n\nfunction blockAuthorAdd() {\n    let method = getFromCacheObject(\"wordsType\")\n    let blockAuthors = getFromCacheMap(`blockAuthorMap`)\n\n    let word = String(result.get(\"æ–‡æœ¬æ¡†\")).trim()\n    if (word === \"\") {\n        sleepToast(`ğŸš« æ·»åŠ å±è”½\\n${wordsType[method]}\\n\\nâš ï¸ è¯·åœ¨ã€æ–‡æœ¬æ¡†ã€‘å†…è¾“å…¥ã€ä½œè€…IDã€‘\\næˆ–ä½¿ç”¨ä¸Šæ–¹ ğŸš« å±è”½ä½œè€…`)\n    } else if (blockAuthors.has(word)) {\n        let text = `${blockAuthors.get(word)} ${word}`\n        sleepToast(`ğŸš« æ·»åŠ å±è”½\\n${wordsType[method]}\\n\\nâœ… ã€${text}ã€‘å·²ç»åŠ å…¥å±è”½åˆ—è¡¨äº†`)\n    }\n    // è¾“å…¥çº¯æ•°å­—ï¼Œæ·»åŠ å¯¹åº”IDçš„ä½œè€…\n    else if (!isNaN(word)) {\n        let user = getAjaxJson(urlUserDetailed(word)).body\n        blockAuthors.set(user.userId, user.name)\n        let text = `@${user.name} ${user.userId}`\n        sleepToast(`ğŸš« æ·»åŠ å±è”½\\n${wordsType[method]}\\n\\nâœ… å·²å°†ã€${text}ã€‘åŠ å…¥å±è”½åˆ—è¡¨ä¸­`)\n    }\n    else if (word) {\n        sleepToast(`ğŸš« æ·»åŠ å±è”½\\n${wordsType[method]}\\n\\nâš ï¸ è¾“å…¥ã€ç”¨æˆ·IDã€‘å¯å±è”½è¯¥ä½œè€…`)\n    }\n    putInCacheMap(`blockAuthorMap`, blockAuthors)\n}\n\nfunction blockAuthorDelete() {\n    let method = getFromCacheObject(\"wordsType\")\n    let blockAuthors = getFromCacheMap(`blockAuthorMap`)\n\n    let word = String(result.get(\"æ–‡æœ¬æ¡†\")).trim()\n    if (word === \"\") {\n        sleepToast(`â­•ï¸ åˆ é™¤å±è”½\\n${wordsType[method]}\\n\\nâš ï¸ è¯·åœ¨ã€æ–‡æœ¬æ¡†ã€‘å†…è¾“å…¥ã€ä½œè€…IDã€‘\\næˆ–ä½¿ç”¨ä¸Šæ–¹ ğŸš« å±è”½ä½œè€…`)\n    }\n    // è¾“å…¥çº¯æ•°å­—ï¼Œåˆ é™¤å¯¹åº”IDçš„ä½œè€…\n    else if (!isNaN(word) && blockAuthors.has(word)) {\n        let text = `@${blockAuthors.get(word)} ${word}`\n        blockAuthors.delete(word)\n        sleepToast(`â­•ï¸ åˆ é™¤å±è”½\\n${wordsType[method]}\\n\\nâœ… å·²åˆ é™¤ã€${text}ã€‘`)\n    }\n    //ä½œè€…åç§°\n    else if (Array.from(blockAuthors.values()).includes(word)) {\n        let index = Array.from(blockAuthors.values()).indexOf(word)\n        let key = Array.from(blockAuthors.keys())[index]\n        let text = `@${blockAuthors.get(key)} ${key}`\n        blockAuthors.delete(key)\n        sleepToast(`â­•ï¸ åˆ é™¤å±è”½\\n${wordsType[method]}\\n\\nâœ… å·²åˆ é™¤ã€${text}ã€‘`)\n    }\n    else if (word) {\n        sleepToast(`â­•ï¸ åˆ é™¤å±è”½\\n${wordsType[method]}\\n\\nâš ï¸ è¾“å…¥ã€ç”¨æˆ·IDã€‘å¯å±è”½è¯¥ä½œè€…`)\n    }\n    putInCacheMap(`blockAuthorMap`, blockAuthors)\n}\n\nfunction blockAddFactory() {\n    if (getFromCacheObject(\"wordsType\") === \"authors\") return blockAuthorAdd()\n    else return blockWordAdd()\n}\n\nfunction blockDeleteFactory() {\n    if (getFromCacheObject(\"wordsType\") === \"authors\") return blockAuthorDelete()\n    else return blockWordDelete()\n}\n\n\nfunction likeTagsShow() {\n    let likeTags = getFromCacheObject(`likeTags`)\n    if (likeTags === null) likeTags = []\n    sleepToast(`ğŸ‘€ æŸ¥çœ‹æ ‡ç­¾\\nğŸ“Œ å–œæ¬¢æ ‡ç­¾\\n\\n${likeTags.join(\"ã€\")}`, 5)\n}\n\nfunction likeTagsAdd() {\n    let likeTags = getFromCacheObject(`likeTags`)\n    if (likeTags === null) likeTags = []\n\n    let word = String(result.get(\"æ–‡æœ¬æ¡†\")).trim()\n    if (word === \"\") {\n        sleepToast(`ğŸ“Œ å–œæ¬¢æ ‡ç­¾\\nğŸ“Œ æ·»åŠ æ ‡ç­¾\\n\\nâš ï¸ è¯·åœ¨ã€æ–‡æœ¬æ¡†ã€‘å†…ç›´æ¥è¾“å…¥æ ‡ç­¾å†…å®¹`)\n    } else if (word.startsWith(\"@\") || word.startsWith(\"ï¼ \")) {\n        sleepToast(`ğŸ“Œ å–œæ¬¢æ ‡ç­¾\\nğŸ“Œ æ·»åŠ æ ‡ç­¾\\n\\nâš ï¸ ä»…æ”¯æŒæ·»åŠ ã€æ ‡ç­¾ã€‘\\nä¸æ”¯æŒæ·»åŠ  @ä½œè€…åç§°`)\n    } else if (word.startsWith(\"#\") || word.startsWith(\"ï¼ƒ\")) {\n        sleepToast(`ğŸ“Œ å–œæ¬¢æ ‡ç­¾\\nğŸ“Œ æ·»åŠ æ ‡ç­¾\\n\\nâš ï¸ ä»…æ”¯æŒæ·»åŠ ã€æ ‡ç­¾ã€‘\\nä¸æ”¯æŒæ·»åŠ  #æ ‡ç­¾åç§°`)\n    } else if (likeTags.includes(word)) {\n        sleepToast(`ğŸ“Œ å–œæ¬¢æ ‡ç­¾\\nğŸ“Œ æ·»åŠ æ ‡ç­¾\\n\\nâœ… ã€${word}ã€‘å·²ç»åŠ å…¥å–œæ¬¢æ ‡ç­¾äº†\\nè¯·äºå‘ç°é¡µåˆ·æ–°åæŸ¥çœ‹`)\n    } else {\n        likeTags.push(word)\n        putInCacheObject(`likeTags`, likeTags)\n        sleepToast(`ğŸ“Œ å–œæ¬¢æ ‡ç­¾\\nğŸ“Œ æ·»åŠ æ ‡ç­¾\\n\\nâœ… å·²å°†ã€${word}ã€‘åŠ å…¥å–œæ¬¢æ ‡ç­¾äº†`)\n        try {source.refreshExplore()} catch (e) {}\n    }\n}\n\nfunction likeTagsDelete() {\n    let likeTags = getFromCacheObject(`likeTags`)\n    if (likeTags === null) likeTags = []\n\n    let word = String(result.get(\"æ–‡æœ¬æ¡†\")).trim()\n    if (word === \"\") {\n        sleepToast(`ğŸ“Œ å–œæ¬¢æ ‡ç­¾\\nğŸ—‘ åˆ é™¤æ ‡ç­¾\\n\\nâš ï¸ è¯·åœ¨ã€æ–‡æœ¬æ¡†ã€‘å†…ç›´æ¥è¾“å…¥æ ‡ç­¾å†…å®¹`)\n    } else if (!likeTags.includes(word)) {\n        sleepToast(`ğŸ“Œ å–œæ¬¢æ ‡ç­¾\\nğŸ—‘ åˆ é™¤æ ‡ç­¾\\n\\nâš ï¸ ã€${word}ã€‘ä¸åœ¨å–œæ¬¢æ ‡ç­¾\\nè¯·æ£€æŸ¥æ˜¯å¦æœ‰é”™åˆ«å­—`)\n    } else {\n        likeTags = likeTags.filter(item => item !== word)\n        putInCacheObject(`likeTags`, likeTags)\n        sleepToast(`ğŸ“Œ å–œæ¬¢æ ‡ç­¾\\nğŸ—‘ åˆ é™¤æ ‡ç­¾\\n\\nâœ… å·²åˆ é™¤è¯¥æ ‡ç­¾ã€${word}ã€‘`)\n        try {source.refreshExplore()} catch (e) {}\n    }\n}\n\n\nfunction likeAuthorsShow() {\n    let text = printAuthorMap(getFromCacheMap(`likeAuthors`))\n    sleepToast(`ğŸ‘€ æŸ¥çœ‹æ”¶è—\\nâ¤ï¸ ä»–äººæ”¶è—\\n\\n${text.trim()}`, 2)\n}\n\nfunction likeAuthorsAdd() {\n    let likeAuthors = getFromCacheMap(`likeAuthors`)\n    let word = String(result.get(\"æ–‡æœ¬æ¡†\")).trim()\n    if (word.startsWith(\"@\") || word.startsWith(\"ï¼ \")) {\n        return sleepToast(`â¤ï¸ ä»–äººæ”¶è—\\nâ¤ï¸ æ·»åŠ æ”¶è—\\n\\nâš ï¸ ä»…æ”¯æŒé€šè¿‡ã€ä½œè€…IDã€‘å…³æ³¨\\nä¸æ”¯æŒæ·»åŠ  @ä½œè€…åç§°`)\n    } else if (word.startsWith(\"#\") || word.startsWith(\"ï¼ƒ\")) {\n        return sleepToast(`â¤ï¸ ä»–äººæ”¶è—\\nâ¤ï¸ æ·»åŠ æ”¶è—\\n\\nâš ï¸ ä»…æ”¯æŒé€šè¿‡ã€ä½œè€…IDã€‘å…³æ³¨\\nä¸æ”¯æŒæ·»åŠ  #æ ‡ç­¾åç§°`)\n    } else if (likeAuthors.has(word)) {\n        let text = `${likeAuthors.get(word)} ${word}`\n        sleepToast(`â¤ï¸ ä»–äººæ”¶è—\\nâ¤ï¸ æ·»åŠ æ”¶è—\\n\\nâœ… ã€${text}ã€‘å·²ç»åŠ å…¥æ”¶è—åˆ—è¡¨äº†ï¼Œè¯·äºå‘ç°é¡µæŸ¥çœ‹`)\n    }\n\n    // æ— è¾“å…¥å†…å®¹ï¼Œæ·»åŠ å½“å‰å°è¯´çš„ä½œè€…\n    if (word === \"\") {\n        let novel = getNovel()\n        likeAuthors.set(String(novel.userId), novel.userName)\n        let text = `@${novel.userName} ${novel.userId}`\n        sleepToast(`â¤ï¸ ä»–äººæ”¶è—\\nâ¤ï¸ æ·»åŠ æ”¶è—\\n\\nâœ… å·²å°†ã€${text}ã€‘åŠ å…¥ä»–äººæ”¶è—åˆ—è¡¨äº†ï¼Œè¯·äºå‘ç°é¡µæŸ¥çœ‹\\n\\nğŸ“Œ ã€æ–‡æœ¬æ¡†ã€‘å†…è¾“å…¥ã€ç”¨æˆ·IDã€‘å¯å…³æ³¨å…¶ä»–ç”¨æˆ·çš„æ”¶è—`)\n    }\n    // è¾“å…¥çº¯æ•°å­—ï¼Œæ·»åŠ å¯¹åº”IDçš„ä½œè€…\n    else if (!isNaN(word)) {\n        let user = getAjaxJson(urlUserDetailed(word)).body\n        likeAuthors.set(user.userId, user.name)\n        let text = `@${user.name} ${user.userId}`\n        sleepToast(`â¤ï¸ ä»–äººæ”¶è—\\nï¸ æ·»åŠ æ”¶è—\\n\\nâœ… å·²å°†ã€${text}ã€‘åŠ å…¥ä»–äººæ”¶è—åˆ—è¡¨äº†ï¼Œè¯·äºå‘ç°é¡µæŸ¥çœ‹`)\n    }\n\n    else if (word) {\n        sleepToast(`â¤ï¸ ä»–äººæ”¶è—\\nâ¤ï¸ æ·»åŠ æ”¶è—\\n\\nğŸ“Œ ã€æ–‡æœ¬æ¡†ã€‘å†…è¾“å…¥ã€ç”¨æˆ·IDã€‘å¯å…³æ³¨å…¶ä»–ç”¨æˆ·çš„æ”¶è—`)\n    }\n    putInCacheMap(`likeAuthors`, likeAuthors)\n    try {source.refreshExplore()} catch (e) {}\n}\n\nfunction likeAuthorsDelete() {\n    let likeAuthors = getFromCacheMap(`likeAuthors`)\n    let word = String(result.get(\"æ–‡æœ¬æ¡†\")).trim()\n    if (word.startsWith(\"@\") || word.startsWith(\"ï¼ \")) {\n        return sleepToast(`â¤ï¸ ä»–äººæ”¶è—\\nğŸ–¤ å–æ¶ˆæ”¶è—\\n\\nâš ï¸ ä»…æ”¯æŒé€šè¿‡ã€ä½œè€…ID/ä½œè€…åç§°ã€‘å–å…³\\nä¸æ”¯æŒè¾“å…¥ @ä½œè€…åç§°`)\n    } else if (word.startsWith(\"#\") || word.startsWith(\"ï¼ƒ\")) {\n        return sleepToast(`â¤ï¸ ä»–äººæ”¶è—\\nğŸ–¤ å–æ¶ˆæ”¶è—\\n\\nâš ï¸ ä»…æ”¯æŒé€šè¿‡ã€ä½œè€…ID/ä½œè€…åç§°ã€‘å–å…³\\nä¸æ”¯æŒè¾“å…¥ #æ ‡ç­¾åç§°`)\n    }\n\n    if (word === \"\") {\n        let novel = getNovel()\n        likeAuthors.delete(novel.userId)\n        let text = `@${novel.userName} ${novel.userId}`\n        sleepToast(`â¤ï¸ ä»–äººæ”¶è—\\nğŸ–¤ å–æ¶ˆæ”¶è—\\n\\nâœ… å·²å°†ã€${text}ã€‘ç§»å‡ºä»–äººæ”¶è—åˆ—è¡¨äº†\\n\\nğŸ“Œ ã€æ–‡æœ¬æ¡†ã€‘å†…è¾“å…¥ã€ç”¨æˆ·IDã€‘å¯å–æ¶ˆå…³æ³¨å…¶ä»–ç”¨æˆ·çš„æ”¶è—`)\n\n    // è¾“å…¥çº¯æ•°å­—ï¼Œåˆ é™¤å¯¹åº”IDçš„ä½œè€…\n    } else if (!isNaN(word) && likeAuthors.has(word)) {\n        let text = `@${likeAuthors.get(word)} ${word}`\n        likeAuthors.delete(word)\n        sleepToast(`â¤ï¸ ä»–äººæ”¶è—\\nğŸ–¤ å–æ¶ˆæ”¶è—\\n\\nâœ… å·²å–å…³ã€${text}ã€‘`)\n\n    //ä½œè€…åç§°\n    } else if (Array.from(likeAuthors.values()).includes(word)) {\n        let index = Array.from(likeAuthors.values()).indexOf(word)\n        let key = Array.from(likeAuthors.keys())[index]\n        let text = `@${likeAuthors.get(key)} ${key}`\n        likeAuthors.delete(key)\n        sleepToast(`â¤ï¸ ä»–äººæ”¶è—\\nğŸ–¤ å–æ¶ˆæ”¶è—\\n\\nâœ… å·²å–å…³ã€${text}ã€‘`)\n    }\n    else if (word) {\n        sleepToast(`â¤ï¸ ä»–äººæ”¶è—\\nğŸ–¤ å–æ¶ˆæ”¶è—\\n\\nğŸ“Œ ã€æ–‡æœ¬æ¡†ã€‘å†…è¾“å…¥ã€ç”¨æˆ·IDã€‘å¯å–å…³å…¶ä»–ç”¨æˆ·çš„æ”¶è—`)\n    }\n    putInCacheMap(`likeAuthors`, likeAuthors)\n    try {source.refreshExplore()} catch (e) {}\n}\n\nfunction shareFactory(type) {\n    let novel = getNovel()\n    if (novel === undefined || novel === null) return sleepToast(\"âš ï¸ è¯·åœ¨å°è¯´é˜…è¯»é¡µé¢ï¼Œä½¿ç”¨æœ¬åŠŸèƒ½\")\n    if (type.includes(\"author\")) {\n        startBrowser(urlUserUrl(novel.userId), novel.userName)\n    }\n    else if (type.includes(\"novel\") || (!novel.seriesId)) {\n        startBrowser(urlNovelUrl(novel.id), novel.title)\n    }\n    else if (type.includes(\"series\") && novel.seriesId) {\n        startBrowser(urlSeriesUrl(novel.seriesId), novel.seriesTitle)\n    }\n}\n\nfunction startPixivSettings() {\n    startBrowser(\"https://www.pixiv.net/settings/viewing\", \"è´¦å·è®¾ç½®\")\n}\nfunction startGithubReadme() {\n    startBrowser(\"https://pixivsource.pages.dev/Pixiv\", \"ä½¿ç”¨æŒ‡å—\")\n}\nfunction startGithubIssue() {\n    startBrowser(\"https://github.com/DowneyRem/PixivSource/issues\", \"åé¦ˆé—®é¢˜\")\n}\n\nfunction checkStatus(status) {\n    if (eval(String(status)) === true) return \"â¤ï¸\"\n    else return \"ğŸ–¤\"\n}\n\nfunction readMeSearch() {\n    return sleepToast(`ğŸ” æœç´¢è¯´æ˜\\n\n    æ ‡ç­¾ä¹‹é—´éœ€è¦ä»¥ã€ç©ºæ ¼ã€‘é—´éš”\n    â– æ’é™¤æ ‡ç­¾ï¼š#æ ‡ç­¾1 -æ ‡ç­¾2\n    ğŸ‘¤ ä½œè€…ä¸“æœï¼š@æœç´¢ä½œè€…åç§°\n    #ï¸ æ ‡ç­¾ä¸“æœï¼š#æ ‡ç­¾1 æ ‡ç­¾2 \n    â¬ å­—æ•°ç­›é€‰1ï¼š#æ ‡ç­¾1 æ ‡ç­¾2 å­—æ•°3k5\n    â¬ å­—æ•°ç­›é€‰2ï¼š@ä½œè€…çš„åç§° å­—æ•°3w5`.replace(\"    \",\"\"), 5)\n}\n\nlet settingsName = {\n    \"SEARCH_AUTHOR\": \"ğŸ” æœç´¢ä½œè€…\",\n    \"SHOW_ORIGINAL_LINK\": \"ğŸ”— åŸå§‹é“¾æ¥\",\n    \"CONVERT_CHINESE\": \"ğŸ€„ï¸ ç¹ç®€é€šæœ\",\n    \"SHOW_UPDATE_TIME\": \"ğŸ“… æ›´æ–°æ—¶é—´\",\n    \"SHOW_COMMENTS\": \"ğŸ’¬ æ˜¾ç¤ºè¯„è®º\",\n    \"MORE_INFORMATION\": \"ğŸ“– æ›´å¤šç®€ä»‹\",\n    \"REPLACE_TITLE_MARKS\": \"ğŸ“š æ¢å¤ã€Šã€‹\",\n    \"SHOW_CAPTIONS\": \"ğŸ–¼ï¸ æ˜¾ç¤ºæè¿°\",\n    \"HIDE_LIKE_NOVELS\": \"â¤ï¸ éšè—æ”¶è—\",\n    \"HIDE_WATCHED_SERIES\": \"ğŸ“ƒ éšè—è¿½æ›´\",\n    \"IPDirect\": \"âœˆï¸ ç›´è¿æ¨¡å¼\",\n    \"FAST\": \"â© å¿«é€Ÿæ¨¡å¼\",\n    \"DEBUG\": \"ğŸ è°ƒè¯•æ¨¡å¼\",\n    \"SHOW_GENERAL\": \"ğŸ†— å¸¸è§„å°è¯´\",\n    \"SHOW_NEW_ADULT\": \"ğŸ” æœ€æ–°ä¼åˆ’\",\n    \"SHOW_NEW_GENERAL\": \"ğŸ†— æœ€æ–°ä¼åˆ’\",\n    \"SHOW_RANK_ADULT\": \"ğŸ” æ’è¡Œæ¦œå•\",\n    \"SHOW_RANK_GENERAL\": \"ğŸ†— æ’è¡Œæ¦œå•\",\n    \"SHOW_GENRE_ADULT\": \"ğŸ” åŸåˆ›çƒ­é—¨\",\n    \"SHOW_GENRE_GENERAL\": \"ğŸ†— åŸåˆ›çƒ­é—¨\",\n    \"SHOW_FURRY\": \"ğŸº å…½äººå°è¯´\",\n    \"SHOW_DISCOVER\": \"âš™ï¸ å‘ç°è®¾ç½®\\nï¼ˆä¹¦æºç¼–è¾‘ç•Œé¢ï¼‰\",\n    \"SHOW_SETTINGS\": \"âš™ï¸ ä¹¦æºè®¾ç½®\\nï¼ˆä¹¦æºç¼–è¾‘ç•Œé¢ï¼‰\",\n    \"SHOW_DISCOVER2\": \"âš™ï¸ å‘ç°è®¾ç½®\\nï¼ˆå°è¯´é˜…è¯»ç•Œé¢ï¼‰\",\n    \"SHOW_SETTINGS2\": \"âš™ï¸ ä¹¦æºè®¾ç½®\\nï¼ˆå°è¯´é˜…è¯»ç•Œé¢ï¼‰\",\n}\n\nfunction statusMsg(status) {\n    if (status === true) return \"âœ… å·²å¼€å¯\"\n    else if (status === false) return \"ğŸš« å·²å…³é—­\"\n    else return \"ğŸˆšï¸ æœªè®¾ç½®\"\n}\n\n// æ£€æµ‹å¿«é€Ÿæ¨¡å¼ä¿®æ”¹çš„4ä¸ªè®¾ç½®\nfunction getSettingStatus(mode) {\n    if (mode === undefined) mode = \"\"\n    let keys = [], msgList = []\n    let settings = getFromCacheObject(\"pixivSettings\")\n    if (mode === \"FAST\") {\n        keys = Object.keys(settingsName).slice(0, 5)\n    } else if (mode === \"IPDirect\") {\n        keys = Object.keys(settingsName).slice(0, 2)\n    } else if (mode.includes(\"DISCOVER\")) {\n        keys = Object.keys(settingsName).slice(13, 21)\n    } else {\n        keys = Object.keys(settingsName).slice(0, 13)\n    }\n    for (let i in keys) {\n        msgList.push(`${statusMsg(settings[keys[i]])}ã€€${settingsName[keys[i]]}`)\n    }\n    return msgList.join(\"\\n\").trim()\n}\n\nfunction showSettings() {\n    sleepToast(`\\nâš™ï¸ å½“å‰è®¾ç½®\\n\\n${getSettingStatus()}`)\n}\nfunction showSettingsDiscover() {\n    sleepToast(`\\nâš™ï¸ å½“å‰å‘ç°è®¾ç½®\\n\\n${getSettingStatus(\"DISCOVER\")}`)\n}\n\nfunction setDefaultSettingsLoginUrl() {\n    setDefaultSettings()\n    sleepToast(`\\nâœ… å·²æ¢å¤ã€€ğŸ”§ é»˜è®¤è®¾ç½®\\n\\n${getSettingStatus()}`)\n}\n\nfunction editSettings(settingName) {\n    let msg, status\n    let settings = getFromCacheObject(\"pixivSettings\")\n    if (!settings) settings = setDefaultSettings()\n    if (!!settings[settingName]) {\n        status = settings[settingName] = !settings[settingName]\n    } else {\n        status = settings[settingName] = true\n    }\n    putInCacheObject(\"pixivSettings\", settings)\n\n    if (settingName === \"FAST\") {\n        checkSettings(settings)\n        msg = `\\n\\n${statusMsg(status)}ã€€${settingsName[settingName]}\\n\\n${getSettingStatus(settingName)}`\n    } else if (settingName === \"IPDirect\") {\n        if (settings.IPDirect && !isLogin()) {\n            msg = \"âœˆï¸ ç›´è¿æ¨¡å¼\\n\\nâœˆï¸ ç›´è¿æ¨¡å¼ éœ€ç™»å½•è´¦å·\\nå½“å‰æœªç™»å½•è´¦å·ï¼Œç°å·²å…³é—­ç›´è¿æ¨¡å¼\"\n            settings.IPDirect = false\n            checkSettings(settings)\n        } else {\n            checkSettings(settings)\n            msg = `\\n\\n${statusMsg(status)}ã€€${settingsName[settingName]}\\n\\n${getSettingStatus(settingName)}`\n        }\n        try {source.refreshExplore()} catch (e) {}\n    } else {\n        msg = `\\n\\n${statusMsg(status)}ã€€${settingsName[settingName]}`\n        if (settingName.startsWith(\"SHOW\")) try {source.refreshExplore()} catch (e) {}\n    }\n    sleepToast(msg)\n}\n\nfunction cleanCache() {\n    let novel = getNovel()\n    cache.delete(`${urlNovelUrl(novel.id)}`)\n    cache.delete(`${urlNovelDetailed(novel.id)}`)\n    try {java.refreshContent()} catch(err) {}\n    sleepToast(`ğŸ”„ åˆ·æ–°æœ¬ç« \\n\\nè‹¥æ­£æ–‡æœªæ›´æ–°ï¼Œè¯·æ‰‹åŠ¨åˆ·æ–°`, 5)\n}\n\nfunction getFurryAuthors() {\n    cache.delete(\"https://api.furrynovel.ink/fav/user/cache\")  // åˆ é™¤ç¼“å­˜å®æ—¶è¯·æ±‚æ•°æ®\n    let furryAuthorsMap = {}\n    let authorsListLinpx = getAjaxJson(\"https://api.furrynovel.ink/fav/user/cache\")\n    authorsListLinpx.forEach(author => {\n        furryAuthorsMap[author.name] = author.id || author._id\n    })\n\n    // let authorsMapFurryReading = getAjaxJson(\"\")\n    // furryAuthorsMap = Object.assign(furryAuthorsMap, authorsMapFurryReading)\n    putInCacheObject(\"furryAuthors\", furryAuthorsMap)\n    return furryAuthorsMap\n}\n\nfunction updatePixivAuthors() {\n    let furryAuthors = getFurryAuthors()\n    let pixivAuthors = getFromCacheObject(\"pixivAuthors\")\n    if (!pixivAuthors) pixivAuthors = {}\n    pixivAuthors = Object.assign(pixivAuthors, furryAuthors)\n    putInCacheObject(\"pixivAuthors\", pixivAuthors, cacheSaveSeconds)\n    sleepToast(\"\\nğŸº å…½äººä½œè€…æœç´¢ä¼˜åŒ– \\n\\n âœ… å·²å¯¼å…¥ Linpx æ¨èä½œè€…\", 1)\n    return pixivAuthors\n}",
        "respondTime": 180000,
        "ruleBookInfo": {
            "author": "userName",
            "canReName": "true",
            "coverUrl": "coverUrl",
            "init": "@js:\nvar util = objParse(String(java.get(\"util\")))\n\nfunction objParse(obj) {\n    return JSON.parse(obj, (n, v) => {\n        if (typeof v == \"string\" && v.match(\"()\")) {\n            return eval(`(${v})`)\n        }\n        return v;\n    })\n}\n\nfunction novelHandler(novel){\n    novel = util.formatNovels(util.handNovels([novel], true))[0]\n    if (novel.seriesId === undefined || novel.seriesId === null) {\n        book.bookUrl = novel.detailedUrl = urlNovelUrl(novel.id)\n        book.tocUrl = novel.catalogUrl = urlIP(urlNovelDetailed(novel.id))\n    } else {\n        book.bookUrl = novel.detailedUrl = urlSeriesUrl(novel.seriesId)\n        book.tocUrl = novel.catalogUrl = urlIP(urlSeriesDetailed(novel.seriesId))\n    }\n    // æ”¾å…¥ä¿¡æ¯ä»¥ä¾¿ç™»é™†ç•Œé¢ä½¿ç”¨\n    source.putLoginInfo(JSON.stringify(novel))\n    putInCacheObject(\"novel\", novel)\n    return novel\n}\n\n(() => {\n    return novelHandler(util.getNovelResFirst(result))\n})()",
            "intro": "description",
            "kind": "tags",
            "lastChapter": "latestChapter",
            "name": "title",
            "tocUrl": "catalogUrl",
            "wordCount": "textCount"
        },
        "ruleContent": {
            "content": "@js:\nvar util = objParse(String(java.get(\"util\")))\nlet emoji = {\n    \"normal\": 101, \"surprise\": 102, \"series\": 103, \"heaven\": 104, \"happy\": 105,\n    \"excited\": 106, \"sing\": 107, \"cry\": 108, \"normal2\": 201, \"shame2\": 202,\n    \"love2\": 203, \"interesting2\": 204, \"blush2\": 205, \"fire2\": 206, \"angry2\": 207,\n    \"shine2\": 208, \"panic2\": 209, \"normal3\": 301, \"satisfaction3\": 302, \"surprise3\": 303,\n    \"smile3\": 304, \"shock3\": 305, \"gaze3\": 306, \"wink3\": 307, \"happy3\": 308,\n    \"excited3\": 309, \"love3\": 310, \"normal4\": 401, \"surprise4\": 402, \"series4\": 403,\n    \"love4\": 404, \"shine4\": 405, \"sweet4\": 406, \"shame4\": 407, \"sleep4\": 408,\n    \"heart\": 501, \"teardrop\": 502, \"star\": 503\n}\n\nfunction objParse(obj) {\n    return JSON.parse(obj, (n, v) => {\n        if (typeof v == \"string\" && v.match(\"()\")) {\n            return eval(`(${v})`)\n        }\n        return v;\n    })\n}\n\nfunction getNovelInfo(res) {\n    // æ”¾å…¥å°è¯´ä¿¡æ¯ä»¥ä¾¿ç™»é™†ç•Œé¢ä½¿ç”¨\n    let novel = source.getLoginInfoMap()\n    if (!novel) novel = getFromCacheObject(\"novel\")\n    if (res && res.error === true) return\n    novel.id = Number(res.id)\n    novel.title = res.title\n    novel.userId = res.userId\n    novel.userName = res.userName\n\n    if (res.bookmarkData) {\n        novel.isBookmark = true\n        putInCache(`collect${novel.id}`, res.bookmarkData.id)\n        util.saveNovels(\"likeNovels\", [Number(novel.id)])\n    } else {\n        novel.isBookmark = false\n    }\n\n    if (res.seriesNavData) {\n        novel.seriesId = Number(res.seriesNavData.seriesId)\n        novel.seriesTitle = res.seriesNavData.title\n        novel.isWatched = res.seriesNavData.isWatched\n        util.saveNovels(\"watchedSeries\", [Number(novel.seriesId)])\n    } else {\n        novel.seriesId = null\n        novel.seriesTitle = \"\"\n        novel.isWatched = false\n    }\n\n    // ç³»åˆ— + é˜…è¯»ï¼Œä½¿ç”¨å½“å‰ç« èŠ‚åç§°\n    if (novel.seriesId && util.environment.IS_LEGADO) {\n        let novelIds = getFromCacheObject(`novelIds${novel.seriesId}`)\n        novel.id = novelIds[book.durChapterIndex]\n        novel.title = book.durChapterTitle\n        let bookmarkId = getFromCacheObject(`collect${novel.id}`)\n        novel.isBookmark = !!bookmarkId\n    }\n\n    // æ·»åŠ æŠ•ç¥¨ä¿¡æ¯\n    if (res.pollData) novel.pollChoicesCount = res.pollData.choices.length\n    else novel.pollChoicesCount = 0\n    novel[\"ç« èŠ‚åç§°\"] = novel.title\n    source.putLoginInfo(JSON.stringify(novel))\n    putInCacheObject(\"novel\", novel)\n}\n\nfunction getCaptions(res, content)ã€€{\n    // åœ¨æ­£æ–‡å†…éƒ¨æ·»åŠ å°è¯´æè¿°\n    if (util.settings.SHOW_CAPTIONS && res.description !== \"\") {\n        content = res.description + \"\\n\" + \"â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”\\n\".repeat(2) + content\n    }\n    return content\n}\n\nfunction replaceUploadedImage(res, content) {\n    // è·å– [uploadedimage:] çš„å›¾ç‰‡é“¾æ¥\n    if (res.textEmbeddedImages) {\n        Object.keys(res.textEmbeddedImages).forEach((key) => {\n            content = content.replace(`[uploadedimage:${key}]`, `<img src=\"${urlCoverUrl(res.textEmbeddedImages[key].urls.original)}\">`)\n        })\n    }\n    return content\n}\n\nfunction replacePixivImage(content) {\n    // è·å– [pixivimage:] çš„å›¾ç‰‡é“¾æ¥ [pixivimage:1234] [pixivimage:1234-1]\n    let matched = content.match(RegExp(/\\[pixivimage:(\\d+)-?(\\d+)]/gm))\n    if (matched) {\n        matched.forEach(pixivimage => {\n            let matched2, illustId, order = 0\n            if (pixivimage.includes(\"-\")) {\n                matched2 = pixivimage.match(RegExp(\"(\\\\d+)-(\\\\d+)\"))\n                illustId = matched2[1]; order = matched2[2]\n            } else {\n                matched2 = pixivimage.match(RegExp(\"\\\\d+\"))\n                illustId = matched2[0];\n            }\n            if (urlIllustOriginal(illustId, order)) {\n                content = content.replace(`${pixivimage}`, `<img src=\"${urlIllustOriginal(illustId, order)}\">`)\n            } else {\n                content = content.replace(`${pixivimage}`, ``)\n            }\n        })\n    }\n    return content\n}\n\nfunction replaceNewPage(content) {\n    // æ›¿æ¢ Pixiv åˆ†é¡µæ ‡è®°ç¬¦å· [newpage]\n    if (!util.environment.IS_LEGADO_SIGMA) {\n        let matched = content.match(RegExp(/[ ã€€]*\\[newpage][ ã€€]*/gm))\n        if (matched) {\n            for (let i in matched) {\n                content = content.replace(`${matched[i]}`, `${\"<p>â€‹<p/>\".repeat(3)}`)\n            }\n        }\n    }\n    return content\n}\n\nfunction replaceChapter(content) {\n    // æ›¿æ¢ Pixiv ç« èŠ‚æ ‡è®°ç¬¦å· [chapter:]\n    let matched = content.match(RegExp(/\\[chapter:(.*?)]/gm))\n    if (matched) {\n        for (let i in matched) {\n            let matched2 = matched[i].match(/\\[chapter:(.*?)]/m)\n            let chapter = matched2[1].trim()\n            // æ›¿æ¢ Pixiv åˆ†é¡µæ ‡è®°ç¬¦å· [newpage]\n            if (util.environment.IS_LEGADO_SIGMA) {\n                content = content.replace(`${matched[i]}`, `<usehtml><h3>${chapter}</h3></usehtml>`)\n            } else {\n                content = content.replace(`${matched[i]}`, `${chapter}<p>â€‹<p/>`)\n            }\n        }\n    }\n    return content\n}\n\nfunction replaceJumpPage(content) {\n    // æ›¿æ¢ Pixiv è·³è½¬é¡µé¢æ ‡è®°ç¬¦å· [[jump:]]\n    let matched = content.match(RegExp(/\\[jump:(\\d+)]/gm))\n    if (matched) {\n        for (let i in matched) {\n            let page = matched[i].match(/\\d+/)\n            content = content.replace(`${matched[i]}`, `\\n\\nè·³è½¬è‡³ç¬¬${page}èŠ‚`)\n        }\n    }\n    return content\n}\n\nfunction replaceJumpUrl(content) {\n    // æ›¿æ¢ Pixiv é“¾æ¥æ ‡è®°ç¬¦å· [[jumpuri: > ]]\n    let matched = content.match(RegExp(/\\[\\[jumpuri:(.*?)>(.*?)]]/gm))\n    if (matched) {\n        for (let i in matched) {\n            let matched2 = matched[i].match(/\\[\\[jumpuri:(.*?)>(.*?)]]/m)\n            let matchedText = matched2[0]\n            let urlName = matched2[1].trim()\n            let urlLink = matched2[2].trim()\n\n            if (util.environment.IS_LEGADO_SIGMA) {\n                content = content.replace(`${matchedText}`, `<usehtml><p>ã€€ã€€<a href=${urlLink}>${urlName}</a></p></usehtml>`)\n            } else {\n                if (urlLink === urlName) {\n                    content = content.replace(`${matchedText}`, `${urlName}`)\n                } else {\n                    content = content.replace(`${matchedText}`, `${urlName}: ${urlLink}`)\n                }\n            }\n        }\n    }\n    return content\n}\n\nfunction replaceRb(content) {\n    // æ›¿æ¢ Pixiv æ³¨éŸ³æ ‡è®°ç¬¦å· [[rb: > ]]\n    let matched = content.match(RegExp(/\\[\\[rb:(.*?)>(.*?)]]/gm))\n    if (matched) {\n        for (let i in matched) {\n            let matched2 = matched[i].match(/\\[\\[rb:(.*?)>(.*?)]]/m)\n            let matchedText = matched2[0]\n            let kanji = matched2[1].trim()\n            let kana = matched2[2].trim()\n\n            if (!util.settings.REPLACE_TITLE_MARKS) {\n                // é»˜è®¤æ›¿æ¢æˆï¼ˆæ‹¬å·ï¼‰\n                content = content.replace(`${matchedText}`, `${kanji}ï¼ˆ${kana}ï¼‰`)\n            } else {\n                let reg = RegExp(\"[\\\\u4E00-\\\\u9FFF]+\", \"g\");\n                if (reg.test(kana)) {\n                    // kanaä¸ºä¸­æ–‡ï¼Œåˆ™æ›¿æ¢å›ã€Šä¹¦åå·ã€‹\n                    content = content.replace(`${matchedText}`, `${kanji}ã€Š${kana}ã€‹`)\n                } else {\n                    // é˜…è¯»ä¸æ”¯æŒ <ruby> <rt> æ³¨éŸ³\n                    // content = content.replace(`${matchedText}`, `<ruby>${kanji}<rt>${kana}</rt></ruby>`)\n                    content = content.replace(`${matchedText}`, `${kanji}ï¼ˆ${kana}ï¼‰`)\n                }\n            }\n        }\n    }\n    return content\n}\n\nfunction getPollData(res, content) {\n    // æ·»åŠ æŠ•ç¥¨\n    if (res.pollData) {\n        let poll = `ğŸ“ƒ æŠ•ç¥¨(âœ…${res.pollData.total}å·²æŠ•)ï¼š\\n${res.pollData.question}\\n`\n        res.pollData.choices.forEach(choice => {\n            poll += `é€‰é¡¹${choice.id}ï¼š${choice.text}(âœ…${choice.count})\\n`\n        })\n        content += \"\\n\" + \"â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”\\n\".repeat(2) + poll\n    }\n    return content\n}\n\nfunction processComment(item) {\n    let text = item.comment || \"\"\n    if (text === \"\" && item.stampId) {\n        return `<img src=\"${urlStampUrl(item.stampId)}\">`\n    }\n    return text.replace(/\\(([^)]+)\\)/g, (match, key) => {\n        if (emoji.hasOwnProperty(key)) {\n            return `<img src=\"${urlEmojiUrl(emoji[key])}\" >`\n        }\n        return match\n    })\n}\n\nfunction formatComment(item, replyToName = null) {\n    const content = processComment(item)\n    const isMyComment = item.userId === String(getFromCache(\"pixiv:uid\"))\n    const commentId = isMyComment ? `(${item.id})` : \"\"\n    const name = replyToName ? `@${item.userName}(â¤´ï¸@${replyToName})` : `@${item.userName}`\n    return `${name}ï¼š${content}(${item.commentDate})${commentId}\\n`\n}\n\nfunction getComment(res, content) {\n    if (!util.settings.SHOW_COMMENTS || res.commentCount === 0) return content\n\n    const limit = 50\n    let comments = [], commentUrls = [];\n    let maxPage = Math.ceil(res.commentCount / limit)\n    if (maxPage >= 2 && util.environment.IS_LEGADO) {\n        for (let i = 0; i < maxPage; i++) {\n            commentUrls.push(urlIP(urlNovelComments(res.id, i * limit, limit)))\n        }\n        comments = getAjaxAllJson(commentUrls).map(resp => resp.body.comments).flat()\n    } else {\n        for (let i = 0; i < maxPage; i++) {\n            let result = getAjaxJson(urlIP(urlNovelComments(res.id, i * limit, limit)), true)\n            if (result && !result.error && result.body && result.body.comments) {\n                comments = comments.concat(result.body.comments)\n            }\n        }\n    }\n\n    let commentText = `ğŸ’¬ è¯„è®º(å…±è®¡${comments.length}æ¡)ï¼š\\n`\n    comments.forEach(comment => {\n        commentText += formatComment(comment)\n        if (comment.hasReplies) {\n            let resp = getAjaxJson(urlIP(urlNovelCommentsReply(comment.id, 1)), true)\n            if (resp && !resp.error && resp.body && resp.body.comments) {\n                resp.body.comments.reverse().forEach(reply => {\n                    commentText += formatComment(reply, reply.replyToUserName)\n                })\n            }\n            commentText += \"â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”\\n\"\n        }\n    })\n    return content + \"\\n\" + \"â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”\\n\".repeat(2) + commentText\n}\n\nfunction getContent(res) {\n    getNovelInfo(res)  // æ”¾å…¥ä¿¡æ¯ä»¥ä¾¿ç™»é™†ç•Œé¢ä½¿ç”¨\n    let content = String(res.content)\n    // let content = \"undefined\"\n    if (content.includes(\"undefined\")) {\n        return checkContent()\n    }\n\n    content = getCaptions(res, content)\n    content = replaceUploadedImage(res, content)\n    content = replacePixivImage(content)\n    content = replaceNewPage(content)\n    content = replaceChapter(content)\n    content = replaceJumpPage(content)\n    content = replaceJumpUrl(content)\n    content = replaceRb(content)\n    content = getPollData(res, content)\n    content = getComment(res, content)\n    return content\n}\n\nfunction checkContent() {\n    let latestMsg = getAjaxJson(urlMessageThreadLatest(5))\n    if (latestMsg.error === true) {\n        java.log(JSON.stringify(latestMsg))\n\n    } else if (latestMsg.body.total >= 1) {\n        let msg = latestMsg.body.message_threads.filter(item => item.thread_name === \"pixiväº‹å‹™å±€\")[0]\n        if (msg === undefined) {\n            sleepToast(`æ‚¨äº ${java.timeFormat(new Date().getTime())} è§¦å‘ Pixiv ã€è¯·æ±‚é™åˆ¶ã€‘ï¼Œå»ºè®®ç¨å€™/é‡æ–°ç™»å½•å†ç»§ç»­`, 3)\n            // java.startBrowser(\"https://www.pixiv.net\", 'é€€å‡ºç™»å½•')\n            // java.startBrowser(\"https://www.pixiv.net/logout.php\",'é€€å‡ºç™»å½•')  // ä¸æ¸…é™¤ WebView ç¼“å­˜æ— æ³•é‡æ–°ç™»å½•\n\n        } else if (new Date().getTime()- 1000*msg.modified_at <= 3*24*60*60*1000) { // 3*24hå†…æé†’\n            sleepToast(`æ‚¨äº ${java.timeFormat(1000*msg.modified_at)} è§¦å‘ Pixiv ã€è¿‡åº¦è®¿é—®ã€‘ï¼Œè¯·ä¿®æ”¹å¯†ç å¹¶é‡æ–°ç™»å½•`, 3)\n            sleepToast(`${msg.latest_content}`, 5)\n            java.startBrowser(\"https://accounts.pixiv.net/password/change\",'ä¿®æ”¹å¯†ç ')\n        }\n    }\n}\n\n(() => {\n    return getContent(util.getNovelResFirst(result))\n})()",
            "title": "",
            "imageStyle": "FULL",
            "callBackJs": "function getNovel() {\n    let novel = {}\n    novel.author = novel.userName = book.author.replace(\"@\", \"\")\n    if (book.bookUrl.includes(\"series\")) {\n        novel.seriesId = book.bookUrl.match(/\\d+/)[0]\n        novel.seriesTitle = book.name\n\n        let novelIds = getFromCacheObject(`novelIds${novel.seriesId}`)\n        novel.id = novelIds[book.durChapterIndex]\n        novel.title = book.durChapterTitle\n    } else {\n        novel.seriesId = 0\n        novel.seriesTitle = \"\"\n        novel.id = book.bookUrl.match(/\\d+/)[0]\n        novel.title = book.name\n    }\n    return novel\n}\n\nfunction shareBook() {\n    let text = `æˆ‘æ­£åœ¨çœ‹ï¼šã€${book.author.replace(\"@\", \"\")}ã€‘åˆ›ä½œçš„ã€Š${book.name}ã€‹`\n    if (!!book.durChapterTitle && String(book.name) !== String(book.durChapterTitle)) {\n        text += `çš„ ã€${book.durChapterTitle}ã€‘`\n    }\n    text += `\\n\\nå°è¯´é“¾æ¥ï¼š\\n${book.bookUrl}\\n\\nåˆ†äº«è‡ªã€å¼€æºé˜…è¯»ã€‘Pixivä¹¦æºã€‚ä½¿ç”¨æ·»åŠ ç½‘å€ï¼Œå¿«é€Ÿæ·»åŠ æœ¬æ–‡`\n    java.copyText(text)\n    return true\n}\n\nfunction clearCache() {\n    let novel = getNovel()\n    cache.delete(`${urlNovelUrl(novel.id)}`)\n    cache.delete(`${urlNovelDetailed(novel.id)}`)\n    cache.delete(`${urlSearchNovel(novel.title, 1)}`)\n    if (novel.seriesId) {\n        cache.delete(`${urlSeriesUrl(novel.seriesId)}`)\n        cache.delete(`${urlSeriesDetailed(novel.seriesId)}`)\n        cache.delete(`${urlSearchSeries(novel.seriesTitle, 1)}`)\n\n        let novelIds = getFromCacheObject(`novelIds${novel.seriesId}`)\n        novelIds.forEach(novelId => {\n            cache.delete(`${urlNovelUrl(novelId)}`)\n            cache.delete(`${urlNovelDetailed(novelId)}`)\n        })\n    }\n    return true\n}\n\nfunction copyBookUrl() {\n    java.copyText(book.bookUrl)\n    return true\n}\nfunction copyTocUrl() {\n    java.copyText(book.tocUrl)\n    return true\n}\n\n// ä¿å­˜é˜…è¯»ï¼Œæ›´æ–°ç™»å½•ç•Œé¢çš„ç« èŠ‚åç§°\nfunction saveRead() {\n    source.putLoginInfo(JSON.stringify({\"ç« èŠ‚åç§°\": book.durChapterTitle}))\n}\n\nfunction startShelfRefresh() {\n    source.putConcurrent(\"18/30000\")\n}\n\nfunction endShelfRefresh() {\n    source.putConcurrent(\"25/5000\")\n}\n\nfunction callBackFactory(event) {\n    switch (event) {\n        // case \"clickBookName\":\n        //     return clickBookName()\n        // case \"longClickBookName\":\n        //     return longClickBookName()\n        // case \"clickAuthor\":\n        //     return clickAuthor()\n        // case \"longClickAuthor\":\n        //     return longClickAuthor()\n        // case \"clickCustomButton\":\n        //     return customButton()\n        // case \"longClickCustomButton\":\n        //     return longcustomButton()\n\n        case \"clickShareBook\":\n            return shareBook()\n        case \"clickClearCache\":\n            return clearCache()\n        case \"clickCopyBookUrl\":\n            return copyBookUrl()\n        case \"clickCopyTocUrl\":\n            return copyTocUrl()\n\n        // ä¸‹é¢çš„äº‹ä»¶æ— æ³•è¢«å›è°ƒç»“æœæ¶ˆè´¹\n        // case \"addBookShelf\":\n        //     return addBookShelf()\n        // case \"delBookShelf\":\n        //     return delBookShelf()\n        case \"saveRead\":\n            return saveRead()\n        // case \"startRead\":\n        //     return startRead()\n        // case \"endRead\":\n        //     return endRead()\n        case \"startShelfRefresh\":\n            return startShelfRefresh()\n        case \"endShelfRefresh\":\n            return endShelfRefresh()\n    }\n}\n\n(() => {\n    return callBackFactory(event)\n})()"
        },
        "ruleExplore": {
            "author": "userName",
            "bookList": "@js:\nvar util = objParse(String(java.get(\"util\")))\nvar seriesSet = new Set();  // å­˜å‚¨seriesID æœ‰BUGæ— æ³•å¤„ç†ç¿»é¡µ\n\nfunction objParse(obj) {\n    return JSON.parse(obj, (n, v) => {\n        if (typeof v == \"string\" && v.match(\"()\")) {\n            return eval(`(${v})`)\n        }\n        return v;\n    })\n}\n\nfunction handlerFactory() {\n    if (baseUrl.includes(\"https://cdn.jsdelivr.net\")) {\n        return () => {updateSource(); return []}\n    }\n    if (baseUrl.includes(\"github\")) {\n        return () => {startBrowser(baseUrl, \"\"); return []}\n    }\n    if (!isLogin()) {\n        return handlerNoLogin()\n    }\n    if (baseUrl.includes(\"/bookmark\")) {\n        return handlerBookMarks()\n    }\n    if (baseUrl.includes(\"/top\")) {\n        return handlerRecommend()\n    }\n    if (baseUrl.includes(\"/follow_latest\")) {\n        return handlerFollowLatest()\n    }\n    if (baseUrl.includes(\"/watch_list\")) {\n        return handlerWatchList()\n    }\n    if (baseUrl.includes(\"/discovery\")) {\n        return handlerDiscovery()\n    }\n    if (baseUrl.includes(\"/new\")) {\n        return handlerDiscovery()\n    }\n    if (baseUrl.includes(\"/commission/\")) {\n        return handlerFollowLatest()\n    }\n    if (baseUrl.includes(\"/user_event/portal\")) {\n        return handlerFollowLatest()\n    }\n    if (baseUrl.includes(\"/genre\")) {\n        return handlerWatchList()\n    }\n    // æ­£åˆ™åŒ¹é…ç½‘å€å†…å®¹\n    if (baseUrl.includes(\"/ranking\")) {\n        return handlerRanking()\n    }\n    if (baseUrl.includes(\"/marker_all\")) {\n        return handlerRanking()\n    }\n    if (baseUrl.includes(\"/editors_picks\")) {\n        return handlerRanking()\n    }\n    if (baseUrl.includes(\"/ajax/search/novels\")) {\n        return handlerSearch()\n    }\n    if (baseUrl.startsWith(\"https://www.pixiv.net\")) {\n        return handlerRanking()\n    }\n    else {\n        return () => {startBrowser(baseUrl, \"\"); return []}\n    }\n}\n\nfunction handlerNoLogin() {\n    return () => {\n        sleepToast(\"âš ï¸ å½“å‰æœªç™»å½•è´¦å·\\n\\nè¯·ç™»å½• Pixiv è´¦å·\", 1.5)\n        util.removeCookie(); util.login()\n        sleepToast(\"ç™»å½•æˆåŠŸåï¼Œè¯·é‡æ–°è¿›å…¥å‘ç°\", 2)\n        return []\n    }\n}\n\n// æ¨èå°è¯´\nfunction handlerRecommend() {\n    return () => {\n        let res = JSON.parse(result)\n        const recommend = res.body.page.recommend\n        const novels = res.body.thumbnails.novel\n        let nidSet = new Set(recommend.ids)\n        // java.log(nidSet.size)\n        let list = novels.filter(novel => nidSet.has(String(novel.id)))\n        // java.log(`è¿‡æ»¤ç»“æœ:${JSON.stringify(list)}`)\n        return util.formatNovels(util.handNovels(util.combineNovels(list)))\n    }\n}\n\n// æ”¶è—å°è¯´ï¼Œä»–äººæ”¶è—\nfunction handlerBookMarks() {\n    return () => {\n        let res = JSON.parse(result).body.works\n        if (res === undefined || res.length === 0) {\n            //æµç¨‹æ— æ³•æœ¬ç¯èŠ‚ä¸­æ­¢ åªèƒ½äº¤ç»™ä¸‹ä¸€æµç¨‹å¤„ç†\n            return []\n        }\n        return util.formatNovels(util.handNovels(res))\n    }\n}\n\n//å…³æ³¨ä½œè€…ï¼Œå°è¯´å§”æ‰˜ï¼Œå°è¯´ä¼åˆ’\nfunction handlerFollowLatest() {\n    return () => {\n        let res = JSON.parse(result)\n        return util.formatNovels(util.handNovels(util.combineNovels(res.body.thumbnails.novel)))\n    }\n}\n\n//æ¨èå°è¯´ï¼Œæœ€è¿‘å°è¯´\nfunction handlerDiscovery() {\n    return () => {\n        let res = JSON.parse(result)\n        return util.formatNovels(util.handNovels(util.combineNovels(res.body.novels)))\n    }\n}\n\n// æœç´¢æ ‡ç­¾\nfunction handlerSearch() {\n    return () => {\n        let res = JSON.parse(result)\n        return util.formatNovels(util.handNovels(util.combineNovels(res.body.novel.data)))\n    }\n}\n\n// è¿½æ›´åˆ—è¡¨ï¼Œçƒ­é—¨åˆ†ç±»\nfunction handlerWatchList() {\n    return () => {\n        let res = JSON.parse(result)\n        return util.formatNovels(util.handNovels(res.body.thumbnails.novelSeries))\n    }\n}\n\n// æ’è¡Œæ¦œï¼Œä¹¦ç­¾ï¼Œé¦–é¡µï¼Œç¼–è¾‘éƒ¨æ¨èï¼Œé¡ºåºç›¸åŒ\nfunction handlerRanking() {\n    if (util.environment.IS_LEGADO) return handlerRankingAjaxAll()\n    // else if (util.environment.IS_SOURCE_READ) return handlerRankingWebview()\n    else if (util.environment.IS_SOURCE_READ) return handlerRankingAjax()\n    else return []\n}\n\n// æ’è¡Œæ¦œï¼Œä¹¦ç­¾ï¼Œé¦–é¡µï¼Œç¼–è¾‘éƒ¨æ¨èï¼Œé¡ºåºç›¸åŒ\nfunction handlerRankingAjaxAll() {\n    return () => {\n        let  novelIds = [], novelUrls = []\n        // let result = result + java.ajax(`${baseUrl}&p=2`)  // æ­£åˆ™è·å–ç½‘å€ä¸­çš„ novelId\n        let matched = result.match(RegExp(/\\/novel\\/show\\.php\\?id=\\d{5,}/gm))\n        for (let i in matched) {\n            let novelId = matched[i].match(RegExp(/\\d{5,}/))[0]\n            if (novelIds.indexOf(novelId) === -1) {\n                novelIds.push(novelId)\n                novelUrls.push(urlNovelDetailed(novelId))\n            }\n        }\n        // java.log(JSON.stringify(novelIds))\n        let novels = getAjaxAllJson(novelUrls).map(resp => resp.body)\n        return util.formatNovels(util.handNovels(util.combineNovels(novels)))\n    }\n}\n\n// æ’è¡Œæ¦œï¼Œä¹¦ç­¾ï¼Œé¦–é¡µ\nfunction handlerRankingWebview() {\n    return () => {\n        let novelIds = []  // æ­£åˆ™è·å–ç½‘å€ä¸­çš„ novelId\n        // let result = result + java.ajax(`${baseUrl}&p=2`)  // æ­£åˆ™è·å–ç½‘å€ä¸­çš„ novelId\n        let matched = result.match(RegExp(/\\/novel\\/show\\.php\\?id=\\d{5,}/gm))\n        for (let i in matched) {\n            let novelId = matched[i].match(RegExp(/\\d{5,}/))[0]\n            if (novelIds.indexOf(novelId) === -1) {\n                novelIds.push(novelId)\n            }\n        }\n        // java.log(JSON.stringify(novelIds))\n        let userNovels = getWebviewJson(\n            urlNovelsDetailed(getFromCache(\"pixiv:uid\"), novelIds), html => {\n                return (html.match(new RegExp(\">\\\\{.*?}<\"))[0].replace(\">\", \"\").replace(\"<\", \"\"))\n            }).body\n        return util.formatNovels(util.handNovels(util.combineNovels(Object.values(userNovels))))\n    }\n}\n\n// æ’è¡Œæ¦œï¼Œä¹¦ç­¾ï¼Œé¡ºåºç›¸åŒ\nfunction handlerRankingAjax() {\n    return () => {\n        let novels = [], novelIds = []\n        // let result = result + java.ajax(`${baseUrl}&p=2`)  // æ­£åˆ™è·å–ç½‘å€ä¸­çš„ novelId\n        let matched = result.match(RegExp(/\\/novel\\/show\\.php\\?id=\\d{5,}/gm))\n        for (let i in matched) {\n            let novelId = matched[i].match(RegExp(/\\d{5,}/))[0]\n            if (novelIds.indexOf(novelId) === -1) {\n                novelIds.push(novelId)\n                // java.log(urlNovelDetailed(novelId))\n                let res = getAjaxJson(urlNovelDetailed(novelId))\n                if (res.error !== true) {\n                    novels.push(res.body)\n                } else {\n                    java.log(JSON.stringify(res))\n                }\n            }\n        }\n        return util.formatNovels(util.handNovels(util.combineNovels(novels)))\n    }\n}\n\n(() => {\n    return handlerFactory()()\n})()",
            "bookUrl": "detailedUrl",
            "coverUrl": "coverUrl",
            "intro": "description",
            "kind": "tags",
            "lastChapter": "latestChapter",
            "name": "title",
            "wordCount": "textCount"
        },
        "ruleSearch": {
            "author": "userName",
            "bookList": "@js:\nvar util = objParse(String(java.get(\"util\")))\n\nfunction objParse(obj) {\n    return JSON.parse(obj, (n, v) => {\n        if (typeof v == \"string\" && v.match(\"()\")) {\n            return eval(`(${v})`)\n        }\n        return v;\n    })\n}\n\nvar first = true;\n// å­˜å‚¨seriesID\nvar seriesSet = {\n    keywords: \"Pixiv:Search\",\n    has: (value) => {\n        let page = Number(java.get(\"page\"))\n        if (page === 1 && first) {\n            first = false\n            cache.deleteMemory(this.keywords)\n            return false\n        }\n\n        let v = cache.getFromMemory(this.keywords)\n        if (v === undefined || v === null) {\n            return false\n        }\n        let set = new Set(JSON.parse(v))\n        return set.has(value)\n    },\n\n    add: (value) => {\n        let v = cache.getFromMemory(this.keywords)\n        if (v === undefined || v === null) {\n            cache.putMemory(this.keywords, JSON.stringify([value]))\n\n        } else {\n            let arr = JSON.parse(v)\n            if (typeof arr === \"string\") {\n                arr = Array(arr)\n            }\n            arr.push(value)\n            cache.putMemory(this.keywords, JSON.stringify(arr))\n        }\n    },\n};\n\nfunction getUserIdCache() {\n    let userId\n    let userName = String(java.get(\"keyword\"))\n    //cache.delete(\"pixivAuthors\")\n    let pixivAuthors = getFromCacheObject(\"pixivAuthors\")\n    // java.log(JSON.stringify(pixivAuthors))\n    if (pixivAuthors) userId = pixivAuthors[userName]\n    if (userId) {\n        java.log(`ğŸ‘¤ ç¼“å­˜ä½œè€…IDï¼š${userId}`)\n        return [userId]\n    }\n}\n\nfunction getUserIdOnline(full) {\n    let userName = String(java.get(\"keyword\"))\n    let page = Number(java.get(\"page\"))\n    let userIds = getAjaxParseJson(urlSearchUser(userName, page, full), html => {\n            let resp = JSON.parse(html.match(/<script id=\"__NEXT_DATA__\"[^>]*>([\\s\\S]*?)<\\/script>/)[1])\n            return resp.props.pageProps.userIds\n        }\n    )\n\n    let tempUids = []\n    for (let i in userIds) {\n        let userId = userIds[i]\n        let resp = getAjaxJson(urlIP(urlUserAllWorks(userId)), true)\n        // java.log(urlIP(urlUserAllWorks(userId)))\n        if (resp.error === false) {\n            // ä»…è·å–æœ‰å°è¯´çš„ä½œè€…\n            let novelIds = Object.keys(resp.body.novels)\n            // java.log(`${userId}-${novelIds.length}`)\n            if (novelIds.length >= 1) tempUids.push(userId)\n        }\n    }\n    java.log(`ğŸ‘¤ è·å–ä½œè€…IDï¼š${JSON.stringify(tempUids)}`)\n    return tempUids\n}\n\nfunction getUserNovels() {\n    let page = Number(java.get(\"page\"))\n    let uidList = getUserIdCache()\n    if (!uidList) uidList = getUserIdOnline()\n    // if (!uidList) uidList = getUserIdOnline(true)\n\n    let novels = []\n    for (let i in uidList) {\n        let uid = uidList[i]\n        let resp = getAjaxJson(urlIP(urlUserAllWorks(uid)))\n        // java.log(urlIP(urlUserAllWorks(id)))\n\n        // è·å–ç³»åˆ—å°è¯´ï¼Œä¸ util.handnovels ç³»åˆ—è¯¦æƒ…å…¼å®¹\n        let seriesIds = []\n        if (resp.body.novelSeries.length >= 1) {\n            resp.body.novelSeries.forEach(novel =>{\n                seriesIds.push(novel.id)\n                novel.textCount = novel.publishedTotalCharacterCount\n                novel.description = novel.caption\n            })\n            novels = novels.concat(resp.body.novelSeries)\n        }\n\n        // è·å–æ‰€æœ‰ç³»åˆ—å†…éƒ¨çš„å°è¯´ ID\n        let seriesNovelIds = []\n        if (util.environment.IS_LEGADO) {\n            let seriesUrls = seriesIds.map(seriesId => urlIP(urlSeriesNovelsTitles(seriesId)))\n            // let resp = getAjaxAllJson(seriesUrls).map(resp => resp.body)\n            // seriesNovelIds = resp.flat().map(item => item.id)\n            seriesNovelIds = getAjaxAllJson(seriesUrls).flatMap(resp => resp.body.map(item => item.id))\n        }\n\n        if (util.environment.IS_SOURCEREAD) {\n            seriesIds.forEach(seriesId => {\n                let novels = getAjaxJson(urlIP(urlSeriesNovelsTitles(seriesId))).body\n                seriesNovelIds.push.apply(seriesNovelIds, novels.map(novel => novel.id))\n            })\n        }\n        // java.log(`æœ‰ç³»åˆ—çš„å°è¯´IDï¼š${JSON.stringify(seriesNovelIds)}`)\n        // java.log(JSON.stringify(seriesNovelIds.length))\n\n        // è·å–å•ç¯‡å°è¯´\n        let novelIds = Object.keys(resp.body.novels)\n        novelIds = novelIds.filter(novelId => (!seriesNovelIds.includes(novelId)))\n        novelIds = novelIds.reverse().slice((page - 1) * 20, page * 20)\n        // java.log(`çœŸå•ç¯‡çš„å°è¯´IDï¼š${JSON.stringify(novelIds)}`)\n        // java.log(JSON.stringify(novelIds.length))\n\n        if (util.environment.IS_LEGADO) {\n            let novelUrls = novelIds.map(novelId => urlIP(urlNovelDetailed(novelId)))\n            // java.log(JSON.stringify(novelUrls))\n            // cache.delete(novelUrls)\n            novels = novels.concat(getAjaxAllJson(novelUrls).map(resp => resp.body))\n        }\n\n        if (util.environment.IS_SOURCEREAD) {\n            novelIds.forEach(novelId => {\n                // java.log(urlIP(urlNovelDetailed(novelId)))\n                let res = getAjaxJson(urlIP(urlNovelDetailed(novelId)))\n                if (res.error !== true) {\n                    novels.push(res.body)\n                } else {\n                    java.log(JSON.stringify(res))\n                }\n            })\n        }\n    }\n    \n    util.debugFunc(() => {\n        java.log(`è·å–ç”¨æˆ·æœç´¢å°è¯´ç»“æŸ`)\n    })\n    return novels\n}\n\nfunction search(name, type, page) {\n    let resp = {}\n    if (type.includes(\"novel\")) {\n        resp = getAjaxJson(urlIP(urlSearchNovel(name, page)))\n        java.log(urlIP(urlSearchNovel(name, page)))\n    }\n    if (type.includes(\"series\")) {\n        resp = getAjaxJson(urlIP(urlSearchSeries(name, page)))\n        java.log(urlIP(urlSearchSeries(name, page)))\n    }\n    if (resp.error === true || resp.total === 0) {\n        return {\"data\": [], \"total\":0, \"lastPage\": 0}\n    }\n    return resp.body.novel\n}\n\nfunction getSeries() {\n    let resp = JSON.parse(result)\n    if (resp.error === true) {\n        return []\n    }\n    let name = String(java.get(\"keyword\"))\n    let page = Number(java.get(\"page\"))\n    java.log(urlIP(urlSearchSeries(name, page)))\n    putInCacheObject(urlIP(urlSearchSeries(name, page)), resp, cacheSaveSeconds)  // åŠ å…¥ç¼“å­˜\n    return resp.body.novel.data\n}\n\nfunction getNovels() {\n    let name = String(java.get(\"keyword\"))\n    let page = Number(java.get(\"page\"))\n    let resp = search(name, \"novel\", page)\n    return util.combineNovels(resp.data)\n}\n\nfunction getConvertNovels() {\n    let novels = []\n    let name = String(java.get(\"keyword\"))\n    let page = Number(java.get(\"page\"))\n    let name1 = String(java.s2t(name))\n    let name2 = String(java.t2s(name))\n    if (name1 !== name) novels = novels.concat(search(name1, \"novel\", page).data)\n    if (name2 !== name) novels = novels.concat(search(name2, \"novel\", page).data)\n    novels = util.combineNovels(novels)\n    if (name1 !== name) novels = novels.concat(search(name1, \"series\", page).data)\n    if (name2 !== name) novels = novels.concat(search(name2, \"series\", page).data)\n    return novels\n}\n\nfunction novelFilter(novels) {\n    let textCount = 0, tags = []\n    let limitedTextCount = String(java.get(\"limitedTextCount\")).replace(\"å­—æ•°\", \"\").replace(\"å­—æ•¸\", \"\")\n    // limitedTextCount = `3w 3k 3w5 3k5`.[0]\n    if (limitedTextCount.includes(\"w\") || limitedTextCount.includes(\"W\")) {\n        let num = limitedTextCount.toLowerCase().split(\"w\")\n        textCount = 10000 * num[0] + 1000 * num[1]\n    } else if (limitedTextCount.includes(\"k\") || limitedTextCount.includes(\"K\")) {\n        let num = limitedTextCount.toLowerCase().split(\"k\")\n        textCount = 1000 * num[0] + 100 * num[1]\n    }\n\n    let novels0 = novels.map(novel => novel.id)\n    if (textCount >= 1) {\n        novels = novels.filter(novel => novel.textCount >= textCount)\n        let novels1 = novels.map(novel => novel.id)\n        java.log(`ğŸ”¢ å­—æ•°é™åˆ¶ï¼š${limitedTextCount}`)\n        java.log(`â¬ å­—æ•°é™åˆ¶ï¼šè¿‡æ»¤å‰${novels0.length}ï¼›è¿‡æ»¤å${novels1.length}`)\n    }\n\n    let inputTags = String(java.get(\"inputTags\")).split(\" \")\n    for (let i in inputTags) {\n        let tag = inputTags[i].trim()\n        if (tag !== \"\") tags.push(`${tag}`)\n    }\n\n    if (tags.length >= 1) {\n        // ä»…ä¿ç•™å«æœ‰æ‰€æœ‰æ ‡ç­¾çš„å°è¯´\n        // novels = novels.filter(novel => {\n        //     // java.log(`${JSON.stringify(novel.tags)}\\n${tags.every(item => novel.tags.includes(item))}`)\n        //     return tags.every(item => novel.tags.includes(item))\n        // })\n        novels = novels.filter(novel => tags.every(item => novel.tags.includes(item)))\n        let novels2 = novels.map(novel => novel.id)\n        java.log(`#ï¸âƒ£ è¿‡æ»¤æ ‡ç­¾ï¼š${tags.join(\"ã€\")}`)\n        java.log(`#ï¸âƒ£ è¿‡æ»¤æ ‡ç­¾ï¼šè¿‡æ»¤å‰${novels0.length}ï¼›è¿‡æ»¤å${novels2.length}`)\n    }\n\n    let inputAuthor = String(java.get(\"inputAuthor\")).trim()\n    if (inputAuthor) {\n        // novels = novels.filter(novel => {\n        //     java.log(`${novel.userName}-${novel.userName.includes(inputAuthor)}`)\n        //     return novel.userName.includes(inputAuthor)\n        // })\n        novels = novels.filter(novel => novel.userName.includes(inputAuthor))\n        let novels2 = novels.map(novel => novel.id)\n        java.log(`ğŸ‘¤ è¿‡æ»¤ä½œè€…ï¼š${inputAuthor.join(\"ã€\")}`)\n        java.log(`ğŸ‘¤ è¿‡æ»¤ä½œè€…ï¼šè¿‡æ»¤å‰${novels0.length}ï¼›è¿‡æ»¤å${novels2.length}`)\n    }\n    return novels\n}\n\n(() => {\n    let novels = []\n    let keyword = String(java.get(\"keyword\"))\n    if (keyword.startsWith(\"@\")) {\n        java.put(\"keyword\", keyword.slice(1))\n        novels = novels.concat(getUserNovels())\n    } else if (keyword.startsWith(\"#\")) {\n        java.put(\"keyword\", keyword.slice(1))\n        novels = novels.concat(getSeries())\n        novels = novels.concat(getNovels())\n    } else {\n        if (!isLogin()) {\n            sleepToast(\"ğŸ” æœç´¢å°è¯´\\n\\nâš ï¸ å½“å‰æœªç™»å½•è´¦å·\\nè¯·ç™»å½• Pixiv è´¦å·\", 1.5)\n            util.removeCookie(); util.login()\n            sleepToast(\"ğŸ” æœç´¢å°è¯´\\n\\nç™»å½•æˆåŠŸåï¼Œè¯·é‡æ–°æœç´¢\", 2)\n            return []\n        }\n        novels = novels.concat(getSeries())\n        novels = novels.concat(getNovels())\n        if (util.settings.SEARCH_AUTHOR) novels = novels.concat(getUserNovels())\n        if (util.settings.CONVERT_CHINESE) novels = novels.concat(getConvertNovels())\n    }\n    // java.log(JSON.stringify(novels))\n    // è¿”å›ç©ºåˆ—è¡¨ä¸­æ­¢æµç¨‹\n    if (novels.length === 0) {\n        return []\n    }\n    return novelFilter(util.formatNovels(util.handNovels(novels)))\n})()",
            "bookUrl": "detailedUrl",
            "checkKeyWord": "#æµ‹è¯•é¡µé¢",
            "coverUrl": "coverUrl",
            "intro": "description",
            "kind": "tags",
            "lastChapter": "latestChapter",
            "name": "title",
            "wordCount": "textCount"
        },
        "ruleToc": {
            "chapterList": "@js:\nvar util = objParse(String(java.get(\"util\")))\n\nfunction objParse(obj) {\n    return JSON.parse(obj, (n, v) => {\n        if (typeof v == \"string\" && v.match(\"()\")) {\n            return eval(`(${v})`)\n        }\n        return v;\n    })\n}\n\nfunction urlNovel(novelId){\n    if (util.settings.SHOW_ORIGINAL_LINK) {\n        return urlNovelUrl(novelId)\n    } else {\n        return urlNovelDetailed(novelId)\n    }\n}\n\nfunction oneShotHandler(res) {\n    res.textCount = res.userNovels[`${res.id}`].textCount\n    res.createDate = timeTextFormat(res.createDate)\n    return [{\n        title: res.title.trim(),\n        chapterUrl: urlIP(urlNovel(res.id)),\n        chapterInfo: `${res.createDate}ã€€ã€€${res.textCount}å­—`\n    }]\n}\n\nfunction seriesHandler(res) {\n    const limit = 30\n    let returnList = [], novelIds = []\n    let seriesID = res.id, allChaptersCount = res.total\n    util.debugFunc(() => {\n        java.log(`æœ¬ç³»åˆ— ${seriesID} ä¸€å…±æœ‰${allChaptersCount}ç« `);\n    })\n\n    //å‘é€è¯·æ±‚è·å¾—ç›¸åº”æ•°é‡çš„ç›®å½•åˆ—è¡¨\n    function sendAjaxForGetChapters(lastIndex) {\n        resp = getAjaxJson(urlIP(urlSeriesNovels(seriesID, limit, lastIndex)), true)\n        res = resp.body.thumbnails.novel\n        // res = resp.body.page.seriesContents\n        res.forEach(v => {\n            v.title = v.title.trim()\n            v.chapterUrl = urlIP(urlNovel(v.id))\n            novelIds.push(v.id)\n            if (v.updateDate !== undefined) {\n                v.updateDate = timeTextFormat(v.createDate)\n                v.chapterInfo = `${v.updateDate}ã€€ã€€${v.textCount}å­—`\n            } else {\n                v.updateDate = java.timeFormat(v.uploadTimestamp)\n                v.chapterInfo = `${v.updateDate}ã€€ã€€${v.textLength}å­—`\n            }\n            util.debugFunc(() => {\n                java.log(`${v.title}`)\n            })\n        })\n        return res;\n    }\n\n    if (!util.settings.SHOW_UPDATE_TIME) {\n        returnList = getAjaxJson(urlIP(urlSeriesNovelsTitles(seriesID)), true).body\n        returnList.forEach(v => {\n            v.title = v.title.trim()\n            v.chapterUrl = urlIP(urlNovel(v.id))\n            novelIds.push(v.id)\n        })\n    } else {\n        //é€»è¾‘æ§åˆ¶è€… ä¹Ÿå°±æ˜¯ä½¿ç”¨ä¸Šé¢å®šä¹‰çš„ä¸¤ä¸ªå‡½æ•°æ¥åšå¯¹åº”åŠŸèƒ½\n        //è¦çˆ¬å–çš„æ€»æ¬¡æ•°\n        let max = Math.ceil(allChaptersCount / limit)\n        for (let i = 0; i < max; i++) {\n            //java.log(\"içš„å€¼:\"+i)\n            let list = sendAjaxForGetChapters(i * limit);\n            //å–å‡ºæ¯ä¸ªå€¼\n            returnList = returnList.concat(list)\n        }\n    }\n    // æ”¾å…¥å°è¯´ä¿¡æ¯ä»¥ä¾¿ç™»é™†ç•Œé¢ä½¿ç”¨\n    let novel = source.getLoginInfoMap()\n    if (novel === undefined) novel = getFromCacheObject(\"novel\")\n    novel.novelIds = novelIds\n    putInCacheObject(`novelIds${seriesID}`, novelIds, cacheSaveSeconds)\n    // java.log(JSON.stringify(returnList))\n    source.putLoginInfo(JSON.stringify(novel))\n    putInCacheObject(\"novel\", novel)\n    return returnList\n}\n\n(function (res) {\n    res = util.getNovelResSeries(result)\n    if (res.firstNovelId === undefined || res.seriesNavData === null) {\n        return oneShotHandler(res)\n    } else {\n        return seriesHandler(res)\n    }\n})()",
            "chapterName": "title",
            "chapterUrl": "chapterUrl",
            "isPay": "",
            "isVip": "",
            "updateTime": "chapterInfo"
        },
        "searchUrl": "@js:\njava.put(\"key\", key)\njava.put(\"page\", page)\nlet keyword = key.split(\" \")\nlet limitedTextCount\nif (key.includes(\"å­—æ•°\") || key.includes(\"å­—æ•¸\") ) {\n    limitedTextCount = keyword.pop()\n    keyword = keyword.join(\" \")\n} else {\n    limitedTextCount = \"\"\n    keyword = key\n}\njava.put(\"keyword\", keyword)\njava.put(\"limitedTextCount\", limitedTextCount)\n\nif (keyword.startsWith(\"@\") || keyword.startsWith(\"ï¼ \")) {\n    keyword = keyword.slice(1)\n    if (keyword.includes(\"#\") || keyword.includes(\"ï¼ƒ\")) {\n        let author = keyword.split(\" \")[0]\n        let tags = keyword.replace(author, \"\").trim().slice(1)\n        java.put(\"keyword\", `@${author}`)\n        java.put(\"inputTags\", tags)\n        java.log(`ğŸ‘¤ æœç´¢ä½œè€…ï¼š${author} #ï¸âƒ£ è¿‡æ»¤æ ‡ç­¾ï¼š${tags.replace(\" \", \"ã€\")}`)\n    } else {\n        java.put(\"keyword\", `@${keyword}`)\n        java.log(`ğŸ‘¤ æœç´¢ä½œè€…ï¼š${keyword}`)\n    }\n\n} else if (keyword.startsWith(\"#\") || keyword.startsWith(\"ï¼ƒ\")) {\n    keyword = keyword.slice(1)\n    java.log(`#ï¸âƒ£ æœç´¢æ ‡ç­¾ï¼š${keyword}`)\n    java.put(\"keyword\", `#${keyword}`)\n\n} else {\n    java.log(`ğŸ” æœç´¢å†…å®¹ï¼š${keyword}`)\n}\nurlIP(urlSearchSeries(keyword, page))",
        "variableComment": "âš™ï¸ ä¹¦æºè®¾ç½®ï¼š\n1ï¸âƒ£ ä¹¦æ¶ - é˜…è¯»ç•Œé¢ - Pixiv å°è¯´ - ç™»å½•\n2ï¸âƒ£ æˆ‘çš„ - ä¹¦æºç®¡ç† - Pixiv å°è¯´ - ç™»å½•\nç‚¹å‡»ã€ğŸ‘€ ä¹¦æºè®¾ç½®ã€‘ã€ğŸ‘€ å‘ç°è®¾ç½®ã€‘æ˜¾ç¤ºç›¸å…³è®¾ç½®æŒ‰é’®\n\nâ–¶ï¸ è‡ªå®šåŠŸèƒ½ï¼š\nå°è¯´ä¹¦æ¶ - é˜…è¯»ç•Œé¢ - Pixiv å°è¯´ - ç™»å½•\n\nğŸ’¬ å‘é€è¯„è®ºï¼š\n1ï¸âƒ£ æ–‡æœ¬æ¡†å†… è¾“å…¥å†…å®¹ï¼Œç‚¹å‡»ã€âœ… å‘é€è¯„è®ºã€‘\n\nğŸš« å±è”½æ ‡ç­¾/æè¿°(æœ¬åœ°)ï¼š\n1ï¸âƒ£ ç‚¹å‡»ã€ğŸ‘€ æŸ¥çœ‹å±è”½ã€‘ï¼Œåˆ‡æ¢è‡³å±è”½åˆ—è¡¨\n2ï¸âƒ£ æ–‡æœ¬æ¡†å†… è¾“å…¥å†…å®¹ï¼Œç‚¹å‡»ã€ğŸš« åŠ å…¥å±è”½ã€‘\n\nğŸ“Œ å–œæ¬¢æ ‡ç­¾(æœ¬åœ°)ï¼š\n1ï¸âƒ£ æ–‡æœ¬æ¡†å†… è¾“å…¥æ ‡ç­¾ï¼Œç‚¹å‡»ã€ğŸ“Œ å–œæ¬¢æ ‡ç­¾ã€‘\n\nâ¤ï¸ å…³æ³¨ ä»–äººæ”¶è—(æœ¬åœ°)ï¼š\n1ï¸âƒ£ æ–‡æœ¬æ¡†å†… è¾“å…¥ä½œè€…IDï¼Œç‚¹å‡»ã€â¤ï¸ ä»–äººæ”¶è—ã€‘\n\n",
        "weight": 0
    },
    {
        "bookSourceComment": "ğŸ…¿ï¸ Pixiv æ¼«ç”»ï¼ˆæ›´æ–°ğŸ“†ï¼š2026/02/22ï¼‰\n\nä¹¦æºç‰ˆæœ¬ï¼š262\nä½¿ç”¨è¯´æ˜ï¼šğŸ“Œé˜…è¯» Plus 3.26.0129 ç‰ˆæœ¬å¯ç”¨\nå¯ç”¨åŠŸèƒ½ï¼šâœ…æœç´¢âœ…å‘ç°âœ…æ·»åŠ ç½‘å€âœ…è®¢é˜…æº\næœç´¢æ’ç”»ï¼šâœ…æ’ç”»âœ…æ¼«ç”»âœ…åŠ¨å›¾âœ…æ ‡ç­¾\nå‘ç°æ¼«ç”»ï¼šâœ…å…³æ³¨âœ…è¿½æ›´âœ…æ¨èâœ…å‘ç°âœ…æ”¶è—\næ·»åŠ ç½‘å€ï¼šâœ…æ’ç”»é“¾æ¥âœ…æ¼«ç”»ç›®å½•\nè®¢é˜…ç”¨æ³•ï¼šç‚¹å‡»è®¢é˜…æºæ‰“å¼€æ’ç”»/æ¼«ç”»ç›®å½•ï¼Œã€åˆ·æ–°ã€‘ï¼Œç‚¹å‡»ã€åŠ å…¥ä¹¦æ¶ã€‘æŒ‰é’®ï¼Œæ·»åŠ åˆ°ä¹¦æ¶\n\nä¹¦æºå‘å¸ƒï¼šPixiv ä¹¦æºé¢‘é“ https://t.me/PixivSource\né¡¹ç›®åœ°å€ï¼šhttps://github.com/DowneyRem/PixivSource\nä½¿ç”¨æ•™ç¨‹ï¼šhttps://pixivsource.pages.dev/Pixiv\n\næ—§ç‰ˆä¹¦æºï¼š\nhttps://cdn.jsdelivr.net/gh/DowneyRem/PixivSource@191/pixiv.json\nhttps://raw.githubusercontent.com/DowneyRem/PixivSource/191/pixiv.json\n\nè§„åˆ™è®¢é˜…ï¼šimport è®¢é˜…æº\nhttps://cdn.jsdelivr.net/gh/DowneyRem/PixivSource@main/import.json\nhttps://raw.githubusercontent.com/DowneyRem/PixivSource/main/import.json\n\nâš™ï¸ ä¹¦æºè®¾ç½®ï¼š\nè®¾ç½®1ï¸âƒ£ï¼šæ‰“å¼€å°è¯´ - èœå• - ç™»å½• - ç‚¹å‡»ä¸‹æ–¹æŒ‰é’®\nè®¾ç½®2ï¸âƒ£ï¼šç¼–è¾‘ä¹¦æº - åŸºæœ¬ - å˜é‡è¯´æ˜ - ä¿®æ”¹å¹¶ä¿å­˜",
        "bookSourceGroup": "ğŸ” Pixiv æ¼«ç”»",
        "bookSourceName": "ğŸ…¿ï¸ Pixiv æ¼«ç”»",
        "bookSourceType": 2,
        "bookSourceUrl": "https://www.pixiv.net/manga",
        "bookUrlPattern": "(https?://)?(www\\.)?pixiv\\.net/((artworks|user/\\d+/series)|ajax/(illust|series))/\\d+",
        "concurrentRate": "30/5000",
        "customButton": false,
        "customOrder": 2,
        "enabled": false,
        "enabledCookieJar": true,
        "enabledExplore": true,
        "eventListener": false,
        "exploreUrl": "@js:\nlet SHOW_GENERAL_NEW, SHOW_GENERAL_RANK\ntry {\n    settings = JSON.parse(String(source.variableComment).match(RegExp(/{([\\s\\S]*?)}/gm)))\n    SHOW_GENERAL_NEW = settings.SHOW_GENERAL_NEW     // å‘ç°ï¼šæœ€æ–°ã€ä¼åˆ’ã€çº¦ç¨¿æ˜¾ç¤ºä¸€èˆ¬å°è¯´\n} catch (e) {\n    SHOW_GENERAL_NEW = false\n}\n\nli = [\n    {\"â­ï¸ å…³æ³¨\": \"https://www.pixiv.net/ajax/follow_latest/illust?p={{page}}&mode=all&lang=zh\"},\n    {\"ğŸ“ƒ è¿½æ›´\": \"https://www.pixiv.net/ajax/watch_list/manga?p={{page}}&new=1&lang=zh\"},\n    {\"ğŸ’¯ æ¨è\": \"https://www.pixiv.net/ajax/top/illust?mode=all&lang=zh\"},\n    {\"ğŸ” å‘ç°\": \"https://www.pixiv.net/ajax/illust/discovery?mode=all&lang=zh\"},\n    {\"â¤ï¸ æ”¶è—\": \"https://www.pixiv.net/ajax/user/{{cache.get(\\\"pixiv:uid\\\")}}/illusts/bookmarks?tag=&offset={{(page-1)*24}}&limit=24&rest=show&lang=zh\"},\n    {\"ãŠ™ï¸ æ”¶è—\": \"https://www.pixiv.net/ajax/user/{{cache.get(\\\"pixiv:uid\\\")}}/illusts/bookmarks?tag=&offset={{(page-1)*24}}&limit=24&rest=hide&lang=zh\"},\n    {\"ğŸ  é¦–é¡µ\": \"https://www.pixiv.net\"},\n    {\"ğŸ†™ æ›´æ–°\": \"https://cdn.jsdelivr.net/gh/DowneyRem/PixivSource@main/pixiv.json\"}\n]\n\nr18New = [\n    {\"ğŸ†• æœ€æ–° ä¼åˆ’ çº¦ç¨¿ ğŸ’°\": \"\"},\n    {\"ğŸ†• æœ€æ–°\": \"https://www.pixiv.net/ajax/illust/new?lastId=0&limit=20&type=manga&r18=true&lang=zh\"},\n    {\"ğŸ“‘ ä¼åˆ’\": \"https://www.pixiv.net/ajax/user_event/portal/artworks?mode=r18&p={{page}}&lang=zh\"},\n    {\"ğŸ’° çº¦ç¨¿\": \"https://www.pixiv.net/ajax/commission/page/request/complete/manga?mode=r18&p={{page}}&lang=zh\"},\n    {\"ğŸ” å‘ç°\": \"https://www.pixiv.net/ajax/illust/discovery?mode=r18&lang=zh\"},\n]\n\ngeneralNew = [\n    {\"âœ… æœ€æ–° ä¼åˆ’ çº¦ç¨¿ âœ…\": \"\"},\n    {\"æœ€æ–°\": \"https://www.pixiv.net/ajax/illust/new?lastId=0&limit=20&type=manga&lang=zh\"},\n    {\"ä¼åˆ’\": \"https://www.pixiv.net/ajax/user_event/portal/artworks?mode=all&p={{page}}&lang=zh\"},\n    {\"çº¦ç¨¿\": \"https://www.pixiv.net/ajax/commission/page/request/complete/manga?mode=all&p={{page}}&lang=zh\"},\n    {\"å‘ç°\": \"https://www.pixiv.net/ajax/illust/discovery?mode=all&lang=zh\"}\n]\n\nr18Rank = [\n    {\"ğŸ‘‘ æ’è¡Œæ¦œå• ğŸ‘‘\": \"\"},\n    {\"ä»Šæ—¥\": \"https://www.pixiv.net/ranking.php?mode=daily_r18&p={{page}}&format=json\"},\n    {\"æœ¬å‘¨\": \"https://www.pixiv.net/ranking.php?mode=weekly_r18&p={{page}}&format=json\"},\n    {\"R18G\": \"https://www.pixiv.net/ranking.php?mode=r18g&p={{page}}&format=json\"},\n    {\"ç”·æ€§\": \"https://www.pixiv.net/ranking.php?mode=male_r18&p={{page}}&format=json\"},\n    {\"å¥³æ€§\": \"https://www.pixiv.net/ranking.php?mode=female_r18&p={{page}}&format=json\"}\n]\n\ngeneralRank = [\n    {\"ğŸ† æ’è¡Œæ¦œå• ğŸ†\": \"\"},\n    {\"ä»Šæ—¥\": \"https://www.pixiv.net/ranking.php?mode=daily&p={{page}}&format=json\"},\n    {\"æœ¬å‘¨\": \"https://www.pixiv.net/ranking.php?mode=weekly&p={{page}}&format=json\"},\n    {\"æœ¬æœˆ\": \"https://www.pixiv.net/ranking.php?mode=monthly&p={{page}}&format=json\"},\n    {\"æ–°äºº\": \"https://www.pixiv.net/ranking.php?mode=rookie&p={{page}}&format=json\"},\n    {\"åŸåˆ›\": \"https://www.pixiv.net/ranking.php?mode=original&p={{page}}&format=json\"},\n    {\"A I \": \"https://www.pixiv.net/ranking.php?mode=original&p={{page}}&format=json\"},\n    {\"ç”·æ€§\": \"https://www.pixiv.net/ranking.php?mode=male&p={{page}}&format=json\"},\n    {\"å¥³æ€§\": \"https://www.pixiv.net/ranking.php?mode=female&p={{page}}&format=json\"},\n]\n\nlet source = [\n    {\"ğŸ“˜ ä¹¦æºç›¸å…³ ğŸ“˜\": \"\"},\n    {\"ğŸ  ä¸»é¡µ\": \"https://pixivsource.pages.dev\"},\n    {\"ğŸ”° æŒ‡å—\": \"https://pixivsource.pages.dev/Pixiv\"},\n    {\"ğŸ åé¦ˆ\": \"https://github.com/DowneyRem/PixivSource/issues\"},\n    {\"ğŸ’° æ‰“èµ\": \"https://pixivsource.pages.dev/Sponsor\"},\n]\n\nli = li.concat(r18New)\nif (SHOW_GENERAL_NEW) li = li.concat(generalNew)\nli = li.concat(r18Rank)\nif (SHOW_GENERAL_RANK) li = li.concat(generalRank)\nli = li.concat(source)\n\n// æ·»åŠ æ ¼å¼\nli.forEach(item => {\n    item.title = Object.keys(item)[0]\n    item.url = Object.values(item)[0]\n    if (item.url.includes(\"https://www.pixiv.net\")) item.url = urlIP(item.url)\n    delete item[Object.keys(item)[0]]\n    item.style = {}\n    item.style.layout_flexGrow = 1\n    item.style.layout_flexShrink = 1\n    item.style.layout_alignSelf = \"auto\"\n    item.style.layout_wrapBefore = \"false\"\n    if (item.url === \"\") {\n        item.style.layout_flexBasisPercent = 1\n    } else {\n        item.style.layout_flexBasisPercent = -1\n    }\n})\n\nJSON.stringify(li)",
        "header": "{\"Referer\":\"https://www.pixiv.net\"}",
        "jsLib": "var cacheSaveSeconds = 30*24*60*60  // é•¿æœŸç¼“å­˜ 30 å¤©\nvar cacheTempSeconds = 10*60*1000   // å†·å´æ—¶é—´ 10 åˆ†é’Ÿ\n\nfunction cacheGetAndSet(key, supplyFunc, requestUpdate) {\n    const {java, cache} = this\n    let timestamp = 0\n    let v = this.getFromCacheObject(key)\n    if (Array.isArray(v)) {\n        try {\n            timestamp = v[0].timestamp\n        } catch (e) {\n            timestamp = 0\n        }\n    } else if (v) {\n        timestamp = v.timestamp\n    }\n\n    const isExpired = v && (new Date().getTime() >= timestamp + cacheTempSeconds)\n    const isError = v && (v.error === true) && isExpired\n    requestUpdate = requestUpdate && isExpired\n\n    if (!v || requestUpdate || isError) {\n        v = supplyFunc()\n        let now = new Date().getTime()\n        // getAjaxJson getWebviewJson æ—¶é—´æˆ³å†™å…¥å¯¹è±¡æœ¬èº«\n        if (!Array.isArray(v)) {\n            v = Object.assign({timestamp: now}, v)\n        }\n        // else {\n        //     // getAjaxAllJson æ—¶é—´æˆ³å†™å…¥ç¬¬ä¸€ä¸ªå…ƒç´ ï¼ˆè¯»å–æ—¶ v[0].timestampï¼‰// ä¸é‡å¤å†™å…¥\n        //     if (v.length > 0) v[0] = Object.assign({timestamp: now}, v[0])\n        // }\n        this.putInCacheObject(key, v, cacheSaveSeconds)\n    }\n    return v\n}\n\nfunction putInCache(name, object, saveSeconds) {\n    const {java, cache} = this\n    if (saveSeconds === undefined) saveSeconds = 0\n    if (object) {\n        cache.put(name, object, saveSeconds)\n    }\n}\nfunction getFromCache(name) {\n    const {java, cache} = this\n    let object = cache.get(name)\n    if (object === undefined) return null  // å…¼å®¹æºé˜…\n    return object\n}\n\nfunction normalizeUrl(url) {\n    if (!url.startsWith(\"https://210.140\")) return url\n    return url.replace(\"210.140.139.155\", \"www.pixiv.net\")\n        .replace(\"210.140.139.133\", \"i.pximg.net\")\n        .split(\",\")[0]\n}\nfunction putInCacheObject(objectName, object, saveSeconds) {\n    const {java, cache} = this\n    if (object === undefined) object = null\n    if (saveSeconds === undefined) saveSeconds = 0\n    // if (objectName === \"pixivSettings\") {\n    //     this._settings = object\n    // }\n    cache.put(this.normalizeUrl(objectName), JSON.stringify(object), saveSeconds)\n}\nfunction getFromCacheObject(objectName) {\n    const {java, cache} = this\n    // if (objectName === \"pixivSettings\" && this._settings) {\n    //     return this._settings\n    // }\n    let object = cache.get(this.normalizeUrl(objectName))\n    if (object === undefined) return null  // å…¼å®¹æºé˜…ï¼Œé¿å… parse æŠ¥é”™\n    return JSON.parse(object)\n}\n\nfunction isHtmlString(str) {\n    return str.startsWith(\"<!DOCTYPE html>\")\n}\nfunction isJsonString(str) {\n    try {\n        if (typeof JSON.parse(str) === \"object\") return true\n    } catch(e) {}\n    return false\n}\n\nfunction isJsonString(str) {\n    try {\n        let result = JSON.parse(str)\n        return typeof result === \"object\" && result !== null\n    } catch(e) {\n        return false\n    }\n}\n\nfunction getAjaxJson(url, requestUpdate) {\n    const {java, cache} = this\n    return this.cacheGetAndSet(url, () => {\n        return JSON.parse(java.ajax(url))\n    }, requestUpdate)\n}\nfunction getAjaxAllJson(urls, requestUpdate) {\n    const {java, cache} = this\n    let batchKey = JSON.stringify(urls)\n    return this.cacheGetAndSet(batchKey, () => {\n        let results = []\n        let now = new Date().getTime()\n        let responses = java.ajaxAll(urls)\n        for (let i in urls) {\n            let data = JSON.parse(responses[i].body())\n            data = Object.assign({timestamp: now}, data)\n            results.push(data)\n            this.putInCacheObject(urls[i], data, cacheSaveSeconds)\n        }\n        return results\n    }, requestUpdate)\n}\nfunction getAjaxParseJson(url, parseFunc, requestUpdate) {\n    const {java, cache} = this\n    return this.cacheGetAndSet(url, () => {\n        let resp = parseFunc(java.ajax(url))\n        if (resp instanceof Object) return resp\n        else return JSON.parse(resp)\n    }, requestUpdate)\n}\nfunction getWebviewJson(url, parseFunc, requestUpdate) {\n    const {java, cache} = this\n    return this.cacheGetAndSet(url, () => {\n        let html = java.webView(null, url, null)\n        return JSON.parse(parseFunc(html))\n    }, requestUpdate)\n}\n\nfunction getWebViewUA() {\n    const {java, cache} = this\n    let userAgent = this.getFromCache(\"userAgent\")\n    if (userAgent) return String(userAgent)\n\n    userAgent = String(java.getWebViewUA())\n    if (userAgent.includes(\"Windows NT 10.0; Win64; x64\")) {\n        userAgent = \"Mozilla/5.0 (Linux; Android 10; K) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/119.0.0.0 Mobile Safari/537.36\"\n    }\n    // java.log(`userAgent=${userAgent}`)\n    this.putInCache(\"userAgent\", userAgent, cacheSaveSeconds/7)\n    return String(userAgent)\n}\nfunction startBrowser(url, title) {\n    const {java, cache} = this\n    if (!title) title = url\n    let msg = \"\"\n    let headers = {}\n    headers[\"User-Agent\"] = this.getWebViewUA()\n\n    if (url.includes(\"https://www.pixiv.net\")) {\n        if (url.includes(\"settings\")) msg += \"âš™ï¸ è´¦å·è®¾ç½®\"\n        else msg += \"â¤´ï¸ åˆ†äº«å°è¯´\"\n        msg += \"\\n\\nå³å°†æ‰“å¼€ Pixiv\\nè¯·ç¡®è®¤å·²å¼€å¯ä»£ç†/æ¢¯å­/VPNç­‰\"\n    } else if (url.includes(\"github.com\") || url.includes(\"github.io\")) {\n        if (url.includes(\"issues\")) msg += \"ğŸ åé¦ˆé—®é¢˜\"\n        msg += \"\\n\\nå³å°†æ‰“å¼€ Github\\nè¯·ç¡®è®¤å·²å¼€å¯ä»£ç†/æ¢¯å­/VPNç­‰\"\n    }\n    this.sleepToast(msg, 0.01)\n    java.startBrowser(`${url}, ${JSON.stringify({headers: headers})}`, title)\n}\n\n// ç›´è¿åŠŸèƒ½å‚è€ƒè‡ª æ´›å¨…æ©™çš„é˜…è¯»ä»“åº“\n// https://github.com/Luoyacheng/yuedu\n// å…¶ç›´è¿åŠŸèƒ½å‚è€ƒè‡ª PixEz Flutter\n// https://github.com/Notsfsssf/pixez-flutter\nfunction urlIP(url) {\n    const {java, cache} = this\n    let settings = this.getFromCacheObject(\"pixivIllustSettings\")\n    if (!settings) settings = this.setDefaultSettings()\n    if (settings.IPDirect) {\n        url = url.replace(\"http://\", \"https://\").replace(\"www.pixiv.net\", \"210.140.139.155\")\n        let headers = {\n            \"User-Agent\": \"Mozilla/5.0 (Linux; Android 14)\",\n            \"X-Requested-With\": \"XMLHttpRequest\",\n            \"Host\": \"www.pixiv.net\",\n            \"Referer\": \"https://www.pixiv.net/\",\n            \"X-csrf-token\": this.getFromCache(\"pixivCsrfToken\") || \"\",\n            \"Cookie\": this.getFromCache(\"pixivCookie\") || \"\"\n        }\n        return `${url}, ${JSON.stringify({headers: headers})}`\n    }\n    return url\n}\n\nfunction urlIllustUrl(illustId) {\n    return `https://www.pixiv.net/artworks/${illustId}`\n}\nfunction urlIllustDetailed(illustId) {\n    return `https://www.pixiv.net/ajax/illust/${illustId}?lang=zh`\n}\nfunction urlIllustsDetailed(userId, idList) {\n    return `https://www.pixiv.net/ajax/user/${userId}/illusts?${idList.map(v => \"ids[]=\" + v).join(\"&\")}`\n}\nfunction urlSeriesUrl(userId, seriesId) {\n    return `https://www.pixiv.net/user/${userId}/series/${seriesId}`\n}\nfunction urlSeriesDetailed(seriesId, page) {\n    if (page === undefined) page = 1\n    return `https://www.pixiv.net/ajax/series/${seriesId}?p=${page}&lang=zh`\n}\n\nfunction urlUserAllWorks(userId) {\n    return `https://www.pixiv.net/ajax/user/${userId}/profile/all?lang=zh`\n}\n\nfunction urlSearchArtwork(name, page) {\n    return `https://www.pixiv.net/ajax/search/artworks/${encodeURI(name)}?word=${encodeURI(name)}&order=date_d&mode=all&p=${page}&s_mode=s_tc&type=all&lang=zh`\n}\nfunction urlSearchIllust(name, page) {\n    return `https://www.pixiv.net/ajax/search/artworks/${encodeURI(name)}?word=${encodeURI(name)}&order=date_d&mode=all&p=${page}&s_mode=s_tc&type=illust&lang=zh`\n}\nfunction urlSearchManga(name, page) {\n    return `https://www.pixiv.net/ajax/search/artworks/${encodeURI(name)}?word=${encodeURI(name)}&order=date_d&mode=all&p=${page}&s_mode=s_tc&type=manga&lang=zh`\n}\nfunction urlSearchUgoira(name, page) {\n    return `https://www.pixiv.net/ajax/search/artworks/${encodeURI(name)}?word=${encodeURI(name)}&order=date_d&mode=all&p=${page}&s_mode=s_tc&type=ugoira&lang=zh`\n}\n// å®Œå…¨åŒ¹é…ç”¨æˆ·å\nfunction urlSearchUser(name) {\n    return `https://www.pixiv.net/search/users?nick=${encodeURI(name)}&s_mode=s_usr&nick_mf=1`\n}\n\n// ç›´è¿åŠŸèƒ½å‚è€ƒè‡ª æ´›å¨…æ©™çš„é˜…è¯»ä»“åº“\n// https://github.com/Luoyacheng/yuedu\n// å…¶ç›´è¿åŠŸèƒ½å‚è€ƒè‡ª PixEz Flutter\n// https://github.com/Notsfsssf/pixez-flutter\nfunction urlCoverUrl(url) {\n    const {java, cache} = this\n    if (url && !url.trim()) return \"\"\n\n    let settings = this.getFromCacheObject(\"pixivIllustSettings\")\n    if (!settings) settings = this.setDefaultSettings()\n    if (!settings.IPDirect) return url\n\n    let headers = {\"Referer\": \"https://www.pixiv.net/\"}\n    if (settings.IPDirect && url.trim()) {\n        if (url.includes(\"i.pximg.net\")) {\n            url = url.replace(\"https://i.pximg.net\", \"https://210.140.139.133\")\n            headers.host = \"i.pximg.net\"\n        } else {\n            url = url.replace(\"https://s.pximg.net\", \"https://210.140.139.133\")\n            headers.host = \"s.pximg.net\"\n        }\n    }\n    return `${url}, ${JSON.stringify({headers: headers})}`\n}\n\nfunction addZero(num) {\n    return String(num).padStart(2, '0')\n}\nfunction dateFormat(str) {\n    let time = new Date(str);\n    let Y = time.getFullYear() + \"å¹´\";\n    let M = this.addZero(time.getMonth() + 1) + \"æœˆ\";\n    let D = this.addZero(time.getDate()) + \"æ—¥\";\n    return Y + M + D;\n}\nfunction timeFormat(str) {\n    let time = new Date(str);\n    let YY = time.getFullYear()\n    let MM = this.addZero(time.getMonth() + 1)\n    let DD = this.addZero(time.getDate())\n    let hh = this.addZero(time.getHours())\n    let mm = this.addZero(time.getMinutes())\n    let ss = this.addZero(time.getSeconds())\n    return `${YY}-${MM}-${DD} ${hh}:${mm}:${ss}`\n}\nfunction timeTextFormat(text) {\n    return `${text.slice(0, 10)} ${text.slice(11, 19)}`\n}\n\nfunction sleep(seconds) {\n    return Packages.java.lang.Thread.sleep(1000*seconds)\n}\nfunction sleepToast(text, seconds) {\n    let {java} = this\n    java.log(text)\n    java.longToast(text)\n    if (seconds === undefined) {seconds = 0.01}\n    this.sleep(seconds)\n}\n\nfunction setDefaultSettings() {\n    const {java, cache} = this\n    let settings = {}\n    settings.CONVERT_CHINESE = true     // æœç´¢ï¼šæœç´¢æ—¶è¿›è¡Œç¹ç®€è½¬æ¢\n    settings.SHOW_ORIGINAL_LINK = true  // ç›®å½•ï¼šæ˜¾ç¤ºæºé“¾æ¥\n    settings.QUALITY_REGULAR = true     // æ­£æ–‡ï¼šå›¾ç‰‡è´¨é‡ï¼Œregular æˆ– original\n\n    settings.IPDirect = false           // å…¨å±€ï¼šç›´è¿æ¨¡å¼\n    settings.DEBUG = false              // å…¨å±€ï¼šè°ƒè¯•æ¨¡å¼\n\n    this.putInCacheObject(\"pixivIllustSettings\", settings)\n    return settings\n}\nfunction checkSettings() {\n    const {java, cache} = this\n    let settings = this.getFromCacheObject(\"pixivIllustSettings\")\n    if (!settings) settings = this.setDefaultSettings()\n    if (settings.IPDirect) {\n        settings.SEARCH_AUTHOR = false       // æœç´¢ï¼šé»˜è®¤å…³é—­æœç´¢ä½œè€…åç§°\n        settings.SHOW_ORIGINAL_LINK = false  // ç›®å½•ï¼šä¸æ˜¾ç¤ºç« èŠ‚æºé“¾æ¥\n    }\n    this.putInCacheObject(\"pixivIllustSettings\", settings)\n    return settings\n}\n\nfunction updateSource() {\n    const {java, source} = this\n    java.longToast(\"ğŸ†™ æ›´æ–°ä¹¦æº\\n\\nJsdelivr CDN æ›´æ–°æœ‰å»¶è¿Ÿ\\nGithub æ›´æ–°éœ€ä»£ç†\")\n    let onlineSource, comment, sourceName, sourceNameCapitalize, index = 0\n    if (source.bookSourceUrl.includes(\"pixiv\")) sourceName = \"pixiv\"\n    else if (source.bookSourceUrl.includes(\"furrynovel\")) sourceName = \"linpx\"\n    sourceNameCapitalize = sourceName[0].toUpperCase() + sourceName.substring(1)\n\n    if (source.bookSourceName.includes(\"å¤‡ç”¨\")) index = 1\n    else if (source.bookSourceName.includes(\"æ¼«ç”»\")) index = 2\n    if (source.bookSourceUrl.includes(\"furrynovel.com\")) {\n        sourceNameCapitalize = \"FurryNovel\"\n        index = 1\n    }\n\n    try {\n        let updateUrl = `https://cdn.jsdelivr.net/gh/DowneyRem/PixivSource@main/${sourceName}.json`\n        onlineSource = JSON.parse(java.get(updateUrl,{'User-Agent': 'Mozilla/5.0 (Linux; Android 14)','X-Requested-With': 'XMLHttpRequest'}).body())[index]\n        comment = onlineSource.bookSourceComment.split(\"\\n\")\n    } catch (e) {\n        try {\n            let updateUrl = `https://raw.githubusercontent.com/DowneyRem/PixivSource/main/${sourceName}.json`\n            onlineSource = JSON.parse(java.get(updateUrl,{'User-Agent': 'Mozilla/5.0 (Linux; Android 14)','X-Requested-With': 'XMLHttpRequest'}).body())[index]\n            comment = onlineSource.bookSourceComment.split(\"\\n\")\n        } catch (e) {\n            onlineSource = {lastUpdateTime: new Date().getTime()}\n            comment = source.bookSourceComment.split(\"\\n\")\n        }\n    }\n    comment = onlineSource.bookSourceComment.split(\"\\n\")\n    // onlineSource = source\n    // comment = source.bookSourceComment.split(\"\\n\")\n\n    let htm = `\n<!DOCTYPE html>\n<html lang=\"zh-CN\">\n<head>\n    <meta charset=\"UTF-8\">\n    <meta name=\"viewport\" content=\"width=device-width, initial-scale=1.0\">\n    <title>æ›´æ–° ${source.bookSourceName} ä¹¦æº</title>\n    <style> \n    table { text-align: center; margin: 0 auto; } .ann { display: flex; justify-content: center; align-items: center; height: 5vh; } \n    button { background-color: rgb(76, 175, 80); color: white; border: none; border-radius: 4px; height: 6vh; width: 30vw; overflow: hidden; } \n    button span { cursor: pointer; display: inline-block; position: relative; transition: 0.4s; } \n    button span:after { content: '>'; position: absolute; opacity: 0; top: 0; right: 30px; transition: 0.2s; } \n    button:active span { padding-right: 20px; } \n    button:active span:after { opacity: 1; right: -40px; }\n    </style>\n</head>\n\n<body>\n    <table border=\"1\" cellspacing=\"0\">\n        <th colspan=\"2\"> ${source.bookSourceName} ä¹¦æº \n        <a href=\"https://pixivsource.pages.dev/FurryNovel\">ğŸ”° ä½¿ç”¨æŒ‡å—</a>\n        || <a href=\"https://pixivsource.pages.dev/Sponsor\">â¤ï¸ èµåŠ©å¼€å‘</a>\n        </th>\n        <tr>\n            <td>â˜ï¸ è¿œç¨‹ç‰ˆæœ¬ï¼š${onlineSource.bookSourceComment.split(\"\\n\")[2].replace(\"ä¹¦æºç‰ˆæœ¬ï¼š\", \"\")}</td>\n            <td>ğŸ“† æ›´æ–°ï¼š${timeFormat(onlineSource.lastUpdateTime)}</td>\n        </tr>\n        <tr>\n            <td>ğŸ“¥ æœ¬åœ°ç‰ˆæœ¬ï¼š${source.bookSourceComment.split(\"\\n\")[2].replace(\"ä¹¦æºç‰ˆæœ¬ï¼š\", \"\")}</td>\n            <td>ğŸ“† æ›´æ–°ï¼š${timeFormat(source.lastUpdateTime)}</td>\n        </tr> \n        <tr><td colspan=\"2\" style=\"text-align: left;\">${comment.slice(3, 9).join(\"<br>\")}</td></tr>\n        <tr><td colspan=\"2\" style=\"text-align: left;\">${comment.slice(comment.length-3, comment.length).join(\"<br>\")}</td></tr>\n    </table>\n    \n    <table border=\"0\" cellspacing=\"20\">\n        <th colspan=\"2\"> æ›´æ–° ${source.bookSourceName} ä¹¦æº </th>\n        <tr><td><div class=\"ann\">\n            <a href=\"legado://import/importonline?src=https://cdn.jsdelivr.net/gh/DowneyRem/PixivSource@main/${sourceName}.json\">\n            <button><span>æ›´æ–°ä¹¦æº<br>(Jsdelivr CDN)</span></button>\n            </a></div></td>\n            \n            <td><div class=\"ann\">\n            <a href=\"legado://import/importonline?src=https://cdn.jsdelivr.net/gh/DowneyRem/PixivSource@main/btsrk.json\">\n            <button><span>æ›´æ–°è®¢é˜…<br>(Jsdelivr CDN)</span></button>\n            </a></div></td>\n        </tr>\n        \n        <tr><td><div class=\"ann\">\n            <a href=\"legado://import/importonline?src=https://raw.githubusercontent.com/DowneyRem/PixivSource/main/${sourceName}.json\">\n            <button><span>ä¹¦æºé“¾æ¥<br>(GitHub)</span></button>\n            </a></div></td>\n            \n            <td><div class=\"ann\">\n            <a href=\"legado://import/importonline?src=https://raw.githubusercontent.com/DowneyRem/PixivSource/main/btsrk.json\">\n            <button><span>è®¢é˜…é“¾æ¥<br>(GitHub)</span></button>\n            </a></div></td>\n        </tr>\n        \n        <tr><td><div class=\"ann\">\n            <a href=\"legado://import/importonline?src=https://codeberg.org/DowneyRem/PixivSource/raw/branch/main/${sourceName}.json\">\n            <button><span>å¤‡ç”¨ä¹¦æºé“¾æ¥<br>(Codeberg)</span></button>\n            </a></div></td>\n            \n            <td><div class=\"ann\">\n            <a href=\"legado://import/importonline?src=https://codeberg.org/DowneyRem/PixivSource/raw/branch/main/btsrk.json\">\n            <button><span>å¤‡ç”¨è®¢é˜…é“¾æ¥<br>(Codeberg)</span></button>\n            </a></div></td>\n        </tr>\n    </table>\n</body>\n</html>`\n    java.startBrowser(`data:text/html;charset=utf-8;base64, ${java.base64Encode(htm)}`, 'æ›´æ–°ä¹¦æº')\n    return []\n}",
        "lastUpdateTime": 1771689600251,
        "loginCheckJs": "var util = {}\n\nfunction objStringify(obj) {\n    return JSON.stringify(obj, (n, v) => {\n        if (typeof v == \"function\")\n            return v.toString();\n        return v;\n    });\n}\n\n// æ£€æµ‹ æºé˜…\n// å¯ç”¨ java.ajax() ä¸å¯ç”¨ java.webview() java.ajaxAll()\n// å¯ç”¨ java.getCookie() cache.put() cache.get() é»˜è®¤å€¼ä¸º undefined\n// å¯ç”¨ java.startBrowser() ä¸å¯ç”¨ java.startBrowserAwaitAwait\n// å¯ç”¨ source.bookSourceName source.getVariable() source.setVariable()ç­‰\n// java.getUserAgent() java.getWebViewUA() ç›®å‰è¿”å›å†…å®¹ç›¸åŒ\nfunction isSourceRead() {\n    return java.getUserAgent() === java.getWebViewUA()\n}\n// æ­£å¼ç‰ˆ ä¸æ”¯æŒåœ¨ JSlib çš„å‡½æ•°ç›´æ¥è®¾ç½®é»˜è®¤å‚æ•°\n// æ­£å¼ç‰ˆ ä¸æ”¯æŒ a?.b çš„å†™æ³•\n// æ£€æµ‹ é˜…è¯» æ­£å¼ç‰ˆ ä¸ Beta ç‰ˆæœ¬\nfunction isLegadoOfficial() {\n    let isLegadoOfficialStatus\n    try {\n        eval('({})?.value')\n        isLegadoOfficialStatus = false\n    } catch (e) {\n        isLegadoOfficialStatus = true\n    }\n    return isLegadoOfficialStatus\n}\n// æ£€æµ‹ é˜…è¯» Beta ç‰ˆæœ¬ ä¸ LYC ç‰ˆæœ¬\n// LYC ç‰ˆæœ¬æ–°å¢å‡½æ•°\n// java.ajaxTestAll()\n// java.openVideoPlayer(url: String, title: String, float: Boolean)\n// cookie.setWebCookie(url,cookie)\n// source.refreshExplore()\n// source.refreshJSLib()\nfunction isLegadoLYC() {\n    return typeof java.ajaxTestAll === \"function\"\n}\n\nfunction publicFunc() {\n    let u = {}, settings = {}\n    // è¾“å‡ºä¹¦æºä¿¡æ¯\n    java.log(`${source.bookSourceComment.split(\"\\n\")[0]}`)\n    java.log(`ğŸ“Œ ${source.bookSourceComment.split(\"\\n\")[2]}`)\n    java.log(`ğŸ“† æ›´æ–°æ—¶é—´ï¼š${java.timeFormat(source.lastUpdateTime)}`)\n\n    if (isSourceRead()) {\n        java.log(\"ğŸ“± è½¯ä»¶å¹³å°ï¼šğŸ æºé˜… SourceRead\")\n    } else if (isLegadoOfficial()) {\n        java.log(\"ğŸ“± è½¯ä»¶å¹³å°ï¼šğŸ¤– é˜…è¯» æ­£å¼ç‰ˆ\")\n        sleepToast(\"\\nâš ï¸å½“å‰è½¯ä»¶ä¸ºï¼šé˜…è¯»ã€æ­£å¼ç‰ˆã€‘\\nã€æ­£å¼ç‰ˆã€‘å·²å¹´ä¹…å¤±ä¿®ï¼Œä¸æ¨èç»§ç»­ä½¿ç”¨\\n\\nä¸ºäº†æ›´å¥½çš„ä½¿ç”¨ä½“éªŒï¼Œè¯·ç”¨ï¼š\\nã€é˜…è¯» Plusã€‘æˆ–ã€é˜…è¯» Beta æ–°åŒ…åã€‘\\n\\nå³å°†ä¸ºæ‚¨æ‰“å¼€ã€é˜…è¯» Plusã€‘ä¸‹è½½ç•Œé¢\")\n        sleep(3); startBrowser(\"https://loyc.xyz/c/legado.html#download\", \"ä¸‹è½½é˜…è¯» Plus\")\n\n    } else {\n        if (isLegadoLYC()) {\n            java.log(\"ğŸ“± è½¯ä»¶å¹³å°ï¼šğŸ¤– é˜…è¯» Betaã€æ–°åŒ…åã€‘/ é˜…è¯» Plus\")\n        } else {\n            java.log(\"ğŸ“± è½¯ä»¶å¹³å°ï¼šğŸ¤– é˜…è¯» Betaã€åŸåŒ…åã€‘\")\n            sleepToast(\"\\nâš ï¸å½“å‰è½¯ä»¶ä¸ºï¼šé˜…è¯» Betaã€åŸåŒ…åã€‘\\n\\nä¸ºäº†æ›´å¥½çš„ä½¿ç”¨ä½“éªŒï¼Œè¯·ç”¨ï¼š\\nã€é˜…è¯» Plusã€‘æˆ–ã€é˜…è¯» Beta æ–°åŒ…åã€‘\\n\\nå³å°†ä¸ºæ‚¨æ‰“å¼€ã€é˜…è¯» Plusã€‘ä¸‹è½½ç•Œé¢\")\n            sleep(3); startBrowser(\"https://loyc.xyz/c/legado.html#download\", \"ä¸‹è½½é˜…è¯» Plus\")\n        }\n    }\n\n    // è®¾ç½®åˆå§‹åŒ–\n    // cache.delete(\"pixivIllustSettings\")\n    settings = getFromCacheObject(\"pixivIllustSettings\")\n    if (settings) {\n        java.log(\"âš™ï¸ ä½¿ç”¨è‡ªå®šä¹‰è®¾ç½®\")\n    } else {\n        java.log(\"âš™ï¸ ä½¿ç”¨é»˜è®¤è®¾ç½®\")\n        settings = setDefaultSettings()\n    }\n    settings = checkSettings()\n    if (settings.IPDirect) {\n        java.log(\"âœˆï¸ ç›´è¿æ¨¡å¼ï¼šâœ… å·²å¼€å¯\")\n    } else {\n        java.log(\"âœˆï¸ ç›´è¿æ¨¡å¼ï¼šâŒ å·²å…³é—­\")\n    }\n    u.settings = settings\n    putInCacheObject(\"pixivIllustSettings\", settings)  // è®¾ç½®å†™å…¥ç¼“å­˜\n\n    u.environment = {}\n    u.environment.IS_SOURCEREAD = isSourceRead()\n    u.environment.IS_LEGADO = !isSourceRead()\n    u.environment.IS_LYC_BRUNCH = isLegadoLYC()\n    putInCacheObject(\"pixivEnvironment\", u.environment)  // è®¾ç½®å†™å…¥ç¼“å­˜\n\n    u.debugFunc = (func) => {\n        if (util.settings.DEBUG === true) {\n            func()\n        }\n    }\n\n    u.checkStatus = function(status) {\n        if (status === true) return \"âœ… å·²\"\n        else if (status === false) return \"âŒ æœª\"\n        else if (status === undefined) return \"ğŸˆšï¸ æ— æ•°æ®ï¼š\"\n    }\n\n    u.login = function() {\n        let resp = java.startBrowserAwait(`https://accounts.pixiv.net/login,\n    {\"headers\": {\"User-Agent\": \"${java.getWebViewUA()}\"}}`, 'ç™»å½•è´¦å·', false)\n        if (resp.code() === 200) {\n            this.getCsrfToken(); this.getCookie()\n        } else {\n            java.log(resp.code()); sleepToast(\"âš ï¸ ç™»å½•å¤±è´¥\")\n        }\n    }\n\n    u.logout = function() {\n        this.removeCookie()\n        java.startBrowser(\"https://www.pixiv.net/logout.php\", \"é€€å‡ºè´¦å·\")\n        this.removeCookie()\n        sleepToast(`âœ… å·²é€€å‡ºå½“å‰è´¦å·\\n\\né€€å‡ºåè¯·ç‚¹å‡»å³ä¸Šè§’çš„ âœ”ï¸ é€€å‡º\\n\\nç™»å½•è¯·ç‚¹å‡»ã€ç™»å½•è´¦å·ã€‘è¿›è¡Œç™»å½•`)\n    }\n\n    u.getCookie = function() {\n        let pixivCookie = String(java.getCookie(\"https://www.pixiv.net/\", null))\n        if (isLogin()) putInCache(\"pixivCookie\", pixivCookie, 60*60)  // ç¼“å­˜1h\n    }\n\n    u.removeCookie = function() {\n        cookie.removeCookie('https://www.pixiv.net')\n        cookie.removeCookie('https://accounts.pixiv.net')\n        cookie.removeCookie('https://accounts.google.com')\n        cookie.removeCookie('https://api.weibo.com')\n        cache.delete(\"pixivCookie\")\n        cache.delete(\"pixiv:uid\")\n        cache.delete(\"pixivCsrfToken\")  // ä¸ç™»å½•è®¾å¤‡æœ‰å…³\n        cache.delete(\"headers\")\n    }\n\n    // è·å– Csrf Tokenï¼Œä»¥ä¾¿è¿›è¡Œæ”¶è—ç­‰è¯·æ±‚\n    // è·å–æ–¹æ³•æ¥è‡ªè„šæœ¬ Pixiv Previewer\n    // https://github.com/Ocrosoft/PixivPreviewer\n    // https://greasyfork.org/zh-CN/scripts/30766-pixiv-previewer/code\n    u.getCsrfToken = function() {\n        let pixivCsrfToken = getFromCache(\"pixivCsrfToken\")\n        if (!pixivCsrfToken) {\n            let html = java.webView(null, \"https://www.pixiv.net/\", null)\n            try {\n                pixivCsrfToken = html.match(/token\\\\\":\\\\\"([a-z0-9]{32})/)[1]\n                putInCache(\"pixivCsrfToken\", pixivCsrfToken)  // ä¸ç™»å½•è®¾å¤‡æœ‰å…³ï¼Œæ— æ³•å­˜å‚¨ nul\n            } catch (e) {\n                pixivCsrfToken = null\n                cache.delete(\"pixivCsrfToken\")  // ä¸ç™»å½•è®¾å¤‡æœ‰å…³ï¼Œæ— æ³•å­˜å‚¨ nul\n                // sleepToast(\"âš ï¸ æœªç™»å½•è´¦å·(pixivCsrfToken)\")\n            }\n            java.log(`pixivCsrfToken:\\n${pixivCsrfToken}`)\n        }\n        return pixivCsrfToken\n    }\n\n    u.handIllusts = function (illusts) {\n        illusts.forEach(illust => {\n            // illust.id = illust.id\n            // illust.title = illust.title\n            // illust.userName = illust.userName\n            // illust.tags = illust.tags\n            if (!(illust.tags instanceof Array)) {\n                illust.tags = illust.tags.tags.map(item => item.tag)\n                illust.coverUrl = illust.url = illust.urls.regular  // å…¼å®¹æ­£æ–‡æœç´¢\n                illust.updateDate = illust.uploadDate\n            }\n            illust.textCount = null\n            // illust.pageCount = illust.pageCount\n            // illust.description = illust.description\n            illust.coverUrl = illust.url\n            illust.detailedUrl = urlIP(urlIllustDetailed(illust.id))\n            // illust.createDate = illust.createDate\n            // illust.updateDate = illust.updateDate\n            // illust.aiType = illust.aiType\n\n            if (illust.seriesNavData === undefined || illust.seriesNavData === null) {\n                illust.latestChapter = illust.title\n            } else {\n                illust.seriesId = illust.seriesNavData.seriesId\n                illust.title = illust.seriesNavData.title\n            }\n\n            if (illust.seriesId !== undefined) {\n                let resp = getAjaxJson(urlIP(urlSeriesDetailed(illust.seriesId))).body\n                let series = resp.illustSeries.filter(item => item.id === illust.seriesId)[0]\n                // illust.title = illust.title\n                illust.tags = illust.tags.concat(series.tags)\n                illust.latestChapter = resp.thumbnails.illust.filter(item => item.id === series.latestIllustId)[0].title\n                illust.description = series.description\n                if (series.url === undefined) {\n                    let firstChapter = getAjaxJson(urlIP(urlIllustDetailed(series.firstIllustId))).body\n                    illust.coverUrl = firstChapter.urls.regular\n                    illust.tags = illust.tags.concat(firstChapter.tags.tags.map(item => item.tag))\n                }\n                illust.createDate = series.createDate\n                illust.updateDate = series.updateDate\n                illust.total = series.total\n            }\n        })\n        return illusts\n    }\n\n    u.formatIllusts = function (illusts) {\n        illusts.forEach(illust => {\n            illust.title = illust.title.trim()\n            if (!illust.userName.startsWith(\"@\")) illust.userName = `@${illust.userName}`\n            illust.tags = Array.from(new Set(illust.tags))\n            illust.tags = illust.tags.join(\",\")\n            illust.coverUrl = urlCoverUrl(illust.coverUrl)\n            illust.createDate = dateFormat(illust.createDate)\n            illust.updateDate = dateFormat(illust.updateDate)\n            if (util.MORE_INFORMATION) {\n                illust.description = `\\nä¹¦åï¼š${illust.title}\\nä½œè€…ï¼š${illust.userName}\\næ ‡ç­¾ï¼š${illust.tags}\\né¡µé¢ï¼š${illust.pageCount}\\nä¸Šä¼ ï¼š${illust.createDate}\\næ›´æ–°ï¼š${illust.updateDate}\\nç®€ä»‹ï¼š${illust.description}`\n            } else {\n                illust.description = `\\n${illust.title}ï¼Œå…±${illust.pageCount}é¡µ\\n${illust.description}\\nä¸Šä¼ æ—¶é—´ï¼š${illust.createDate}\\næ›´æ–°æ—¶é—´ï¼š${illust.updateDate}`\n            }\n        })\n        return illusts\n    }\n\n    u.getIllustRes = function (result) {\n        let illustId = 0, res = {}\n        let isJson = isJsonString(result)\n        let isHtml = result.startsWith(\"<!DOCTYPE html>\")\n        if (!isJson && isHtml) {\n            let pattern1 = \"(https?://)?(www\\\\.)?pixiv\\\\.net/(artworks|ajax/illust)/(\\\\d+)\"\n            let isIllust = baseUrl.match(new RegExp(pattern1))\n            let pattern2 = \"(https?://)?(www\\\\.)?pixiv\\\\.net/(user/\\\\d+|ajax)/series/(\\\\d+)\"\n            let isSeries = baseUrl.match(new RegExp(pattern2))\n\n            if (isIllust) {\n                illustId = isIllust[4]\n            } else if (isSeries) {\n                seriesId = isSeries[4]\n                java.log(`åŒ¹é…ç³»åˆ—IDï¼š${seriesId}`)\n                illustId = getAjaxJson(urlIP(urlSeriesDetailed(seriesId))).body.page.series.reverse()[0].workId\n            }\n        }\n        if (isJson) {\n            res = JSON.parse(result)\n        }\n\n        if (illustId) {\n            java.log(`åŒ¹é…æ’ç”»IDï¼š${illustId}`)\n            res = getAjaxJson(urlIP(urlIllustDetailed(illustId)))\n        }\n        if (res.error) {\n            java.log(`æ— æ³•ä» Pixiv è·å–å½“å‰æ¼«ç”»`)\n            java.log(JSON.stringify(res))\n            return []\n        }\n        return res.body\n    }\n\n    util = u\n    java.put(\"util\", objStringify(u))\n}\n\n// è·å–è¯·æ±‚çš„user idæ–¹ä¾¿å…¶ä»–ajaxè¯·æ±‚æ„é€ \nfunction getPixivUid() {\n    let uid = getFromCache(\"pixiv:uid\")\n    if (!uid || String(uid) === \"null\") {\n        let html = java.webView(null, \"https://www.pixiv.net/\", null)\n        try {\n            uid = html.match(/user_id:'(\\d+)'/)[1]\n        } catch (e) {\n            uid = null\n        }\n        putInCache(\"pixiv:uid\", String(uid))\n    }\n}\n\npublicFunc()\nif (result.code() === 200) {\n    getPixivUid(); util.getCookie(); util.getCsrfToken()\n}\njava.getStrResponse(null, null)",
        "loginUi": "@js:\nlet source = [\n    {\"ğŸ…¿ï¸ ç™»å½•è´¦å·\": \"login()\" },\n    {\"âš™ï¸ è´¦å·è®¾ç½®\": \"startPixivSettings()\" },\n    {\"ğŸ”™ é€€å‡ºè´¦å·\": \"logout()\" },\n    {\"ğŸ†™ æ›´æ–°ä¹¦æº\": \"updateSource()\" },\n    {\"ğŸ”° ä½¿ç”¨æŒ‡å—\": \"startGithubReadme()\" },\n    {\"ğŸš« âœˆï¸ ç›´è¿æ¨¡å¼\": \"editSettings('IPDirect')\" },\n]\n\nlet settings = [\n    {\"ä¹¦æºè®¾ç½®\": \"text\" },\n    {\"âš™ï¸ å½“å‰è®¾ç½®\": \"showSettings()\" },\n    {\"ğŸ”§ é»˜è®¤è®¾ç½®\": \"setDefaultSettingsLoginUrl()\" },\n    {\"ğŸ€„ ğŸš« ç¹ç®€é€šæœ\": \"editSettings('CONVERT_CHINESE')\" },\n\n    {\"ğŸ”— ğŸš« åŸå§‹é“¾æ¥\": \"editSettings('SHOW_ORIGINAL_LINK')\" },\n    {\"ğŸ–¼ï¸ ğŸš« å¸¸è§„è´¨é‡\": \"editSettings('SHOW_CAPTIONS')\" },\n    {\"ğŸš« ğŸ è°ƒè¯•æ¨¡å¼\": \"editSettings('DEBUG')\" },\n]\n\nlet li = []\nli = source.concat(settings)\n\n// å¤„ç†æŒ‰é’®\nli.forEach(item => {\n    item.name = Object.keys(item)[0]\n    let list = item.name.split(\" \")\n    if (list.length === 1 ) {\n        item.type = \"text\"\n    } else if (list.length === 2) {\n        item.type = \"button\"\n        item.action = Object.values(item)[0]\n    } else {\n        item.name = list[list.length - 1]\n        item.type = \"toggle\"\n        item.default = `${list[0]} `\n        list.length = list.length - 1\n        item.chars = list.map(char => `${char} `)\n        item.action = Object.values(item)[0]\n    }\n    delete item[Object.keys(item)[0]]\n    // æ·»åŠ æ ¼å¼\n    if (item.type === \"button\" || item.type === \"toggle\") {\n        item.style = {}\n        item.style.layout_flexGrow = 1\n        item.style.layout_flexBasisPercent = -1\n    }\n})\n\nJSON.stringify(li)",
        "loginUrl": "function login() {\n    sleepToast(\"ğŸ”„ æ­£åœ¨æ£€æµ‹ç™»é™†çŠ¶æ€ï¼Œè¯·ç¨å€™\")\n    if (isLogin()) {\n        sleepToast(\"ï¸ğŸ…¿ï¸ ç™»å½•è´¦å·\\nâœ… å·²ç»ç™»å½•è¿‡è´¦å·äº†\\n\\nå¯ä»¥ç‚¹å‡»ã€ğŸ”™ é€€å‡ºè´¦å·ã€‘æ¥åˆ‡æ¢è´¦å·\")\n        return false\n    }\n\n    let resp = java.startBrowserAwait(`https://accounts.pixiv.net/login,\n    {\"headers\": {\"User-Agent\": ${getWebViewUA()}}}`, 'ç™»å½•è´¦å·', false)\n    if (resp.code() === 200) {\n        getCsrfToken(); getCookie()\n        return true\n    } else {\n        java.log(resp.code()); sleepToast(\"ğŸ…¿ï¸ ç™»å½•è´¦å·\\n\\nâš ï¸ ç™»å½•å¤±è´¥\")\n        return false\n    }\n}\n\nfunction logout() {\n    removeCookie()\n    java.startBrowser(\"https://www.pixiv.net/logout.php\", \"é€€å‡ºè´¦å·\")\n    removeCookie(); removeLikeDataCache(); removeSettingsCache()\n    sleepToast(`âœ… å·²é€€å‡ºå½“å‰è´¦å·\\n\\né€€å‡ºåè¯·ç‚¹å‡»å³ä¸Šè§’çš„ âœ”ï¸ é€€å‡º\\n\\nç™»å½•è¯·ç‚¹å‡»ã€ç™»å½•è´¦å·ã€‘è¿›è¡Œç™»å½•`)\n}\n\nfunction removeCookie() {\n    cookie.removeCookie('https://www.pixiv.net')\n    cookie.removeCookie('https://accounts.pixiv.net')\n    cookie.removeCookie('https://accounts.google.com')\n    cookie.removeCookie('https://api.weibo.com')\n    cache.delete(\"pixivCookie\")\n    cache.delete(\"pixiv:uid\")\n    cache.delete(\"pixivCsrfToken\")  // ä¸ç™»å½•è®¾å¤‡æœ‰å…³\n    cache.delete(\"headers\")\n}\n\nfunction getCookie() {\n    let pixivCookie = String(java.getCookie(\"https://www.pixiv.net/\", null))\n    if (isLogin()) putInCache(\"pixivCookie\", pixivCookie, 60*60)\n}\n\n// è·å– Csrf Tokenï¼Œä»¥ä¾¿è¿›è¡Œæ”¶è—ç­‰è¯·æ±‚\n// è·å–æ–¹æ³•æ¥è‡ªè„šæœ¬ Pixiv Previewer\n// https://github.com/Ocrosoft/PixivPreviewer\n// https://greasyfork.org/zh-CN/scripts/30766-pixiv-previewer/code\nfunction getCsrfToken() {\n    let pixivCsrfToken = getFromCache(\"pixivCsrfToken\")\n    if (!pixivCsrfToken) {\n        let html = java.webView(null, \"https://www.pixiv.net/\", null)\n        try {\n            pixivCsrfToken = html.match(/token\\\\\":\\\\\"([a-z0-9]{32})/)[1]\n            putInCache(\"pixivCsrfToken\", pixivCsrfToken)  // ä¸ç™»å½•è®¾å¤‡æœ‰å…³ï¼Œæ— æ³•å­˜å‚¨ nul\n        } catch (e) {\n            pixivCsrfToken = null\n            cache.delete(\"pixivCsrfToken\")  // ä¸ç™»å½•è®¾å¤‡æœ‰å…³ï¼Œæ— æ³•å­˜å‚¨ nul\n            // sleepToast(\"âš ï¸ æœªç™»å½•è´¦å·(pixivCsrfToken)\")\n        }\n        java.log(`pixivCsrfToken:\\n${pixivCsrfToken}`)\n    }\n    return pixivCsrfToken\n}\n\nfunction getIllust() {}\n\nfunction getPostBody(url, body, headers) {\n    if (headers === undefined) headers = getFromCacheObject(\"headers\")\n    if (isJsonString(body)) {\n        headers[\"content-type\"] = \"application/json; charset=utf-8\"\n    } else if (typeof body === \"string\") {\n        headers[\"content-type\"] = \"application/x-www-form-urlencoded; charset=utf-8\"\n    }\n    try {\n        java.log(`getPostBody(${url}, ${body}, ${headers})`)\n        return JSON.parse(java.post(url, body, headers).body())\n    } catch (e) {\n        e = String(e)\n        // sleepToast(e)\n        // sleepToast(JSON.stringify(headers))\n        if (e.includes(\"400\")) sleepToast(`ğŸ“¤ getPostBody\\n\\nâš ï¸ ç¼ºå°‘ headers`, 1)\n        else if (e.includes(\"403\")) sleepToast(`ğŸ“¤ getPostBody\\n\\nâš ï¸ ç¼ºå°‘ cookie æˆ– cookie è¿‡æœŸ`, 1)\n        else if (e.includes(\"404\")) sleepToast(`ğŸ“¤ getPostBody\\n\\nâš ï¸ 404 ç¼ºå°‘ pixivCsrfToken `, 1)\n        else if (e.includes(\"422\")) sleepToast(`ğŸ“¤ getPostBody\\n\\nâš ï¸ è¯·æ±‚ä¿¡æ¯æœ‰è¯¯`, 1)\n        return {error: true, errMsg:e}\n    }\n}\n\nfunction userFollow(restrict) {\n    if (restrict === undefined) restrict = 0\n    let novel = getNovel()\n    let resp = getPostBody(\n        \"https://www.pixiv.net/bookmark_add.php\",\n        `mode=add&type=user&user_id=${novel.userId}&tag=\"\"&restrict=${restrict}&format=json`\n    )\n    if (resp.error === true) {\n        sleepToast(`â­ï¸ å…³æ³¨ä½œè€…\\n\\nâš ï¸ å…³æ³¨ã€${novel.userName}ã€‘å¤±è´¥`, 1)\n        shareFactory(\"author\")\n    } else {\n        sleepToast(`â­ï¸ å…³æ³¨ä½œè€…\\n\\nâœ… å·²å…³æ³¨ã€${novel.userName}ã€‘`)\n        putInCache(`follow${novel.userId}`, true)\n    }\n}\n\nfunction userUnFollow() {\n    let novel = getNovel()\n    let resp = getPostBody(\n        \"https://www.pixiv.net/rpc_group_setting.php\",\n        `mode=del&type=bookuser&id=${novel.userId}`\n    )\n    if (resp.error === true) {\n        sleepToast(`â­ï¸ å…³æ³¨ä½œè€…\\n\\nâš ï¸ å–æ¶ˆå…³æ³¨ã€${novel.userName}ã€‘å¤±è´¥`, 1)\n        shareFactory(\"author\")\n    } else {\n        sleepToast(`â­ï¸ å…³æ³¨ä½œè€…\\n\\nâœ… å·²å–æ¶ˆå…³æ³¨ã€${novel.userName}ã€‘`)\n        cache.delete(`follow${novel.userId}`)\n    }\n}\n\nfunction userFollowFactory(code) {\n    if (code === undefined) code = 1\n    let novel = getNovel()\n    let lastStatus = getFromCacheObject(`follow${novel.userId}`)\n    if (lastStatus === true) code = 0\n\n    if (code === 0) userUnFollow()\n    else if (code === 1) userFollow()\n}\n\nfunction startPixivSettings() {\n    startBrowser(\"https://www.pixiv.net/settings/viewing\", \"è´¦å·è®¾ç½®\")\n}\nfunction startGithubReadme() {\n    startBrowser(\"https://pixivsource.pages.dev/Pixiv\", \"ä½¿ç”¨æŒ‡å—\")\n}\n\nlet settingsName = {\n    \"SHOW_ORIGINAL_LINK\": \"ğŸ”— åŸå§‹é“¾æ¥\",\n    \"CONVERT_CHINESE\": \"ğŸ€„ï¸ ç¹ç®€é€šæœ\",\n    \"QUALITY_REGULAR\": \"ğŸ–¼ï¸ å¸¸è§„è´¨é‡\",\n    \"IPDirect\": \"âœˆï¸ ç›´è¿æ¨¡å¼\",\n    \"DEBUG\": \"ğŸ è°ƒè¯•æ¨¡å¼\"\n}\n\nfunction statusMsg(status) {\n    if (status === true) return \"âœ… å·²å¼€å¯\"\n    else if (status === false) return \"ğŸš« å·²å…³é—­\"\n    else return \"ğŸˆšï¸ æœªè®¾ç½®\"\n}\n\n// æ£€æµ‹å¿«é€Ÿæ¨¡å¼ä¿®æ”¹çš„4ä¸ªè®¾ç½®\nfunction getSettingStatus(mode) {\n    if (mode === undefined) mode = \"\"\n    let keys = [], msgList = []\n    let settings = getFromCacheObject(\"pixivIllustSettings\")\n    // if (mode === \"FAST\") {\n    //     keys = Object.keys(settingsName).slice(0, 5)\n    // }\n    if (mode === \"IPDirect\") {\n        keys = Object.keys(settingsName).slice(0, 1)\n    } else {\n        keys = Object.keys(settingsName)\n    }\n    for (let i in keys) {\n        msgList.push(`${statusMsg(settings[keys[i]])}ã€€${settingsName[keys[i]]}`)\n    }\n    return msgList.join(\"\\n\").trim()\n}\n\nfunction showSettings() {\n    sleepToast(`\\nâš™ï¸ å½“å‰è®¾ç½®\\n\\n${getSettingStatus()}`)\n}\n\nfunction setDefaultSettingsLoginUrl() {\n    setDefaultSettings()\n    sleepToast(`\\nâœ… å·²æ¢å¤ã€€ğŸ”§ é»˜è®¤è®¾ç½®\\n\\n${getSettingStatus()}`)\n}\n\nfunction editSettings(settingName) {\n    let msg, status\n    let settings = getFromCacheObject(\"pixivIllustSettings\")\n    if (!settings) settings = setDefaultSettings()\n    if (!!settings[settingName]) {\n        status = settings[settingName] = !settings[settingName]\n    } else {\n        status = settings[settingName] = true\n    }\n    putInCacheObject(\"pixivIllustSettings\", settings)\n\n    if (settingName === \"IPDirect\") {\n        if (settings.IPDirect && !isLogin()) {\n            msg = \"âœˆï¸ ç›´è¿æ¨¡å¼\\n\\nâœˆï¸ ç›´è¿æ¨¡å¼ éœ€ç™»å½•è´¦å·\\nå½“å‰æœªç™»å½•è´¦å·ï¼Œç°å·²å…³é—­ç›´è¿æ¨¡å¼\"\n            settings.IPDirect = false\n            checkSettings()\n            putInCacheObject(\"pixivIllustSettings\", settings)\n        } else {\n            checkSettings()\n            msg = `\\n\\n${statusMsg(status)}ã€€${settingsName[settingName]}\\n\\n${getSettingStatus(settingName)}`\n        }\n\n    } else if (settingName === \"QUALITY_REGULAR\") {\n        msg = `\\n\\n${statusMsg(status)}ã€€${settingsName[settingName]}\\n\\n`\n        if (settings.QUALITY_REGULAR)\n             msg += \"å›¾ç‰‡è´¨é‡è®¾ç½®ä¸º regular \"\n        else msg += \"å›¾ç‰‡è´¨é‡è®¾ç½®ä¸º original\"\n\n    } else {\n        msg = `\\n\\n${statusMsg(status)}ã€€${settingsName[settingName]}`\n    }\n    sleepToast(msg)\n}",
        "respondTime": 180000,
        "ruleBookInfo": {
            "author": "userName",
            "canReName": "true",
            "coverUrl": "coverUrl",
            "init": "@js:\nvar util = objParse(String(java.get(\"util\")))\n\nfunction objParse(obj) {\n    return JSON.parse(obj, (n, v) => {\n        if (typeof v == \"string\" && v.match(\"()\")) {\n            return eval(`(${v})`)\n        }\n        return v;\n    })\n}\n\nfunction illustHandler(illust){\n    illust = util.formatIllusts(util.handIllusts([illust]))[0]\n    book.bookUrl = illust.detailedUrl = urlIllustUrl(illust.id)\n    book.tocUrl = illust.catalogUrl = urlIP(urlIllustDetailed(illust.id))\n    return illust\n}\n\n(() => {\n    return illustHandler(util.getIllustRes(result))\n})()",
            "intro": "description",
            "kind": "tags",
            "lastChapter": "latestChapter",
            "name": "title",
            "tocUrl": "catalogUrl"
        },
        "ruleContent": {
            "content": "@js:\nvar util = objParse(String(java.get(\"util\")))\n\nfunction objParse(obj) {\n    return JSON.parse(obj, (n, v) => {\n        if (typeof v == \"string\" && v.match(\"()\")) {\n            return eval(`(${v})`)\n        }\n        return v;\n    })\n}\n\nfunction getContent(res) {\n    let content = [\"\"]\n    // li = \"mini thumb small regular original\".split(\" \")\n    let quality = util.settings.QUALITY_REGULAR ? \"regular\" : \"original\"\n    let illustLink = getAjaxJson(urlIP(urlIllustDetailed(res.id))).body.urls[quality]\n    for (let order = 0; order < res.pageCount; order++) {\n        content.push(`<img src=\"${urlCoverUrl(illustLink)}\">`)\n        illustLink = illustLink.replace(`_p${order}`, `_p${order + 1}`)\n    }\n    content = content.join(\"\\n\")\n    return content\n}\n\n(function () {\n    return getContent(util.getIllustRes(result))\n})()",
            "title": "",
            "imageStyle": "FULL",
            "callBackJs": "// function getNovel() {\n//     let novel = {}\n//     novel.author = novel.userName = book.author.replace(\"@\", \"\")\n//     if (book.bookUrl.includes(\"series\")) {\n//         novel.seriesId = book.bookUrl.match(/\\d+/)[0]\n//         novel.seriesTitle = book.name\n//\n//         let novelIds = getFromCacheObject(`novelIds${novel.seriesId}`)\n//         novel.id = novelIds[book.durChapterIndex]\n//         novel.title = book.durChapterTitle\n//     } else {\n//         novel.seriesId = 0\n//         novel.seriesTitle = \"\"\n//         novel.id = book.bookUrl.match(/\\d+/)[0]\n//         novel.title = book.name\n//     }\n//     return novel\n// }\n\nfunction shareBook() {\n    let text = `æˆ‘æ­£åœ¨çœ‹ï¼šã€${book.author.replace(\"@\", \"\")}ã€‘åˆ›ä½œçš„ã€Š${book.name}ã€‹`\n    if (!!book.durChapterTitle && String(book.name) !== String(book.durChapterTitle)) {\n        text += `çš„ ã€${book.durChapterTitle}ã€‘`\n    }\n    text += `\\n\\né“¾æ¥ï¼š\\n${book.bookUrl}\\n\\nåˆ†äº«è‡ªã€å¼€æºé˜…è¯»ã€‘Pixivä¹¦æºã€‚ä½¿ç”¨æ·»åŠ ç½‘å€ï¼Œå¿«é€Ÿæ·»åŠ æœ¬æ–‡`\n    java.copyText(text)\n    return true\n}\n\nfunction copyBookUrl() {\n    java.copyText(book.bookUrl)\n    return true\n}\nfunction copyTocUrl() {\n    java.copyText(book.tocUrl)\n    return true\n}\n\n// ä¿å­˜é˜…è¯»ï¼Œæ›´æ–°ç™»å½•ç•Œé¢çš„ç« èŠ‚åç§°\nfunction saveRead() {\n    source.putLoginInfo(JSON.stringify({\"ç« èŠ‚åç§°\": book.durChapterTitle}))\n}\n\nfunction startShelfRefresh() {\n    source.putConcurrent(\"18/30000\")\n}\n\nfunction endShelfRefresh() {\n    source.putConcurrent(\"25/5000\")\n}\n\nfunction callBackFactory(event) {\n    switch (event) {\n        // case \"clickBookName\":\n        //     return clickBookName()\n        // case \"longClickBookName\":\n        //     return longClickBookName()\n        // case \"clickAuthor\":\n        //     return clickAuthor()\n        // case \"longClickAuthor\":\n        //     return longClickAuthor()\n        // case \"clickCustomButton\":\n        //     return customButton()\n        // case \"longClickCustomButton\":\n        //     return longcustomButton()\n\n        case \"clickShareBook\":\n            return shareBook()\n        // case \"clickClearCache\":\n        //     return clearCache()\n        case \"clickCopyBookUrl\":\n            return copyBookUrl()\n        case \"clickCopyTocUrl\":\n            return copyTocUrl()\n\n        // ä¸‹é¢çš„äº‹ä»¶æ— æ³•è¢«å›è°ƒç»“æœæ¶ˆè´¹\n        // case \"addBookShelf\":\n        //     return addBookShelf()\n        // case \"delBookShelf\":\n        //     return delBookShelf()\n        case \"saveRead\":\n            return saveRead()\n        // case \"startRead\":\n        //     return startRead()\n        // case \"endRead\":\n        //     return endRead()\n        case \"startShelfRefresh\":\n            return startShelfRefresh()\n        case \"endShelfRefresh\":\n            return endShelfRefresh()\n    }\n}\n\n(() => {\n    return callBackFactory(event)\n})()"
        },
        "ruleExplore": {
            "author": "userName",
            "bookList": "@js:\nvar util = objParse(String(java.get(\"util\")))\nvar seriesSet = new Set();  // å­˜å‚¨seriesID æœ‰BUGæ— æ³•å¤„ç†ç¿»é¡µ\n\nfunction objParse(obj) {\n    return JSON.parse(obj, (n, v) => {\n        if (typeof v == \"string\" && v.match(\"()\")) {\n            return eval(`(${v})`)\n        }\n        return v;\n    })\n}\n\nfunction handlerFactory() {\n    if (baseUrl.includes(\"https://cdn.jsdelivr.net\")) {\n        return () => {updateSource(); return []}\n    }\n    if (baseUrl.includes(\"github\")) {\n        return () => {startBrowser(baseUrl, \"\"); return []}\n    }\n    if (!isLogin()) {\n        return handlerNoLogin()\n    }\n    if (baseUrl.includes(\"/follow_latest\")) {\n        return handlerFollowLatest()\n    }\n    if (baseUrl.includes(\"/watch_list\")) {\n        return handlerWatchList()\n    }\n    if (baseUrl.includes(\"/top\")) {\n        return handlerRecommend()\n    }\n    if (baseUrl.includes(\"/discovery\")) {\n        return handlerDiscovery()\n    }\n    if (baseUrl.includes(\"/bookmark\")) {\n        return handlerBookMarks()\n    }\n    if (baseUrl.includes(\"/new\")) {\n        return handlerDiscovery()\n    }\n    if (baseUrl.includes(\"/commission/\")) {\n        return handlerFollowLatest()\n    }\n    if (baseUrl.includes(\"/user_event/portal\")) {\n        return handlerFollowLatest()\n    }\n    // æ­£åˆ™åŒ¹é…ç½‘å€å†…å®¹\n    if (baseUrl.includes(\"/ranking\") && (baseUrl.endsWith(\"json\"))) {\n        return handlerRanking()\n    }\n    if (baseUrl.includes(\"/ranking\")) {\n        return handlerRegexIllusts()\n    }\n    else {\n        return () => {startBrowser(baseUrl, \"\"); return []}\n    }\n}\n\nfunction handlerNoLogin() {\n    return () => {\n        sleepToast(\"âš ï¸ å½“å‰æœªç™»å½•è´¦å·\\n\\nè¯·ç™»å½• Pixiv è´¦å·\", 1.5)\n        util.removeCookie(); util.login()\n        sleepToast(\"ç™»å½•æˆåŠŸåï¼Œè¯·é‡æ–°è¿›å…¥å‘ç°\", 2)\n        return []\n    }\n}\n\n//å…³æ³¨ä½œè€…ï¼Œæ¼«ç”»å§”æ‰˜ï¼Œæ¼«ç”»ä¼åˆ’\nfunction handlerFollowLatest() {\n    return () => {\n        let res = JSON.parse(result)\n        return util.formatIllusts(util.handIllusts(res.body.thumbnails.illust))\n    }\n}\n\n// è¿½æ›´åˆ—è¡¨\nfunction handlerWatchList() {\n    return () => {\n        let res = JSON.parse(result)\n        // li =  res.body.page.watchedSeriesIds\n        return util.formatIllusts(util.handIllusts(res.body.thumbnails.illust))\n    }\n}\n\n// æ¨èæ¼«ç”»\nfunction handlerRecommend() {\n    return () => {\n        let res = JSON.parse(result)\n        const recommend = res.body.page.recommend\n        const illusts = res.body.thumbnails.illust\n        let nidSet = new Set(recommend.ids)\n        // java.log(nidSet.size)\n        let list = illusts.filter(illust => nidSet.has(String(illust.id)))\n        // java.log(`è¿‡æ»¤ç»“æœ:${JSON.stringify(list)}`)\n        return util.formatIllusts(util.handIllusts(list))\n    }\n}\n\n//å‘ç°æ¼«ç”»\nfunction handlerDiscovery() {\n    return () => {\n        let res = JSON.parse(result)\n        return util.formatIllusts(util.handIllusts(res.body.illusts))\n    }\n}\n\n// æ”¶è—æ¼«ç”»\nfunction handlerBookMarks() {\n    return () => {\n        let res = JSON.parse(result).body.works\n        if (res === undefined || res.length === 0) {\n            //æµç¨‹æ— æ³•æœ¬ç¯èŠ‚ä¸­æ­¢ åªèƒ½äº¤ç»™ä¸‹ä¸€æµç¨‹å¤„ç†\n            return []\n        }\n        return util.formatIllusts(util.handIllusts(res))\n    }\n}\n\n// æ’è¡Œæ¦œï¼Œé¡ºåºç›¸åŒ\nfunction handlerRanking() {\n    return () => {\n        let res = JSON.parse(result)\n        res.contents.forEach(item =>{\n            item.id = item.illust_id\n            // item.title = item.title\n            item.userName = item.user_name\n            // item.tags = item.tags\n            item.latestChapter = item.title\n            item.description = null\n            item.coverUrl = item.url\n            item.detailedUrl = urlIP(urlIllustDetailed(item.id))\n            item.createDate = item.updateDate = item.illust_upload_timestamp * 1000\n\n            if (item.illust_series !== false) {\n                let series = item.illust_series\n                item.seriesId = series.illust_series_id\n                item.order = series.illust_series_content_order\n                item.total = series.illust_series_content_count\n                if (item.order === item.total) item.latestChapter = item.title\n                item.title = series.illust_series_title\n                item.description = series.illust_series_caption\n                item.pageCount = series.illust_page_count\n                item.createDate = item.updateDate = series.illust_series_create_datetime\n            }\n        })\n        return util.formatIllusts(util.handIllusts(res.contents))\n    }\n}\n\n//é¦–é¡µï¼Œé¡ºåºéšæœº\nfunction handlerRegexIllusts() {\n    return () => {\n        let illustIds = []  // æ­£åˆ™è·å–ç½‘å€ä¸­çš„ illustId\n        let matched = result.match(RegExp(/\\/artworks\\/\\d{5,}/gm))\n        for (let i in matched) {\n            let illustId = matched[i].match(RegExp(/\\d{5,}/))[0]\n            if (illustIds.indexOf(illustId) === -1) {\n                illustIds.push(illustId)\n            }\n        }\n        let userIllusts = getWebviewJson(\n            urlIP(urlIllustsDetailed(getFromCache(\"pixiv:uid\"), illustIds)), html => {\n                return (html.match(new RegExp(\">\\\\{.*?}<\"))[0].replace(\">\", \"\").replace(\"<\", \"\"))\n            }).body\n        return util.formatIllusts(util.handIllusts(Object.values(userIllusts)))\n    }\n}\n\n(() => {\n    return handlerFactory()()\n})()",
            "bookUrl": "detailedUrl",
            "coverUrl": "coverUrl",
            "intro": "description",
            "kind": "tags",
            "lastChapter": "latestChapter",
            "name": "title",
            "wordCount": ""
        },
        "ruleSearch": {
            "author": "userName",
            "bookList": "@js:\nvar util = objParse(String(java.get(\"util\")))\n\nfunction objParse(obj) {\n    return JSON.parse(obj, (n, v) => {\n        if (typeof v == \"string\" && v.match(\"()\")) {\n            return eval(`(${v})`)\n        }\n        return v;\n    })\n}\n\nfunction getArtwork() {\n    let resp = JSON.parse(result)\n    if (resp.error === true) {\n        return []\n    }\n    let name = String(java.get(\"key\"))\n    let page = Number(java.get(\"page\"))\n    java.log(urlIP(urlSearchArtwork(name, page)))\n    putInCacheObject(urlIP(urlSearchArtwork(name, page)), resp, cacheSaveSeconds)  // åŠ å…¥ç¼“å­˜\n    return resp.body.illustManga.data\n}\n\nfunction search(name, page) {\n    let resp = getAjaxJson(urlIP(urlSearchArtwork(name, page)))\n    java.log(urlIP(urlSearchArtwork(name, page)))\n    if (resp.error === true || resp.total === 0) {\n        return {\"data\": [], \"total\":0, \"lastPage\": 0}\n    }\n    return resp.body.illustManga\n}\n\nfunction getConvertArtwork() {\n    let illusts = []\n    let name = String(java.get(\"key\"))\n    let name1 = String(java.s2t(name))\n    let name2 = String(java.t2s(name))\n    if (name1 !== name) illusts = illusts.concat(search(name1, 1).data)\n    if (name2 !== name) illusts = illusts.concat(search(name2, 1).data)\n    return illusts\n}\n\n(() => {\n    let artworks = []\n    artworks = artworks.concat(getArtwork())\n    if (util.settings.CONVERT_CHINESE) artworks = artworks.concat(getConvertArtwork())\n    // java.log(JSON.stringify(artworks))\n    // è¿”å›ç©ºåˆ—è¡¨ä¸­æ­¢æµç¨‹\n    if (artworks.length === 0) {\n        return []\n    }\n    return util.formatIllusts(util.handIllusts(artworks))\n})()",
            "bookUrl": "detailedUrl",
            "checkKeyWord": "æµ‹è¯•",
            "coverUrl": "coverUrl",
            "intro": "description",
            "kind": "tags",
            "lastChapter": "latestChapter",
            "name": "title",
            "wordCount": ""
        },
        "ruleToc": {
            "chapterList": "@js:\nvar util = objParse(String(java.get(\"util\")))\n\nfunction objParse(obj) {\n    return JSON.parse(obj, (n, v) => {\n        if (typeof v == \"string\" && v.match(\"()\")) {\n            return eval(`(${v})`)\n        }\n        return v;\n    })\n}\n\nfunction urlIllust(novelId){\n    if (util.settings.SHOW_ORIGINAL_LINK) {\n        return urlIllustUrl(novelId)\n    } else {\n        return urlIllustDetailed(novelId)\n    }\n}\n\nfunction oneShotHandler(res) {\n    return [{\n        title: res.title.replace(RegExp(/^\\s+|\\s+$/g), \"\"),\n        chapterUrl: urlIP(urlIllust(res.id)),\n        chapterInfo: `${timeTextFormat(res.createDate)}`\n    }]\n}\n\nfunction seriesHandler(res) {\n    let limit = 12, total = 0, illusts = []\n    let seriesId = res.seriesNavData.seriesId\n    if (res.seriesId === undefined) {\n        total = getAjaxJson(urlIP(urlSeriesDetailed(res.seriesNavData.seriesId))).body.page.total\n    } else {\n        total = res.total\n    }\n    util.debugFunc(() => {\n        java.log(`æœ¬ç³»åˆ— ${seriesId} ä¸€å…±æœ‰${total}ç« `);\n    })\n\n    //è¦çˆ¬å–çš„æ€»æ¬¡æ•°\n    let max = (total / limit) + 1\n    for (let page = 1; page < max; page++) {\n        // java.log(urlIP(urlSeriesDetailed(seriesId, page)))\n        res = getAjaxJson(urlIP(urlSeriesDetailed(seriesId, page))).body\n        let illusts_id = res.page.series.map(item => item.workId)\n        illusts = illusts.concat(res.thumbnails.illust.filter(illust => illusts_id.includes(illust.id)))\n    }\n    illusts.reverse().forEach(illust => {\n        illust.title = illust.title.replace(RegExp(/^\\s+|\\s+$/g), \"\")\n        illust.chapterUrl = urlIP(urlIllust(illust.id))\n        illust.chapterInfo = timeTextFormat(illust.createDate)\n    })\n    // java.log(JSON.stringify(illusts))\n    return illusts\n}\n\n(() => {\n    let res = util.getIllustRes(result)\n    if (res.seriesNavData !== null) {\n        return seriesHandler(res)\n    } else {\n        return oneShotHandler(res)\n    }\n})()",
            "chapterName": "title",
            "chapterUrl": "chapterUrl",
            "updateTime": "chapterInfo"
        },
        "searchUrl": "@js:\njava.put(\"key\", key)\njava.put(\"page\", page)\nif (key.startsWith(\"@\") || key.startsWith(\"ï¼ \")) {\n    key = key.slice(1)\n    java.log(`ğŸ‘¤ æœç´¢ä½œè€…ï¼š${key}`)\n} else if (key.startsWith(\"#\") || key.startsWith(\"ï¼ƒ\")) {\n    key = key.slice(1)\n    java.log(`#ï¸âƒ£ æœç´¢æ ‡ç­¾ï¼š${key}`)\n} else {\n    java.log(`ğŸ” æœç´¢å†…å®¹ï¼š${key}`)\n}\n\njava.put(\"key\", key)\nurlIP(urlSearchArtwork(key, page))",
        "variableComment": "âš™ï¸ ä¹¦æºè®¾ç½®ï¼š\nè®¾ç½®1ï¸âƒ£ï¼šæ‰“å¼€å°è¯´ - èœå• - ç™»å½• - ç‚¹å‡»ä¸‹æ–¹æŒ‰é’®\nâ–¶ï¸ æœç´¢ä»»æ„å°è¯´ï¼ŒåŒæ­¥è®¾ç½®æ•°æ®\n\nè®¾ç½®2ï¸âƒ£ï¼šç¼–è¾‘ä¹¦æº - åŸºæœ¬ - å˜é‡è¯´æ˜ - ä¿®æ”¹å¹¶ä¿å­˜\nâš™ï¸ è‡ªå®šä¹‰è®¾ç½®ï¼šå°† true æ”¹ä¸º falseï¼Œæˆ–ç›¸å\nâš ï¸ è®¾ç½®æºå˜é‡ã€æ— æ³•ã€‘æ›´æ”¹ä¹¦æºè‡ªå®šä¹‰è®¾ç½®\nâš ï¸ æ³¨æ„ä¸è¦æ·»åŠ æˆ–åˆ é™¤å°¾éšé€—å·\",\"\nâš ï¸ æ›´æ–°å‘ç°é¡µéœ€è¦é•¿æŒ‰\"Pixiv\"ï¼Œæ‰‹åŠ¨åˆ·æ–°\nä»¥ä¸‹å†…å®¹ä¸ºä¹¦æºè®¾ç½®ï¼š\n{\n\"SHOW_GENERAL_NEW\": false,\n}\n\n// SHOW_GENERAL_NEW\n// å‘ç°ï¼šæœ€æ–°ã€ä¼åˆ’ã€çº¦ç¨¿æ˜¾ç¤ºä¸€èˆ¬æ¼«ç”»\n\n",
        "weight": 0
    }
]