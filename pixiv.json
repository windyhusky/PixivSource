[
    {
        "bookSourceComment": "Pixiv å°è¯´ï¼ˆæ›´æ–°ğŸ“†ï¼š2025-06-05ï¼‰\n\nä½¿ç”¨è¯´æ˜ï¼šé˜…è¯»ç‰ˆæœ¬ 3.25.0527 åŠä¹‹åç‰ˆæœ¬å¯ç”¨\nå¯ç”¨åŠŸèƒ½ï¼šâœ…æœç´¢âœ…å‘ç°âœ…æ·»åŠ ç½‘å€âœ…è®¢é˜…æº\næœç´¢å°è¯´ï¼šâœ…å•ç¯‡âœ…ç³»åˆ—âœ…æ ‡ç­¾âœ…ä½œè€…\nå‘ç°å°è¯´ï¼šâœ…å…³æ³¨âœ…è¿½æ›´âœ…æ¨èâœ…å‘ç°\nå‘ç°å°è¯´ï¼šâœ…æ”¶è—âœ…ä¹¦ç­¾âœ…é¦–é¡µâœ…æ’è¡Œ\næ·»åŠ ç½‘å€ï¼šâœ…Pixivå°è¯´é“¾æ¥âœ…Pixivç³»åˆ—é“¾æ¥\nè®¢é˜…ç”¨æ³•ï¼šç‚¹å‡»è®¢é˜…æºæ‰“å¼€å°è¯´/ç³»åˆ—å°è¯´ï¼Œã€åˆ·æ–°ã€‘ï¼Œç‚¹å‡»ã€åŠ å…¥ä¹¦æ¶ã€‘æŒ‰é’®ï¼Œæ·»åŠ åˆ°ä¹¦æ¶\n\nä¹¦æºå‘å¸ƒï¼šå…½äººé˜…è¯»é¢‘é“ https://t.me/FurryReading\né¡¹ç›®åœ°å€ï¼šhttps://github.com/windyhusky/PixivSource\nä½¿ç”¨æ•™ç¨‹ï¼šhttps://github.com/windyhusky/PixivSource/blob/main/doc/Pixiv.md\n\nè§„åˆ™è®¢é˜…ï¼šimport è®¢é˜…æº\nhttps://cdn.jsdelivr.net/gh/windyhusky/PixivSource@main/import.json\nhttps://raw.githubusercontent.com/windyhusky/PixivSource/main/import.json\n\nâš™ï¸ ä¹¦æºè®¾ç½®ï¼š\nè®¾ç½®1ï¸âƒ£ï¼šç¼–è¾‘ä¹¦æº - èœå• - ç™»å½• - ç‚¹å‡»ä¸‹æ–¹æŒ‰é’®\nè®¾ç½®2ï¸âƒ£ï¼šç¼–è¾‘ä¹¦æº - åŸºæœ¬ - å˜é‡è¯´æ˜ - ä¿®æ”¹å¹¶ä¿å­˜\n\nâ¤ï¸ æŸ¥çœ‹ä»–äººæ”¶è—ï¼š\n1ï¸âƒ£è®¢é˜… - é•¿æŒ‰è®¢é˜…æº\" - ç¼–è¾‘ - èœå• - è®¾ç½®æºå˜é‡\n2ï¸âƒ£æºå˜é‡ï¼šè¾“å…¥ä½œè€…IDï¼Œä¸€è¡Œä¸€ä¸ªï¼Œä¿å­˜\n3ï¸âƒ£å¯¼å…¥ï¼šæ‰“å¼€è®¢é˜…æº- èœå• - ç™»å½• - ç‚¹å‡»\"â¤ï¸ ä»–äººæ”¶è—\"\n4ï¸âƒ£æ›´æ–°ï¼šå‘ç° - é•¿æŒ‰\"Pixiv\" - åˆ·æ–° - æŸ¥çœ‹ä»–äººæ”¶è—",
        "bookSourceGroup": "ğŸ” Pixiv",
        "bookSourceName": "Pixiv å°è¯´",
        "bookSourceType": 0,
        "bookSourceUrl": "https://www.pixiv.net/novel",
        "bookUrlPattern": "(https?://)?(www\\.)?pixiv\\.net(/ajax)?/novel/(show\\.php\\?id=|series/)?\\d+",
        "concurrentRate": "180/60000",
        "customOrder": 0,
        "enabled": true,
        "enabledCookieJar": false,
        "enabledExplore": true,
        "exploreUrl": "@js:\nlet SHOW_R18_GENRE, SHOW_GENERAL_NEW, SHOW_GENERAL_RANK, SHOW_GENERAL_GENRE\ntry {\n    settings = JSON.parse(String(source.variableComment).match(RegExp(/{([\\s\\S]*?)}/gm)))\n    SHOW_R18_GENRE = settings.SHOW_R18_GENRE         // å‘ç°ï¼šçƒ­é—¨åˆ†ç±»æ˜¾ç¤ºR18å°è¯´\n    SHOW_GENERAL_NEW = settings.SHOW_GENERAL_NEW     // å‘ç°ï¼šæœ€æ–°ã€ä¼åˆ’ã€çº¦ç¨¿æ˜¾ç¤ºä¸€èˆ¬å°è¯´\n    SHOW_GENERAL_RANK = settings.SHOW_GENERAL_RANK   // å‘ç°ï¼šæ’è¡Œæ¦œæ˜¾ç¤ºä¸€èˆ¬å°è¯´\n    SHOW_GENERAL_GENRE = settings.SHOW_GENERAL_GENRE // å‘ç°ï¼šçƒ­é—¨åˆ†ç±»æ˜¾ç¤ºä¸€èˆ¬å°è¯´\n} catch (e) {\n    SHOW_R18_GENRE = false\n    SHOW_GENERAL_NEW = false\n    SHOW_GENERAL_RANK = false\n    SHOW_GENERAL_GENRE = false\n}\n\nli = [\n    {\"â­ï¸ å…³æ³¨\": \"https://www.pixiv.net/ajax/follow_latest/novel?p={{page}}&mode=r18&lang=zh\"},\n    {\"ğŸ“ƒ è¿½æ›´\": \"https://www.pixiv.net/ajax/watch_list/novel?p={{page}}&new=1&lang=zh\"},\n    {\"ğŸ’¯ æ¨è\": \"https://www.pixiv.net/ajax/top/novel?mode=r18&lang=zh\"},\n    {\"ğŸ” å‘ç°\": \"https://www.pixiv.net/ajax/novel/discovery?mode=r18&lang=zh\"},\n    {\"â¤ï¸ æ”¶è—\": \"https://www.pixiv.net/ajax/user/{{cache.get(\\\"pixiv:uid\\\")}}/novels/bookmarks?tag=&offset={{(page-1)*24}}&limit=24&rest=show&lang=zh\"},\n    {\"ãŠ™ï¸ æ”¶è—\": \"https://www.pixiv.net/ajax/user/{{cache.get(\\\"pixiv:uid\\\")}}/novels/bookmarks?tag=&offset={{(page-1)*24}}&limit=24&rest=hide&lang=zh\"},\n    {\"ğŸ·ï¸ ä¹¦ç­¾\": \"https://www.pixiv.net/novel/marker_all.php\"},\n    {\"ğŸ  é¦–é¡µ\": \"https://www.pixiv.net\"},\n]\n\nnormal = [\n    {\"âœ… å¸¸è§„ å°è¯´ æ¨è âœ…\": \"\"},\n    {\"â­ï¸ å…³æ³¨\": \"https://www.pixiv.net/ajax/follow_latest/novel?p={{page}}&mode=all&lang=zh\"},\n    {\"ğŸ’¯ æ¨è\": \"https://www.pixiv.net/ajax/top/novel?mode=all&lang=zh\"},\n    {\"ğŸ” å‘ç°\": \"https://www.pixiv.net/ajax/novel/discovery?mode=safe&lang=zh\"},\n    {\"ğŸ†™ æ›´æ–°\": \"https://cdn.jsdelivr.net/gh/windyhusky/PixivSource@main/pixiv.json\"},\n]\n\nr18New = [\n    {\"ğŸ†• æœ€æ–° ä¼åˆ’ çº¦ç¨¿ ğŸ’°\": \"\"},\n    {\"ğŸ†• æœ€æ–°\": \"https://www.pixiv.net/ajax/novel/new?lastId=0&limit=20&r18=true&lang=zh\"},\n    {\"ğŸ“‘ ä¼åˆ’\": \"https://www.pixiv.net/ajax/user_event/portal/novels?mode=r18&p={{page}}&lang=zh\"},\n    {\"ğŸ’° çº¦ç¨¿\": \"https://www.pixiv.net/ajax/commission/page/request/complete/novels?mode=r18&p={{page}}&lang=zh\"},\n    {\"ğŸ” å‘ç°\": \"https://www.pixiv.net/ajax/novel/discovery?mode=all&lang=zh\"},\n]\n\ngeneralNew = [\n    {\"âœ… æœ€æ–° ä¼åˆ’ çº¦ç¨¿ âœ…\": \"\"},\n    {\"æœ€æ–°\": \"https://www.pixiv.net/ajax/novel/new?lastId=0&limit=20&r18=false&lang=zh\"},\n    {\"ä¼åˆ’\": \"https://www.pixiv.net/ajax/user_event/portal/novels?mode=all&p={{page}}&lang=zh\"},\n    {\"çº¦ç¨¿\": \"https://www.pixiv.net/ajax/commission/page/request/complete/novels?mode=all&p={{page}}&lang=zh\"},\n    {\"ç¼–è¾‘\": \"https://www.pixiv.net/novel/editors_picks\"},\n]\n\nr18Rank = [\n    {\"ğŸ‘‘ æ’è¡Œæ¦œå• ğŸ‘‘\": \"\"},\n    {\"ä»Šæ—¥\": \"https://www.pixiv.net/novel/ranking.php?mode=daily_r18\"},\n    {\"æœ¬å‘¨\": \"https://www.pixiv.net/novel/ranking.php?mode=weekly_r18\"},\n    {\"R18G\": \"https://www.pixiv.net/novel/ranking.php?mode=r18g\"},\n    {\"ç”·æ€§\": \"https://www.pixiv.net/novel/ranking.php?mode=male_r18\"},\n    {\"å¥³æ€§\": \"https://www.pixiv.net/novel/ranking.php?mode=female_r18\"}\n]\n\ngeneralRank = [\n    {\"ğŸ† æ’è¡Œæ¦œå• ğŸ†\": \"\"},\n    {\"ä»Šæ—¥\": \"https://www.pixiv.net/novel/ranking.php?mode=daily\"},\n    {\"æœ¬å‘¨\": \"https://www.pixiv.net/novel/ranking.php?mode=weekly\"},\n    {\"æœ¬æœˆ\": \"https://www.pixiv.net/novel/ranking.php?mode=monthly\"},\n    {\"ç”·æ€§\": \"https://www.pixiv.net/novel/ranking.php?mode=male\"},\n    {\"å¥³æ€§\": \"https://www.pixiv.net/novel/ranking.php?mode=female\"},\n    {\"æ–°äºº\": \"https://www.pixiv.net/novel/ranking.php?mode=rookie\"},\n    {\"åŸåˆ›\": \"https://www.pixiv.net/novel/ranking.php?mode=weekly_original\"},\n    {\"AIç”Ÿæˆ\": \"https://www.pixiv.net/novel/ranking.php?mode=weekly_ai\"}\n]\n\nr18Genre = [\n    {\"ğŸ”¥ åŸåˆ›çƒ­é—¨ ğŸ”¥\": \"\"},\n    {\"ç”·æ€§\": \"https://www.pixiv.net/ajax/genre/novel/male?mode=r18&lang=zh\"},\n    {\"å¥³æ€§\": \"https://www.pixiv.net/ajax/genre/novel/female?mode=r18&lang=zh\"},\n    {\"æ‹çˆ±\": \"https://www.pixiv.net/ajax/genre/novel/romance?mode=r18&lang=zh\"},\n    {\"å¼‚ä¸–ç•Œå¥‡å¹»\": \"https://www.pixiv.net/ajax/genre/novel/isekai_fantasy?mode=r18&lang=zh\"},\n    {\"ç°ä»£å¥‡å¹»\": \"https://www.pixiv.net/ajax/genre/novel/contemporary_fantasy?mode=r18&lang=zh\"},\n    {\"æ‚¬ç–‘\": \"https://www.pixiv.net/ajax/genre/novel/mystery?mode=r18&lang=zh\"},\n    {\"ææ€–\": \"https://www.pixiv.net/ajax/genre/novel/horror?mode=r18&lang=zh\"},\n    {\"ç§‘å¹»\": \"https://www.pixiv.net/ajax/genre/novel/sci-fi?mode=r18&lang=zh\"},\n    {\"æ–‡å­¦\": \"https://www.pixiv.net/ajax/genre/novel/literature?mode=r18&lang=zh\"},\n    {\"æƒ…æ„Ÿ\": \"https://www.pixiv.net/ajax/genre/novel/drama?mode=r18&lang=zh\"},\n    {\"å†å²\": \"https://www.pixiv.net/ajax/genre/novel/historical_pieces?mode=r18&lang=zh\"},\n    {\"è€½ç¾\": \"https://www.pixiv.net/ajax/genre/novel/bl?mode=r18&lang=zh\"},\n    {\"ç™¾åˆ\": \"https://www.pixiv.net/ajax/genre/novel/yuri?mode=r18&lang=zh\"},\n    {\"æ•£æ–‡Â·è¯—æ­Œ\": \"https://www.pixiv.net/ajax/genre/novel/poetry?mode=r18&lang=zh\"},\n    {\"éšç¬”Â·çºªå®\": \"https://www.pixiv.net/ajax/genre/novel/non-fiction??mode=r18&lang=zh\"},\n    {\"å‰§æœ¬\": \"https://www.pixiv.net/ajax/genre/novel/screenplays?mode=r18&lang=zh\"},\n    {\"è¯„è®º\": \"https://www.pixiv.net/ajax/genre/novel/reviews?mode=r18&lang=zh\"},\n    {\"å…¶ä»–\": \"https://www.pixiv.net/ajax/genre/novel/other?mode=r18&lang=zh\"}\n]\n\ngeneralgGenre = [\n    {\"â¤ï¸â€ğŸ”¥ åŸåˆ›çƒ­é—¨ â¤ï¸â€ğŸ”¥\": \"\"},\n    {\"ç»¼åˆ\": \"https://www.pixiv.net/ajax/genre/novel/all?mode=safe&lang=zh\"},\n    {\"æ‹çˆ±\": \"https://www.pixiv.net/ajax/genre/novel/romance?mode=safe&lang=zh\"},\n    {\"å¼‚ä¸–ç•Œå¥‡å¹»\": \"https://www.pixiv.net/ajax/genre/novel/isekai_fantasy?mode=safe&lang=zh\"},\n    {\"ç°ä»£å¥‡å¹»\": \"https://www.pixiv.net/ajax/genre/novel/contemporary_fantasy?mode=safe&lang=zh\"},\n    {\"æ‚¬ç–‘\": \"https://www.pixiv.net/ajax/genre/novel/mystery?mode=safe&lang=zh\"},\n    {\"ææ€–\": \"https://www.pixiv.net/ajax/genre/novel/horror?mode=safe&lang=zh\"},\n    {\"ç§‘å¹»\": \"https://www.pixiv.net/ajax/genre/novel/sci-fi?mode=safe&lang=zh\"},\n    {\"æ–‡å­¦\": \"https://www.pixiv.net/ajax/genre/novel/literature?mode=safe&lang=zh\"},\n    {\"æƒ…æ„Ÿ\": \"https://www.pixiv.net/ajax/genre/novel/drama?mode=safe&lang=zh\"},\n    {\"å†å²\": \"https://www.pixiv.net/ajax/genre/novel/historical_pieces?mode=safe&lang=zh\"},\n    {\"è€½ç¾\": \"https://www.pixiv.net/ajax/genre/novel/bl?mode=safe&lang=zh\"},\n    {\"ç™¾åˆ\": \"https://www.pixiv.net/ajax/genre/novel/yuri?mode=safe&lang=zh\"},\n    {\"æ•£æ–‡Â·è¯—æ­Œ\": \"https://www.pixiv.net/ajax/genre/novel/poetry?mode=safe&lang=zh\"},\n    {\"éšç¬”Â·çºªå®\": \"https://www.pixiv.net/ajax/genre/novel/non-fiction??mode=safe&lang=zh\"},\n    {\"å‰§æœ¬\": \"https://www.pixiv.net/ajax/genre/novel/screenplays?mode=safe&lang=zh\"},\n    {\"è¯„è®º\": \"https://www.pixiv.net/ajax/genre/novel/reviews?mode=safe&lang=zh\"},\n    {\"å…¶ä»–\": \"https://www.pixiv.net/ajax/genre/novel/other?mode=safe&lang=zh\"}\n]\n\nbookmarks = [{\"â¤ï¸ ä»–äººæ”¶è— â¤ï¸\": \"\"}]\n\nli = li.concat(normal)\nli = li.concat(r18New)\nif (SHOW_GENERAL_NEW === true) {\n    li = li.concat(generalNew)\n}\nli = li.concat(r18Rank)\nif (SHOW_GENERAL_RANK === true) {\n    li = li.concat(generalRank)\n}\nif (SHOW_R18_GENRE === true) {\n    li = li.concat(r18Genre)\n}\nif (SHOW_GENERAL_GENRE === true) {\n    li = li.concat(generalgGenre)\n}\n\nsleepToast('ä½¿ç”¨æŒ‡å—ğŸ”–\\n\\nå‘ç° - æ›´æ–° - ç‚¹å‡»\"ğŸ”° ä½¿ç”¨æŒ‡å—\" - æŸ¥çœ‹')\nsleepToast('æŸ¥çœ‹ä»–äººæ”¶è—â¤ï¸\\n\\nè¯·åœ¨ã€è®¢é˜…æºã€‘è®¾ç½®æºå˜é‡ï¼Œå¹¶åœ¨ã€è®¢é˜…æºã€‘çš„ç™»å½•ç•Œé¢ç‚¹å‡» â¤ï¸ ä»–äººæ”¶è— å¯¼å…¥æ•°æ®åï¼Œå†è¿›è¡Œåˆ·æ–°')\n\nlet authors = getFromCache(\"pixivLikeAuthors\")\nif (authors !== null) {\n    authors.forEach(authorId => {\n        let resp = getAjaxJson(urlUserDetailed(authorId))\n        if (resp.error !== true) {\n            let bookmark = {}\n            bookmark[resp.body.name] = `https://www.pixiv.net/ajax/user/${authorId}/novels/bookmarks?tag=&offset={{(page-1)*24}}&limit=24&rest=show&lang=zh`\n            bookmarks.push(bookmark)\n        }\n    })\n    li = li.concat(bookmarks)\n} else {\n    sleepToast(\"â¤ï¸ ä»–äººæ”¶è—\\n åˆ·æ–°å‘ç°å‰ï¼Œè¯·åœ¨ã€è®¢é˜…æºã€‘è®¾ç½®æºå˜é‡ï¼Œå¹¶åœ¨ã€è®¢é˜…æºã€‘çš„ç™»å½•ç•Œé¢ç‚¹å‡» â¤ï¸ ä»–äººæ”¶è— å¯¼å…¥æ•°æ®\")\n}\n\nli.forEach(item => {\n    item.title = Object.keys(item)[0]\n    item.url = Object.values(item)[0]\n    delete item[Object.keys(item)[0]]\n    item.style = {}\n    item.style.layout_flexGrow = 1\n    item.style.layout_flexShrink = 1\n    item.style.layout_alignSelf = \"auto\"\n    item.style.layout_wrapBefore = \"false\"\n    if (item.url === \"\") {\n        item.style.layout_flexBasisPercent = 1\n    } else {\n        item.style.layout_flexBasisPercent = -1\n    }\n})\n\nJSON.stringify(li)",
        "header": "{\"referer\":\"https://www.pixiv.net\"}",
        "jsLib": "var checkTimes = 0\nvar cacheSaveSeconds = 7*24*60*60  // ç¼“å­˜æ—¶é—´7å¤©\n\nfunction cacheGetAndSet(cache, key, supplyFunc) {\n    let v = cache.get(key)\n    if (v === undefined || v === null) {\n        v = JSON.stringify(supplyFunc())\n        cache.put(key, v, cacheSaveSeconds)\n    }\n    return JSON.parse(v)\n}\nfunction getFromCache(object) {\n    let {cache} = this\n    return JSON.parse(cache.get(object))\n}\n\nfunction isHtmlString(str) {\n    return str.startsWith(\"<!DOCTYPE html>\")\n}\nfunction isJsonString(str) {\n    try {\n        if (typeof JSON.parse(str) === \"object\") {\n            return true\n        }\n    } catch(e) {}\n    return false\n}\n\nfunction getAjaxJson(url, forceUpdate) {\n    const {java, cache} = this\n    if (forceUpdate === true) {\n        let result = JSON.parse(java.ajax(url))\n        cache.put(url, JSON.stringify(result), cacheSaveSeconds)\n        return result\n    }\n    return cacheGetAndSet(cache, url, () => {\n        return JSON.parse(java.ajax(url))\n    })\n}\nfunction getAjaxAllJson(urls, forceUpdate) {\n    const {java, cache} = this\n    if (forceUpdate === true) {\n        let result = java.ajaxAll(urls).map(resp => JSON.parse(resp.body()).body)\n        cache.put(urls, JSON.stringify(result), cacheSaveSeconds)\n        return result\n    }\n    return cacheGetAndSet(cache, urls, () => {\n        return java.ajaxAll(urls).map(resp => JSON.parse(resp.body()).body)\n    })\n}\nfunction getWebviewJson(url, parseFunc) {\n    const {java, cache} = this\n    return cacheGetAndSet(cache, url, () => {\n        let html = java.webView(null, url, null)\n        return JSON.parse(parseFunc(html))\n    })\n}\n\nfunction isLogin() {\n    const {java} = this\n    let cookie = String(java.getCookie(\"https://www.pixiv.net/\", null))\n    return cookie.includes(\"first_visit_datetime\")\n}\n\nfunction urlNovelUrl(novelId) {\n    return `https://www.pixiv.net/novel/show.php?id=${novelId}`\n}\nfunction urlNovelDetailed(novelId) {\n    return `https://www.pixiv.net/ajax/novel/${novelId}`\n}\nfunction urlNovelsDetailed(userId, nidList) {\n    return `https://www.pixiv.net/ajax/user/${userId}/novels?${nidList.map(v => \"ids[]=\" + v).join(\"&\")}`\n}\nfunction urlNovelBookmarkData(novelId) {\n    return `https://www.pixiv.net/ajax/novel/${novelId}/bookmarkData`\n}\nfunction urlNovelComments(novelId, offset, limit) {\n    return `https://www.pixiv.net/ajax/novels/comments/roots?novel_id=${novelId}&offset=${offset}&limit=${limit}&lang=zh`\n}\nfunction urlNovelCommentsReply(commentId, page) {\n    return `https://www.pixiv.net/ajax/novels/comments/replies?comment_id=${commentId}&page=${page}&lang=zh`\n}\n\nfunction urlSeriesUrl(seriesId) {\n    return `https://www.pixiv.net/novel/series/${seriesId}`\n}\nfunction urlSeriesDetailed(seriesId) {\n    return `https://www.pixiv.net/ajax/novel/series/${seriesId}?lang=zh`\n}\nfunction urlSeriesNovelsTitles(seriesId) {\n    return `https://www.pixiv.net/ajax/novel/series/${seriesId}/content_titles`\n}\nfunction urlSeriesNovels(seriesId, limit, offset) {\n    if (limit > 30) limit = 30\n    if (limit < 10) limit = 10\n    return `https://www.pixiv.net/ajax/novel/series_content/${seriesId}?limit=${limit}&last_order=${offset}&order_by=asc&lang=zh`\n}\n\nfunction urlUserUrl(userID) {\n    return `https://www.pixiv.net/users/${userID}/novels`\n}\nfunction urlUserDetailed(userID) {\n    return `https://www.pixiv.net/ajax/user/${userID}`\n}\nfunction urlUserWorkLatest(userID) {\n    return `https://www.pixiv.net/ajax/user/${userID}/works/latest`\n}\nfunction urlUserAllWorks(userId) {\n    return `https://www.pixiv.net/ajax/user/${userId}/profile/all?lang=zh`\n}\n\nfunction urlSearchNovel(novelName, page) {\n    return `https://www.pixiv.net/ajax/search/novels/${novelName}?word=${novelName}&order=date_d&mode=all&p=${page}&s_mode=s_tag&lang=zh`\n}\nfunction urlSearchSeries(seriesName, page) {\n    return`https://www.pixiv.net/ajax/search/novels/${seriesName}?word=${seriesName}&order=date_d&mode=all&p=${page}&s_mode=s_tag&gs=1&lang=zh`\n}\n// ä¸å®Œå…¨åŒ¹é…ç”¨æˆ·å\nfunction urlSearchUser(userName, full) {\n    if (full === undefined || full === false) {\n        return `https://www.pixiv.net/search/users?nick=${userName}&s_mode=s_usr&nick_mf=1`\n    } else {\n        return `https://www.pixiv.net/search/users?nick=${userName}&s_mode=s_usr_full&i=1`\n    }\n}\n\nfunction urlCoverUrl(url) {\n    return `${url}, {\"headers\": {\"Referer\":\"https://www.pixiv.net/\"}}`\n}\nfunction urlIllustDetailed(illustId) {\n    return `https://www.pixiv.net/ajax/illust/${illustId}?lang=zh`\n}\nfunction urlIllustOriginal(illustId, order) {\n    const {java, cache} = this\n    if (order <= 1) order = 1\n    let url = urlIllustDetailed(illustId)\n    let illustOriginal = cacheGetAndSet(cache, url, () => {\n        return JSON.parse(java.ajax(url))\n    }).body.urls.original\n    return urlCoverUrl(illustOriginal.replace(`_p0`, `_p${order - 1}`))\n}\n\nfunction urlMessageThreadLatest(max) {\n    if (max === undefined || max <= 5) max = 5\n    return `https://www.pixiv.net/rpc/index.php?mode=latest_message_threads2&num=${max}&lang=zh`\n}\nfunction urlMessageThreadContents(threadId, max) {\n    return `https://www.pixiv.net/rpc/index.php?mode=message_thread_contents&thread_id=${threadId}&num=${max}`\n}\nfunction urlMessageThreadDetail(threadId) {\n    return `https://www.pixiv.net/rpc/index.php?mode=message_thread&thread_id=${threadId}`\n}\nfunction urlNotification() {\n    return `https://www.pixiv.net/ajax/notification&lang=zh`\n}\n\nfunction dateFormat(str) {\n    let addZero = function (num) {\n        return num < 10 ? '0' + num : num;\n    }\n    let time = new Date(str);\n    let Y = time.getFullYear() + \"å¹´\";\n    let M = addZero(time.getMonth() + 1) + \"æœˆ\";\n    let D = addZero(time.getDate()) + \"æ—¥\";\n    return Y + M + D;\n}\nfunction timeTextFormat(text) {\n    return `${text.slice(0, 10)} ${text.slice(11, 19)}`\n}\nfunction sleep(time) {\n    let endTime = new Date().getTime() + time\n    while(true){\n        if (new Date().getTime() > endTime){\n            return;\n        }\n    }\n}\nfunction sleepToast(text, second) {\n    const {java} = this\n    java.log(text)\n    java.longToast(text)\n    if (second === undefined || second <= 3) {second = 3}\n    sleep(1000*second)\n}\n\nfunction updateSource() {\n    const {java, source} = this\n    let onlineSource, comment, sourceName, sourceNameCapitalize, index = 0\n    if (source.bookSourceUrl.includes(\"pixiv\")) sourceName = \"pixiv\"\n    else if (source.bookSourceUrl.includes(\"furrynovel\")) sourceName = \"linpx\"\n    sourceNameCapitalize = sourceName[0].toUpperCase() + sourceName.substring(1)\n\n    if (source.bookSourceName.includes(\"å¤‡ç”¨\")) index = 1\n    else if (source.bookSourceName.includes(\"æ¼«ç”»\")) index = 2\n    if (source.bookSourceUrl.includes(\"furrynovel.com\")) {\n        sourceNameCapitalize = \"FurryNovel\"\n        index = 1\n    }\n\n    try {\n        let updateUrl = `https://cdn.jsdelivr.net/gh/windyhusky/PixivSource@main/${sourceName}.json`\n        onlineSource = JSON.parse(java.get(updateUrl,{'User-Agent': 'Mozilla/5.0 (Linux; Android 14)','X-Requested-With': 'XMLHttpRequest'}).body())[index]\n        comment = onlineSource.bookSourceComment.split(\"\\n\")\n    } catch (e) {\n        try {\n            let updateUrl = `https://raw.githubusercontent.com/windyhusky/PixivSource/main/${sourceName}.json`\n            onlineSource = JSON.parse(java.get(updateUrl,{'User-Agent': 'Mozilla/5.0 (Linux; Android 14)','X-Requested-With': 'XMLHttpRequest'}).body())[index]\n            comment = onlineSource.bookSourceComment.split(\"\\n\")\n        } catch (e) {\n            onlineSource = {lastUpdateTime: new Date().getTime()}\n            comment = source.bookSourceComment.split(\"\\n\")\n        }\n    }\n\n    let htm = `data:text/html; charset=utf-8,\n<html>\n<head>\n    <meta name=\"viewport\" content=\"width=device-width, initial-scale=1.0\">\n    <title>æ›´æ–° ${source.bookSourceName} ä¹¦æº</title>\n    <style> \n    table { text-align: center; margin: 0 auto; } .ann { display: flex; justify-content: center; align-items: center; height: 5vh; } \n    button { background-color: rgb(76, 175, 80); color: white; border: none; border-radius: 4px; height: 6vh; width: 30vw; overflow: hidden; } \n    button span { cursor: pointer; display: inline-block; position: relative; transition: 0.4s; } \n    button span:after { content: '>'; position: absolute; opacity: 0; top: 0; right: 30px; transition: 0.2s; } \n    button:active span { padding-right: 20px; } \n    button:active span:after { opacity: 1; right: -40px; }\n    </style>\n</head>\n\n<body>\n    <table border=\"1\" cellspacing=\"0\">\n        <th colspan=\"2\"> ${source.bookSourceName} ä¹¦æº <a href=\"https://github.com/windyhusky/PixivSource/blob/main/doc/${sourceNameCapitalize}.md\">ğŸ”° ä½¿ç”¨æŒ‡å—</a></th>\n        <tr><td>â˜ï¸ è¿œç¨‹ä»“åº“ç‰ˆæœ¬ï¼š${java.timeFormat(onlineSource.lastUpdateTime)}</td></tr>\n        <tr><td>ğŸ“¥ é˜…è¯»æœ¬åœ°ç‰ˆæœ¬ï¼š${java.timeFormat(source.lastUpdateTime)}</td></tr>\n        <tr><td style=\"text-align: left;\">${comment.slice(2, 9).join(\"<br>\")}</td></tr>\n        <tr><td style=\"text-align: left;\">${comment.slice(comment.length-9, comment.length).join(\"<br>\")}</td></tr>\n    </table>\n    \n    <table border=\"0\" cellspacing=\"20\">\n        <th colspan=\"2\"> æ›´æ–° ${source.bookSourceName} ä¹¦æº </th>\n        <tr><td><div class=\"ann\">\n            <a href=\"legado://import/importonline?src=https://cdn.jsdelivr.net/gh/windyhusky/PixivSource@main/${sourceName}.json\">\n            <button><span>æ›´æ–°ä¹¦æº<br>(Jsdelivr CDN)</span></button>\n            </a></div></td>\n            \n            <td><div class=\"ann\">\n            <a href=\"legado://import/importonline?src=https://cdn.jsdelivr.net/gh/windyhusky/PixivSource@main/btsrk.json\">\n            <button><span>æ›´æ–°è®¢é˜…<br>(Jsdelivr CDN)</span></button>\n            </a></div></td>\n        </tr>\n        \n        <tr><td><div class=\"ann\">\n            <a href=\"legado://import/importonline?src=https://raw.githubusercontent.com/windyhusky/PixivSource/main/${sourceName}.json\">\n            <button><span>ä¹¦æºé“¾æ¥<br>(GitHub)</span></button>\n            </a></div></td>\n            \n            <td><div class=\"ann\">\n            <a href=\"legado://import/importonline?src=https://raw.githubusercontent.com/windyhusky/PixivSource/main/btsrk.json\">\n            <button><span>è®¢é˜…é“¾æ¥<br>(GitHub)</span></button>\n            </a></div></td>\n        </tr>\n        \n        <tr><td><div class=\"ann\">\n            <a href=\"legado://import/importonline?src=https://codeberg.org/DowneyRem/PixivSource/raw/branch/main/${sourceName}.json\">\n            <button><span>å¤‡ç”¨ä¹¦æºé“¾æ¥<br>(Codeberg)</span></button>\n            </a></div></td>\n            \n            <td><div class=\"ann\">\n            <a href=\"legado://import/importonline?src=https://codeberg.org/DowneyRem/PixivSource/raw/branch/main/btsrk.json\">\n            <button><span>å¤‡ç”¨è®¢é˜…é“¾æ¥<br>(Codeberg)</span></button>\n            </a></div></td>\n        </tr>\n    </table>\n</body>\n</html>`;\n    java.startBrowser(htm,'æ›´æ–°ä¹¦æº');\n    return []\n}",
        "lastUpdateTime": 1749096000251,
        "loginCheckJs": "var util = {}\n\nfunction objStringify(obj) {\n    return JSON.stringify(obj, (n, v) => {\n        if (typeof v == \"function\")\n            return v.toString();\n        return v;\n    });\n}\n\nfunction publicFunc() {\n    let u = {}, settings\n    java.log(String(source.bookSourceComment).split(\"\\n\")[0])       // è¾“å‡ºä¹¦æºä¿¡æ¯\n    java.log(`æœ¬åœ°ä¹¦æºæ›´æ–°æ—¶é—´ï¼š${java.timeFormat(source.lastUpdateTime)}`) // è¾“å‡ºä¹¦æºä¿¡æ¯\n\n    // è·å–è®¾ç½®ï¼Œå¤‡ç”¨ä¹¦æºä½¿ç”¨æ—§ç‰ˆè®¾ç½®ï¼Œä¹¦æºä»ç¼“å­˜è·å–è®¾ç½®\n    if (source.bookSourceName.includes(\"å¤‡ç”¨\")) {\n        settings = JSON.parse(String(source.variableComment).match(RegExp(/{([\\s\\S]*?)}/gm)))\n    } else {\n        settings = getFromCache(\"pixivSettings\")\n    }\n    if (settings !== null) {\n        java.log(\"âš™ï¸ ä½¿ç”¨è‡ªå®šä¹‰è®¾ç½®\")\n    } else {\n        settings = {}\n        settings.CONVERT_CHINESE = true     // æœç´¢ï¼šæœç´¢æ—¶è¿›è¡Œç¹ç®€è½¬æ¢\n        settings.MORE_INFORMATION = false   // è¯¦æƒ…ï¼šä¹¦ç±ç®€ä»‹æ˜¾ç¤ºæ›´å¤šä¿¡æ¯\n        settings.SHOW_UPDATE_TIME = true    // ç›®å½•ï¼šæ˜¾ç¤ºæ›´æ–°æ—¶é—´ï¼Œä½†ä¼šå¢åŠ å°‘è®¸è¯·æ±‚\n        settings.SHOW_ORIGINAL_LINK = true  // ç›®å½•ï¼šæ˜¾ç¤ºåŸå§‹é“¾æ¥ï¼Œä½†ä¼šå¢åŠ å¤§é‡è¯·æ±‚\n        settings.REPLACE_TITLE_MARKS = true // æ­£æ–‡ï¼šæ³¨éŸ³å†…å®¹ä¸ºæ±‰å­—æ—¶ï¼Œæ›¿æ¢ä¸ºä¹¦åå·\n        settings.SHOW_CAPTIONS = true       // æ­£æ–‡ï¼šç« é¦–æ˜¾ç¤ºæè¿°\n        settings.SHOW_COMMENTS = true       // æ­£æ–‡ï¼šç« å°¾æ˜¾ç¤ºè¯„è®º\n        settings.FAST  = false              // å…¨å±€ï¼šå¿«é€Ÿæ¨¡å¼\n        settings.DEBUG = false              // å…¨å±€ï¼šè°ƒè¯•æ¨¡å¼\n        java.log(\"âš™ï¸ ä½¿ç”¨é»˜è®¤è®¾ç½®ï¼ˆæ— è‡ªå®šä¹‰è®¾ç½® æˆ– è‡ªå®šä¹‰è®¾ç½®æœ‰è¯¯ï¼‰\")\n    }\n\n    u.CONVERT_CHINESE = settings.CONVERT_CHINESE\n    u.MORE_INFORMATION = settings.MORE_INFORMATION\n    u.SHOW_UPDATE_TIME = settings.SHOW_UPDATE_TIME\n    u.SHOW_ORIGINAL_LINK = settings.SHOW_ORIGINAL_LINK\n    u.REPLACE_TITLE_MARKS = settings.REPLACE_TITLE_MARKS\n    u.SHOW_CAPTIONS = settings.SHOW_CAPTIONS\n    u.SHOW_COMMENTS = settings.SHOW_COMMENTS\n    u.FAST  = settings.FAST\n    u.DEBUG = settings.DEBUG\n\n    if (u.FAST === true) {\n        u.CONVERT_CHINESE = settings.CONVERT_CHINESE = false        // æœç´¢ï¼šç¹ç®€é€šæœ\n        u.SHOW_UPDATE_TIME = settings.SHOW_UPDATE_TIME = true       // ç›®å½•ï¼šæ˜¾ç¤ºç« èŠ‚æ›´æ–°æ—¶é—´\n        u.SHOW_ORIGINAL_LINK = settings.SHOW_ORIGINAL_LINK = false  // ç›®å½•ï¼šæ˜¾ç¤ºç« èŠ‚æºé“¾æ¥\n        u.SHOW_CAPTIONS = settings.SHOW_CAPTIONS = true             // æ­£æ–‡ï¼šæ˜¾ç¤ºè¯„è®º\n    }\n    cache.put(\"pixivSettings\", JSON.stringify(settings))  // è®¾ç½®å†™å…¥ç¼“å­˜\n\n    if (u.DEBUG === true) {\n        java.log(JSON.stringify(settings, null, 4))\n        java.log(`DEBUG = ${u.DEBUG}`)\n    }\n    u.debugFunc = (func) => {\n        if (util.DEBUG) {\n            func()\n        }\n    }\n\n    // å°†å¤šä¸ªé•¿ç¯‡å°è¯´è§£æä¸ºä¸€æœ¬ä¹¦\n    u.combineNovels = function (novels) {\n        return novels.filter(novel => {\n            // å•æœ¬ç›´æ¥è§£æä¸ºä¸€æœ¬ä¹¦\n            if (novel.seriesId === undefined || novel.seriesId === null) {\n                return true\n            }\n            // é›†åˆä¸­æ²¡æœ‰è¯¥ç³»åˆ—è§£æä¸ºä¸€æœ¬ä¹¦\n            if (!seriesSet.has(novel.seriesId)) {\n                seriesSet.add(novel.seriesId)\n                return true\n            }\n            return false\n        })\n    }\n\n    // å¤„ç† novels åˆ—è¡¨\n    u.handNovels = function (novels, detailed=false) {\n        let authors = getFromCache(\"blockAuthorList\")  // å±è”½ä½œè€…\n        if (authors !== null) {\n            java.log(`å±è”½ä½œè€…IDï¼š${JSON.stringify(authors)}`)\n            authors.forEach(author => {\n                novels = novels.filter(novel => novel.userId !== String(author))\n            })\n        }\n\n        novels.forEach(novel => {\n            // novel.id = novel.id\n            // novel.title = novel.title\n            // novel.userName = novel.userName\n            // novel.userId = novel.userId\n            // novel.tags = novel.tags\n            cache.put(`${novel.userName}`, novel.userId)  // åŠ å…¥ç¼“å­˜ï¼Œä¾¿äºæœç´¢ä½œè€…\n            if (novel.tags === undefined || novel.tags === null) {\n                novel.tags = []\n            }\n            // é»˜è®¤æœç´¢\n            if (novel.isOneshot === undefined) {\n                // novel.seriesId = novel.seriesId\n                // novel.seriesTitle = novel.seriesTitle\n                // novel.textCount = novel.textCount\n                // novel.description = novel.description\n                novel.coverUrl = novel.url\n                // novel.createDate = novel.createDate\n                // novel.updateDate = novel.updateDate\n            } else {  // æœç´¢ç³»åˆ—\n                if (novel.isOneshot === true) {\n                    novel.seriesId = undefined\n                    novel.id = novel.novelId  // è·å–çœŸæ­£çš„ novelId\n                    novel.seriesTitle = undefined\n                } else {\n                    novel.seriesId = novel.id\n                    novel.id = novel.novelId = novel.latestEpisodeId  // è·å–çœŸæ­£çš„ novelId\n                    novel.seriesTitle = novel.title\n                }\n                novel.textCount = novel.textLength\n                novel.description = novel.caption\n                novel.coverUrl = novel.cover.urls[\"480mw\"]\n                novel.createDate = novel.createDateTime\n                novel.updateDate = novel.updateDateTime\n            }\n\n            // æ­£æ–‡è¯¦æƒ…é¡µ\n            if (novel.content !== undefined) {\n                novel.novelId = novel.id\n                novel.tags = novel.tags.tags.map(item => item.tag)\n                novel.textCount = novel.userNovels[`${novel.id}`].textCount\n                // novel.latestChapter = novel.title\n                // novel.description = novel.description\n                novel.coverUrl = novel.userNovels[`${novel.id}`].url\n                // novel.createDate = novel.createDate\n                novel.updateDate = novel.uploadDate\n                if (novel.seriesNavData !== undefined && novel.seriesNavData !== null) {\n                    novel.seriesId = novel.seriesNavData.seriesId\n                    novel.seriesTitle = novel.seriesNavData.title\n                }\n            }\n            // ç³»åˆ—è¯¦æƒ…\n            if (novel.firstNovelId !== undefined) {\n                novel.seriesId = novel.id\n                novel.id = novel.novelId = novel.firstNovelId\n                novel.seriesTitle = novel.title\n                novel.coverUrl = novel.cover.urls[\"480mw\"]\n            }\n\n            if (novel.seriesId === undefined || novel.seriesId === null) {  // å•ç¯‡\n                novel.tags.unshift(\"å•æœ¬\")\n                novel.latestChapter = novel.title\n                novel.detailedUrl = urlNovelDetailed(novel.id)\n            }\n            if (novel.seriesId !== undefined && detailed === false) {\n                novel.id = novel.seriesId\n                novel.firstNovelId = novel.novelId\n                novel.title = novel.seriesTitle\n                novel.tags.unshift(\"é•¿ç¯‡\")\n                novel.detailedUrl = urlSeriesDetailed(novel.seriesId)\n                // novel.seriesNavData = {}\n                // novel.seriesNavData.seriesId = novel.seriesId\n                // novel.seriesNavData.title = novel.seriesTitle\n            }\n\n            if (novel.seriesId !== undefined && detailed === true) {\n                let series = getAjaxJson(urlSeriesDetailed(novel.seriesId)).body\n                novel.id = series.firstNovelId\n                novel.title = series.title\n                // novel.userName = novel.userName\n                novel.tags = novel.tags.concat(series.tags)\n                novel.tags.unshift(\"é•¿ç¯‡\")\n                novel.textCount = series.publishedTotalCharacterCount\n                novel.description = series.caption\n                novel.coverUrl = series.cover.urls[\"480mw\"]\n\n                // å‘é€è¯·æ±‚è·å–ç¬¬ä¸€ç«  è·å–æ ‡ç­¾ä¸ç®€ä»‹\n                let firstNovel = {}\n                try {\n                    firstNovel = getAjaxJson(urlNovelDetailed(series.firstNovelId)).body\n                    novel.tags = novel.tags.concat(firstNovel.tags.tags.map(item => item.tag))\n                } catch (e) {  // é˜²æ­¢ç³»åˆ—é¦–ç¯‡æ— æƒé™è·å–\n                    try {\n                        firstNovel = getAjaxJson(urlSeriesNovels(novel.seriesId, 30, 0)).body.thumbnails.novel[0]\n                        novel.id = novel.firstNovelId = firstNovel.id\n                        novel.tags = novel.tags.concat(firstNovel.tags)\n                    } catch (e) { // é˜²æ­¢ç³»åˆ—é¦–ç¯‡æ— æƒé™è·å–\n                        firstNovel = {}\n                        firstNovel.description = \"\"\n                    }\n                }\n                novel.tags.unshift(\"é•¿ç¯‡\")\n                if (novel.description === \"\") {\n                    novel.description = firstNovel.description\n                }\n            }\n        })\n        util.debugFunc(() => {\n            java.log(`å¤„ç†å°è¯´å®Œæˆ`)\n        })\n        return novels\n    }\n\n    // å°è¯´ä¿¡æ¯æ ¼å¼åŒ–\n    u.formatNovels = function (novels) {\n        novels.forEach(novel => {\n            novel.title = novel.title.replace(RegExp(/^\\s+|\\s+$/g), \"\")\n            novel.coverUrl = urlCoverUrl(novel.coverUrl)\n            novel.readingTime = `${novel.readingTime / 60} åˆ†é’Ÿ`\n            novel.createDate = dateFormat(novel.createDate);\n            novel.updateDate = dateFormat(novel.updateDate);\n\n            novel.tags2 = []\n            for (let i in novel.tags) {\n                let tag = novel.tags[i]\n                if (tag.includes(\"/\")) {\n                    let tags = tag.split(\"/\")\n                    novel.tags2 = novel.tags2.concat(tags)\n                } else {\n                    novel.tags2.push(tag)\n                }\n            }\n            novel.tags = Array.from(new Set(novel.tags2))\n            novel.tags = novel.tags.join(\",\")\n\n            if (util.MORE_INFORMATION) {\n                novel.description = `\\nä¹¦åï¼š${novel.title}\\nä½œè€…ï¼š${novel.userName}\\næ ‡ç­¾ï¼š${novel.tags}\\nä¸Šä¼ ï¼š${novel.createDate}\\næ›´æ–°ï¼š${novel.updateDate}\\nç®€ä»‹ï¼š${novel.description}`\n            } else {\n                novel.description = `\\n${novel.description}\\nä¸Šä¼ æ—¶é—´ï¼š${novel.createDate}\\næ›´æ–°æ—¶é—´ï¼š${novel.updateDate}`\n            }\n        })\n        return novels\n    }\n\n    // æ­£æ–‡ï¼Œè¯¦æƒ…ï¼Œæœç´¢ï¼šä»ç½‘å€è·å–idï¼Œè¿”å›å•ç¯‡å°è¯´ resï¼Œç³»åˆ—è¿”å›é¦–ç¯‡å°è¯´ res\n    // pixiv é»˜è®¤åˆ†äº«ä¿¡æ¯ä¸­æœ‰#å·ï¼Œä¸ä¼šè¢«è¯†åˆ«æˆé“¾æ¥ï¼Œæ— æ³•ä½¿ç”¨æ·»åŠ ç½‘å€\n    u.getNovelRes = function (result) {\n        let novelId = 0, res = {\"body\": {}}\n        let isJson = isJsonString(result)\n        let isHtml = isHtmlString(result)\n\n        if (!isJson && isHtml) {\n            let id = baseUrl.match(new RegExp(\"\\\\d+\"))[0]\n            let pattern = \"(https?://)?(www\\\\.)?pixiv\\\\.net/novel/series/\\\\d+\"\n            let isSeries = baseUrl.match(new RegExp(pattern))\n            if (isSeries) {\n                java.log(`ç³»åˆ—IDï¼š${id}`)\n                try {\n                    novelId = getAjaxJson(urlSeriesDetailed(id)).body.firstNovelId\n                } catch (e) {\n                    novelId = getAjaxJson(urlSeriesNovels(id, 30, 0)).body.thumbnails.novel[0].id\n                }\n            } else {\n                let pattern = \"(https?://)?(www\\\\.)?pixiv\\\\.net/novel/(show\\\\.php\\\\?id=)?\\\\d+\"\n                let isNovel = baseUrl.match(new RegExp(pattern))\n                if (isNovel) {\n                    novelId = id\n                }\n            }\n        }\n        if (isJson) {\n            res = JSON.parse(result)\n        }\n\n        if (novelId) {\n            java.log(`åŒ¹é…å°è¯´IDï¼š${novelId}`)\n            res = getAjaxJson(urlNovelDetailed(novelId))\n        }\n        if (res.error === true) {\n            java.log(`æ— æ³•ä» Pixiv è·å–å½“å‰å°è¯´`)\n            java.log(JSON.stringify(res))\n        }\n        return res.body\n    }\n\n    // ç›®å½•ï¼šä»ç½‘å€è·å–idï¼Œå°½å¯èƒ½è¿”å›ç³»åˆ— resï¼Œå•ç¯‡å°è¯´è¿”å›å°è¯´ res\n    u.getNovelResSeries = function (result) {\n        let seriesId = 0, res = {\"body\": {}}\n        let isJson = isJsonString(result)\n        let isHtml = isHtmlString(result)\n\n        if (!isJson && isHtml) {\n            let id = baseUrl.match(new RegExp(\"\\\\d+\"))[0]\n            let pattern = \"(https?://)?(www\\\\.)?pixiv\\\\.net/novel/series/\\\\d+\"\n            let isSeries = baseUrl.match(new RegExp(pattern))\n            if (isSeries) {\n                seriesId = id\n            } else {\n                let pattern = \"(https?://)?(www\\\\.)?pixiv\\\\.net/novel/(show\\\\.php\\\\?id=)?\\\\d+\"\n                let isNovel = baseUrl.match(new RegExp(pattern))\n                if (isNovel) {\n                    java.log(`åŒ¹é…å°è¯´IDï¼š${id}`)\n                    res = getAjaxJson(urlNovelDetailed(id))\n                }\n            }\n        }\n        if (isJson) {\n            res = JSON.parse(result)\n        }\n\n        if (res.body !== undefined && res.body.seriesNavData !== undefined && res.body.seriesNavData !== null) {\n            seriesId = res.body.seriesNavData.seriesId\n        }\n        if (seriesId) {\n            java.log(`ç³»åˆ—IDï¼š${seriesId}`)\n            res = getAjaxJson(urlSeriesDetailed(seriesId))\n        }\n        if (res.error === true) {\n            java.log(`æ— æ³•ä» Pixiv è·å–å½“å‰å°è¯´`)\n            java.log(JSON.stringify(res))\n        }\n        return res.body\n    }\n\n    util = u\n    java.put(\"util\", objStringify(u))\n}\n\nfunction checkMessageThread(checkTimes) {\n    if (checkTimes === undefined) {\n        checkTimes = Number(cache.get(\"checkTimes\"))\n    }\n    if (checkTimes === 0 && isLogin()) {\n        let latestMsg = getAjaxJson(urlMessageThreadLatest(5))\n        if (latestMsg.error === true) {\n            java.log(JSON.stringify(latestMsg))\n        } else if (latestMsg.body.total >= 1) {\n            let msg = latestMsg.body.message_threads.filter(item => item.thread_name === \"pixiväº‹å‹™å±€\")[0]\n            if (msg !== undefined && new Date().getTime()- 1000*msg.modified_at <= 3*24*60*60*1000) { // 3å¤©å†…è¿›è¡Œæç¤º\n                sleepToast(`æ‚¨äº ${java.timeFormat(1000*msg.modified_at)} è§¦å‘ Pixiv ã€è¿‡åº¦è®¿é—®ã€‘ï¼Œè¯·ä¿®æ”¹å¯†ç å¹¶é‡æ–°ç™»å½•ã€‚\\nå¦‚å·²ä¿®æ”¹è¯·å¿½ç•¥`, 3)\n                sleepToast(`${msg.latest_content}`, 5)\n                java.startBrowser(\"https://accounts.pixiv.net/password/change\",'ä¿®æ”¹å¯†ç ')\n            }\n        }\n    }\n    cache.put(\"checkTimes\", checkTimes + 1, 4*60*60)  // ç¼“å­˜4hï¼Œæ¯4hæé†’ä¸€æ¬¡\n    // cache.put(\"checkTimes\", checkTimes + 1, 60)  // æµ‹è¯•ç”¨ï¼Œç¼“å­˜60sï¼Œæ¯åˆ†é’Ÿæé†’ä¸€æ¬¡\n    // java.log(checkTimes + 1)\n}\n\n// è·å–è¯·æ±‚çš„user idæ–¹ä¾¿å…¶ä»–ajaxè¯·æ±‚æ„é€ \nfunction getPixivUid() {\n    let uid = java.getResponse().headers().get(\"x-userid\")\n    if (uid != null) {\n        cache.put(\"pixiv:uid\", String(uid))\n    }\n}\n\nfunction getCookie() {\n    let pixivCookie = String(java.getCookie(\"https://www.pixiv.net/\", null))\n    if (pixivCookie.includes(\"first_visit_datetime\")) {\n        cache.put(\"pixivCookie\", pixivCookie, 60*60)\n        return pixivCookie\n    }\n}\n\n// è·å– Csrf Tokenï¼Œä»¥ä¾¿è¿›è¡Œæ”¶è—ç­‰è¯·æ±‚\n// è·å–æ–¹æ³•æ¥è‡ªè„šæœ¬ Pixiv Previewer\n// https://github.com/Ocrosoft/PixivPreviewer\n// https://greasyfork.org/zh-CN/scripts/30766-pixiv-previewer/code\nfunction getCsrfToken() {\n    let csfrToken = getWebviewJson(\"https://www.pixiv.net/\", html => {\n        return JSON.stringify(html.match(/token\\\\\":\\\\\"([a-z0-9]{32})/)[1])\n    })\n    cache.put(\"csfrToken\", csfrToken)  // ä¸ç™»å½•è®¾å¤‡æœ‰å…³\n    return csfrToken\n}\n\nfunction getHeaders() {\n    let headers = {\n        \"accept\": \"application/json\",\n        \"accept-encoding\": \"gzip, deflate, br, zstd\",\n        \"accept-language\": \"zh-CN\",\n        // \"content-type\": \"application/json; charset=utf-8\",\n        // \"content-type\": \"application/x-www-form-urlencoded; charset=utf-8\",\n        \"origin\": \"https//www.pixiv.net\",\n        \"referer\": \"https://www.pixiv.net/\",\n        // \"sec-ch-ua\": `\"Not/A)Brand\";v=\"8\", \"Chromium\";v=\"132\", \"Google Chrome\";v=\"132\"`,\n        // \"sec-ch-ua-mobile\": \"?0\",\n        // \"sec-ch-ua-platform\": \"Windows\",\n        // \"sec-fetch-dest\": \"empty\",\n        // \"sec-fetch-mode\": \"cors\",\n        // \"sec-fetch-site\": \"same-origin\",\n        \"user-agent\": String(java.getUserAgent()),\n        \"x-csrf-token\": cache.get(\"csfrToken\"),\n        \"Cookie\": cache.get(\"pixivCookie\")\n    }\n    cache.put(\"headers\", JSON.stringify(headers))\n    return headers\n}\n\nfunction getBlockAuthorsFromSource() {\n    let authors = []\n    try {\n        authors = JSON.parse(`[${source.getVariable()}]`)\n        // sleepToast(JSON.stringify(authors))\n    } catch (e) {\n        sleepToast(\"ğŸš« å±è”½ä½œè€…\\nâš ï¸ ã€ä¹¦æºã€‘æºå˜é‡è®¾ç½®æœ‰è¯¯\\nè¾“å…¥ä½œè€…IDï¼Œä»¥è‹±æ–‡é€—å·é—´éš”ï¼Œä¿å­˜\")\n    }\n    return authors\n}\n\nfunction syncBlockAuthorList() {\n    let authors1 = getFromCache(\"blockAuthorList\")\n    let authors2 = getBlockAuthorsFromSource()\n    if (authors1 === null) {\n        cache.put(\"blockAuthorList\", JSON.stringify(authors2))\n    } else if (authors1.length > authors2.length) {\n        cache.put(\"blockAuthorList\", JSON.stringify(authors2))\n        java.log(\"å±è”½ä½œè€…ï¼šå·²å°†æºå˜é‡åŒæ­¥è‡³å†…å­˜\")\n    }\n}\n\npublicFunc(); syncBlockAuthorList()\nif (result.code() === 200) {\n    getPixivUid(); getCsrfToken(); getCookie(); getHeaders()\n    if (!util.FAST) checkMessageThread()  // æ£€æµ‹è¿‡åº¦è®¿é—®\n//     if (isHtmlString(result.body())) {  // æ£€æµ‹ç™»å½•\n//         let loginStatus = getWebviewJson(baseUrl, html => {\n//             return JSON.stringify(html.match(/login:\\s*'([^']+)'/)[1])\n//         })\n//         if (loginStatus !== \"yes\") sleepToast(\"è¯·ç™»å½•\")\n//     }\n// } else if (result.code() === 400) {\n//     sleepToast(\"è¯·é‡æ–°ç™»å½•\")\n//     source.login()\n}\nutil.debugFunc(() => {\n    java.log(`${java.getUserAgent()}\\n`)\n    java.log(`${cache.get(\"csfrToken\")}\\n`)\n    java.log(`${cache.get(\"pixivCookie\")}\\n`)\n})\njava.getStrResponse(null, null)",
        "loginUi": "[\n    {\n        \"name\": \"\\uD83C\\uDD7Fï¸ ç™»å½•è´¦å·\",\n        \"type\": \"button\",\n        \"action\": \"login()\",\n        \"style\": {\n            \"layout_flexGrow\": 1,\n            \"layout_flexBasisPercent\": -1\n        }\n    },\n    {\n        \"name\": \"âš™ï¸ è´¦å·è®¾ç½®\",\n        \"type\": \"button\",\n        \"action\": \"startPixivSettings()\",\n        \"style\": {\n            \"layout_flexGrow\": 1,\n            \"layout_flexBasisPercent\": -1\n        }\n    },\n    {\n        \"name\": \"\\uD83D\\uDD19 é€€å‡ºè´¦å·\",\n        \"type\": \"button\",\n        \"action\": \"logout()\",\n        \"style\": {\n            \"layout_flexGrow\": 1,\n            \"layout_flexBasisPercent\": -1\n        }\n    },\n    {\n        \"name\": \"ğŸ†™ æ›´æ–°ä¹¦æº\",\n        \"type\": \"button\",\n        \"action\": \"updateSource()\",\n        \"style\": {\n            \"layout_flexGrow\": 1,\n            \"layout_flexBasisPercent\": -1\n        }\n    },\n    {\n        \"name\": \"\\uD83D\\uDD30 ä½¿ç”¨æŒ‡å—\",\n        \"type\": \"button\",\n        \"action\": \"startGithubReadme()\",\n        \"style\": {\n            \"layout_flexGrow\": 1,\n            \"layout_flexBasisPercent\": -1\n        }\n    },\n    {\n        \"name\": \"\\uD83D\\uDC1E åé¦ˆé—®é¢˜\",\n        \"type\": \"button\",\n        \"action\": \"startGithubIssue()\",\n        \"style\": {\n            \"layout_flexGrow\": 1,\n            \"layout_flexBasisPercent\": -1\n        }\n    },\n    {\n        \"name\": \"â¤ï¸ å…¬å¼€æ”¶è—\",\n        \"type\": \"button\",\n        \"action\": \"novelBookmarkFactory(1)\",\n        \"style\": {\n            \"layout_flexGrow\": 1,\n            \"layout_flexBasisPercent\": -1\n        }\n    },\n    {\n        \"name\": \"ãŠ™ï¸ ç§å¯†æ”¶è—\",\n        \"type\": \"button\",\n        \"action\": \"novelBookmarkFactory(2)\",\n        \"style\": {\n            \"layout_flexGrow\": 1,\n            \"layout_flexBasisPercent\": -1\n        }\n    },\n    {\n        \"name\": \"\\uD83D\\uDCCC å½“å‰ç« èŠ‚\",\n        \"type\": \"button\",\n        \"action\": \"charpterRead()\",\n        \"style\": {\n            \"layout_flexGrow\": 1,\n            \"layout_flexBasisPercent\": -1\n        }\n    },\n    {\n        \"name\": \"\\uD83D\\uDCC3 è¿½æ›´ç³»åˆ—\",\n        \"type\": \"button\",\n        \"action\": \"seriesWatchFactory()\",\n        \"style\": {\n            \"layout_flexGrow\": 1,\n            \"layout_flexBasisPercent\": -1\n        }\n    },\n    {\n        \"name\": \"â­ï¸ å…³æ³¨ä½œè€…\",\n        \"type\": \"button\",\n        \"action\": \"userFollowFactory()\",\n        \"style\": {\n            \"layout_flexGrow\": 1,\n            \"layout_flexBasisPercent\": -1\n        }\n    },\n    {\n        \"name\": \"\\uD83D\\uDEAB å±è”½ä½œè€…\",\n        \"type\": \"button\",\n        \"action\": \"userBlock()\",\n        \"style\": {\n            \"layout_flexGrow\": 1,\n            \"layout_flexBasisPercent\": -1\n        }\n    },\n    {\n        \"name\": \"å‘é€è¯„è®º\",\n        \"type\": \"text\"\n    },\n    {\n        \"name\": \"âœ… å‘é€è¯„è®º\",\n        \"type\": \"button\",\n        \"action\": \"novelCommentAdd()\",\n        \"style\": {\n            \"layout_flexGrow\": 1,\n            \"layout_flexBasisPercent\": -1\n        }\n    },\n    {\n        \"name\": \"\\uD83D\\uDDD1 åˆ é™¤è¯„è®º\",\n        \"type\": \"button\",\n        \"action\": \"novelCommentDelete()\",\n        \"style\": {\n            \"layout_flexGrow\": 1,\n            \"layout_flexBasisPercent\": -1\n        }\n    },\n    {\n        \"name\": \"\\uD83D\\uDCC4 åŠŸèƒ½è¯´æ˜\",\n        \"type\": \"button\",\n        \"action\": \"readMeLogin()\",\n        \"style\": {\n            \"layout_flexGrow\": 1,\n            \"layout_flexBasisPercent\": -1\n        }\n    },\n    {\n        \"name\": \"\\uD83D\\uDD0D æœç´¢è¯´æ˜\",\n        \"type\": \"button\",\n        \"action\": \"readMeSearch()\",\n        \"style\": {\n            \"layout_flexGrow\": 1,\n            \"layout_flexBasisPercent\": -1\n        }\n    },\n    {\n        \"name\": \"\\uD83C\\uDC04 ç¹ç®€é€šæœ\",\n        \"type\": \"button\",\n        \"action\": \"editSettings('CONVERT_CHINESE')\",\n        \"style\": {\n            \"layout_flexGrow\": 1,\n            \"layout_flexBasisPercent\": -1\n        }\n    },\n    {\n        \"name\": \"\\uD83D\\uDCD6 æ›´å¤šç®€ä»‹\",\n        \"type\": \"button\",\n        \"action\": \"editSettings('MORE_INFORMATION')\",\n        \"style\": {\n            \"layout_flexGrow\": 1,\n            \"layout_flexBasisPercent\": -1\n        }\n    },\n    {\n        \"name\": \"\\uD83D\\uDCC5 æ›´æ–°æ—¶é—´\",\n        \"type\": \"button\",\n        \"action\": \"editSettings('SHOW_UPDATE_TIME')\",\n        \"style\": {\n            \"layout_flexGrow\": 1,\n            \"layout_flexBasisPercent\": -1\n        }\n    },\n    {\n        \"name\": \"\\uD83D\\uDD17 åŸå§‹é“¾æ¥\",\n        \"type\": \"button\",\n        \"action\": \"editSettings('SHOW_ORIGINAL_LINK')\",\n        \"style\": {\n            \"layout_flexGrow\": 1,\n            \"layout_flexBasisPercent\": -1\n        }\n    },\n    {\n        \"name\": \"\\uD83D\\uDCDA æ¢å¤ã€Šã€‹\",\n        \"type\": \"button\",\n        \"action\": \"editSettings('REPLACE_TITLE_MARKS')\",\n        \"style\": {\n            \"layout_flexGrow\": 1,\n            \"layout_flexBasisPercent\": -1\n        }\n    },\n    {\n        \"name\": \"\\uD83D\\uDDBCï¸ æ˜¾ç¤ºæè¿°\",\n        \"type\": \"button\",\n        \"action\": \"editSettings('SHOW_CAPTIONS')\",\n        \"style\": {\n            \"layout_flexGrow\": 1,\n            \"layout_flexBasisPercent\": -1\n        }\n    },\n    {\n        \"name\": \"\\uD83D\\uDCAC æ˜¾ç¤ºè¯„è®º\",\n        \"type\": \"button\",\n        \"action\": \"editSettings('SHOW_COMMENTS')\",\n        \"style\": {\n            \"layout_flexGrow\": 1,\n            \"layout_flexBasisPercent\": -1\n        }\n    },\n    {\n        \"name\": \"â© å¿«é€Ÿæ¨¡å¼\",\n        \"type\": \"button\",\n        \"action\": \"editSettings('FAST')\",\n        \"style\": {\n            \"layout_flexGrow\": 1,\n            \"layout_flexBasisPercent\": -1\n        }\n    }\n]",
        "loginUrl": "function login() {\n    let resp = java.startBrowserAwait(`https://accounts.pixiv.net/login,{\"headers\": {\"User-Agent\": \"${cache.get(\"userAgent\")}\"}}`, 'ç™»å½•è´¦å·', false)\n    if (resp.code() === 200) {\n        getCookie(); getCsrfToken()\n    } else {\n        java.log(resp.code()); sleepToast(\"âš ï¸ ç™»å½•å¤±è´¥\")\n    }\n    return resp.body()\n}\n\nfunction logout() {\n    removeCookie()\n    java.startBrowser(\"https://www.pixiv.net/logout.php\", \"é€€å‡ºè´¦å·\")\n    removeCookie()\n    sleepToast(`âœ…å·²é€€å‡ºå½“å‰è´¦å·\\n\\né€€å‡ºåè¯·ç‚¹å‡»å³ä¸Šè§’çš„ âœ”ï¸ é€€å‡º\\n\\nç™»å½•è¯·ç‚¹å‡»ã€ç™»å½•è´¦å·ã€‘è¿›è¡Œç™»å½•`)\n}\n\nfunction removeCookie() {\n    cookie.removeCookie('https://www.pixiv.net')\n    cookie.removeCookie('https://accounts.pixiv.net')\n    cookie.removeCookie('https://accounts.google.com')\n    cookie.removeCookie('https://api.weibo.com')\n    cache.delete(\"pixivCookie\")\n    cache.delete(\"csfrToken\")  // ä¸ç™»å½•è®¾å¤‡æœ‰å…³\n    cache.delete(\"headers\")\n}\n\n// è·å– Csrf Tokenï¼Œä»¥ä¾¿è¿›è¡Œæ”¶è—ç­‰è¯·æ±‚\n// è·å–æ–¹æ³•æ¥è‡ªè„šæœ¬ Pixiv Previewer\n// https://github.com/Ocrosoft/PixivPreviewer\n// https://greasyfork.org/zh-CN/scripts/30766-pixiv-previewer/code\nfunction getCsrfToken() {\n    let csfrToken = getWebviewJson(\"https://www.pixiv.net/\", html => {\n        return JSON.stringify(html.match(/token\\\\\":\\\\\"([a-z0-9]{32})/)[1])\n    })\n    // java.log(csfrToken)\n    cache.put(\"csfrToken\", csfrToken)  // ä¸ç™»å½•è®¾å¤‡æœ‰å…³\n    return csfrToken\n}\n\nfunction getCookie() {\n    let pixivCookie = String(java.getCookie(\"https://www.pixiv.net/\", null))\n    if (pixivCookie.includes(\"first_visit_datetime\")) {\n        // java.log(pixivCookie)\n        cache.put(\"pixivCookie\", pixivCookie, 60*60)\n        return pixivCookie\n    }\n}\n\nfunction getPostBody(url, body, headers) {\n    if (headers === undefined) headers = getFromCache(\"headers\")\n    if (isJsonString(body)) {\n        headers[\"content-type\"] = \"application/json; charset=utf-8\"\n    } else if (typeof(body) == \"string\") {\n        headers[\"content-type\"] = \"application/x-www-form-urlencoded; charset=utf-8\"\n    }\n    try {\n        return JSON.parse(java.post(url, body, headers).body())\n    } catch (e) {\n        java.log(e)\n        if (String(e).includes(400)) sleepToast(`âš ï¸ ç¼ºå°‘ headers`)\n        else if (String(e).includes(403)) sleepToast(`âš ï¸ ç¼ºå°‘ cookie æˆ– cookie è¿‡æœŸ`)\n        else if (String(e).includes(422)) sleepToast(`âš ï¸ è¯·æ±‚ä¿¡æ¯æœ‰è¯¯`)\n        return {error: true}\n    }\n}\n\nfunction novelBookmarkAdd(restrict=0) {\n    let novel = source.getLoginInfoMap()\n    let resp = getPostBody(\n        \"https://www.pixiv.net/ajax/novels/bookmarks/add\",\n        JSON.stringify({\"novel_id\": novel.id, \"restrict\": restrict, \"comment\":\"\", \"tags\":[]})\n    )\n    if (resp.error === true) sleepToast(`âš ï¸ æ”¶è—ã€${novel.title}ã€‘å¤±è´¥`)\n    else if (resp.body === null) sleepToast(`âœ… å·²ç»æ”¶è—ã€${novel.title}ã€‘äº†`)\n    else {\n        cache.put(`collect${novel.id}`, resp.body);\n        sleepToast(`âœ… å·²æ”¶è—ã€${novel.title}ã€‘`)\n    }\n}\n\nfunction getNovelBookmarkId(novelId) {\n    let bookmarkId = getFromCache(`collect${novelId}`)\n    if (bookmarkId === null) {\n        bookmarkId = getAjaxJson(urlNovelBookmarkData(novelId), true).body.bookmarkData.id\n    }\n    return bookmarkId\n}\n\nfunction novelBookmarkDelete() {\n    let novel = source.getLoginInfoMap()\n    let resp = getPostBody(\n        \"https://www.pixiv.net/ajax/novels/bookmarks/delete\",\n        `del=1&book_id=${getNovelBookmarkId(novel.id)}`\n    )\n    if (resp.error === true) sleepToast(`âš ï¸ å–æ¶ˆæ”¶è—ã€${novel.title}ã€‘å¤±è´¥`)\n    else {\n        sleepToast(`âœ… å·²å–æ¶ˆæ”¶è—ã€${novel.title}ã€‘`)\n        cache.delete(`collect${novel.id}`)\n    }\n}\n\nfunction novelsBookmarkDelete(novelIds) {\n    let bookmarkIds = []\n    novelIds.forEach(novelId => {bookmarkIds.push(getNovelBookmarkId(novelId))})\n    let resp = getPostBody(\n        \"https://www.pixiv.net/ajax/novels/bookmarks/remove\",\n        JSON.stringify({\"bookmarkIds\": bookmarkIds})\n    )\n    if (resp.error === true) sleepToast(\"âš ï¸ å–æ¶ˆæ”¶è—å¤±è´¥\")\n    else {\n        sleepToast(\"âœ… å·²å–æ¶ˆæ”¶è—\")\n        novelIds.forEach(novelId => {cache.delete(`collect${novelId}`)})\n    }\n}\n\nfunction novelBookmarkFactory(code) {\n    let novel = source.getLoginInfoMap()\n    let collectId = getFromCache(`collect${novel.id}`)\n    if (collectId >= 1) code = 0\n\n    if (code === 0) novelBookmarkDelete()\n    else if (code === 1) novelBookmarkAdd(0)\n    else if (code === 2) novelBookmarkAdd(1)\n}\n\nfunction novelMarker(page=1) {\n    let novel = source.getLoginInfoMap()\n    let lastMarker = getFromCache(`marker${novel.id}`)\n    if (lastMarker === true) page = 0\n\n    let resp = getPostBody(\n        \"https://www.pixiv.net/novel/rpc_marker.php\",\n        `mode=save&i_id=${novel.id}&u_id=${getFromCache(\"pixiv:uid\")}&page=${page}`\n    )\n    java.log(`mode=save&i_id=${novel.id}&u_id=${getFromCache(\"pixiv:uid\")}&page=${page}`)\n    if (resp.error === true) sleepToast(\"âš ï¸ æ“ä½œå¤±è´¥\")\n    else if (lastMarker === true) {\n        cache.put(`marker${novel.id}`, false)\n        sleepToast(`âœ… å·²åˆ é™¤ä¹¦ç­¾`)\n    } else {\n        cache.put(`marker${novel.id}`, true)\n        sleepToast(`âœ… å·²åŠ å…¥ä¹¦ç­¾`)\n    }\n}\n\nfunction seriesWatch() {\n    let novel = source.getLoginInfoMap()\n    let resp = getPostBody(\n        `https://www.pixiv.net/ajax/novel/series/${novel.seriesId}/watch`,\n        \"{}\"\n    )\n    if (resp.error === true) sleepToast(`âš ï¸ è¿½æ›´ã€${novel.seriesTitle}ã€‘å¤±è´¥`)\n    else {\n        sleepToast(`âœ… å·²è¿½æ›´ã€${novel.seriesTitle}ã€‘`)\n        cache.put(`watch${novel.seriesId}`, true)\n    }\n}\n\nfunction seriesUnWatch() {\n    let novel = source.getLoginInfoMap()\n    let resp = getPostBody(\n        `https://www.pixiv.net/ajax/novel/series/${novel.seriesId}/unwatch`,\n        \"{}\"\n    )\n    if (resp.error === true) sleepToast(`âš ï¸ å–æ¶ˆè¿½æ›´ã€${novel.seriesTitle}ã€‘å¤±è´¥`)\n    else {\n        sleepToast(`âœ… å·²å–æ¶ˆè¿½æ›´ã€${novel.seriesTitle}ã€‘`)\n        cache.delete(`watch${novel.seriesId}`)\n    }\n}\n\nfunction seriesWatchFactory(code=1) {\n    let novel = source.getLoginInfoMap()\n    if (!novel.seriesId) {\n        return sleepToast(`âš ï¸ ã€${novel.title}ã€‘éç³»åˆ—å°è¯´ï¼Œæ— æ³•åŠ å…¥è¿½æ›´åˆ—è¡¨`)\n    }\n\n    let lastStatus = getFromCache(`watch${novel.seriesId}`)\n    if (lastStatus === true) code = 0\n    if (code === 0) seriesUnWatch()\n    else if (code === 1) seriesWatch()\n}\n\nfunction userFollow(restrict=0) {\n    let novel = source.getLoginInfoMap()\n    let resp = getPostBody(\n        \"https://www.pixiv.net/bookmark_add.php\",\n        `mode=add&type=user&user_id=${novel.userId}&tag=\"\"&restrict=${restrict}&format=json`\n    )\n    if (resp.error === true) sleepToast(`âš ï¸ å…³æ³¨ã€${novel.userName}ã€‘å¤±è´¥`)\n    else {\n        sleepToast(`âœ… å·²å…³æ³¨ã€${novel.userName}ã€‘`)\n        cache.put(`follow${novel.userId}`, true)\n    }\n}\n\nfunction userUnFollow() {\n    let novel = source.getLoginInfoMap()\n    let resp = getPostBody(\n        \"https://www.pixiv.net/rpc_group_setting.php\",\n        `mode=del&type=bookuser&id=${novel.userId}`\n    )\n    if (resp.error === true) sleepToast(`âš ï¸ å–æ¶ˆå…³æ³¨ã€${novel.userName}ã€‘å¤±è´¥`)\n    else {\n        sleepToast(`âœ… å·²å–æ¶ˆå…³æ³¨ã€${novel.userName}ã€‘`)\n        cache.delete(`follow${novel.userId}`)\n    }\n}\n\nfunction userFollowFactory(code=1) {\n    let novel = source.getLoginInfoMap()\n    let lastStatus = getFromCache(`follow${novel.userId}`)\n    if (lastStatus === true) code = 0\n\n    if (code === 0) userUnFollow()\n    else if (code === 1) userFollow()\n}\n\nfunction userBlackList() {\n    let action = \"block\"  // æ‹‰é»‘ä½œè€…ï¼Œéå±è”½ä½œæ¶è€…ä½œå“\n    let novel = source.getLoginInfoMap()\n    let lastStatus = getFromCache(`block${novel.userId}`)\n    if (lastStatus === true) action = \"unblock\"\n\n    let resp = getPostBody(\n        `https://www.pixiv.net/ajax/block/save`,\n        JSON.stringify({\"user_id\": novel.userId, \"action\": action})\n    )\n    // java.log(JSON.stringify({\"user_id\": novel.userId, \"action\": action}))\n    if (resp.error === true) sleepToast(\"âš ï¸ æ“ä½œå¤±è´¥\")\n    else if (lastStatus === true) {\n        cache.put(`block${novel.userId}`, false)\n        sleepToast(`âœ… å·²å–æ¶ˆæ‹‰é»‘${novel.userName}`)\n    } else {\n        cache.put(`block${novel.userId}`, true)\n        sleepToast(`âœ… å·²æ‹‰é»‘${novel.userName}`)\n    }\n}\n\nfunction userBlock() {\n    let authors = getFromCache(\"blockAuthorList\")\n    let novel = source.getLoginInfoMap()\n    if (authors.includes(Number(novel.userId))) {\n        authors = authors.filter(author => author !== Number(novel.userId))\n        sleepToast(`âœ… å·²å°†ã€${novel.userName}ã€‘ç§»å‡ºæœ¬åœ°å±è”½åå•`)\n    } else if (novel.userId !== undefined && novel.userId !== null) {\n        authors.push(Number(novel.userId))\n        sleepToast(`âœ… å·²å°†ã€${novel.userName}ã€‘åŠ å…¥æœ¬åœ°å±è”½åå•`)\n    }\n    cache.put(\"blockAuthorList\", JSON.stringify(authors))\n    source.setVariable(authors.toString())\n    // sleepToast(JSON.stringify(authors))\n}\n\nfunction novelCommentAdd() {\n    let userId = getFromCache(\"pixiv:uid\")\n    let novel = source.getLoginInfoMap()\n    let novelId = novel.id\n    let comment = String(result.get(\"å‘é€è¯„è®º\")).trim()\n    if (comment === \"\") {\n        return sleepToast(\"âš ï¸ è¯·è¾“å…¥éœ€è¦å‘é€çš„è¯„è®º\")\n    }\n    let resp = getPostBody(\n        \"https://www.pixiv.net/novel/rpc/post_comment.php\",\n        `type=comment&novel_id=${novelId}&author_user_id=${userId}&comment=${encodeURI(comment)}`\n    )\n\n    // let body = `type=comment&novel_id=${novelId}&author_user_id=${userId}`\n    // if (comment.includes(\"ï¼›\")) {\n    //     let comment = comment.split(\"ï¼›\")\n    //     body += `&comment=${encodeURI(comment[0])}&parent_id=${comment[1]}`\n    // } else body += `&comment=${encodeURI(comment)}`\n    // let resp = getPostBody(\"https://www.pixiv.net/novel/rpc/post_comment.php\", body)\n\n    if (resp.error === true) sleepToast(\"âš ï¸ è¯„è®ºå¤±è´¥\")\n    else sleepToast(`âœ… å·²åœ¨ã€${novel.title}ã€‘å‘å¸ƒè¯„è®ºï¼š\\n${comment}`)\n}\n\nfunction getNovelCommentID(novelId, comment) {\n    let resp = getAjaxJson(urlNovelComments(novelId, 0, 50), true)\n    let list = resp.body.comments.filter(item =>\n        (item.userId === String(getFromCache(\"pixiv:uid\")) && item.comment === comment)\n    )\n    // java.log(JSON.stringify(list))\n    // let commentID = list.map(item => item.id)\n    // java.log(JSON.stringify(commentIDs))\n    return list.map(item => item.id)\n}\n\nfunction novelCommentDelete() {\n    let novel = source.getLoginInfoMap()\n    let novelId = novel.id\n    let comment = String(result.get(\"å‘é€è¯„è®º\")).trim()\n    if (comment === \"\") {\n        return sleepToast(\"âš ï¸ è¯·è¾“å…¥éœ€è¦åˆ é™¤çš„è¯„è®º\")\n    }\n\n    let commentIDs = getNovelCommentID(novelId, comment)\n    java.log(JSON.stringify(commentIDs))\n    if (commentIDs.length === 0) {\n        return sleepToast(`âš ï¸ æœªèƒ½æ‰¾åˆ°è¿™æ¡è¯„è®º\\nè¯·æ£€æŸ¥æ˜¯å¦æœ‰é”™åˆ«å­—æˆ–æ ‡ç‚¹ç¬¦å·æ˜¯å¦ä¸€è‡´`)\n    }\n\n    commentIDs.forEach(commentID =>{\n        let resp = getPostBody(\n            \"https://www.pixiv.net/novel/rpc_delete_comment.php\",\n            `i_id=${novelId}&del_id=${commentID}`\n        )\n        // java.log(JSON.stringify(resp))\n        if (resp.error === true) sleepToast(\"âš ï¸ è¯„è®ºåˆ é™¤å¤±è´¥\")\n        else sleepToast(`âœ… å·²åœ¨ã€${novel.title}ã€‘åˆ é™¤è¯„è®ºï¼š\\n${comment}`)\n    })\n}\n\nfunction startBrowser(url, title) {\n    // let headers = `{\"headers\": {\"User-Agent\":\"${java.getWebViewUA()}\"}}`\n    let headers = `{\"headers\": {\"User-Agent\":\"Mozilla/5.0 (Linux; Android 10; K) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/119.0.0.0 Mobile Safari/537.36\"}}`\n    java.startBrowser(`${url},${headers}`, title)\n}\n\nfunction shareFactory(type) {\n    let novel = source.getLoginInfoMap()\n    if (novel === undefined) return sleepToast(\"âš ï¸ è¯·åœ¨å°è¯´é˜…è¯»é¡µé¢ï¼Œä½¿ç”¨æœ¬åŠŸèƒ½\")\n    if (type.includes(\"author\")) {\n        startBrowser(urlUserUrl(novel.userId), novel.userName)\n    }\n    else if (type.includes(\"novel\") || novel.seriesId === undefined) {\n        startBrowser(urlNovelUrl(novel.novelId), novel.title)\n    }\n    else if (type.includes(\"series\") && novel.seriesId) {\n        startBrowser(urlSeriesUrl(novel.seriesId), novel.seriesTitle)\n    }\n}\n\nfunction startPixivSettings() {\n    startBrowser(\"https://www.pixiv.net/settings/viewing\", \"è´¦å·è®¾ç½®\")\n}\nfunction startGithub() {\n    startBrowser(\"https://github.com/windyhusky/PixivSource\", \"ä¹¦æºä»‹ç»\")\n}\nfunction startGithubIssue() {\n    startBrowser(\"https://github.com/windyhusky/PixivSource/issues\", \"åé¦ˆé—®é¢˜\")\n}\nfunction startGithubReadme() {\n    startBrowser(\"https://github.com/windyhusky/PixivSource/blob/main/doc/Pixiv.md\", \"ä½¿ç”¨æŒ‡å—\")\n}\n\nfunction charpterRead() {\n    let novel = source.getLoginInfoMap()\n    sleepToast(`å†…éƒ¨ç« èŠ‚\\nã€${novel.title}ã€‘\\nå¦‚éå½“å‰ç« èŠ‚åç§°ï¼Œè¯·åˆ·æ–°æ­£æ–‡`)\n}\n\nfunction readMeLogin() {\n    let novel = source.getLoginInfoMap()\n    sleepToast(`ç™»å½•ç•Œé¢åŠŸèƒ½è¯´æ˜\n    ä½¿ç”¨æ”¶è—ã€è¿½æ›´ã€å…³æ³¨ä½œè€…ã€è¯„è®ºç­‰åŠŸèƒ½æ—¶ï¼Œè¯·å…ˆåˆ·æ–°æ­£æ–‡ï¼Œè·å–å½“å‰ç« èŠ‚ä¿¡æ¯\n    ç‚¹å‡»ã€ğŸ“Œ å½“å‰ç« èŠ‚ã€‘æŸ¥çœ‹ä¹¦æºå†…éƒ¨ç« èŠ‚ä¿¡æ¯`, 5)\n}\n\nfunction readMeSearch() {\n    let novel = source.getLoginInfoMap()\n    sleepToast(`æœç´¢è¯´æ˜\n    å…³é”®è¯é—´éœ€è¦ä»¥ç©ºæ ¼é—´éš”\n    ä½œè€…ä¸“æœï¼š@ä½œè€…åç§°\n    æ ‡ç­¾ä¸“æœï¼š#æ ‡ç­¾1 æ ‡ç­¾2\n    å­—æ•°ç­›é€‰1ï¼šæ ‡ç­¾1 æ ‡ç­¾2 å­—æ•°3k5\n    å­—æ•°ç­›é€‰2ï¼š@ä½œè€…åç§° å­—æ•°3w5`, 5)\n}\n\nfunction editSettings(object) {\n    let settingsName = {\n        \"CONVERT_CHINESE\": \"ç¹ç®€é€šæœ\",\n        \"MORE_INFORMATION\": \"æ˜¾ç¤ºæ›´å¤šç®€ä»‹\",\n        \"SHOW_UPDATE_TIME\": \"æ˜¾ç¤ºæ›´æ–°æ—¶é—´\",\n        \"SHOW_ORIGINAL_LINK\": \"æ˜¾ç¤ºåŸå§‹é“¾æ¥\",\n        \"REPLACE_TITLE_MARKS\": \"æ¢å¤ä¹¦åå·ã€Šã€‹\",\n        \"SHOW_CAPTIONS\": \"æ˜¾ç¤ºæè¿°\",\n        \"SHOW_COMMENTS\": \"æ˜¾ç¤ºè¯„è®º\",\n        \"FAST\": \"å¿«é€Ÿæ¨¡å¼\",\n        \"DEBUG\": \"è°ƒè¯•æ¨¡å¼\"\n    }\n\n    let settings = getFromCache(\"pixivSettings\")\n    settings[object] = (!settings[object])\n    if (settings[object] === true) {\n        java.toast(`âœ… å·²å¼€å¯ ${settingsName[object]}`)\n    } else {\n        java.toast(`â å·²å…³é—­ ${settingsName[object]}`)\n    }\n    cache.put(\"pixivSettings\", JSON.stringify(settings))\n}\n\nfunction getLikeAuthors() {\n    let authorIds = []\n    try {\n        let authors = String(source.getVariable()).split(\"\\n\")\n        if (authors[0].trim() !== \"\" && authors.length >= 1) {\n            for (let i in authors) {\n                if (authors[i] !== \"\") {\n                    let authorId = authors[i].match(RegExp(/\\d+/))[0]\n                    authorIds.push(authorId)\n                }\n            }\n            sleepToast(\"â¤ï¸ ä»–äººæ”¶è—ï¼šå·²å¯¼å…¥ä½œè€…æ•°æ®\")\n            cache.put(\"pixivLikeAuthors\", JSON.stringify(authorIds))\n        } else {\n            sleepToast(\"â¤ï¸ ä»–äººæ”¶è—\\nâš ï¸æœªåœ¨ã€è®¢é˜…æºã€‘è®¾ç½®æºå˜é‡\\nè¾“å…¥ä½œè€…IDï¼Œä¸€è¡Œä¸€ä¸ªï¼Œå¯æ·»åŠ ä½œè€…åï¼Œä¿å­˜\")\n        }\n    } catch (e) {\n        sleepToast(\"â¤ï¸ ä»–äººæ”¶è—\\nâš ï¸ã€è®¢é˜…æºã€‘æºå˜é‡è®¾ç½®æœ‰è¯¯\\nè¾“å…¥ä½œè€…IDï¼Œä¸€è¡Œä¸€ä¸ªï¼Œå¯æ·»åŠ ä½œè€…åï¼Œä¿å­˜\")\n    }\n}",
        "respondTime": 180000,
        "ruleBookInfo": {
            "author": "userName",
            "canReName": "true",
            "coverUrl": "coverUrl",
            "init": "@js:\nvar util = objParse(String(java.get(\"util\")))\n\nfunction objParse(obj) {\n    return JSON.parse(obj, (n, v) => {\n        if (typeof v == \"string\" && v.match(\"()\")) {\n            return eval(`(${v})`)\n        }\n        return v;\n    })\n}\n\nfunction novelHandler(novel){\n    novel = util.formatNovels(util.handNovels([novel], true))[0]\n    if (novel.seriesId === undefined || novel.seriesId === null) {\n        novel.detailedUrl = urlNovelUrl(novel.id)\n        novel.catalogUrl = urlNovelDetailed(novel.id)\n    } else {\n        novel.detailedUrl = urlSeriesUrl(novel.seriesId)\n        novel.catalogUrl = urlSeriesDetailed(novel.seriesId)\n    }\n    source.putLoginInfo(JSON.stringify(novel))  // æ”¾å…¥ä¿¡æ¯ä»¥ä¾¿ç™»é™†ç•Œé¢ä½¿ç”¨\n    return novel\n}\n\n(() => {\n    return novelHandler(util.getNovelRes(result))\n})()",
            "intro": "description",
            "kind": "tags",
            "lastChapter": "latestChapter",
            "name": "title",
            "tocUrl": "catalogUrl",
            "wordCount": "textCount"
        },
        "ruleContent": {
            "content": "@js:\nvar util = objParse(String(java.get(\"util\")))\n\nfunction objParse(obj) {\n    return JSON.parse(obj, (n, v) => {\n        if (typeof v == \"string\" && v.match(\"()\")) {\n            return eval(`(${v})`)\n        }\n        return v;\n    })\n}\n\nfunction getContent(res) {\n    // æ”¾å…¥ä¿¡æ¯ä»¥ä¾¿ç™»é™†ç•Œé¢ä½¿ç”¨ï¼Œç¬¬ä¸€æ¬¡åŠ è½½ï¼Œåˆ·æ–°æ—¶å‡†ç¡®\n    let novel = source.getLoginInfoMap()\n    if (res.seriesNavData !== null) {\n        let seriesId = res.seriesNavData.seriesId\n        if (seriesId !== undefined && seriesId !== null) {\n            let novelIds = getFromCache(`novelIds${seriesId}`)\n            novel.id = novelIds[book.durChapterIndex]\n            novel.title = book.durChapterTitle\n        }\n    }\n    source.putLoginInfo(JSON.stringify(novel))\n    // sleepToast(`å½“å‰ç« èŠ‚ï¼š${novel.id}${novel.title}`)\n\n    let content = String(res.content)\n    // let content = \"undefined\"\n    if (content.includes(\"undefined\")) {\n        return checkContent()\n    }\n\n    // åœ¨æ­£æ–‡å†…éƒ¨æ·»åŠ å°è¯´æè¿°\n    if (util.SHOW_CAPTIONS === true && res.description !== \"\") {\n        content = res.description + \"\\n\" + \"â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”\\n\".repeat(2) + content\n    }\n\n    // è·å– [uploadedimage:] çš„å›¾ç‰‡é“¾æ¥\n    let hasEmbeddedImages = res.textEmbeddedImages !== undefined && res.textEmbeddedImages !== null\n    if (hasEmbeddedImages) {\n        Object.keys(res.textEmbeddedImages).forEach((key) => {\n            content = content.replace(`[uploadedimage:${key}]`, `<img src=\"${urlCoverUrl(res.textEmbeddedImages[key].urls.original)}\">`)\n        })\n    }\n\n    // è·å– [pixivimage:] çš„å›¾ç‰‡é“¾æ¥ [pixivimage:1234] [pixivimage:1234-1]\n    let matched = content.match(RegExp(/\\[pixivimage:(\\d+)-?(\\d+)]/gm))\n    if (matched) {\n        matched.forEach(pixivimage => {\n            let matched2, illustId, order = 0\n            if (pixivimage.includes(\"-\")) {\n                matched2 = pixivimage.match(RegExp(\"(\\\\d+)-(\\\\d+)\"))\n                illustId = matched2[1]; order = matched2[2]\n            } else {\n                matched2 = pixivimage.match(RegExp(\"\\\\d+\"))\n                illustId = matched2[0];\n            }\n            content = content.replace(`${pixivimage}`, `<img src=\"${urlIllustOriginal(illustId, order)}\">`)\n        })\n    }\n\n    // æ›¿æ¢ Pixiv åˆ†é¡µæ ‡è®°ç¬¦å· [newpage]\n    matched = content.match(RegExp(/[ ã€€]*\\[newpage][ ã€€]*/gm))\n    if (matched) {\n        for (let i in matched) {\n            content = content.replace(`${matched[i]}`, `${\"<p>â€‹<p/>\".repeat(3)}`)\n        }\n    }\n\n    // æ›¿æ¢ Pixiv ç« èŠ‚æ ‡è®°ç¬¦å· [chapter:]\n    matched = content.match(RegExp(/\\[chapter:(.*?)]/gm))\n    if (matched) {\n        for (let i in matched) {\n            let matched2 = matched[i].match(/\\[chapter:(.*?)]/m)\n            let chapter = matched2[1].trim()\n            content = content.replace(`${matched[i]}`, `${chapter}<p>â€‹<p/>`)\n        }\n    }\n\n    // æ›¿æ¢ Pixiv è·³è½¬é¡µé¢æ ‡è®°ç¬¦å· [[jump:]]\n    matched = content.match(RegExp(/\\[jump:(\\d+)]/gm))\n    if (matched) {\n        for (let i in matched) {\n            let page = matched[i].match(/\\d+/)\n            content = content.replace(`${matched[i]}`, `\\n\\nè·³è½¬è‡³ç¬¬${page}èŠ‚`)\n        }\n    }\n\n    // æ›¿æ¢ Pixiv é“¾æ¥æ ‡è®°ç¬¦å· [[jumpuri: > ]]\n    matched = content.match(RegExp(/\\[\\[jumpuri:(.*?)>(.*?)]]/gm))\n    if (matched) {\n        for (let i in matched) {\n            let matched2 = matched[i].match(/\\[\\[jumpuri:(.*?)>(.*?)]]/m)\n            let matchedText = matched2[0]\n            let urlName = matched2[1].trim()\n            let urlLink = matched2[2].trim()\n            // é˜…è¯»ä¸æ”¯æŒè¶…é“¾æ¥\n            //content = content.replace(`${matchedText}`, `<a href=${urlLink}>${urlName}</a>`)\n            if (urlLink === urlName) {\n                content = content.replace(`${matchedText}`, `${urlName}`)\n            } else {\n                content = content.replace(`${matchedText}`, `${urlName}: ${urlLink}`)\n            }\n        }\n    }\n\n    // æ›¿æ¢ Pixiv æ³¨éŸ³æ ‡è®°ç¬¦å· [[rb: > ]]\n    matched = content.match(RegExp(/\\[\\[rb:(.*?)>(.*?)]]/gm))\n    if (matched) {\n        for (let i in matched) {\n            let matched2 = matched[i].match(/\\[\\[rb:(.*?)>(.*?)]]/m)\n            let matchedText = matched2[0]\n            let kanji = matched2[1].trim()\n            let kana = matched2[2].trim()\n\n            if (!util.REPLACE_TITLE_MARKS) {\n                // é»˜è®¤æ›¿æ¢æˆï¼ˆæ‹¬å·ï¼‰\n                content = content.replace(`${matchedText}`, `${kanji}ï¼ˆ${kana}ï¼‰`)\n            } else {\n                let reg = RegExp(\"[\\\\u4E00-\\\\u9FFF]+\", \"g\");\n                if (reg.test(kana)) {\n                    // kanaä¸ºä¸­æ–‡ï¼Œåˆ™æ›¿æ¢å›ã€Šä¹¦åå·ã€‹\n                    content = content.replace(`${matchedText}`, `${kanji}ã€Š${kana}ã€‹`)\n                } else {\n                    // é˜…è¯»ä¸æ”¯æŒ <ruby> <rt> æ³¨éŸ³\n                    // content = content.replace(`${matchedText}`, `<ruby>${kanji}<rt>${kana}</rt></ruby>`)\n                    content = content.replace(`${matchedText}`, `${kanji}ï¼ˆ${kana}ï¼‰`)\n                }\n            }\n        }\n    }\n\n    if (util.SHOW_COMMENTS === true) {\n        return content + getComment(res)\n    } else {\n        return content\n    }\n}\n\nfunction getComment(res) {\n    let comments = \"\"\n    let resp = getAjaxJson(urlNovelComments(res.id, 0, 50), true)\n    if (resp.error === true){\n        return \"\"\n    }\n    resp.body.comments.forEach(comment =>{\n        comments += `${comment.userName}ï¼š${comment.comment}(${comment.id})\\n`\n        if (comment.hasReplies === true) {\n            let resp = getAjaxJson(urlNovelCommentsReply(comment.id, 1), true)\n            if (resp.error === true) {\n                return \"\"\n            }\n            resp.body.comments.reverse().forEach(reply =>{\n                comments += `${reply.userName}(â¤´ï¸${reply.replyToUserName})ï¼š${reply.comment}(${reply.id})\\n`\n            })\n        }\n    })\n    if (comments) {\n        comments = \"\\n\" + \"â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”\\n\".repeat(2) + \"ç« èŠ‚è¯„è®ºï¼š\\n\" + comments\n    }\n    return comments\n}\n\nfunction checkContent() {\n    let latestMsg = getAjaxJson(urlMessageThreadLatest(5))\n    if (latestMsg.error === true) {\n        java.log(JSON.stringify(latestMsg))\n    } else if (latestMsg.body.total >= 1) {\n        let msg = latestMsg.body.message_threads.filter(item => item.thread_name === \"pixiväº‹å‹™å±€\")[0]\n        if (msg === undefined) {\n            sleepToast(`æ‚¨äº ${java.timeFormat(new Date().getTime())} è§¦å‘ Pixiv ã€è¯·æ±‚é™åˆ¶ã€‘ï¼Œå»ºè®®ç¨å€™/é‡æ–°ç™»å½•å†ç»§ç»­`, 3)\n            // java.startBrowser(\"https://www.pixiv.net\", 'é€€å‡ºç™»å½•')\n            // java.startBrowser(\"https://www.pixiv.net/logout.php\",'é€€å‡ºç™»å½•')  // ä¸æ¸…é™¤ WebView ç¼“å­˜æ— æ³•é‡æ–°ç™»å½•\n\n        } else if (new Date().getTime()- 1000*msg.modified_at <= 3*24*60*60*1000) { // 3*24hå†…æé†’\n            sleepToast(`æ‚¨äº ${java.timeFormat(1000*msg.modified_at)} è§¦å‘ Pixiv ã€è¿‡åº¦è®¿é—®ã€‘ï¼Œè¯·ä¿®æ”¹å¯†ç å¹¶é‡æ–°ç™»å½•`, 3)\n            sleepToast(`${msg.latest_content}`, 5)\n            java.startBrowser(\"https://accounts.pixiv.net/password/change\",'ä¿®æ”¹å¯†ç ')\n        }\n    }\n}\n\n(() => {\n    return getContent(util.getNovelRes(result))\n})()",
            "imageStyle": "DEFAULT"
        },
        "ruleExplore": {
            "author": "userName",
            "bookList": "@js:\nvar util = objParse(String(java.get(\"util\")))\nvar seriesSet = new Set();  // å­˜å‚¨seriesID æœ‰BUGæ— æ³•å¤„ç†ç¿»é¡µ\n\nfunction objParse(obj) {\n    return JSON.parse(obj, (n, v) => {\n        if (typeof v == \"string\" && v.match(\"()\")) {\n            return eval(`(${v})`)\n        }\n        return v;\n    })\n}\n\nfunction handlerFactory() {\n    if (baseUrl.includes(\"https://cdn.jsdelivr.net\")) {\n        return () => {updateSource(); return []}\n    }\n    if (!isLogin()) {\n        return handlerNoLogin()\n    }\n    if (baseUrl.includes(\"/bookmark\")) {\n        return handlerBookMarks()\n    }\n    if (baseUrl.includes(\"/top\")) {\n        return handlerRecommend()\n    }\n    if (baseUrl.includes(\"/follow_latest\")) {\n        return handlerFollowLatest()\n    }\n    if (baseUrl.includes(\"/watch_list\")) {\n        return handlerWatchList()\n    }\n    if (baseUrl.includes(\"/discovery\")) {\n        return handlerDiscovery()\n    }\n    if (baseUrl.includes(\"/new\")) {\n        return handlerDiscovery()\n    }\n    if (baseUrl.includes(\"/commission/\")) {\n        return handlerFollowLatest()\n    }\n    if (baseUrl.includes(\"/user_event/portal\")) {\n        return handlerFollowLatest()\n    }\n    if (baseUrl.includes(\"/genre\")) {\n        return handlerWatchList()\n    }\n    // æ­£åˆ™åŒ¹é…ç½‘å€å†…å®¹\n    if (baseUrl.includes(\"/ranking\")) {\n        return handlerRanking()\n    }\n    if (baseUrl.includes(\"/marker_all\")) {\n        return handlerRanking()\n    }\n    if (baseUrl.includes(\"/editors_picks\")) {\n        return handlerRanking()\n    }\n    if (baseUrl.includes(\"https://www.pixiv.net\")) {\n        return handlerRanking()\n    }\n    else {\n        return []\n    }\n}\n\nfunction handlerNoLogin() {\n    return () => {\n        sleepToast(\"æ­¤åŠŸèƒ½éœ€è¦åœ¨ä¹¦æºç™»å½•åæ‰èƒ½ä½¿ç”¨\")\n        sleepToast('å‘ç° - é•¿æŒ‰\"Pixiv\" - ç™»å½• - ç™»å½•è´¦å·')\n        return []\n    }\n}\n\n// æ¨èå°è¯´\nfunction handlerRecommend() {\n    return () => {\n        let res = JSON.parse(result)\n        const recommend = res.body.page.recommend\n        const novels = res.body.thumbnails.novel\n        let nidSet = new Set(recommend.ids)\n        // java.log(nidSet.size)\n        let list = novels.filter(novel => nidSet.has(String(novel.id)))\n        // java.log(`è¿‡æ»¤ç»“æœ:${JSON.stringify(list)}`)\n        return util.formatNovels(util.handNovels(util.combineNovels(list)))\n    }\n}\n\n// æ”¶è—å°è¯´ï¼Œä»–äººæ”¶è—\nfunction handlerBookMarks() {\n    return () => {\n        let res = JSON.parse(result).body.works\n        if (res === undefined || res.length === 0) {\n            //æµç¨‹æ— æ³•æœ¬ç¯èŠ‚ä¸­æ­¢ åªèƒ½äº¤ç»™ä¸‹ä¸€æµç¨‹å¤„ç†\n            return []\n        }\n        return util.formatNovels(util.handNovels(res))\n    }\n}\n\n//å…³æ³¨ä½œè€…ï¼Œå°è¯´å§”æ‰˜ï¼Œå°è¯´ä¼åˆ’\nfunction handlerFollowLatest() {\n    return () => {\n        let res = JSON.parse(result)\n        return util.formatNovels(util.handNovels(util.combineNovels(res.body.thumbnails.novel)))\n    }\n}\n\n//æ¨èå°è¯´ï¼Œæœ€è¿‘å°è¯´\nfunction handlerDiscovery() {\n    return () => {\n        let res = JSON.parse(result)\n        return util.formatNovels(util.handNovels(util.combineNovels(res.body.novels)))\n    }\n}\n\n// è¿½æ›´åˆ—è¡¨ï¼Œçƒ­é—¨åˆ†ç±»\nfunction handlerWatchList() {\n    return () => {\n        let res = JSON.parse(result)\n        return util.formatNovels(util.handNovels(res.body.thumbnails.novelSeries))\n    }\n}\n\n// æ’è¡Œæ¦œï¼Œä¹¦ç­¾ï¼Œé¦–é¡µï¼Œç¼–è¾‘éƒ¨æ¨èï¼Œé¡ºåºç›¸åŒ\nfunction handlerRanking() {\n    return () => {\n        let novels = [], novelIds = [], novelUrls = []\n        // let result = result + java.ajax(`${baseUrl}&p=2`)  // æ­£åˆ™è·å–ç½‘å€ä¸­çš„ novelId\n        let matched = result.match(RegExp(/\\/novel\\/show\\.php\\?id=\\d{5,}/gm))\n        for (let i in matched) {\n            let novelId = matched[i].match(RegExp(/\\d{5,}/))[0]\n            if (novelIds.indexOf(novelId) === -1) {\n                novelIds.push(novelId)\n                novelUrls.push(urlNovelDetailed(novelId))\n                // java.log(urlNovelDetailed(novelId))\n            }\n        }\n        return util.formatNovels(util.handNovels(util.combineNovels(getAjaxAllJson(novelUrls))))\n    }\n}\n\n(() => {\n    return handlerFactory()()\n})()",
            "bookUrl": "detailedUrl",
            "coverUrl": "coverUrl",
            "intro": "description",
            "kind": "tags",
            "lastChapter": "latestChapter",
            "name": "title",
            "wordCount": "textCount"
        },
        "ruleSearch": {
            "author": "userName",
            "bookList": "@js:\nvar util = objParse(String(java.get(\"util\")))\n\nfunction objParse(obj) {\n    return JSON.parse(obj, (n, v) => {\n        if (typeof v == \"string\" && v.match(\"()\")) {\n            return eval(`(${v})`)\n        }\n        return v;\n    })\n}\n\nvar first = true;\n// å­˜å‚¨seriesID\nvar seriesSet = {\n    keywords: \"Pixiv:Search\",\n    has: (value) => {\n        let page = Number(java.get(\"page\"))\n        if (page === 1 && first) {\n            first = false\n            cache.deleteMemory(this.keywords)\n            return false\n        }\n\n        let v = cache.getFromMemory(this.keywords)\n        if (v === undefined || v === null) {\n            return false\n        }\n        let set = new Set(JSON.parse(v))\n        return set.has(value)\n    },\n\n    add: (value) => {\n        let v = cache.getFromMemory(this.keywords)\n        if (v === undefined || v === null) {\n            cache.putMemory(this.keywords, JSON.stringify([value]))\n\n        } else {\n            let arr = JSON.parse(v)\n            if (typeof arr === \"string\") {\n                arr = Array(arr)\n            }\n            arr.push(value)\n            cache.putMemory(this.keywords, JSON.stringify(arr))\n        }\n    },\n};\n\nfunction getUserNovels() {\n    if (!isLogin()) {\n        return []\n    }\n\n    let uidList = [], novels = []\n    let username = String(java.get(\"keyword\"))\n    let page = Number(java.get(\"page\"))\n\n    let userid = cache.get(username)\n    if (userid !== undefined && userid !== null) {\n        uidList = [userid]\n        java.log(`ç¼“å­˜ä½œè€…IDï¼š${userid}`)\n    } else {\n        html = java.ajax(urlSearchUser(username))\n        // java.log(html)\n        // ä»…åŒ¹é…æœ‰æŠ•ç¨¿ä½œå“çš„ç”¨æˆ·\n        let match = html.match(new RegExp(`\"userIds\":\\\\[(?:(?:\\\\d+,?)+)]`))\n        // java.log(JSON.stringify(match))\n        if (match === null || match.length === 0) {\n            return []\n        }\n\n        match = JSON.stringify(match).replace(\"\\\\\",\"\").split(\",\")\n        // java.log(JSON.stringify(match))\n        let regNumber = new RegExp(\"\\\\d+\")\n        uidList = match.map(v => {\n            return v.match(regNumber)[0]\n        })\n        java.log(JSON.stringify(uidList))\n    }\n\n    let tempUids = []\n    for (let i in uidList) {\n        let id = uidList[i]\n        let resp = getAjaxJson(urlUserAllWorks(id))\n        // java.log(urlUserAllWorks(id))\n        if (resp.error === true) {\n            return []\n        }\n\n        // ä»…è·å–å‰3ä¸ªæœ‰å°è¯´çš„ä½œè€…\n        let novelsId = Object.keys(resp.body.novels)\n        // java.log(`${id}-${novelsId.length}`)\n        if (novelsId.length >= 1) tempUids.push(id)\n        if (tempUids.length === 3) {\n            java.log(JSON.stringify(tempUids))\n            break\n        }\n\n        // è·å–ç³»åˆ—å°è¯´ï¼Œä¸ util.handnovels ç³»åˆ—è¯¦æƒ…å…¼å®¹\n        let seriesIds = []\n        if (resp.body.novelSeries.length >= 1) {\n            resp.body.novelSeries.forEach(novel =>{\n                seriesIds.push(novel.id)\n                novel.textCount = novel.publishedTotalCharacterCount\n                novel.description = novel.caption\n            })\n            novels = novels.concat(resp.body.novelSeries)\n        }\n\n        // è·å–å•ç¯‡å°è¯´\n        if (novelsId.length >= 1) {\n            let novelsId = Object.keys(resp.body.novels).reverse().slice((page - 1) * 20, page * 20)\n            let url = urlNovelsDetailed(id, novelsId)\n            util.debugFunc(() => {\n                java.log(`å‘é€è·å–ä½œè€…å°è¯´çš„Ajaxè¯·æ±‚:${url}`)\n            })\n            let userNovels = getWebviewJson(url, html => {\n                return (html.match(new RegExp(\">\\\\{.*?}<\"))[0].replace(\">\", \"\").replace(\"<\", \"\"))\n            }).body\n            // let userNovels = getAjaxJson(url).body\n            // è·å–å¯¹åº”çš„å°è¯´ è¯¥åºåˆ—æ˜¯æŒ‰ç…§idæ’åº\n            // åè½¬ä»¥æŒ‰ç…§æ›´æ–°æ—¶é—´æ’åº\n            let single = Object.values(userNovels).reverse()\n            // ç­›é€‰çœŸæ­£çš„å•ç¯‡å°è¯´\n            let realSingleNovels = single.filter(novel => (!seriesIds.includes(novel.seriesId)))\n            // java.log(JSON.stringify(realSingleNovel))\n            novels = novels.concat(realSingleNovels)\n        }\n    }\n    util.debugFunc(() => {\n        java.log(`è·å–ç”¨æˆ·æœç´¢å°è¯´ç»“æŸ`)\n    })\n    return novels\n}\n\nfunction search(name, type, page) {\n    let resp = {}\n    if (type.includes(\"novel\")) {\n        resp = getAjaxJson(urlSearchNovel(name, page))\n        java.log(urlSearchNovel(name, page))\n    }\n    if (type.includes(\"series\")) {\n        resp = getAjaxJson(urlSearchSeries(name, page))\n        java.log(urlSearchSeries(name, page))\n    }\n    if (resp.error === true || resp.total === 0) {\n        return {\"data\": [], \"lastPage\": 0}\n    }\n    return resp.body.novel\n}\n\nfunction getSeries() {\n    if (JSON.parse(result).error !== true) {\n        cache.put(urlSearchSeries(java.get(\"keyword\"), java.get(\"page\")), result, 30*60)  // åŠ å…¥ç¼“å­˜\n        return JSON.parse(result).body.novel.data\n    } else {\n        return []\n    }\n}\n\nfunction getNovels() {\n    let MAXPAGES = 1, novels = []\n    let novelName = String(java.get(\"keyword\"))\n    let resp = search(novelName, \"novel\", 1)\n    novels = novels.concat(resp.data)\n    for (let page = Number(java.get(\"page\")) + 1; page < resp.lastPage, page <= MAXPAGES; page++) {\n        novels = novels.concat(search(novelName,\"novel\", page).data)\n    }\n    return novels\n}\n\nfunction getConvertNovels() {\n    let novels = []\n    let novelName = String(java.get(\"keyword\"))\n    let name1 = String(java.s2t(novelName))\n    let name2 = String(java.t2s(novelName))\n    if (name1 !== novelName) novels = novels.concat(search(name1, \"series\", 1).data)\n    if (name2 !== novelName) novels = novels.concat(search(name2, \"series\", 1).data)\n    if (name1 !== novelName) novels = novels.concat(search(name1, \"novel\", 1).data)\n    if (name2 !== novelName) novels = novels.concat(search(name2, \"novel\", 1).data)\n    return novels\n}\n\nfunction novelFilter(novels) {\n    let limitedTextCount = String(java.get(\"limitedTextCount\")).replace(\"å­—æ•°\", \"\").replace(\"å­—æ•¸\", \"\")\n    // limitedTextCount = `3w 3k 3w5 3k5`.[0]\n    let textCount = 0\n    if (limitedTextCount.includes(\"w\")) {\n        let num = limitedTextCount.split(\"w\")\n        textCount = 10000 * num[0] + 1000 * num[1]\n    }\n    if (limitedTextCount.includes(\"k\")) {\n        let num = limitedTextCount.split(\"k\")\n        textCount = 1000 * num[0] + 100 * num[1]\n    }\n    java.log(`å­—æ•°é™åˆ¶ï¼š${limitedTextCount}`)\n    java.log(`å­—æ•°é™åˆ¶ï¼š${textCount}`)\n    return novels.filter(novel => novel.textCount >= textCount)\n}\n\n(() => {\n    let novels = []\n    let keyword = String(java.get(\"keyword\"))\n    if (keyword.startsWith(\"@\") || keyword.startsWith(\"ï¼ \")) {\n        keyword = keyword.slice(1)\n        java.put(\"keyword\", keyword)\n        novels = novels.concat(getUserNovels())\n    } else if (keyword.startsWith(\"#\") || keyword.startsWith(\"ï¼ƒ\")) {\n        keyword = keyword.slice(1)\n        java.put(\"keyword\", keyword)\n        novels = novels.concat(getNovels())\n        novels = novels.concat(getSeries())\n    } else {\n        novels = novels.concat(getNovels())\n        novels = novels.concat(getSeries())\n        novels = novels.concat(getUserNovels())\n        if (util.CONVERT_CHINESE) novels = novels.concat(getConvertNovels())\n    }\n    // java.log(JSON.stringify(novels))\n    // è¿”å›ç©ºåˆ—è¡¨ä¸­æ­¢æµç¨‹\n    if (novels.length === 0) {\n        return []\n    }\n    return novelFilter(util.formatNovels(util.handNovels(util.combineNovels(novels))))\n})()",
            "bookUrl": "detailedUrl",
            "checkKeyWord": "æµ‹è¯•é¡µé¢",
            "coverUrl": "coverUrl",
            "intro": "description",
            "kind": "tags",
            "lastChapter": "latestChapter",
            "name": "title",
            "wordCount": "textCount"
        },
        "ruleToc": {
            "chapterList": "@js:\nvar util = objParse(String(java.get(\"util\")))\n\nfunction objParse(obj) {\n    return JSON.parse(obj, (n, v) => {\n        if (typeof v == \"string\" && v.match(\"()\")) {\n            return eval(`(${v})`)\n        }\n        return v;\n    })\n}\n\nfunction urlNovel(novelId){\n    if (util.SHOW_ORIGINAL_LINK) {\n        return urlNovelUrl(novelId)\n    } else {\n        return urlNovelDetailed(novelId)\n    }\n}\n\nfunction oneShotHandler(res) {\n    res.textCount = res.userNovels[`${res.id}`].textCount\n    res.createDate = timeTextFormat(res.createDate)\n    return [{\n        title: res.title.replace(RegExp(/^\\s+|\\s+$/g), \"\"),\n        chapterUrl: urlNovel(res.id),\n        chapterInfo: `${res.createDate}ã€€ã€€${res.textCount}å­—`\n    }]\n}\n\nfunction seriesHandler(res) {\n    const limit = 30\n    let returnList = [], novelIds = []\n    let seriesID = res.id, allChaptersCount = res.total\n    util.debugFunc(() => {\n        java.log(`æœ¬ç³»åˆ— ${seriesID} ä¸€å…±æœ‰${allChaptersCount}ç« `);\n    })\n\n    //å‘é€è¯·æ±‚è·å¾—ç›¸åº”æ•°é‡çš„ç›®å½•åˆ—è¡¨\n    function sendAjaxForGetChapters(lastIndex) {\n        resp = getAjaxJson(urlSeriesNovels(seriesID, limit, lastIndex), true)\n        res = resp.body.thumbnails.novel\n        // res = resp.body.page.seriesContents\n        res.forEach(v => {\n            v.title = v.title.replace(RegExp(/^\\s+|\\s+$/g), \"\").replace(RegExp(/ï¼ˆ|ï¼‰|-/g), \"\")\n            v.chapterUrl = urlNovel(v.id)\n            novelIds.push(v.id)\n            if (v.updateDate !== undefined) {\n                v.updateDate = timeTextFormat(v.createDate)\n                v.chapterInfo = `${v.updateDate}ã€€ã€€${v.textCount}å­—`\n            } else {\n                v.updateDate = java.timeFormat(v.uploadTimestamp)\n                v.chapterInfo = `${v.updateDate}ã€€ã€€${v.textLength}å­—`\n            }\n            util.debugFunc(() => {\n                java.log(`${v.title}`)\n            })\n        })\n        return res;\n    }\n\n    if (!util.SHOW_UPDATE_TIME) {\n        returnList = getAjaxJson(urlSeriesNovelsTitles(seriesID), true).body\n        returnList.forEach(v => {\n            v.title = v.title.replace(RegExp(/^\\s+|\\s+$/g), \"\").replace(RegExp(/ï¼ˆ|ï¼‰|-/g), \"\")\n            v.chapterUrl = urlNovel(v.id)\n            novelIds.push(v.id)\n        })\n    } else {\n        //é€»è¾‘æ§åˆ¶è€… ä¹Ÿå°±æ˜¯ä½¿ç”¨ä¸Šé¢å®šä¹‰çš„ä¸¤ä¸ªå‡½æ•°æ¥åšå¯¹åº”åŠŸèƒ½\n        //è¦çˆ¬å–çš„æ€»æ¬¡æ•°\n        let max = (allChaptersCount / limit) + 1\n        for (let i = 0; i < max; i++) {\n            //java.log(\"içš„å€¼:\"+i)\n            let list = sendAjaxForGetChapters(i * limit);\n            //å–å‡ºæ¯ä¸ªå€¼\n            returnList = returnList.concat(list)\n        }\n    }\n    // æ”¾å…¥ä¿¡æ¯ä»¥ä¾¿ç™»é™†ç•Œé¢ä½¿ç”¨\n    cache.put(`novelIds${seriesID}`, JSON.stringify(novelIds))\n    // java.log(JSON.stringify(returnList))\n    return returnList\n}\n\n(function (res) {\n    res = util.getNovelResSeries(result)\n    if (res.firstNovelId === undefined || res.seriesNavData === null) {\n        return oneShotHandler(res)\n    } else {\n        return seriesHandler(res)\n    }\n})()",
            "chapterName": "title",
            "chapterUrl": "chapterUrl",
            "isPay": "false ",
            "isVip": "true",
            "updateTime": "chapterInfo"
        },
        "searchUrl": "@js:\njava.put(\"key\", key)\njava.put(\"page\", page)\nlet keyword = key.split(\" \")\nlet limitedTextCount\nif (key.includes(\"å­—æ•°\") || key.includes(\"å­—æ•¸\") ) {\n    limitedTextCount = keyword.pop()\n    keyword = keyword.join(\" \")\n} else {\n    limitedTextCount = \"\"\n    keyword = key\n}\njava.put(\"keyword\", keyword)\njava.put(\"limitedTextCount\", limitedTextCount)\nif (keyword.startsWith(\"@\") || keyword.startsWith(\"ï¼ \")) {\n    keyword = keyword.slice(1)\n    java.log(`æœç´¢ä½œè€…ï¼š${keyword}`)\n}\nif (keyword.startsWith(\"#\") || keyword.startsWith(\"ï¼ƒ\")) {\n    keyword = keyword.slice(1)\n    java.log(`æœç´¢æ ‡ç­¾ï¼š${keyword}`)\n}\nurlSearchSeries(keyword, page)",
        "variableComment": "â¤ï¸ æŸ¥çœ‹ä»–äººæ”¶è—ï¼š\nå‘ç°ï¼šé•¿æŒ‰\"Pixiv\"ï¼Œç¼–è¾‘ï¼Œå³ä¸Šè§’èœå•ï¼Œè®¾ç½®æºå˜é‡\nè®¾ç½®æºå˜é‡ï¼šè¾“å…¥ä½œè€…IDï¼Œä¸€è¡Œä¸€ä¸ªï¼Œå¯æ·»åŠ ä½œè€…åï¼Œä¿å­˜\nå‘ç°ï¼šé•¿æŒ‰\"Pixiv\"ï¼Œåˆ·æ–°ï¼ŒæŸ¥çœ‹ä»–äººæ”¶è—\nä»¥ä¸‹å†…å®¹ä¸ºæºå˜é‡æ¨¡æ¿ï¼š\n12345 ä½œè€…å\n67890 //ä½œè€…å\n\n\nâš™ï¸ è‡ªå®šä¹‰ä¹¦æºè®¾ç½®ï¼š\nâš™ï¸ è‡ªå®šä¹‰è®¾ç½®ï¼šè¯·åœ¨ã€ç™»å½•ç•Œé¢ã€‘ä¸­ä¿®æ”¹\nâš™ï¸ è‡ªå®šä¹‰å‘ç°ï¼šè¯·åœ¨ã€åŸºæœ¬-å˜é‡è¯´æ˜ã€‘å¤„ä¿®æ”¹ä»£ç \nâš™ï¸ è‡ªå®šä¹‰è®¾ç½®ï¼šå°† true æ”¹ä¸º falseï¼Œæˆ–ç›¸å\nâš ï¸ è®¾ç½®æºå˜é‡ã€æ— æ³•ã€‘æ›´æ”¹ä¹¦æºè‡ªå®šä¹‰è®¾ç½®\nâš ï¸ æ³¨æ„ä¸è¦æ·»åŠ æˆ–åˆ é™¤å°¾éšé€—å·\",\"\nâš ï¸ æ›´æ–°å‘ç°é¡µéœ€è¦é•¿æŒ‰\"Pixiv\"ï¼Œæ‰‹åŠ¨åˆ·æ–°\nä»¥ä¸‹å†…å®¹ä¸ºä¹¦æºè®¾ç½®ï¼š\n{\n\"SHOW_GENERAL_NEW\": false,\n\"SHOW_GENERAL_RANK\": false,\n\"SHOW_R18_GENRE\": false,\n\"SHOW_GENERAL_GENRE\": false\n}\n\n// SHOW_GENERAL_NEW\n// å‘ç°ï¼šæœ€æ–°ã€ä¼åˆ’ã€çº¦ç¨¿æ˜¾ç¤ºä¸€èˆ¬å°è¯´\n// SHOW_GENERAL_RANK\n// å‘ç°ï¼šæ’è¡Œæ¦œæ˜¾ç¤ºä¸€èˆ¬å°è¯´\n// SHOW_R18_GENRE\n// å‘ç°ï¼šçƒ­é—¨åˆ†ç±»æ˜¾ç¤ºR18å°è¯´\n// SHOW_GENERAL_GENRE\n// å‘ç°ï¼šçƒ­é—¨åˆ†ç±»æ˜¾ç¤ºä¸€èˆ¬å°è¯´\n\n",
        "weight": 0
    },
    {
        "bookSourceComment": "Pixiv å°è¯´(å¤‡ç”¨)ï¼ˆæ›´æ–°ğŸ“†ï¼š2025-06-05ï¼‰\n\nä½¿ç”¨è¯´æ˜ï¼šé˜…è¯»ç‰ˆæœ¬ 3.23.0503 åŠä¹‹åç‰ˆæœ¬å¯ç”¨\nå¯ç”¨åŠŸèƒ½ï¼šâœ…æœç´¢âœ…å‘ç°âœ…æ·»åŠ ç½‘å€âœ…è®¢é˜…æº\næœç´¢å°è¯´ï¼šâœ…å•ç¯‡âœ…ç³»åˆ—âœ…æ ‡ç­¾âœ…ä½œè€…\nå‘ç°å°è¯´ï¼šâœ…å…³æ³¨âœ…è¿½æ›´âœ…æ¨èâœ…å‘ç°\nå‘ç°å°è¯´ï¼šâœ…æ”¶è—âœ…ä¹¦ç­¾âœ…é¦–é¡µâœ…æ’è¡Œ\næ·»åŠ ç½‘å€ï¼šâœ…Pixivå°è¯´é“¾æ¥âœ…Pixivç³»åˆ—é“¾æ¥\nè®¢é˜…ç”¨æ³•ï¼šç‚¹å‡»è®¢é˜…æºæ‰“å¼€å°è¯´/ç³»åˆ—å°è¯´ï¼Œã€åˆ·æ–°ã€‘ï¼Œç‚¹å‡»ã€åŠ å…¥ä¹¦æ¶ã€‘æŒ‰é’®ï¼Œæ·»åŠ åˆ°ä¹¦æ¶\n\nä¹¦æºå‘å¸ƒï¼šå…½äººé˜…è¯»é¢‘é“ https://t.me/FurryReading\né¡¹ç›®åœ°å€ï¼šhttps://github.com/windyhusky/PixivSource\nä½¿ç”¨æ•™ç¨‹ï¼šhttps://github.com/windyhusky/PixivSource/blob/main/doc/Pixiv.md\n\nè§„åˆ™è®¢é˜…ï¼šimport è®¢é˜…æº\nhttps://cdn.jsdelivr.net/gh/windyhusky/PixivSource@main/import.json\nhttps://raw.githubusercontent.com/windyhusky/PixivSource/main/import.json\n\nâš™ï¸ ä¹¦æºè®¾ç½®ï¼š\nä¹¦æºç®¡ç† - ç¼–è¾‘ä¹¦æº - åŸºæœ¬ - å˜é‡è¯´æ˜ - ä¿®æ”¹å¹¶ä¿å­˜\n\nâ¤ï¸ æŸ¥çœ‹ä»–äººæ”¶è—ï¼š\nå‘ç° - é•¿æŒ‰\"Pixiv\" - ç¼–è¾‘ - å³ä¸Šè§’èœå• - è®¾ç½®æºå˜é‡\næºå˜é‡ï¼šè¾“å…¥ä½œè€…IDï¼Œä¸€è¡Œä¸€ä¸ªï¼Œå¯æ·»åŠ ä½œè€…åï¼Œä¿å­˜\nå‘ç° - é•¿æŒ‰\"Pixiv\" - åˆ·æ–° - æŸ¥çœ‹ä»–äººæ”¶è—",
        "bookSourceGroup": "ğŸ” Pixiv",
        "bookSourceName": "Pixiv å°è¯´(å¤‡ç”¨)",
        "bookSourceType": 0,
        "bookSourceUrl": "https://www.pixiv.net",
        "bookUrlPattern": "(https?://)?(www\\.)?pixiv\\.net(/ajax)?/novel/(show\\.php\\?id=|series/)?\\d+",
        "concurrentRate": "180/60000",
        "customOrder": 1,
        "enabled": false,
        "enabledCookieJar": true,
        "enabledExplore": true,
        "exploreUrl": "@js:\nlet SHOW_R18_GENRE, SHOW_GENERAL_NEW, SHOW_GENERAL_RANK, SHOW_GENERAL_GENRE\ntry {\n    settings = JSON.parse(String(source.variableComment).match(RegExp(/{([\\s\\S]*?)}/gm)))\n    SHOW_R18_GENRE = settings.SHOW_R18_GENRE         // å‘ç°ï¼šçƒ­é—¨åˆ†ç±»æ˜¾ç¤ºR18å°è¯´\n    SHOW_GENERAL_NEW = settings.SHOW_GENERAL_NEW     // å‘ç°ï¼šæœ€æ–°ã€ä¼åˆ’ã€çº¦ç¨¿æ˜¾ç¤ºä¸€èˆ¬å°è¯´\n    SHOW_GENERAL_RANK = settings.SHOW_GENERAL_RANK   // å‘ç°ï¼šæ’è¡Œæ¦œæ˜¾ç¤ºä¸€èˆ¬å°è¯´\n    SHOW_GENERAL_GENRE = settings.SHOW_GENERAL_GENRE // å‘ç°ï¼šçƒ­é—¨åˆ†ç±»æ˜¾ç¤ºä¸€èˆ¬å°è¯´\n} catch (e) {\n    SHOW_R18_GENRE = false\n    SHOW_GENERAL_NEW = false\n    SHOW_GENERAL_RANK = false\n    SHOW_GENERAL_GENRE = false\n}\n\nli = [\n    {\"â­ï¸ å…³æ³¨\": \"https://www.pixiv.net/ajax/follow_latest/novel?p={{page}}&mode=r18&lang=zh\"},\n    {\"ğŸ“ƒ è¿½æ›´\": \"https://www.pixiv.net/ajax/watch_list/novel?p={{page}}&new=1&lang=zh\"},\n    {\"ğŸ’¯ æ¨è\": \"https://www.pixiv.net/ajax/top/novel?mode=r18&lang=zh\"},\n    {\"ğŸ” å‘ç°\": \"https://www.pixiv.net/ajax/novel/discovery?mode=r18&lang=zh\"},\n    {\"â¤ï¸ æ”¶è—\": \"https://www.pixiv.net/ajax/user/{{cache.get(\\\"pixiv:uid\\\")}}/novels/bookmarks?tag=&offset={{(page-1)*24}}&limit=24&rest=show&lang=zh\"},\n    {\"ãŠ™ï¸ æ”¶è—\": \"https://www.pixiv.net/ajax/user/{{cache.get(\\\"pixiv:uid\\\")}}/novels/bookmarks?tag=&offset={{(page-1)*24}}&limit=24&rest=hide&lang=zh\"},\n    {\"ğŸ·ï¸ ä¹¦ç­¾\": \"https://www.pixiv.net/novel/marker_all.php\"},\n    {\"ğŸ  é¦–é¡µ\": \"https://www.pixiv.net\"},\n]\n\nnormal = [\n    {\"âœ… å¸¸è§„ å°è¯´ æ¨è âœ…\": \"\"},\n    {\"â­ï¸ å…³æ³¨\": \"https://www.pixiv.net/ajax/follow_latest/novel?p={{page}}&mode=all&lang=zh\"},\n    {\"ğŸ’¯ æ¨è\": \"https://www.pixiv.net/ajax/top/novel?mode=all&lang=zh\"},\n    {\"ğŸ” å‘ç°\": \"https://www.pixiv.net/ajax/novel/discovery?mode=safe&lang=zh\"},\n    {\"ğŸ†™ æ›´æ–°\": \"https://cdn.jsdelivr.net/gh/windyhusky/PixivSource@main/pixiv.json\"},\n]\n\nr18New = [\n    {\"ğŸ†• æœ€æ–° ä¼åˆ’ çº¦ç¨¿ ğŸ’°\": \"\"},\n    {\"ğŸ†• æœ€æ–°\": \"https://www.pixiv.net/ajax/novel/new?lastId=0&limit=20&r18=true&lang=zh\"},\n    {\"ğŸ“‘ ä¼åˆ’\": \"https://www.pixiv.net/ajax/user_event/portal/novels?mode=r18&p={{page}}&lang=zh\"},\n    {\"ğŸ’° çº¦ç¨¿\": \"https://www.pixiv.net/ajax/commission/page/request/complete/novels?mode=r18&p={{page}}&lang=zh\"},\n    {\"ğŸ” å‘ç°\": \"https://www.pixiv.net/ajax/novel/discovery?mode=all&lang=zh\"},\n]\n\ngeneralNew = [\n    {\"âœ… æœ€æ–° ä¼åˆ’ çº¦ç¨¿ âœ…\": \"\"},\n    {\"æœ€æ–°\": \"https://www.pixiv.net/ajax/novel/new?lastId=0&limit=20&r18=false&lang=zh\"},\n    {\"ä¼åˆ’\": \"https://www.pixiv.net/ajax/user_event/portal/novels?mode=all&p={{page}}&lang=zh\"},\n    {\"çº¦ç¨¿\": \"https://www.pixiv.net/ajax/commission/page/request/complete/novels?mode=all&p={{page}}&lang=zh\"},\n    {\"ç¼–è¾‘\": \"https://www.pixiv.net/novel/editors_picks\"},\n]\n\nr18Rank = [\n    {\"ğŸ‘‘ æ’è¡Œæ¦œå• ğŸ‘‘\": \"\"},\n    {\"ä»Šæ—¥\": \"https://www.pixiv.net/novel/ranking.php?mode=daily_r18\"},\n    {\"æœ¬å‘¨\": \"https://www.pixiv.net/novel/ranking.php?mode=weekly_r18\"},\n    {\"R18G\": \"https://www.pixiv.net/novel/ranking.php?mode=r18g\"},\n    {\"ç”·æ€§\": \"https://www.pixiv.net/novel/ranking.php?mode=male_r18\"},\n    {\"å¥³æ€§\": \"https://www.pixiv.net/novel/ranking.php?mode=female_r18\"}\n]\n\ngeneralRank = [\n    {\"ğŸ† æ’è¡Œæ¦œå• ğŸ†\": \"\"},\n    {\"ä»Šæ—¥\": \"https://www.pixiv.net/novel/ranking.php?mode=daily\"},\n    {\"æœ¬å‘¨\": \"https://www.pixiv.net/novel/ranking.php?mode=weekly\"},\n    {\"æœ¬æœˆ\": \"https://www.pixiv.net/novel/ranking.php?mode=monthly\"},\n    {\"ç”·æ€§\": \"https://www.pixiv.net/novel/ranking.php?mode=male\"},\n    {\"å¥³æ€§\": \"https://www.pixiv.net/novel/ranking.php?mode=female\"},\n    {\"æ–°äºº\": \"https://www.pixiv.net/novel/ranking.php?mode=rookie\"},\n    {\"åŸåˆ›\": \"https://www.pixiv.net/novel/ranking.php?mode=weekly_original\"},\n    {\"AIç”Ÿæˆ\": \"https://www.pixiv.net/novel/ranking.php?mode=weekly_ai\"}\n]\n\nr18Genre = [\n    {\"ğŸ”¥ åŸåˆ›çƒ­é—¨ ğŸ”¥\": \"\"},\n    {\"ç”·æ€§\": \"https://www.pixiv.net/ajax/genre/novel/male?mode=r18&lang=zh\"},\n    {\"å¥³æ€§\": \"https://www.pixiv.net/ajax/genre/novel/female?mode=r18&lang=zh\"},\n    {\"æ‹çˆ±\": \"https://www.pixiv.net/ajax/genre/novel/romance?mode=r18&lang=zh\"},\n    {\"å¼‚ä¸–ç•Œå¥‡å¹»\": \"https://www.pixiv.net/ajax/genre/novel/isekai_fantasy?mode=r18&lang=zh\"},\n    {\"ç°ä»£å¥‡å¹»\": \"https://www.pixiv.net/ajax/genre/novel/contemporary_fantasy?mode=r18&lang=zh\"},\n    {\"æ‚¬ç–‘\": \"https://www.pixiv.net/ajax/genre/novel/mystery?mode=r18&lang=zh\"},\n    {\"ææ€–\": \"https://www.pixiv.net/ajax/genre/novel/horror?mode=r18&lang=zh\"},\n    {\"ç§‘å¹»\": \"https://www.pixiv.net/ajax/genre/novel/sci-fi?mode=r18&lang=zh\"},\n    {\"æ–‡å­¦\": \"https://www.pixiv.net/ajax/genre/novel/literature?mode=r18&lang=zh\"},\n    {\"æƒ…æ„Ÿ\": \"https://www.pixiv.net/ajax/genre/novel/drama?mode=r18&lang=zh\"},\n    {\"å†å²\": \"https://www.pixiv.net/ajax/genre/novel/historical_pieces?mode=r18&lang=zh\"},\n    {\"è€½ç¾\": \"https://www.pixiv.net/ajax/genre/novel/bl?mode=r18&lang=zh\"},\n    {\"ç™¾åˆ\": \"https://www.pixiv.net/ajax/genre/novel/yuri?mode=r18&lang=zh\"},\n    {\"æ•£æ–‡Â·è¯—æ­Œ\": \"https://www.pixiv.net/ajax/genre/novel/poetry?mode=r18&lang=zh\"},\n    {\"éšç¬”Â·çºªå®\": \"https://www.pixiv.net/ajax/genre/novel/non-fiction??mode=r18&lang=zh\"},\n    {\"å‰§æœ¬\": \"https://www.pixiv.net/ajax/genre/novel/screenplays?mode=r18&lang=zh\"},\n    {\"è¯„è®º\": \"https://www.pixiv.net/ajax/genre/novel/reviews?mode=r18&lang=zh\"},\n    {\"å…¶ä»–\": \"https://www.pixiv.net/ajax/genre/novel/other?mode=r18&lang=zh\"}\n]\n\ngeneralgGenre = [\n    {\"â¤ï¸â€ğŸ”¥ åŸåˆ›çƒ­é—¨ â¤ï¸â€ğŸ”¥\": \"\"},\n    {\"ç»¼åˆ\": \"https://www.pixiv.net/ajax/genre/novel/all?mode=safe&lang=zh\"},\n    {\"æ‹çˆ±\": \"https://www.pixiv.net/ajax/genre/novel/romance?mode=safe&lang=zh\"},\n    {\"å¼‚ä¸–ç•Œå¥‡å¹»\": \"https://www.pixiv.net/ajax/genre/novel/isekai_fantasy?mode=safe&lang=zh\"},\n    {\"ç°ä»£å¥‡å¹»\": \"https://www.pixiv.net/ajax/genre/novel/contemporary_fantasy?mode=safe&lang=zh\"},\n    {\"æ‚¬ç–‘\": \"https://www.pixiv.net/ajax/genre/novel/mystery?mode=safe&lang=zh\"},\n    {\"ææ€–\": \"https://www.pixiv.net/ajax/genre/novel/horror?mode=safe&lang=zh\"},\n    {\"ç§‘å¹»\": \"https://www.pixiv.net/ajax/genre/novel/sci-fi?mode=safe&lang=zh\"},\n    {\"æ–‡å­¦\": \"https://www.pixiv.net/ajax/genre/novel/literature?mode=safe&lang=zh\"},\n    {\"æƒ…æ„Ÿ\": \"https://www.pixiv.net/ajax/genre/novel/drama?mode=safe&lang=zh\"},\n    {\"å†å²\": \"https://www.pixiv.net/ajax/genre/novel/historical_pieces?mode=safe&lang=zh\"},\n    {\"è€½ç¾\": \"https://www.pixiv.net/ajax/genre/novel/bl?mode=safe&lang=zh\"},\n    {\"ç™¾åˆ\": \"https://www.pixiv.net/ajax/genre/novel/yuri?mode=safe&lang=zh\"},\n    {\"æ•£æ–‡Â·è¯—æ­Œ\": \"https://www.pixiv.net/ajax/genre/novel/poetry?mode=safe&lang=zh\"},\n    {\"éšç¬”Â·çºªå®\": \"https://www.pixiv.net/ajax/genre/novel/non-fiction??mode=safe&lang=zh\"},\n    {\"å‰§æœ¬\": \"https://www.pixiv.net/ajax/genre/novel/screenplays?mode=safe&lang=zh\"},\n    {\"è¯„è®º\": \"https://www.pixiv.net/ajax/genre/novel/reviews?mode=safe&lang=zh\"},\n    {\"å…¶ä»–\": \"https://www.pixiv.net/ajax/genre/novel/other?mode=safe&lang=zh\"}\n]\n\nbookmarks = [{\"â¤ï¸ ä»–äººæ”¶è— â¤ï¸\": \"\"}]\n\nli = li.concat(normal)\nli = li.concat(r18New)\nif (SHOW_GENERAL_NEW === true) {\n    li = li.concat(generalNew)\n}\nli = li.concat(r18Rank)\nif (SHOW_GENERAL_RANK === true) {\n    li = li.concat(generalRank)\n}\nif (SHOW_R18_GENRE === true) {\n    li = li.concat(r18Genre)\n}\nif (SHOW_GENERAL_GENRE === true) {\n    li = li.concat(generalgGenre)\n}\n\nsleepToast('ä½¿ç”¨æŒ‡å—ğŸ”–\\n\\nå‘ç° - æ›´æ–° - ç‚¹å‡»\"ğŸ”° ä½¿ç”¨æŒ‡å—\" - æŸ¥çœ‹')\n\ntry {\n    authors = String(source.getVariable()).split(\"\\n\")\n    if (authors[0].trim() !== \"\" && authors.length >= 1) {\n        for (let i in authors) {\n            if (authors[i] !== \"\") {\n                let authorId = authors[i].match(RegExp(/\\d+/))[0]\n                let resp = JSON.parse(java.ajax(`https://www.pixiv.net/ajax/user/${authorId}`))\n                if (resp.error !== true) {\n                    let bookmark = {}\n                    bookmark[resp.body.name] = `https://www.pixiv.net/ajax/user/${authorId}/novels/bookmarks?tag=&offset={{(page-1)*24}}&limit=24&rest=show&lang=zh`\n                    bookmarks.push(bookmark)\n                }\n            }\n        }\n        li = li.concat(bookmarks)\n    } else {\n        sleepToast('æŸ¥çœ‹ä»–äººæ”¶è—â¤ï¸\\n\\nå‘ç° - é•¿æŒ‰\"Pixiv\" - ç¼–è¾‘ - èœå• - è®¾ç½®æºå˜é‡')\n    }\n} catch (e) {\n    sleepToast(\"âš ï¸æºå˜é‡è®¾ç½®æœ‰è¯¯\\n\\nè¾“å…¥ä½œè€…IDï¼Œä¸€è¡Œä¸€ä¸ªï¼Œå¯æ·»åŠ ä½œè€…åï¼Œä¿å­˜\")\n}\n\nli.forEach(item => {\n    item.title = Object.keys(item)[0]\n    item.url = Object.values(item)[0]\n    delete item[Object.keys(item)[0]]\n    item.style = {}\n    item.style.layout_flexGrow = 1\n    item.style.layout_flexShrink = 1\n    item.style.layout_alignSelf = \"auto\"\n    item.style.layout_wrapBefore = \"false\"\n    if (item.url === \"\") {\n        item.style.layout_flexBasisPercent = 1\n    } else {\n        item.style.layout_flexBasisPercent = -1\n    }\n})\n\nJSON.stringify(li)",
        "header": "{\"referer\":\"https://www.pixiv.net\"}",
        "jsLib": "var checkTimes = 0\nvar cacheSaveSeconds = 7*24*60*60  // ç¼“å­˜æ—¶é—´7å¤©\n\nfunction cacheGetAndSet(cache, key, supplyFunc) {\n    let v = cache.get(key)\n    if (v === undefined || v === null) {\n        v = JSON.stringify(supplyFunc())\n        cache.put(key, v, cacheSaveSeconds)\n    }\n    return JSON.parse(v)\n}\nfunction getFromCache(object) {\n    let {cache} = this\n    return JSON.parse(cache.get(object))\n}\n\nfunction isHtmlString(str) {\n    return str.startsWith(\"<!DOCTYPE html>\")\n}\nfunction isJsonString(str) {\n    try {\n        if (typeof JSON.parse(str) === \"object\") {\n            return true\n        }\n    } catch(e) {}\n    return false\n}\n\nfunction getAjaxJson(url, forceUpdate) {\n    const {java, cache} = this\n    if (forceUpdate === true) {\n        let result = JSON.parse(java.ajax(url))\n        cache.put(url, JSON.stringify(result), cacheSaveSeconds)\n        return result\n    }\n    return cacheGetAndSet(cache, url, () => {\n        return JSON.parse(java.ajax(url))\n    })\n}\nfunction getAjaxAllJson(urls, forceUpdate) {\n    const {java, cache} = this\n    if (forceUpdate === true) {\n        let result = java.ajaxAll(urls).map(resp => JSON.parse(resp.body()).body)\n        cache.put(urls, JSON.stringify(result), cacheSaveSeconds)\n        return result\n    }\n    return cacheGetAndSet(cache, urls, () => {\n        return java.ajaxAll(urls).map(resp => JSON.parse(resp.body()).body)\n    })\n}\nfunction getWebviewJson(url, parseFunc) {\n    const {java, cache} = this\n    return cacheGetAndSet(cache, url, () => {\n        let html = java.webView(null, url, null)\n        return JSON.parse(parseFunc(html))\n    })\n}\n\nfunction isLogin() {\n    const {java} = this\n    let cookie = String(java.getCookie(\"https://www.pixiv.net/\", null))\n    return cookie.includes(\"first_visit_datetime\")\n}\n\nfunction urlNovelUrl(novelId) {\n    return `https://www.pixiv.net/novel/show.php?id=${novelId}`\n}\nfunction urlNovelDetailed(novelId) {\n    return `https://www.pixiv.net/ajax/novel/${novelId}`\n}\nfunction urlNovelsDetailed(userId, nidList) {\n    return `https://www.pixiv.net/ajax/user/${userId}/novels?${nidList.map(v => \"ids[]=\" + v).join(\"&\")}`\n}\nfunction urlNovelBookmarkData(novelId) {\n    return `https://www.pixiv.net/ajax/novel/${novelId}/bookmarkData`\n}\nfunction urlNovelComments(novelId, offset, limit) {\n    return `https://www.pixiv.net/ajax/novels/comments/roots?novel_id=${novelId}&offset=${offset}&limit=${limit}&lang=zh`\n}\nfunction urlNovelCommentsReply(commentId, page) {\n    return `https://www.pixiv.net/ajax/novels/comments/replies?comment_id=${commentId}&page=${page}&lang=zh`\n}\n\nfunction urlSeriesUrl(seriesId) {\n    return `https://www.pixiv.net/novel/series/${seriesId}`\n}\nfunction urlSeriesDetailed(seriesId) {\n    return `https://www.pixiv.net/ajax/novel/series/${seriesId}?lang=zh`\n}\nfunction urlSeriesNovelsTitles(seriesId) {\n    return `https://www.pixiv.net/ajax/novel/series/${seriesId}/content_titles`\n}\nfunction urlSeriesNovels(seriesId, limit, offset) {\n    if (limit > 30) limit = 30\n    if (limit < 10) limit = 10\n    return `https://www.pixiv.net/ajax/novel/series_content/${seriesId}?limit=${limit}&last_order=${offset}&order_by=asc&lang=zh`\n}\n\nfunction urlUserUrl(userID) {\n    return `https://www.pixiv.net/users/${userID}/novels`\n}\nfunction urlUserDetailed(userID) {\n    return `https://www.pixiv.net/ajax/user/${userID}`\n}\nfunction urlUserWorkLatest(userID) {\n    return `https://www.pixiv.net/ajax/user/${userID}/works/latest`\n}\nfunction urlUserAllWorks(userId) {\n    return `https://www.pixiv.net/ajax/user/${userId}/profile/all?lang=zh`\n}\n\nfunction urlSearchNovel(novelName, page) {\n    return `https://www.pixiv.net/ajax/search/novels/${novelName}?word=${novelName}&order=date_d&mode=all&p=${page}&s_mode=s_tag&lang=zh`\n}\nfunction urlSearchSeries(seriesName, page) {\n    return`https://www.pixiv.net/ajax/search/novels/${seriesName}?word=${seriesName}&order=date_d&mode=all&p=${page}&s_mode=s_tag&gs=1&lang=zh`\n}\n// ä¸å®Œå…¨åŒ¹é…ç”¨æˆ·å\nfunction urlSearchUser(userName, full) {\n    if (full === undefined || full === false) {\n        return `https://www.pixiv.net/search/users?nick=${userName}&s_mode=s_usr&nick_mf=1`\n    } else {\n        return `https://www.pixiv.net/search/users?nick=${userName}&s_mode=s_usr_full&i=1`\n    }\n}\n\nfunction urlCoverUrl(url) {\n    return `${url}, {\"headers\": {\"Referer\":\"https://www.pixiv.net/\"}}`\n}\nfunction urlIllustDetailed(illustId) {\n    return `https://www.pixiv.net/ajax/illust/${illustId}?lang=zh`\n}\nfunction urlIllustOriginal(illustId, order) {\n    const {java, cache} = this\n    if (order <= 1) order = 1\n    let url = urlIllustDetailed(illustId)\n    let illustOriginal = cacheGetAndSet(cache, url, () => {\n        return JSON.parse(java.ajax(url))\n    }).body.urls.original\n    return urlCoverUrl(illustOriginal.replace(`_p0`, `_p${order - 1}`))\n}\n\nfunction urlMessageThreadLatest(max) {\n    if (max === undefined || max <= 5) max = 5\n    return `https://www.pixiv.net/rpc/index.php?mode=latest_message_threads2&num=${max}&lang=zh`\n}\nfunction urlMessageThreadContents(threadId, max) {\n    return `https://www.pixiv.net/rpc/index.php?mode=message_thread_contents&thread_id=${threadId}&num=${max}`\n}\nfunction urlMessageThreadDetail(threadId) {\n    return `https://www.pixiv.net/rpc/index.php?mode=message_thread&thread_id=${threadId}`\n}\nfunction urlNotification() {\n    return `https://www.pixiv.net/ajax/notification&lang=zh`\n}\n\nfunction dateFormat(str) {\n    let addZero = function (num) {\n        return num < 10 ? '0' + num : num;\n    }\n    let time = new Date(str);\n    let Y = time.getFullYear() + \"å¹´\";\n    let M = addZero(time.getMonth() + 1) + \"æœˆ\";\n    let D = addZero(time.getDate()) + \"æ—¥\";\n    return Y + M + D;\n}\nfunction timeTextFormat(text) {\n    return `${text.slice(0, 10)} ${text.slice(11, 19)}`\n}\nfunction sleep(time) {\n    let endTime = new Date().getTime() + time\n    while(true){\n        if (new Date().getTime() > endTime){\n            return;\n        }\n    }\n}\nfunction sleepToast(text, second) {\n    const {java} = this\n    java.log(text)\n    java.longToast(text)\n    if (second === undefined || second <= 3) {second = 3}\n    sleep(1000*second)\n}\n\nfunction updateSource() {\n    const {java, source} = this\n    let onlineSource, comment, sourceName, sourceNameCapitalize, index = 0\n    if (source.bookSourceUrl.includes(\"pixiv\")) sourceName = \"pixiv\"\n    else if (source.bookSourceUrl.includes(\"furrynovel\")) sourceName = \"linpx\"\n    sourceNameCapitalize = sourceName[0].toUpperCase() + sourceName.substring(1)\n\n    if (source.bookSourceName.includes(\"å¤‡ç”¨\")) index = 1\n    else if (source.bookSourceName.includes(\"æ¼«ç”»\")) index = 2\n    if (source.bookSourceUrl.includes(\"furrynovel.com\")) {\n        sourceNameCapitalize = \"FurryNovel\"\n        index = 1\n    }\n\n    try {\n        let updateUrl = `https://cdn.jsdelivr.net/gh/windyhusky/PixivSource@main/${sourceName}.json`\n        onlineSource = JSON.parse(java.get(updateUrl,{'User-Agent': 'Mozilla/5.0 (Linux; Android 14)','X-Requested-With': 'XMLHttpRequest'}).body())[index]\n        comment = onlineSource.bookSourceComment.split(\"\\n\")\n    } catch (e) {\n        try {\n            let updateUrl = `https://raw.githubusercontent.com/windyhusky/PixivSource/main/${sourceName}.json`\n            onlineSource = JSON.parse(java.get(updateUrl,{'User-Agent': 'Mozilla/5.0 (Linux; Android 14)','X-Requested-With': 'XMLHttpRequest'}).body())[index]\n            comment = onlineSource.bookSourceComment.split(\"\\n\")\n        } catch (e) {\n            onlineSource = {lastUpdateTime: new Date().getTime()}\n            comment = source.bookSourceComment.split(\"\\n\")\n        }\n    }\n\n    let htm = `data:text/html; charset=utf-8,\n<html>\n<head>\n    <meta name=\"viewport\" content=\"width=device-width, initial-scale=1.0\">\n    <title>æ›´æ–° ${source.bookSourceName} ä¹¦æº</title>\n    <style> \n    table { text-align: center; margin: 0 auto; } .ann { display: flex; justify-content: center; align-items: center; height: 5vh; } \n    button { background-color: rgb(76, 175, 80); color: white; border: none; border-radius: 4px; height: 6vh; width: 30vw; overflow: hidden; } \n    button span { cursor: pointer; display: inline-block; position: relative; transition: 0.4s; } \n    button span:after { content: '>'; position: absolute; opacity: 0; top: 0; right: 30px; transition: 0.2s; } \n    button:active span { padding-right: 20px; } \n    button:active span:after { opacity: 1; right: -40px; }\n    </style>\n</head>\n\n<body>\n    <table border=\"1\" cellspacing=\"0\">\n        <th colspan=\"2\"> ${source.bookSourceName} ä¹¦æº <a href=\"https://github.com/windyhusky/PixivSource/blob/main/doc/${sourceNameCapitalize}.md\">ğŸ”° ä½¿ç”¨æŒ‡å—</a></th>\n        <tr><td>â˜ï¸ è¿œç¨‹ä»“åº“ç‰ˆæœ¬ï¼š${java.timeFormat(onlineSource.lastUpdateTime)}</td></tr>\n        <tr><td>ğŸ“¥ é˜…è¯»æœ¬åœ°ç‰ˆæœ¬ï¼š${java.timeFormat(source.lastUpdateTime)}</td></tr>\n        <tr><td style=\"text-align: left;\">${comment.slice(2, 9).join(\"<br>\")}</td></tr>\n        <tr><td style=\"text-align: left;\">${comment.slice(comment.length-7, comment.length).join(\"<br>\")}</td></tr>\n    </table>\n    \n    <table border=\"0\" cellspacing=\"20\">\n        <th colspan=\"2\"> æ›´æ–° ${source.bookSourceName} ä¹¦æº </th>\n        <tr><td><div class=\"ann\">\n            <a href=\"legado://import/importonline?src=https://cdn.jsdelivr.net/gh/windyhusky/PixivSource@main/${sourceName}.json\">\n            <button><span>æ›´æ–°ä¹¦æº<br>(Jsdelivr CDN)</span></button>\n            </a></div></td>\n            \n            <td><div class=\"ann\">\n            <a href=\"legado://import/importonline?src=https://cdn.jsdelivr.net/gh/windyhusky/PixivSource@main/btsrk.json\">\n            <button><span>æ›´æ–°è®¢é˜…<br>(Jsdelivr CDN)</span></button>\n            </a></div></td>\n        </tr>\n        \n        <tr><td><div class=\"ann\">\n            <a href=\"legado://import/importonline?src=https://raw.githubusercontent.com/windyhusky/PixivSource/main/${sourceName}.json\">\n            <button><span>ä¹¦æºé“¾æ¥<br>(GitHub)</span></button>\n            </a></div></td>\n            \n            <td><div class=\"ann\">\n            <a href=\"legado://import/importonline?src=https://raw.githubusercontent.com/windyhusky/PixivSource/main/btsrk.json\">\n            <button><span>è®¢é˜…é“¾æ¥<br>(GitHub)</span></button>\n            </a></div></td>\n        </tr>\n        \n        <tr><td><div class=\"ann\">\n            <a href=\"legado://import/importonline?src=https://codeberg.org/DowneyRem/PixivSource/raw/branch/main/${sourceName}.json\">\n            <button><span>å¤‡ç”¨ä¹¦æºé“¾æ¥<br>(Codeberg)</span></button>\n            </a></div></td>\n            \n            <td><div class=\"ann\">\n            <a href=\"legado://import/importonline?src=https://codeberg.org/DowneyRem/PixivSource/raw/branch/main/btsrk.json\">\n            <button><span>å¤‡ç”¨è®¢é˜…é“¾æ¥<br>(Codeberg)</span></button>\n            </a></div></td>\n        </tr>\n    </table>\n</body>\n</html>`;\n    java.startBrowser(htm,'æ›´æ–°ä¹¦æº');\n    return []\n}",
        "lastUpdateTime": 1749096000251,
        "loginCheckJs": "var util = {}\n\nfunction objStringify(obj) {\n    return JSON.stringify(obj, (n, v) => {\n        if (typeof v == \"function\")\n            return v.toString();\n        return v;\n    });\n}\n\nfunction publicFunc() {\n    let u = {}, settings\n    java.log(String(source.bookSourceComment).split(\"\\n\")[0])       // è¾“å‡ºä¹¦æºä¿¡æ¯\n    java.log(`æœ¬åœ°ä¹¦æºæ›´æ–°æ—¶é—´ï¼š${java.timeFormat(source.lastUpdateTime)}`) // è¾“å‡ºä¹¦æºä¿¡æ¯\n\n    // è·å–è®¾ç½®ï¼Œå¤‡ç”¨ä¹¦æºä½¿ç”¨æ—§ç‰ˆè®¾ç½®ï¼Œä¹¦æºä»ç¼“å­˜è·å–è®¾ç½®\n    if (source.bookSourceName.includes(\"å¤‡ç”¨\")) {\n        settings = JSON.parse(String(source.variableComment).match(RegExp(/{([\\s\\S]*?)}/gm)))\n    } else {\n        settings = getFromCache(\"pixivSettings\")\n    }\n    if (settings !== null) {\n        java.log(\"âš™ï¸ ä½¿ç”¨è‡ªå®šä¹‰è®¾ç½®\")\n    } else {\n        settings = {}\n        settings.CONVERT_CHINESE = true     // æœç´¢ï¼šæœç´¢æ—¶è¿›è¡Œç¹ç®€è½¬æ¢\n        settings.MORE_INFORMATION = false   // è¯¦æƒ…ï¼šä¹¦ç±ç®€ä»‹æ˜¾ç¤ºæ›´å¤šä¿¡æ¯\n        settings.SHOW_UPDATE_TIME = true    // ç›®å½•ï¼šæ˜¾ç¤ºæ›´æ–°æ—¶é—´ï¼Œä½†ä¼šå¢åŠ å°‘è®¸è¯·æ±‚\n        settings.SHOW_ORIGINAL_LINK = true  // ç›®å½•ï¼šæ˜¾ç¤ºåŸå§‹é“¾æ¥ï¼Œä½†ä¼šå¢åŠ å¤§é‡è¯·æ±‚\n        settings.REPLACE_TITLE_MARKS = true // æ­£æ–‡ï¼šæ³¨éŸ³å†…å®¹ä¸ºæ±‰å­—æ—¶ï¼Œæ›¿æ¢ä¸ºä¹¦åå·\n        settings.SHOW_CAPTIONS = true       // æ­£æ–‡ï¼šç« é¦–æ˜¾ç¤ºæè¿°\n        settings.SHOW_COMMENTS = true       // æ­£æ–‡ï¼šç« å°¾æ˜¾ç¤ºè¯„è®º\n        settings.FAST  = false              // å…¨å±€ï¼šå¿«é€Ÿæ¨¡å¼\n        settings.DEBUG = false              // å…¨å±€ï¼šè°ƒè¯•æ¨¡å¼\n        java.log(\"âš™ï¸ ä½¿ç”¨é»˜è®¤è®¾ç½®ï¼ˆæ— è‡ªå®šä¹‰è®¾ç½® æˆ– è‡ªå®šä¹‰è®¾ç½®æœ‰è¯¯ï¼‰\")\n    }\n\n    u.CONVERT_CHINESE = settings.CONVERT_CHINESE\n    u.MORE_INFORMATION = settings.MORE_INFORMATION\n    u.SHOW_UPDATE_TIME = settings.SHOW_UPDATE_TIME\n    u.SHOW_ORIGINAL_LINK = settings.SHOW_ORIGINAL_LINK\n    u.REPLACE_TITLE_MARKS = settings.REPLACE_TITLE_MARKS\n    u.SHOW_CAPTIONS = settings.SHOW_CAPTIONS\n    u.SHOW_COMMENTS = settings.SHOW_COMMENTS\n    u.FAST  = settings.FAST\n    u.DEBUG = settings.DEBUG\n\n    if (u.FAST === true) {\n        u.CONVERT_CHINESE = settings.CONVERT_CHINESE = false        // æœç´¢ï¼šç¹ç®€é€šæœ\n        u.SHOW_UPDATE_TIME = settings.SHOW_UPDATE_TIME = true       // ç›®å½•ï¼šæ˜¾ç¤ºç« èŠ‚æ›´æ–°æ—¶é—´\n        u.SHOW_ORIGINAL_LINK = settings.SHOW_ORIGINAL_LINK = false  // ç›®å½•ï¼šæ˜¾ç¤ºç« èŠ‚æºé“¾æ¥\n        u.SHOW_CAPTIONS = settings.SHOW_CAPTIONS = true             // æ­£æ–‡ï¼šæ˜¾ç¤ºè¯„è®º\n    }\n    cache.put(\"pixivSettings\", JSON.stringify(settings))  // è®¾ç½®å†™å…¥ç¼“å­˜\n\n    if (u.DEBUG === true) {\n        java.log(JSON.stringify(settings, null, 4))\n        java.log(`DEBUG = ${u.DEBUG}`)\n    }\n    u.debugFunc = (func) => {\n        if (util.DEBUG) {\n            func()\n        }\n    }\n\n    // å°†å¤šä¸ªé•¿ç¯‡å°è¯´è§£æä¸ºä¸€æœ¬ä¹¦\n    u.combineNovels = function (novels) {\n        return novels.filter(novel => {\n            // å•æœ¬ç›´æ¥è§£æä¸ºä¸€æœ¬ä¹¦\n            if (novel.seriesId === undefined || novel.seriesId === null) {\n                return true\n            }\n            // é›†åˆä¸­æ²¡æœ‰è¯¥ç³»åˆ—è§£æä¸ºä¸€æœ¬ä¹¦\n            if (!seriesSet.has(novel.seriesId)) {\n                seriesSet.add(novel.seriesId)\n                return true\n            }\n            return false\n        })\n    }\n\n    // å¤„ç† novels åˆ—è¡¨\n    u.handNovels = function (novels, detailed=false) {\n        let authors = getFromCache(\"blockAuthorList\")  // å±è”½ä½œè€…\n        if (authors !== null) {\n            java.log(`å±è”½ä½œè€…IDï¼š${JSON.stringify(authors)}`)\n            authors.forEach(author => {\n                novels = novels.filter(novel => novel.userId !== String(author))\n            })\n        }\n\n        novels.forEach(novel => {\n            // novel.id = novel.id\n            // novel.title = novel.title\n            // novel.userName = novel.userName\n            // novel.userId = novel.userId\n            // novel.tags = novel.tags\n            cache.put(`${novel.userName}`, novel.userId)  // åŠ å…¥ç¼“å­˜ï¼Œä¾¿äºæœç´¢ä½œè€…\n            if (novel.tags === undefined || novel.tags === null) {\n                novel.tags = []\n            }\n            // é»˜è®¤æœç´¢\n            if (novel.isOneshot === undefined) {\n                // novel.seriesId = novel.seriesId\n                // novel.seriesTitle = novel.seriesTitle\n                // novel.textCount = novel.textCount\n                // novel.description = novel.description\n                novel.coverUrl = novel.url\n                // novel.createDate = novel.createDate\n                // novel.updateDate = novel.updateDate\n            } else {  // æœç´¢ç³»åˆ—\n                if (novel.isOneshot === true) {\n                    novel.seriesId = undefined\n                    novel.id = novel.novelId  // è·å–çœŸæ­£çš„ novelId\n                    novel.seriesTitle = undefined\n                } else {\n                    novel.seriesId = novel.id\n                    novel.id = novel.novelId = novel.latestEpisodeId  // è·å–çœŸæ­£çš„ novelId\n                    novel.seriesTitle = novel.title\n                }\n                novel.textCount = novel.textLength\n                novel.description = novel.caption\n                novel.coverUrl = novel.cover.urls[\"480mw\"]\n                novel.createDate = novel.createDateTime\n                novel.updateDate = novel.updateDateTime\n            }\n\n            // æ­£æ–‡è¯¦æƒ…é¡µ\n            if (novel.content !== undefined) {\n                novel.novelId = novel.id\n                novel.tags = novel.tags.tags.map(item => item.tag)\n                novel.textCount = novel.userNovels[`${novel.id}`].textCount\n                // novel.latestChapter = novel.title\n                // novel.description = novel.description\n                novel.coverUrl = novel.userNovels[`${novel.id}`].url\n                // novel.createDate = novel.createDate\n                novel.updateDate = novel.uploadDate\n                if (novel.seriesNavData !== undefined && novel.seriesNavData !== null) {\n                    novel.seriesId = novel.seriesNavData.seriesId\n                    novel.seriesTitle = novel.seriesNavData.title\n                }\n            }\n            // ç³»åˆ—è¯¦æƒ…\n            if (novel.firstNovelId !== undefined) {\n                novel.seriesId = novel.id\n                novel.id = novel.novelId = novel.firstNovelId\n                novel.seriesTitle = novel.title\n                novel.coverUrl = novel.cover.urls[\"480mw\"]\n            }\n\n            if (novel.seriesId === undefined || novel.seriesId === null) {  // å•ç¯‡\n                novel.tags.unshift(\"å•æœ¬\")\n                novel.latestChapter = novel.title\n                novel.detailedUrl = urlNovelDetailed(novel.id)\n            }\n            if (novel.seriesId !== undefined && detailed === false) {\n                novel.id = novel.seriesId\n                novel.firstNovelId = novel.novelId\n                novel.title = novel.seriesTitle\n                novel.tags.unshift(\"é•¿ç¯‡\")\n                novel.detailedUrl = urlSeriesDetailed(novel.seriesId)\n                // novel.seriesNavData = {}\n                // novel.seriesNavData.seriesId = novel.seriesId\n                // novel.seriesNavData.title = novel.seriesTitle\n            }\n\n            if (novel.seriesId !== undefined && detailed === true) {\n                let series = getAjaxJson(urlSeriesDetailed(novel.seriesId)).body\n                novel.id = series.firstNovelId\n                novel.title = series.title\n                // novel.userName = novel.userName\n                novel.tags = novel.tags.concat(series.tags)\n                novel.tags.unshift(\"é•¿ç¯‡\")\n                novel.textCount = series.publishedTotalCharacterCount\n                novel.description = series.caption\n                novel.coverUrl = series.cover.urls[\"480mw\"]\n\n                // å‘é€è¯·æ±‚è·å–ç¬¬ä¸€ç«  è·å–æ ‡ç­¾ä¸ç®€ä»‹\n                let firstNovel = {}\n                try {\n                    firstNovel = getAjaxJson(urlNovelDetailed(series.firstNovelId)).body\n                    novel.tags = novel.tags.concat(firstNovel.tags.tags.map(item => item.tag))\n                } catch (e) {  // é˜²æ­¢ç³»åˆ—é¦–ç¯‡æ— æƒé™è·å–\n                    try {\n                        firstNovel = getAjaxJson(urlSeriesNovels(novel.seriesId, 30, 0)).body.thumbnails.novel[0]\n                        novel.id = novel.firstNovelId = firstNovel.id\n                        novel.tags = novel.tags.concat(firstNovel.tags)\n                    } catch (e) { // é˜²æ­¢ç³»åˆ—é¦–ç¯‡æ— æƒé™è·å–\n                        firstNovel = {}\n                        firstNovel.description = \"\"\n                    }\n                }\n                novel.tags.unshift(\"é•¿ç¯‡\")\n                if (novel.description === \"\") {\n                    novel.description = firstNovel.description\n                }\n            }\n        })\n        util.debugFunc(() => {\n            java.log(`å¤„ç†å°è¯´å®Œæˆ`)\n        })\n        return novels\n    }\n\n    // å°è¯´ä¿¡æ¯æ ¼å¼åŒ–\n    u.formatNovels = function (novels) {\n        novels.forEach(novel => {\n            novel.title = novel.title.replace(RegExp(/^\\s+|\\s+$/g), \"\")\n            novel.coverUrl = urlCoverUrl(novel.coverUrl)\n            novel.readingTime = `${novel.readingTime / 60} åˆ†é’Ÿ`\n            novel.createDate = dateFormat(novel.createDate);\n            novel.updateDate = dateFormat(novel.updateDate);\n\n            novel.tags2 = []\n            for (let i in novel.tags) {\n                let tag = novel.tags[i]\n                if (tag.includes(\"/\")) {\n                    let tags = tag.split(\"/\")\n                    novel.tags2 = novel.tags2.concat(tags)\n                } else {\n                    novel.tags2.push(tag)\n                }\n            }\n            novel.tags = Array.from(new Set(novel.tags2))\n            novel.tags = novel.tags.join(\",\")\n\n            if (util.MORE_INFORMATION) {\n                novel.description = `\\nä¹¦åï¼š${novel.title}\\nä½œè€…ï¼š${novel.userName}\\næ ‡ç­¾ï¼š${novel.tags}\\nä¸Šä¼ ï¼š${novel.createDate}\\næ›´æ–°ï¼š${novel.updateDate}\\nç®€ä»‹ï¼š${novel.description}`\n            } else {\n                novel.description = `\\n${novel.description}\\nä¸Šä¼ æ—¶é—´ï¼š${novel.createDate}\\næ›´æ–°æ—¶é—´ï¼š${novel.updateDate}`\n            }\n        })\n        return novels\n    }\n\n    // æ­£æ–‡ï¼Œè¯¦æƒ…ï¼Œæœç´¢ï¼šä»ç½‘å€è·å–idï¼Œè¿”å›å•ç¯‡å°è¯´ resï¼Œç³»åˆ—è¿”å›é¦–ç¯‡å°è¯´ res\n    // pixiv é»˜è®¤åˆ†äº«ä¿¡æ¯ä¸­æœ‰#å·ï¼Œä¸ä¼šè¢«è¯†åˆ«æˆé“¾æ¥ï¼Œæ— æ³•ä½¿ç”¨æ·»åŠ ç½‘å€\n    u.getNovelRes = function (result) {\n        let novelId = 0, res = {\"body\": {}}\n        let isJson = isJsonString(result)\n        let isHtml = isHtmlString(result)\n\n        if (!isJson && isHtml) {\n            let id = baseUrl.match(new RegExp(\"\\\\d+\"))[0]\n            let pattern = \"(https?://)?(www\\\\.)?pixiv\\\\.net/novel/series/\\\\d+\"\n            let isSeries = baseUrl.match(new RegExp(pattern))\n            if (isSeries) {\n                java.log(`ç³»åˆ—IDï¼š${id}`)\n                try {\n                    novelId = getAjaxJson(urlSeriesDetailed(id)).body.firstNovelId\n                } catch (e) {\n                    novelId = getAjaxJson(urlSeriesNovels(id, 30, 0)).body.thumbnails.novel[0].id\n                }\n            } else {\n                let pattern = \"(https?://)?(www\\\\.)?pixiv\\\\.net/novel/(show\\\\.php\\\\?id=)?\\\\d+\"\n                let isNovel = baseUrl.match(new RegExp(pattern))\n                if (isNovel) {\n                    novelId = id\n                }\n            }\n        }\n        if (isJson) {\n            res = JSON.parse(result)\n        }\n\n        if (novelId) {\n            java.log(`åŒ¹é…å°è¯´IDï¼š${novelId}`)\n            res = getAjaxJson(urlNovelDetailed(novelId))\n        }\n        if (res.error === true) {\n            java.log(`æ— æ³•ä» Pixiv è·å–å½“å‰å°è¯´`)\n            java.log(JSON.stringify(res))\n        }\n        return res.body\n    }\n\n    // ç›®å½•ï¼šä»ç½‘å€è·å–idï¼Œå°½å¯èƒ½è¿”å›ç³»åˆ— resï¼Œå•ç¯‡å°è¯´è¿”å›å°è¯´ res\n    u.getNovelResSeries = function (result) {\n        let seriesId = 0, res = {\"body\": {}}\n        let isJson = isJsonString(result)\n        let isHtml = isHtmlString(result)\n\n        if (!isJson && isHtml) {\n            let id = baseUrl.match(new RegExp(\"\\\\d+\"))[0]\n            let pattern = \"(https?://)?(www\\\\.)?pixiv\\\\.net/novel/series/\\\\d+\"\n            let isSeries = baseUrl.match(new RegExp(pattern))\n            if (isSeries) {\n                seriesId = id\n            } else {\n                let pattern = \"(https?://)?(www\\\\.)?pixiv\\\\.net/novel/(show\\\\.php\\\\?id=)?\\\\d+\"\n                let isNovel = baseUrl.match(new RegExp(pattern))\n                if (isNovel) {\n                    java.log(`åŒ¹é…å°è¯´IDï¼š${id}`)\n                    res = getAjaxJson(urlNovelDetailed(id))\n                }\n            }\n        }\n        if (isJson) {\n            res = JSON.parse(result)\n        }\n\n        if (res.body !== undefined && res.body.seriesNavData !== undefined && res.body.seriesNavData !== null) {\n            seriesId = res.body.seriesNavData.seriesId\n        }\n        if (seriesId) {\n            java.log(`ç³»åˆ—IDï¼š${seriesId}`)\n            res = getAjaxJson(urlSeriesDetailed(seriesId))\n        }\n        if (res.error === true) {\n            java.log(`æ— æ³•ä» Pixiv è·å–å½“å‰å°è¯´`)\n            java.log(JSON.stringify(res))\n        }\n        return res.body\n    }\n\n    util = u\n    java.put(\"util\", objStringify(u))\n}\n\nfunction checkMessageThread(checkTimes) {\n    if (checkTimes === undefined) {\n        checkTimes = Number(cache.get(\"checkTimes\"))\n    }\n    if (checkTimes === 0 && isLogin()) {\n        let latestMsg = getAjaxJson(urlMessageThreadLatest(5))\n        if (latestMsg.error === true) {\n            java.log(JSON.stringify(latestMsg))\n        } else if (latestMsg.body.total >= 1) {\n            let msg = latestMsg.body.message_threads.filter(item => item.thread_name === \"pixiväº‹å‹™å±€\")[0]\n            if (msg !== undefined && new Date().getTime()- 1000*msg.modified_at <= 3*24*60*60*1000) { // 3å¤©å†…è¿›è¡Œæç¤º\n                sleepToast(`æ‚¨äº ${java.timeFormat(1000*msg.modified_at)} è§¦å‘ Pixiv ã€è¿‡åº¦è®¿é—®ã€‘ï¼Œè¯·ä¿®æ”¹å¯†ç å¹¶é‡æ–°ç™»å½•ã€‚\\nå¦‚å·²ä¿®æ”¹è¯·å¿½ç•¥`, 3)\n                sleepToast(`${msg.latest_content}`, 5)\n                java.startBrowser(\"https://accounts.pixiv.net/password/change\",'ä¿®æ”¹å¯†ç ')\n            }\n        }\n    }\n    cache.put(\"checkTimes\", checkTimes + 1, 4*60*60)  // ç¼“å­˜4hï¼Œæ¯4hæé†’ä¸€æ¬¡\n    // cache.put(\"checkTimes\", checkTimes + 1, 60)  // æµ‹è¯•ç”¨ï¼Œç¼“å­˜60sï¼Œæ¯åˆ†é’Ÿæé†’ä¸€æ¬¡\n    // java.log(checkTimes + 1)\n}\n\n// è·å–è¯·æ±‚çš„user idæ–¹ä¾¿å…¶ä»–ajaxè¯·æ±‚æ„é€ \nfunction getPixivUid() {\n    let uid = java.getResponse().headers().get(\"x-userid\")\n    if (uid != null) {\n        cache.put(\"pixiv:uid\", String(uid))\n    }\n}\n\nfunction getCookie() {\n    let pixivCookie = String(java.getCookie(\"https://www.pixiv.net/\", null))\n    if (pixivCookie.includes(\"first_visit_datetime\")) {\n        cache.put(\"pixivCookie\", pixivCookie, 60*60)\n        return pixivCookie\n    }\n}\n\n// è·å– Csrf Tokenï¼Œä»¥ä¾¿è¿›è¡Œæ”¶è—ç­‰è¯·æ±‚\n// è·å–æ–¹æ³•æ¥è‡ªè„šæœ¬ Pixiv Previewer\n// https://github.com/Ocrosoft/PixivPreviewer\n// https://greasyfork.org/zh-CN/scripts/30766-pixiv-previewer/code\nfunction getCsrfToken() {\n    let csfrToken = getWebviewJson(\"https://www.pixiv.net/\", html => {\n        return JSON.stringify(html.match(/token\\\\\":\\\\\"([a-z0-9]{32})/)[1])\n    })\n    cache.put(\"csfrToken\", csfrToken)  // ä¸ç™»å½•è®¾å¤‡æœ‰å…³\n    return csfrToken\n}\n\nfunction getHeaders() {\n    let headers = {\n        \"accept\": \"application/json\",\n        \"accept-encoding\": \"gzip, deflate, br, zstd\",\n        \"accept-language\": \"zh-CN\",\n        // \"content-type\": \"application/json; charset=utf-8\",\n        // \"content-type\": \"application/x-www-form-urlencoded; charset=utf-8\",\n        \"origin\": \"https//www.pixiv.net\",\n        \"referer\": \"https://www.pixiv.net/\",\n        // \"sec-ch-ua\": `\"Not/A)Brand\";v=\"8\", \"Chromium\";v=\"132\", \"Google Chrome\";v=\"132\"`,\n        // \"sec-ch-ua-mobile\": \"?0\",\n        // \"sec-ch-ua-platform\": \"Windows\",\n        // \"sec-fetch-dest\": \"empty\",\n        // \"sec-fetch-mode\": \"cors\",\n        // \"sec-fetch-site\": \"same-origin\",\n        \"user-agent\": String(java.getUserAgent()),\n        \"x-csrf-token\": cache.get(\"csfrToken\"),\n        \"Cookie\": cache.get(\"pixivCookie\")\n    }\n    cache.put(\"headers\", JSON.stringify(headers))\n    return headers\n}\n\nfunction getBlockAuthorsFromSource() {\n    let authors = []\n    try {\n        authors = JSON.parse(`[${source.getVariable()}]`)\n        // sleepToast(JSON.stringify(authors))\n    } catch (e) {\n        sleepToast(\"ğŸš« å±è”½ä½œè€…\\nâš ï¸ ã€ä¹¦æºã€‘æºå˜é‡è®¾ç½®æœ‰è¯¯\\nè¾“å…¥ä½œè€…IDï¼Œä»¥è‹±æ–‡é€—å·é—´éš”ï¼Œä¿å­˜\")\n    }\n    return authors\n}\n\nfunction syncBlockAuthorList() {\n    let authors1 = getFromCache(\"blockAuthorList\")\n    let authors2 = getBlockAuthorsFromSource()\n    if (authors1 === null) {\n        cache.put(\"blockAuthorList\", JSON.stringify(authors2))\n    } else if (authors1.length > authors2.length) {\n        cache.put(\"blockAuthorList\", JSON.stringify(authors2))\n        java.log(\"å±è”½ä½œè€…ï¼šå·²å°†æºå˜é‡åŒæ­¥è‡³å†…å­˜\")\n    }\n}\n\npublicFunc(); syncBlockAuthorList()\nif (result.code() === 200) {\n    getPixivUid(); getCsrfToken(); getCookie(); getHeaders()\n    if (!util.FAST) checkMessageThread()  // æ£€æµ‹è¿‡åº¦è®¿é—®\n//     if (isHtmlString(result.body())) {  // æ£€æµ‹ç™»å½•\n//         let loginStatus = getWebviewJson(baseUrl, html => {\n//             return JSON.stringify(html.match(/login:\\s*'([^']+)'/)[1])\n//         })\n//         if (loginStatus !== \"yes\") sleepToast(\"è¯·ç™»å½•\")\n//     }\n// } else if (result.code() === 400) {\n//     sleepToast(\"è¯·é‡æ–°ç™»å½•\")\n//     source.login()\n}\nutil.debugFunc(() => {\n    java.log(`${java.getUserAgent()}\\n`)\n    java.log(`${cache.get(\"csfrToken\")}\\n`)\n    java.log(`${cache.get(\"pixivCookie\")}\\n`)\n})\njava.getStrResponse(null, null)",
        "loginUrl": "https://accounts.pixiv.net/login",
        "respondTime": 180000,
        "ruleBookInfo": {
            "author": "userName",
            "canReName": "true",
            "coverUrl": "coverUrl",
            "init": "@js:\nvar util = objParse(String(java.get(\"util\")))\n\nfunction objParse(obj) {\n    return JSON.parse(obj, (n, v) => {\n        if (typeof v == \"string\" && v.match(\"()\")) {\n            return eval(`(${v})`)\n        }\n        return v;\n    })\n}\n\nfunction novelHandler(novel){\n    novel = util.formatNovels(util.handNovels([novel], true))[0]\n    if (novel.seriesId === undefined || novel.seriesId === null) {\n        novel.detailedUrl = urlNovelUrl(novel.id)\n        novel.catalogUrl = urlNovelDetailed(novel.id)\n    } else {\n        novel.detailedUrl = urlSeriesUrl(novel.seriesId)\n        novel.catalogUrl = urlSeriesDetailed(novel.seriesId)\n    }\n    source.putLoginInfo(JSON.stringify(novel))  // æ”¾å…¥ä¿¡æ¯ä»¥ä¾¿ç™»é™†ç•Œé¢ä½¿ç”¨\n    return novel\n}\n\n(() => {\n    return novelHandler(util.getNovelRes(result))\n})()",
            "intro": "description",
            "kind": "tags",
            "lastChapter": "latestChapter",
            "name": "title",
            "tocUrl": "catalogUrl",
            "wordCount": "textCount"
        },
        "ruleContent": {
            "content": "@js:\nvar util = objParse(String(java.get(\"util\")))\n\nfunction objParse(obj) {\n    return JSON.parse(obj, (n, v) => {\n        if (typeof v == \"string\" && v.match(\"()\")) {\n            return eval(`(${v})`)\n        }\n        return v;\n    })\n}\n\nfunction getContent(res) {\n    // æ”¾å…¥ä¿¡æ¯ä»¥ä¾¿ç™»é™†ç•Œé¢ä½¿ç”¨ï¼Œç¬¬ä¸€æ¬¡åŠ è½½ï¼Œåˆ·æ–°æ—¶å‡†ç¡®\n    let novel = source.getLoginInfoMap()\n    if (res.seriesNavData !== null) {\n        let seriesId = res.seriesNavData.seriesId\n        if (seriesId !== undefined && seriesId !== null) {\n            let novelIds = getFromCache(`novelIds${seriesId}`)\n            novel.id = novelIds[book.durChapterIndex]\n            novel.title = book.durChapterTitle\n        }\n    }\n    source.putLoginInfo(JSON.stringify(novel))\n    // sleepToast(`å½“å‰ç« èŠ‚ï¼š${novel.id}${novel.title}`)\n\n    let content = String(res.content)\n    // let content = \"undefined\"\n    if (content.includes(\"undefined\")) {\n        return checkContent()\n    }\n\n    // åœ¨æ­£æ–‡å†…éƒ¨æ·»åŠ å°è¯´æè¿°\n    if (util.SHOW_CAPTIONS === true && res.description !== \"\") {\n        content = res.description + \"\\n\" + \"â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”\\n\".repeat(2) + content\n    }\n\n    // è·å– [uploadedimage:] çš„å›¾ç‰‡é“¾æ¥\n    let hasEmbeddedImages = res.textEmbeddedImages !== undefined && res.textEmbeddedImages !== null\n    if (hasEmbeddedImages) {\n        Object.keys(res.textEmbeddedImages).forEach((key) => {\n            content = content.replace(`[uploadedimage:${key}]`, `<img src=\"${urlCoverUrl(res.textEmbeddedImages[key].urls.original)}\">`)\n        })\n    }\n\n    // è·å– [pixivimage:] çš„å›¾ç‰‡é“¾æ¥ [pixivimage:1234] [pixivimage:1234-1]\n    let matched = content.match(RegExp(/\\[pixivimage:(\\d+)-?(\\d+)]/gm))\n    if (matched) {\n        matched.forEach(pixivimage => {\n            let matched2, illustId, order = 0\n            if (pixivimage.includes(\"-\")) {\n                matched2 = pixivimage.match(RegExp(\"(\\\\d+)-(\\\\d+)\"))\n                illustId = matched2[1]; order = matched2[2]\n            } else {\n                matched2 = pixivimage.match(RegExp(\"\\\\d+\"))\n                illustId = matched2[0];\n            }\n            content = content.replace(`${pixivimage}`, `<img src=\"${urlIllustOriginal(illustId, order)}\">`)\n        })\n    }\n\n    // æ›¿æ¢ Pixiv åˆ†é¡µæ ‡è®°ç¬¦å· [newpage]\n    matched = content.match(RegExp(/[ ã€€]*\\[newpage][ ã€€]*/gm))\n    if (matched) {\n        for (let i in matched) {\n            content = content.replace(`${matched[i]}`, `${\"<p>â€‹<p/>\".repeat(3)}`)\n        }\n    }\n\n    // æ›¿æ¢ Pixiv ç« èŠ‚æ ‡è®°ç¬¦å· [chapter:]\n    matched = content.match(RegExp(/\\[chapter:(.*?)]/gm))\n    if (matched) {\n        for (let i in matched) {\n            let matched2 = matched[i].match(/\\[chapter:(.*?)]/m)\n            let chapter = matched2[1].trim()\n            content = content.replace(`${matched[i]}`, `${chapter}<p>â€‹<p/>`)\n        }\n    }\n\n    // æ›¿æ¢ Pixiv è·³è½¬é¡µé¢æ ‡è®°ç¬¦å· [[jump:]]\n    matched = content.match(RegExp(/\\[jump:(\\d+)]/gm))\n    if (matched) {\n        for (let i in matched) {\n            let page = matched[i].match(/\\d+/)\n            content = content.replace(`${matched[i]}`, `\\n\\nè·³è½¬è‡³ç¬¬${page}èŠ‚`)\n        }\n    }\n\n    // æ›¿æ¢ Pixiv é“¾æ¥æ ‡è®°ç¬¦å· [[jumpuri: > ]]\n    matched = content.match(RegExp(/\\[\\[jumpuri:(.*?)>(.*?)]]/gm))\n    if (matched) {\n        for (let i in matched) {\n            let matched2 = matched[i].match(/\\[\\[jumpuri:(.*?)>(.*?)]]/m)\n            let matchedText = matched2[0]\n            let urlName = matched2[1].trim()\n            let urlLink = matched2[2].trim()\n            // é˜…è¯»ä¸æ”¯æŒè¶…é“¾æ¥\n            //content = content.replace(`${matchedText}`, `<a href=${urlLink}>${urlName}</a>`)\n            if (urlLink === urlName) {\n                content = content.replace(`${matchedText}`, `${urlName}`)\n            } else {\n                content = content.replace(`${matchedText}`, `${urlName}: ${urlLink}`)\n            }\n        }\n    }\n\n    // æ›¿æ¢ Pixiv æ³¨éŸ³æ ‡è®°ç¬¦å· [[rb: > ]]\n    matched = content.match(RegExp(/\\[\\[rb:(.*?)>(.*?)]]/gm))\n    if (matched) {\n        for (let i in matched) {\n            let matched2 = matched[i].match(/\\[\\[rb:(.*?)>(.*?)]]/m)\n            let matchedText = matched2[0]\n            let kanji = matched2[1].trim()\n            let kana = matched2[2].trim()\n\n            if (!util.REPLACE_TITLE_MARKS) {\n                // é»˜è®¤æ›¿æ¢æˆï¼ˆæ‹¬å·ï¼‰\n                content = content.replace(`${matchedText}`, `${kanji}ï¼ˆ${kana}ï¼‰`)\n            } else {\n                let reg = RegExp(\"[\\\\u4E00-\\\\u9FFF]+\", \"g\");\n                if (reg.test(kana)) {\n                    // kanaä¸ºä¸­æ–‡ï¼Œåˆ™æ›¿æ¢å›ã€Šä¹¦åå·ã€‹\n                    content = content.replace(`${matchedText}`, `${kanji}ã€Š${kana}ã€‹`)\n                } else {\n                    // é˜…è¯»ä¸æ”¯æŒ <ruby> <rt> æ³¨éŸ³\n                    // content = content.replace(`${matchedText}`, `<ruby>${kanji}<rt>${kana}</rt></ruby>`)\n                    content = content.replace(`${matchedText}`, `${kanji}ï¼ˆ${kana}ï¼‰`)\n                }\n            }\n        }\n    }\n\n    if (util.SHOW_COMMENTS === true) {\n        return content + getComment(res)\n    } else {\n        return content\n    }\n}\n\nfunction getComment(res) {\n    let comments = \"\"\n    let resp = getAjaxJson(urlNovelComments(res.id, 0, 50), true)\n    if (resp.error === true){\n        return \"\"\n    }\n    resp.body.comments.forEach(comment =>{\n        comments += `${comment.userName}ï¼š${comment.comment}(${comment.id})\\n`\n        if (comment.hasReplies === true) {\n            let resp = getAjaxJson(urlNovelCommentsReply(comment.id, 1), true)\n            if (resp.error === true) {\n                return \"\"\n            }\n            resp.body.comments.reverse().forEach(reply =>{\n                comments += `${reply.userName}(â¤´ï¸${reply.replyToUserName})ï¼š${reply.comment}(${reply.id})\\n`\n            })\n        }\n    })\n    if (comments) {\n        comments = \"\\n\" + \"â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”\\n\".repeat(2) + \"ç« èŠ‚è¯„è®ºï¼š\\n\" + comments\n    }\n    return comments\n}\n\nfunction checkContent() {\n    let latestMsg = getAjaxJson(urlMessageThreadLatest(5))\n    if (latestMsg.error === true) {\n        java.log(JSON.stringify(latestMsg))\n    } else if (latestMsg.body.total >= 1) {\n        let msg = latestMsg.body.message_threads.filter(item => item.thread_name === \"pixiväº‹å‹™å±€\")[0]\n        if (msg === undefined) {\n            sleepToast(`æ‚¨äº ${java.timeFormat(new Date().getTime())} è§¦å‘ Pixiv ã€è¯·æ±‚é™åˆ¶ã€‘ï¼Œå»ºè®®ç¨å€™/é‡æ–°ç™»å½•å†ç»§ç»­`, 3)\n            // java.startBrowser(\"https://www.pixiv.net\", 'é€€å‡ºç™»å½•')\n            // java.startBrowser(\"https://www.pixiv.net/logout.php\",'é€€å‡ºç™»å½•')  // ä¸æ¸…é™¤ WebView ç¼“å­˜æ— æ³•é‡æ–°ç™»å½•\n\n        } else if (new Date().getTime()- 1000*msg.modified_at <= 3*24*60*60*1000) { // 3*24hå†…æé†’\n            sleepToast(`æ‚¨äº ${java.timeFormat(1000*msg.modified_at)} è§¦å‘ Pixiv ã€è¿‡åº¦è®¿é—®ã€‘ï¼Œè¯·ä¿®æ”¹å¯†ç å¹¶é‡æ–°ç™»å½•`, 3)\n            sleepToast(`${msg.latest_content}`, 5)\n            java.startBrowser(\"https://accounts.pixiv.net/password/change\",'ä¿®æ”¹å¯†ç ')\n        }\n    }\n}\n\n(() => {\n    return getContent(util.getNovelRes(result))\n})()",
            "imageStyle": "DEFAULT"
        },
        "ruleExplore": {
            "author": "userName",
            "bookList": "@js:\nvar util = objParse(String(java.get(\"util\")))\nvar seriesSet = new Set();  // å­˜å‚¨seriesID æœ‰BUGæ— æ³•å¤„ç†ç¿»é¡µ\n\nfunction objParse(obj) {\n    return JSON.parse(obj, (n, v) => {\n        if (typeof v == \"string\" && v.match(\"()\")) {\n            return eval(`(${v})`)\n        }\n        return v;\n    })\n}\n\nfunction handlerFactory() {\n    if (baseUrl.includes(\"https://cdn.jsdelivr.net\")) {\n        return () => {updateSource(); return []}\n    }\n    if (!isLogin()) {\n        return handlerNoLogin()\n    }\n    if (baseUrl.includes(\"/bookmark\")) {\n        return handlerBookMarks()\n    }\n    if (baseUrl.includes(\"/top\")) {\n        return handlerRecommend()\n    }\n    if (baseUrl.includes(\"/follow_latest\")) {\n        return handlerFollowLatest()\n    }\n    if (baseUrl.includes(\"/watch_list\")) {\n        return handlerWatchList()\n    }\n    if (baseUrl.includes(\"/discovery\")) {\n        return handlerDiscovery()\n    }\n    if (baseUrl.includes(\"/new\")) {\n        return handlerDiscovery()\n    }\n    if (baseUrl.includes(\"/commission/\")) {\n        return handlerFollowLatest()\n    }\n    if (baseUrl.includes(\"/user_event/portal\")) {\n        return handlerFollowLatest()\n    }\n    if (baseUrl.includes(\"/genre\")) {\n        return handlerWatchList()\n    }\n    // æ­£åˆ™åŒ¹é…ç½‘å€å†…å®¹\n    if (baseUrl.includes(\"/ranking\")) {\n        return handlerRanking()\n    }\n    if (baseUrl.includes(\"/marker_all\")) {\n        return handlerRanking()\n    }\n    if (baseUrl.includes(\"/editors_picks\")) {\n        return handlerRanking()\n    }\n    if (baseUrl.includes(\"https://www.pixiv.net\")) {\n        return handlerRanking()\n    }\n    else {\n        return []\n    }\n}\n\nfunction handlerNoLogin() {\n    return () => {\n        sleepToast(\"æ­¤åŠŸèƒ½éœ€è¦åœ¨ä¹¦æºç™»å½•åæ‰èƒ½ä½¿ç”¨\")\n        sleepToast('å‘ç° - é•¿æŒ‰\"Pixiv\" - ç™»å½• - ç™»å½•è´¦å·')\n        sleepToast('è®¢é˜…æºå¤„é€€å‡ºè´¦å·åï¼Œéœ€è¦æ¸…é™¤ Webview æ•°æ®ï¼Œæ‰èƒ½é‡æ–°ç™»å½•')\n        sleepToast('æˆ‘çš„ - å…¶ä»–è®¾ç½® - æ¸…é™¤ Webview æ•°æ® - ç¡®å®š - é‡æ–°ç™»å½•')\n        return []\n    }\n}\n\n// æ¨èå°è¯´\nfunction handlerRecommend() {\n    return () => {\n        let res = JSON.parse(result)\n        const recommend = res.body.page.recommend\n        const novels = res.body.thumbnails.novel\n        let nidSet = new Set(recommend.ids)\n        // java.log(nidSet.size)\n        let list = novels.filter(novel => nidSet.has(String(novel.id)))\n        // java.log(`è¿‡æ»¤ç»“æœ:${JSON.stringify(list)}`)\n        return util.formatNovels(util.handNovels(util.combineNovels(list)))\n    }\n}\n\n// æ”¶è—å°è¯´ï¼Œä»–äººæ”¶è—\nfunction handlerBookMarks() {\n    return () => {\n        let res = JSON.parse(result).body.works\n        if (res === undefined || res.length === 0) {\n            //æµç¨‹æ— æ³•æœ¬ç¯èŠ‚ä¸­æ­¢ åªèƒ½äº¤ç»™ä¸‹ä¸€æµç¨‹å¤„ç†\n            return []\n        }\n        return util.formatNovels(util.handNovels(res))\n    }\n}\n\n//å…³æ³¨ä½œè€…ï¼Œå°è¯´å§”æ‰˜ï¼Œå°è¯´ä¼åˆ’\nfunction handlerFollowLatest() {\n    return () => {\n        let res = JSON.parse(result)\n        return util.formatNovels(util.handNovels(util.combineNovels(res.body.thumbnails.novel)))\n    }\n}\n\n//æ¨èå°è¯´ï¼Œæœ€è¿‘å°è¯´\nfunction handlerDiscovery() {\n    return () => {\n        let res = JSON.parse(result)\n        return util.formatNovels(util.handNovels(util.combineNovels(res.body.novels)))\n    }\n}\n\n// è¿½æ›´åˆ—è¡¨ï¼Œçƒ­é—¨åˆ†ç±»\nfunction handlerWatchList() {\n    return () => {\n        let res = JSON.parse(result)\n        return util.formatNovels(util.handNovels(res.body.thumbnails.novelSeries))\n    }\n}\n\n// æ’è¡Œæ¦œï¼Œä¹¦ç­¾ï¼Œé¦–é¡µï¼Œç¼–è¾‘éƒ¨æ¨èï¼Œé¡ºåºç›¸åŒ\nfunction handlerRanking() {\n    return () => {\n        let novels = [], novelIds = [], novelUrls = []\n        // let result = result + java.ajax(`${baseUrl}&p=2`)  // æ­£åˆ™è·å–ç½‘å€ä¸­çš„ novelId\n        let matched = result.match(RegExp(/\\/novel\\/show\\.php\\?id=\\d{5,}/gm))\n        for (let i in matched) {\n            let novelId = matched[i].match(RegExp(/\\d{5,}/))[0]\n            if (novelIds.indexOf(novelId) === -1) {\n                novelIds.push(novelId)\n                novelUrls.push(urlNovelDetailed(novelId))\n                // java.log(urlNovelDetailed(novelId))\n            }\n        }\n        return util.formatNovels(util.handNovels(util.combineNovels(getAjaxAllJson(novelUrls))))\n    }\n}\n\n(() => {\n    return handlerFactory()()\n})()",
            "bookUrl": "detailedUrl",
            "coverUrl": "coverUrl",
            "intro": "description",
            "kind": "tags",
            "lastChapter": "latestChapter",
            "name": "title",
            "wordCount": "textCount"
        },
        "ruleSearch": {
            "author": "userName",
            "bookList": "@js:\nvar util = objParse(String(java.get(\"util\")))\n\nfunction objParse(obj) {\n    return JSON.parse(obj, (n, v) => {\n        if (typeof v == \"string\" && v.match(\"()\")) {\n            return eval(`(${v})`)\n        }\n        return v;\n    })\n}\n\nvar first = true;\n// å­˜å‚¨seriesID\nvar seriesSet = {\n    keywords: \"Pixiv:Search\",\n    has: (value) => {\n        let page = Number(java.get(\"page\"))\n        if (page === 1 && first) {\n            first = false\n            cache.deleteMemory(this.keywords)\n            return false\n        }\n\n        let v = cache.getFromMemory(this.keywords)\n        if (v === undefined || v === null) {\n            return false\n        }\n        let set = new Set(JSON.parse(v))\n        return set.has(value)\n    },\n\n    add: (value) => {\n        let v = cache.getFromMemory(this.keywords)\n        if (v === undefined || v === null) {\n            cache.putMemory(this.keywords, JSON.stringify([value]))\n\n        } else {\n            let arr = JSON.parse(v)\n            if (typeof arr === \"string\") {\n                arr = Array(arr)\n            }\n            arr.push(value)\n            cache.putMemory(this.keywords, JSON.stringify(arr))\n        }\n    },\n};\n\nfunction getUserNovels() {\n    if (!isLogin()) {\n        return []\n    }\n\n    let uidList = [], novels = []\n    let username = String(java.get(\"keyword\"))\n    let page = Number(java.get(\"page\"))\n\n    let userid = cache.get(username)\n    if (userid !== undefined && userid !== null) {\n        uidList = [userid]\n        java.log(`ç¼“å­˜ä½œè€…IDï¼š${userid}`)\n    } else {\n        html = java.ajax(urlSearchUser(username))\n        // java.log(html)\n        // ä»…åŒ¹é…æœ‰æŠ•ç¨¿ä½œå“çš„ç”¨æˆ·\n        let match = html.match(new RegExp(`\"userIds\":\\\\[(?:(?:\\\\d+,?)+)]`))\n        // java.log(JSON.stringify(match))\n        if (match === null || match.length === 0) {\n            return []\n        }\n\n        match = JSON.stringify(match).replace(\"\\\\\",\"\").split(\",\")\n        // java.log(JSON.stringify(match))\n        let regNumber = new RegExp(\"\\\\d+\")\n        uidList = match.map(v => {\n            return v.match(regNumber)[0]\n        })\n        java.log(JSON.stringify(uidList))\n    }\n\n    let tempUids = []\n    for (let i in uidList) {\n        let id = uidList[i]\n        let resp = getAjaxJson(urlUserAllWorks(id))\n        // java.log(urlUserAllWorks(id))\n        if (resp.error === true) {\n            return []\n        }\n\n        // ä»…è·å–å‰3ä¸ªæœ‰å°è¯´çš„ä½œè€…\n        let novelsId = Object.keys(resp.body.novels)\n        // java.log(`${id}-${novelsId.length}`)\n        if (novelsId.length >= 1) tempUids.push(id)\n        if (tempUids.length === 3) {\n            java.log(JSON.stringify(tempUids))\n            break\n        }\n\n        // è·å–ç³»åˆ—å°è¯´ï¼Œä¸ util.handnovels ç³»åˆ—è¯¦æƒ…å…¼å®¹\n        let seriesIds = []\n        if (resp.body.novelSeries.length >= 1) {\n            resp.body.novelSeries.forEach(novel =>{\n                seriesIds.push(novel.id)\n                novel.textCount = novel.publishedTotalCharacterCount\n                novel.description = novel.caption\n            })\n            novels = novels.concat(resp.body.novelSeries)\n        }\n\n        // è·å–å•ç¯‡å°è¯´\n        if (novelsId.length >= 1) {\n            let novelsId = Object.keys(resp.body.novels).reverse().slice((page - 1) * 20, page * 20)\n            let url = urlNovelsDetailed(id, novelsId)\n            util.debugFunc(() => {\n                java.log(`å‘é€è·å–ä½œè€…å°è¯´çš„Ajaxè¯·æ±‚:${url}`)\n            })\n            let userNovels = getWebviewJson(url, html => {\n                return (html.match(new RegExp(\">\\\\{.*?}<\"))[0].replace(\">\", \"\").replace(\"<\", \"\"))\n            }).body\n            // let userNovels = getAjaxJson(url).body\n            // è·å–å¯¹åº”çš„å°è¯´ è¯¥åºåˆ—æ˜¯æŒ‰ç…§idæ’åº\n            // åè½¬ä»¥æŒ‰ç…§æ›´æ–°æ—¶é—´æ’åº\n            let single = Object.values(userNovels).reverse()\n            // ç­›é€‰çœŸæ­£çš„å•ç¯‡å°è¯´\n            let realSingleNovels = single.filter(novel => (!seriesIds.includes(novel.seriesId)))\n            // java.log(JSON.stringify(realSingleNovel))\n            novels = novels.concat(realSingleNovels)\n        }\n    }\n    util.debugFunc(() => {\n        java.log(`è·å–ç”¨æˆ·æœç´¢å°è¯´ç»“æŸ`)\n    })\n    return novels\n}\n\nfunction search(name, type, page) {\n    let resp = {}\n    if (type.includes(\"novel\")) {\n        resp = getAjaxJson(urlSearchNovel(name, page))\n        java.log(urlSearchNovel(name, page))\n    }\n    if (type.includes(\"series\")) {\n        resp = getAjaxJson(urlSearchSeries(name, page))\n        java.log(urlSearchSeries(name, page))\n    }\n    if (resp.error === true || resp.total === 0) {\n        return {\"data\": [], \"lastPage\": 0}\n    }\n    return resp.body.novel\n}\n\nfunction getSeries() {\n    if (JSON.parse(result).error !== true) {\n        cache.put(urlSearchSeries(java.get(\"keyword\"), java.get(\"page\")), result, 30*60)  // åŠ å…¥ç¼“å­˜\n        return JSON.parse(result).body.novel.data\n    } else {\n        return []\n    }\n}\n\nfunction getNovels() {\n    let MAXPAGES = 1, novels = []\n    let novelName = String(java.get(\"keyword\"))\n    let resp = search(novelName, \"novel\", 1)\n    novels = novels.concat(resp.data)\n    for (let page = Number(java.get(\"page\")) + 1; page < resp.lastPage, page <= MAXPAGES; page++) {\n        novels = novels.concat(search(novelName,\"novel\", page).data)\n    }\n    return novels\n}\n\nfunction getConvertNovels() {\n    let novels = []\n    let novelName = String(java.get(\"keyword\"))\n    let name1 = String(java.s2t(novelName))\n    let name2 = String(java.t2s(novelName))\n    if (name1 !== novelName) novels = novels.concat(search(name1, \"series\", 1).data)\n    if (name2 !== novelName) novels = novels.concat(search(name2, \"series\", 1).data)\n    if (name1 !== novelName) novels = novels.concat(search(name1, \"novel\", 1).data)\n    if (name2 !== novelName) novels = novels.concat(search(name2, \"novel\", 1).data)\n    return novels\n}\n\nfunction novelFilter(novels) {\n    let limitedTextCount = String(java.get(\"limitedTextCount\")).replace(\"å­—æ•°\", \"\").replace(\"å­—æ•¸\", \"\")\n    // limitedTextCount = `3w 3k 3w5 3k5`.[0]\n    let textCount = 0\n    if (limitedTextCount.includes(\"w\")) {\n        let num = limitedTextCount.split(\"w\")\n        textCount = 10000 * num[0] + 1000 * num[1]\n    }\n    if (limitedTextCount.includes(\"k\")) {\n        let num = limitedTextCount.split(\"k\")\n        textCount = 1000 * num[0] + 100 * num[1]\n    }\n    java.log(`å­—æ•°é™åˆ¶ï¼š${limitedTextCount}`)\n    java.log(`å­—æ•°é™åˆ¶ï¼š${textCount}`)\n    return novels.filter(novel => novel.textCount >= textCount)\n}\n\n(() => {\n    let novels = []\n    let keyword = String(java.get(\"keyword\"))\n    if (keyword.startsWith(\"@\") || keyword.startsWith(\"ï¼ \")) {\n        keyword = keyword.slice(1)\n        java.put(\"keyword\", keyword)\n        novels = novels.concat(getUserNovels())\n    } else if (keyword.startsWith(\"#\") || keyword.startsWith(\"ï¼ƒ\")) {\n        keyword = keyword.slice(1)\n        java.put(\"keyword\", keyword)\n        novels = novels.concat(getNovels())\n        novels = novels.concat(getSeries())\n    } else {\n        novels = novels.concat(getNovels())\n        novels = novels.concat(getSeries())\n        novels = novels.concat(getUserNovels())\n        if (util.CONVERT_CHINESE) novels = novels.concat(getConvertNovels())\n    }\n    // java.log(JSON.stringify(novels))\n    // è¿”å›ç©ºåˆ—è¡¨ä¸­æ­¢æµç¨‹\n    if (novels.length === 0) {\n        return []\n    }\n    return novelFilter(util.formatNovels(util.handNovels(util.combineNovels(novels))))\n})()",
            "bookUrl": "detailedUrl",
            "checkKeyWord": "æµ‹è¯•é¡µé¢",
            "coverUrl": "coverUrl",
            "intro": "description",
            "kind": "tags",
            "lastChapter": "latestChapter",
            "name": "title",
            "wordCount": "textCount"
        },
        "ruleToc": {
            "chapterList": "@js:\nvar util = objParse(String(java.get(\"util\")))\n\nfunction objParse(obj) {\n    return JSON.parse(obj, (n, v) => {\n        if (typeof v == \"string\" && v.match(\"()\")) {\n            return eval(`(${v})`)\n        }\n        return v;\n    })\n}\n\nfunction urlNovel(novelId){\n    if (util.SHOW_ORIGINAL_LINK) {\n        return urlNovelUrl(novelId)\n    } else {\n        return urlNovelDetailed(novelId)\n    }\n}\n\nfunction oneShotHandler(res) {\n    res.textCount = res.userNovels[`${res.id}`].textCount\n    res.createDate = timeTextFormat(res.createDate)\n    return [{\n        title: res.title.replace(RegExp(/^\\s+|\\s+$/g), \"\"),\n        chapterUrl: urlNovel(res.id),\n        chapterInfo: `${res.createDate}ã€€ã€€${res.textCount}å­—`\n    }]\n}\n\nfunction seriesHandler(res) {\n    const limit = 30\n    let returnList = [], novelIds = []\n    let seriesID = res.id, allChaptersCount = res.total\n    util.debugFunc(() => {\n        java.log(`æœ¬ç³»åˆ— ${seriesID} ä¸€å…±æœ‰${allChaptersCount}ç« `);\n    })\n\n    //å‘é€è¯·æ±‚è·å¾—ç›¸åº”æ•°é‡çš„ç›®å½•åˆ—è¡¨\n    function sendAjaxForGetChapters(lastIndex) {\n        resp = getAjaxJson(urlSeriesNovels(seriesID, limit, lastIndex), true)\n        res = resp.body.thumbnails.novel\n        // res = resp.body.page.seriesContents\n        res.forEach(v => {\n            v.title = v.title.replace(RegExp(/^\\s+|\\s+$/g), \"\").replace(RegExp(/ï¼ˆ|ï¼‰|-/g), \"\")\n            v.chapterUrl = urlNovel(v.id)\n            novelIds.push(v.id)\n            if (v.updateDate !== undefined) {\n                v.updateDate = timeTextFormat(v.createDate)\n                v.chapterInfo = `${v.updateDate}ã€€ã€€${v.textCount}å­—`\n            } else {\n                v.updateDate = java.timeFormat(v.uploadTimestamp)\n                v.chapterInfo = `${v.updateDate}ã€€ã€€${v.textLength}å­—`\n            }\n            util.debugFunc(() => {\n                java.log(`${v.title}`)\n            })\n        })\n        return res;\n    }\n\n    if (!util.SHOW_UPDATE_TIME) {\n        returnList = getAjaxJson(urlSeriesNovelsTitles(seriesID), true).body\n        returnList.forEach(v => {\n            v.title = v.title.replace(RegExp(/^\\s+|\\s+$/g), \"\").replace(RegExp(/ï¼ˆ|ï¼‰|-/g), \"\")\n            v.chapterUrl = urlNovel(v.id)\n            novelIds.push(v.id)\n        })\n    } else {\n        //é€»è¾‘æ§åˆ¶è€… ä¹Ÿå°±æ˜¯ä½¿ç”¨ä¸Šé¢å®šä¹‰çš„ä¸¤ä¸ªå‡½æ•°æ¥åšå¯¹åº”åŠŸèƒ½\n        //è¦çˆ¬å–çš„æ€»æ¬¡æ•°\n        let max = (allChaptersCount / limit) + 1\n        for (let i = 0; i < max; i++) {\n            //java.log(\"içš„å€¼:\"+i)\n            let list = sendAjaxForGetChapters(i * limit);\n            //å–å‡ºæ¯ä¸ªå€¼\n            returnList = returnList.concat(list)\n        }\n    }\n    // æ”¾å…¥ä¿¡æ¯ä»¥ä¾¿ç™»é™†ç•Œé¢ä½¿ç”¨\n    cache.put(`novelIds${seriesID}`, JSON.stringify(novelIds))\n    // java.log(JSON.stringify(returnList))\n    return returnList\n}\n\n(function (res) {\n    res = util.getNovelResSeries(result)\n    if (res.firstNovelId === undefined || res.seriesNavData === null) {\n        return oneShotHandler(res)\n    } else {\n        return seriesHandler(res)\n    }\n})()",
            "chapterName": "title",
            "chapterUrl": "chapterUrl",
            "updateTime": "chapterInfo"
        },
        "searchUrl": "@js:\njava.put(\"key\", key)\njava.put(\"page\", page)\nlet keyword = key.split(\" \")\nlet limitedTextCount\nif (key.includes(\"å­—æ•°\") || key.includes(\"å­—æ•¸\") ) {\n    limitedTextCount = keyword.pop()\n    keyword = keyword.join(\" \")\n} else {\n    limitedTextCount = \"\"\n    keyword = key\n}\njava.put(\"keyword\", keyword)\njava.put(\"limitedTextCount\", limitedTextCount)\nif (keyword.startsWith(\"@\") || keyword.startsWith(\"ï¼ \")) {\n    keyword = keyword.slice(1)\n    java.log(`æœç´¢ä½œè€…ï¼š${keyword}`)\n}\nif (keyword.startsWith(\"#\") || keyword.startsWith(\"ï¼ƒ\")) {\n    keyword = keyword.slice(1)\n    java.log(`æœç´¢æ ‡ç­¾ï¼š${keyword}`)\n}\nurlSearchSeries(keyword, page)",
        "variableComment": "â¤ï¸ æŸ¥çœ‹ä»–äººæ”¶è—ï¼š\nå‘ç°ï¼šé•¿æŒ‰\"Pixiv\"ï¼Œç¼–è¾‘ï¼Œå³ä¸Šè§’èœå•ï¼Œè®¾ç½®æºå˜é‡\nè®¾ç½®æºå˜é‡ï¼šè¾“å…¥ä½œè€…IDï¼Œä¸€è¡Œä¸€ä¸ªï¼Œå¯æ·»åŠ ä½œè€…åï¼Œä¿å­˜\nå‘ç°ï¼šé•¿æŒ‰\"Pixiv\"ï¼Œåˆ·æ–°ï¼ŒæŸ¥çœ‹ä»–äººæ”¶è—\nä»¥ä¸‹å†…å®¹ä¸ºæºå˜é‡æ¨¡æ¿ï¼š\n12345 ä½œè€…å\n67890 //ä½œè€…å\n\n\nâš™ï¸ è‡ªå®šä¹‰ä¹¦æºè®¾ç½®ï¼š\nâš™ï¸ è‡ªå®šä¹‰è®¾ç½®ï¼šè¯·åœ¨åŸºæœ¬-å˜é‡è¯´æ˜å¤„ä¿®æ”¹ä»£ç \nâš™ï¸ è‡ªå®šä¹‰è®¾ç½®ï¼šå°† true æ”¹ä¸º falseï¼Œæˆ–ç›¸å\nâš ï¸ è®¾ç½®æºå˜é‡ã€æ— æ³•ã€‘æ›´æ”¹ä¹¦æºè‡ªå®šä¹‰è®¾ç½®\nâš ï¸ æ³¨æ„ä¸è¦æ·»åŠ æˆ–åˆ é™¤å°¾éšé€—å·\",\"\nâš ï¸ å‘ç°é¡µéœ€è¦é•¿æŒ‰\"Pixiv\"ï¼Œæ‰‹åŠ¨åˆ·æ–°\nä»¥ä¸‹å†…å®¹ä¸ºä¹¦æºè®¾ç½®ï¼š\n{\n\"CONVERT_CHINESE\": true,\n\"SHOW_UPDATE_TIME\": true,\n\"MORE_INFORMATION\": false,\n\"SHOW_ORIGINAL_LINK\": true,\n\n\"REPLACE_TITLE_MARKS\": true,\n\"SHOW_CAPTIONS\": true,\n\"SHOW_COMMENTS\": true,\n\n\"FAST\": true,\n\"DEBUG\": false,\n\n\"SHOW_GENERAL_NEW\": false,\n\"SHOW_GENERAL_RANK\": false,\n\"SHOW_R18_GENRE\": false,\n\"SHOW_GENERAL_GENRE\": false\n}\n\n// CONVERT_CHINESE\n// æœç´¢ï¼šæœç´¢æ—¶è¿›è¡Œç¹ç®€è½¬æ¢ï¼Œä½†æœç´¢ä¼šå˜æ…¢\n// MORE_INFORMATION\n// è¯¦æƒ…ï¼šä¹¦ç±ç®€ä»‹æ˜¾ç¤ºæ›´å¤šä¿¡æ¯\n\n// SHOW_UPDATE_TIME\n// ç›®å½•ï¼šæ˜¾ç¤ºæ›´æ–°æ—¶é—´ï¼Œä½†ä¼šå¢åŠ å°‘è®¸è¯·æ±‚\n// SHOW_ORIGINAL_LINK\n// ç›®å½•ï¼šæ˜¾ç¤ºåŸå§‹é“¾æ¥ï¼Œä½†ä¼šå¢åŠ å¤§é‡è¯·æ±‚\n\n// REPLACE_TITLE_MARKS\n// æ­£æ–‡ï¼šæ³¨éŸ³å†…å®¹ä¸ºæ±‰å­—æ—¶ï¼Œæ›¿æ¢ä¸ºä¹¦åå·\n// SHOW_CAPTIONS\n// æ­£æ–‡ï¼šç« é¦–æ˜¾ç¤ºå°è¯´æè¿°\n// SHOW_COMMENTS\n// æ­£æ–‡ï¼šç« å°¾æ˜¾ç¤ºå°è¯´è¯„è®º\n\n// FAST\n// å¿«é€Ÿæ¨¡å¼ï¼Œç¦ç”¨ç¹ç®€ç»Ÿæœï¼Œä¸æ˜¾ç¤ºç« èŠ‚æ¥æºé“¾æ¥\n// DEBUG\n// è°ƒè¯•æ¨¡å¼\n\n// SHOW_GENERAL_NEW\n// å‘ç°ï¼šæœ€æ–°ã€ä¼åˆ’ã€çº¦ç¨¿æ˜¾ç¤ºä¸€èˆ¬å°è¯´\n// SHOW_GENERAL_RANK\n// å‘ç°ï¼šæ’è¡Œæ¦œæ˜¾ç¤ºä¸€èˆ¬å°è¯´\n// SHOW_R18_GENRE\n// å‘ç°ï¼šçƒ­é—¨åˆ†ç±»æ˜¾ç¤ºR18å°è¯´\n// SHOW_GENERAL_GENRE\n// å‘ç°ï¼šçƒ­é—¨åˆ†ç±»æ˜¾ç¤ºä¸€èˆ¬å°è¯´\n",
        "weight": 0
    },
    {
        "bookSourceComment": "Pixiv æ¼«ç”»ï¼ˆæ›´æ–°ğŸ“†ï¼š2025-05-25ï¼‰\n\nå¯ç”¨åŠŸèƒ½ï¼šâœ…æœç´¢âœ…å‘ç°âœ…æ·»åŠ ç½‘å€âœ…è®¢é˜…æº\næœç´¢æ’ç”»ï¼šâœ…æ¼«ç”»â˜‘ï¸æ’ç”»âŒåŠ¨å›¾âœ…æ ‡ç­¾\nå‘ç°æ¼«ç”»ï¼šâœ…å…³æ³¨âœ…è¿½æ›´âœ…æ¨èâœ…å‘ç°âœ…æ”¶è—\næ·»åŠ ç½‘å€ï¼šâœ…Pixivæ’ç”»é“¾æ¥âœ…Pixivæ¼«ç”»ç›®å½•\nè®¢é˜…ç”¨æ³•ï¼šç‚¹å‡»è®¢é˜…æºæ‰“å¼€æ’ç”»/æ¼«ç”»ç›®å½•ï¼Œã€åˆ·æ–°ã€‘ï¼Œç‚¹å‡»ã€åŠ å…¥ä¹¦æ¶ã€‘æŒ‰é’®ï¼Œæ·»åŠ åˆ°ä¹¦æ¶\n\nä¹¦æºå‘å¸ƒï¼šå…½äººé˜…è¯»é¢‘é“ https://t.me/FurryReading\né¡¹ç›®åœ°å€ï¼šhttps://github.com/windyhusky/PixivSource\nä½¿ç”¨æ•™ç¨‹ï¼šhttps://github.com/windyhusky/PixivSource/blob/main/doc/Pixiv.md\n\nè§„åˆ™è®¢é˜…ï¼šimport è®¢é˜…æº\nhttps://cdn.jsdelivr.net/gh/windyhusky/PixivSource@main/import.json\nhttps://raw.githubusercontent.com/windyhusky/PixivSource/main/import.json\n\nâš™ï¸ ä¹¦æºè®¾ç½®ï¼š\nä¹¦æºç®¡ç† - ç¼–è¾‘ä¹¦æº - åŸºæœ¬ - å˜é‡è¯´æ˜ - ä¿®æ”¹å¹¶ä¿å­˜",
        "bookSourceGroup": "ğŸ” Pixiv æ¼«ç”»",
        "bookSourceName": "Pixiv æ¼«ç”»",
        "bookSourceType": 2,
        "bookSourceUrl": "https://www.pixiv.net/manga",
        "bookUrlPattern": "(https?://)?(www\\.)?pixiv\\.net/((artworks|user/\\d+/series)|ajax/(illust|series))/\\d+",
        "concurrentRate": "180/60000",
        "customOrder": 2,
        "enabled": true,
        "enabledCookieJar": true,
        "enabledExplore": true,
        "exploreUrl": "@js:\nlet SHOW_GENERAL_NEW, SHOW_GENERAL_RANK\ntry {\n    settings = JSON.parse(String(source.variableComment).match(RegExp(/{([\\s\\S]*?)}/gm)))\n    SHOW_GENERAL_NEW = settings.SHOW_GENERAL_NEW     // å‘ç°ï¼šæœ€æ–°ã€ä¼åˆ’ã€çº¦ç¨¿æ˜¾ç¤ºä¸€èˆ¬å°è¯´\n    SHOW_GENERAL_RANK = settings.SHOW_GENERAL_RANK   // å‘ç°ï¼šæ’è¡Œæ¦œæ˜¾ç¤ºä¸€èˆ¬å°è¯´\n} catch (e) {\n    SHOW_GENERAL_NEW = false\n    SHOW_GENERAL_RANK = false\n}\n\nli = [\n    {\"â­ï¸ å…³æ³¨\": \"https://www.pixiv.net/ajax/follow_latest/illust?p={{page}}&mode=all&lang=zh\"},\n    {\"ğŸ“ƒ è¿½æ›´\": \"https://www.pixiv.net/ajax/watch_list/manga?p={{page}}&new=1&lang=zh\"},\n    {\"ğŸ’¯ æ¨è\": \"https://www.pixiv.net/ajax/top/illust?mode=all&lang=zh\"},\n    {\"ğŸ” å‘ç°\": \"https://www.pixiv.net/ajax/illust/discovery?mode=all&lang=zh\"},\n    {\"â¤ï¸ æ”¶è—\": \"https://www.pixiv.net/ajax/user/{{cache.get(\\\"pixiv:uid\\\")}}/illusts/bookmarks?tag=&offset={{(page-1)*24}}&limit=24&rest=show&lang=zh\"},\n    {\"ãŠ™ï¸ æ”¶è—\": \"https://www.pixiv.net/ajax/user/{{cache.get(\\\"pixiv:uid\\\")}}/illusts/bookmarks?tag=&offset={{(page-1)*24}}&limit=24&rest=hide&lang=zh\"},\n    {\"ğŸ  é¦–é¡µ\": \"https://www.pixiv.net\"},\n    {\"ğŸ†™ æ›´æ–°\": \"https://cdn.jsdelivr.net/gh/windyhusky/PixivSource@main/pixiv.json\"}\n]\n\ngeneralNew = [\n    {\"ğŸ†• æœ€æ–° ä¼åˆ’ çº¦ç¨¿ ğŸ’°\": \"\"},\n    {\"ğŸ†• æœ€æ–°\": \"https://www.pixiv.net/ajax/illust/new?lastId=0&limit=20&type=manga&lang=zh\"},\n    {\"ğŸ“‘ ä¼åˆ’\": \"https://www.pixiv.net/ajax/user_event/portal/artworks?mode=all&p={{page}}&lang=zh\"},\n    {\"ğŸ’° çº¦ç¨¿\": \"https://www.pixiv.net/ajax/commission/page/request/complete/manga?mode=all&p={{page}}&lang=zh\"},\n    {\"ğŸ” å‘ç°\": \"https://www.pixiv.net/ajax/illust/discovery?mode=all&lang=zh\"}\n]\n\nr18Rank = [\n    {\"ğŸ‘‘ æ’è¡Œæ¦œå• ğŸ‘‘\": \"\"},\n    {\"ä»Šæ—¥\": \"https://www.pixiv.net/ranking.php?mode=daily_r18&content=manga&p={{page}}&format=json\"},\n    {\"æœ¬å‘¨\": \"https://www.pixiv.net/ranking.php?mode=weekly_r18&content=manga&p={{page}}&format=json\"},\n    {\"R18G\": \"https://www.pixiv.net/ranking.php?mode=r18g&content=manga&p={{page}}&format=json\"},\n    {\"ç”·æ€§\": \"https://www.pixiv.net/ranking.php?mode=male_r18\"},\n    {\"å¥³æ€§\": \"https://www.pixiv.net/ranking.php?mode=female_r18\"}\n]\n\ngeneralRank = [\n    {\"ğŸ† æ’è¡Œæ¦œå• ğŸ†\": \"\"},\n    {\"ä»Šæ—¥\": \"https://www.pixiv.net/ranking.php?mode=daily&content=manga&p={{page}}&format=json\"},\n    {\"æœ¬å‘¨\": \"https://www.pixiv.net/ranking.php?mode=weekly&content=manga&p={{page}}&format=json\"},\n    {\"æœ¬æœˆ\": \"https://www.pixiv.net/ranking.php?mode=monthly&content=manga&p={{page}}&format=json\"},\n    {\"æ–°äºº\": \"https://www.pixiv.net/ranking.php?mode=rookie&content=manga&p={{page}}&format=json\"}\n]\n\nif (SHOW_GENERAL_RANK === true) {\n    li = li.concat(generalNew)\n}\nli = li.concat(r18Rank)\nif (SHOW_GENERAL_RANK === true) {\n    li = li.concat(generalRank)\n}\n\nli.forEach(item => {\n    item.title = Object.keys(item)[0]\n    item.url = Object.values(item)[0]\n    delete item[Object.keys(item)[0]]\n    item.style = {}\n    item.style.layout_flexGrow = 1\n    item.style.layout_flexShrink = 1\n    item.style.layout_alignSelf = \"auto\"\n    item.style.layout_wrapBefore = \"false\"\n    if (item.url === \"\") {\n        item.style.layout_flexBasisPercent = 1\n    } else {\n        item.style.layout_flexBasisPercent = -1\n    }\n})\n\nJSON.stringify(li)",
        "header": "{\"referer\":\"https://www.pixiv.net\"}",
        "jsLib": "function cacheGetAndSet(cache, key, supplyFunc) {\n    let v = cache.get(key)\n    if (v === undefined || v === null) {\n        v = JSON.stringify(supplyFunc())\n        // ç¼“å­˜10åˆ†é’Ÿ\n        cache.put(key, v, 600)\n    }\n    return JSON.parse(v)\n}\nfunction isJsonString(str) {\n    try {\n        if (typeof JSON.parse(str) === \"object\") {\n            return true\n        }\n    } catch(e) {}\n    return false\n}\nfunction getAjaxJson(url) {\n    const {java, cache} = this\n    return cacheGetAndSet(cache, url, () => {\n        return JSON.parse(java.ajax(url))\n    })\n}\nfunction getWebviewJson(url, parseFunc) {\n    const {java, cache} = this\n    return cacheGetAndSet(cache, url, () => {\n        let html = java.webView(null, url, null)\n        return JSON.parse(parseFunc(html))\n    })\n}\n\nfunction isLogin() {\n    const {java} = this\n    let cookie = String(java.getCookie(\"https://www.pixiv.net/\", null))\n    return cookie.includes(\"first_visit_datetime\")\n}\n\nfunction urlIllustUrl(illustId) {\n    return `https://www.pixiv.net/artworks/${illustId}`\n}\nfunction urlIllustDetailed(illustId) {\n    return `https://www.pixiv.net/ajax/illust/${illustId}?lang=zh`\n}\nfunction urlIllustsDetailed(userId, idList) {\n    return `https://www.pixiv.net/ajax/user/${userId}/illusts?${idList.map(v => \"ids[]=\" + v).join(\"&\")}`\n}\nfunction urlSeriesUrl(userId, seriesId) {\n    return `https://www.pixiv.net/user/${userId}/series/${seriesId}`\n}\nfunction urlSeriesDetailed(seriesId, page=1) {\n    return `https://www.pixiv.net/ajax/series/${seriesId}?p=${page}&lang=zh`\n}\n\nfunction urlUserAllWorks(userId) {\n    return `https://www.pixiv.net/ajax/user/${userId}/profile/all?lang=zh`\n}\n\nfunction urlSearchArtwork(name, page) {\n    return `https://www.pixiv.net/ajax/search/artworks/${encodeURI(name)}?word=${encodeURI(name)}&order=date_d&mode=all&p=${page}&s_mode=s_tc&type=all&lang=zh`\n}\nfunction urlSearchIllust(name, page) {\n    return `https://www.pixiv.net/ajax/search/artworks/${encodeURI(name)}?word=${encodeURI(name)}&order=date_d&mode=all&p=${page}&s_mode=s_tc&type=illust&lang=zh`\n}\nfunction urlSearchManga(name, page) {\n    return `https://www.pixiv.net/ajax/search/artworks/${encodeURI(name)}?word=${encodeURI(name)}&order=date_d&mode=all&p=${page}&s_mode=s_tc&type=manga&lang=zh`\n}\nfunction urlSearchUgoira(name, page) {\n    return `https://www.pixiv.net/ajax/search/artworks/${encodeURI(name)}?word=${encodeURI(name)}&order=date_d&mode=all&p=${page}&s_mode=s_tc&type=ugoira&lang=zh`\n}\n// å®Œå…¨åŒ¹é…ç”¨æˆ·å\nfunction urlSearchUser(name) {\n    return `https://www.pixiv.net/search/users?nick=${encodeURI(name)}&s_mode=s_usr&nick_mf=1`\n}\n\nfunction urlCoverUrl(url) {\n    return `${url}, {\"headers\": {\"Referer\":\"https://www.pixiv.net/\"}}`\n}\n\nfunction dateFormat(str) {\n    let addZero = function (num) {\n        return num < 10 ? '0' + num : num;\n    }\n    let time = new Date(str);\n    let Y = time.getFullYear() + \"å¹´\";\n    let M = addZero(time.getMonth() + 1) + \"æœˆ\";\n    let D = addZero(time.getDate()) + \"æ—¥\";\n    return Y + M + D;\n}\nfunction timeTextFormat(text) {\n    return `${text.slice(0, 10)} ${text.slice(11, 19)}`\n}\nfunction sleep(time) {\n    let endTime = new Date().getTime() + time\n    while(true){\n        if (new Date().getTime() > endTime){\n            return;\n        }\n    }\n}\nfunction sleepToast(text, second) {\n    const {java} = this\n    java.log(text)\n    java.longToast(text)\n    if (second === undefined || second <= 2) {second = 2}\n    sleep(1000*second)\n}\n\nfunction updateSource() {\n    const {java, source} = this\n    let onlineSource, comment, sourceName, sourceNameCapitalize, index = 0\n    if (source.bookSourceUrl.includes(\"pixiv\")) sourceName = \"pixiv\"\n    else if (source.bookSourceUrl.includes(\"furrynovel\")) sourceName = \"linpx\"\n    sourceNameCapitalize = sourceName[0].toUpperCase() + sourceName.substring(1)\n\n    if (source.bookSourceName.includes(\"å¤‡ç”¨\")) index = 1\n    else if (source.bookSourceName.includes(\"æ¼«ç”»\")) index = 2\n    if (source.bookSourceUrl.includes(\"furrynovel.com\")) {\n        sourceNameCapitalize = \"FurryNovel\"\n        index = 1\n    }\n\n    try {\n        let updateUrl = `https://cdn.jsdelivr.net/gh/windyhusky/PixivSource@main/${sourceName}.json`\n        onlineSource = JSON.parse(java.get(updateUrl,{'User-Agent': 'Mozilla/5.0 (Linux; Android 14)','X-Requested-With': 'XMLHttpRequest'}).body())[index]\n        comment = onlineSource.bookSourceComment.split(\"\\n\")\n    } catch (e) {\n        try {\n            let updateUrl = `https://raw.githubusercontent.com/windyhusky/PixivSource/main/${sourceName}.json`\n            onlineSource = JSON.parse(java.get(updateUrl,{'User-Agent': 'Mozilla/5.0 (Linux; Android 14)','X-Requested-With': 'XMLHttpRequest'}).body())[index]\n            comment = onlineSource.bookSourceComment.split(\"\\n\")\n        } catch (e) {\n            onlineSource = {lastUpdateTime: new Date().getTime()}\n            comment = source.bookSourceComment.split(\"\\n\")\n        }\n    }\n\n    let htm = `data:text/html; charset=utf-8,\n<html>\n<head>\n    <meta name=\"viewport\" content=\"width=device-width, initial-scale=1.0\">\n    <title>æ›´æ–° ${source.bookSourceName} ä¹¦æº</title>\n    <style> \n    table { text-align: center; margin: 0 auto; } .ann { display: flex; justify-content: center; align-items: center; height: 5vh; } \n    button { background-color: rgb(76, 175, 80); color: white; border: none; border-radius: 4px; height: 6vh; width: 30vw; overflow: hidden; } \n    button span { cursor: pointer; display: inline-block; position: relative; transition: 0.4s; } \n    button span:after { content: '>'; position: absolute; opacity: 0; top: 0; right: 30px; transition: 0.2s; } \n    button:active span { padding-right: 20px; } \n    button:active span:after { opacity: 1; right: -40px; }\n    </style>\n</head>\n\n<body>\n    <table border=\"1\" cellspacing=\"0\">\n        <th colspan=\"2\"> ${source.bookSourceName} ä¹¦æº <a href=\"https://github.com/windyhusky/PixivSource/blob/main/doc/FurryNovel.md\">ğŸ”° ä½¿ç”¨æŒ‡å—</a></th>\n        <tr><td>â˜ï¸ è¿œç¨‹ä»“åº“ç‰ˆæœ¬ï¼š${java.timeFormat(onlineSource.lastUpdateTime)}</td></tr>\n        <tr><td>ğŸ“¥ é˜…è¯»æœ¬åœ°ç‰ˆæœ¬ï¼š${java.timeFormat(source.lastUpdateTime)}</td></tr>\n        <tr><td style=\"text-align: left;\">${comment.slice(2, 7).join(\"<br>\")}</td></tr>\n        <tr><td style=\"text-align: left;\">${comment.slice(comment.length-2, comment.length).join(\"<br>\")}</td></tr>\n    </table>\n    \n    <table border=\"0\" cellspacing=\"20\">\n        <th colspan=\"2\"> æ›´æ–° ${source.bookSourceName} ä¹¦æº </th>\n        <tr><td><div class=\"ann\">\n            <a href=\"legado://import/importonline?src=https://cdn.jsdelivr.net/gh/windyhusky/PixivSource@main/${sourceName}.json\">\n            <button><span>æ›´æ–°ä¹¦æº<br>(Jsdelivr CDN)</span></button>\n            </a></div></td>\n            \n            <td><div class=\"ann\">\n            <a href=\"legado://import/importonline?src=https://cdn.jsdelivr.net/gh/windyhusky/PixivSource@main/btsrk.json\">\n            <button><span>æ›´æ–°è®¢é˜…<br>(Jsdelivr CDN)</span></button>\n            </a></div></td>\n        </tr>\n        \n        <tr><td><div class=\"ann\">\n            <a href=\"legado://import/importonline?src=https://raw.githubusercontent.com/windyhusky/PixivSource/main/${sourceName}.json\">\n            <button><span>ä¹¦æºé“¾æ¥<br>(GitHub)</span></button>\n            </a></div></td>\n            \n            <td><div class=\"ann\">\n            <a href=\"legado://import/importonline?src=https://raw.githubusercontent.com/windyhusky/PixivSource/main/btsrk.json\">\n            <button><span>è®¢é˜…é“¾æ¥<br>(GitHub)</span></button>\n            </a></div></td>\n        </tr>\n        \n        <tr><td><div class=\"ann\">\n            <a href=\"legado://import/importonline?src=https://codeberg.org/DowneyRem/PixivSource/raw/branch/main/${sourceName}.json\">\n            <button><span>å¤‡ç”¨ä¹¦æºé“¾æ¥<br>(Codeberg)</span></button>\n            </a></div></td>\n            \n            <td><div class=\"ann\">\n            <a href=\"legado://import/importonline?src=https://codeberg.org/DowneyRem/PixivSource/raw/branch/main/btsrk.json\">\n            <button><span>å¤‡ç”¨è®¢é˜…é“¾æ¥<br>(Codeberg)</span></button>\n            </a></div></td>\n        </tr>\n    </table>\n</body>\n</html>`;\n    java.startBrowser(htm,'æ›´æ–°ä¹¦æº');\n    return []\n}",
        "lastUpdateTime": 1749096000251,
        "loginCheckJs": "var util = {}\n\nfunction objStringify(obj) {\n    return JSON.stringify(obj, (n, v) => {\n        if (typeof v == \"function\")\n            return v.toString();\n        return v;\n    });\n}\n\nfunction publicFunc() {\n    let u = {}, settings = {}\n    java.log(String(source.bookSourceComment).split(\"\\n\")[0]) // è¾“å‡ºä¹¦æºä¿¡æ¯\n    java.log(`æœ¬åœ°ä¹¦æºæ›´æ–°æ—¶é—´ï¼š${java.timeFormat(source.lastUpdateTime)}`) // è¾“å‡ºä¹¦æºä¿¡æ¯\n    settings = JSON.parse(String(source.variableComment).match(RegExp(/{([\\s\\S]*?)}/gm)))\n    if (settings !== null) {\n        java.log(\"âš™ï¸ ä½¿ç”¨è‡ªå®šä¹‰è®¾ç½®\")\n    } else {\n        settings = {}\n        settings.CONVERT_CHINESE = true     // æœç´¢ï¼šæœç´¢æ—¶è¿›è¡Œç¹ç®€è½¬æ¢\n        settings.SEARCH_ILLUSTS = false     // æœç´¢æ’ç”»\n        settings.SHOW_ORIGINAL_LINK = true  // ç›®å½•å¤„æ˜¾ç¤ºæºé“¾æ¥ï¼Œä½†ä¼šå¢åŠ è¯·æ±‚æ¬¡æ•°\n        settings.DEBUG = false              // è°ƒè¯•æ¨¡å¼\n        java.log(\"âš™ï¸ ä½¿ç”¨é»˜è®¤è®¾ç½®ï¼ˆæ— è‡ªå®šä¹‰è®¾ç½® æˆ– è‡ªå®šä¹‰è®¾ç½®æœ‰è¯¯ï¼‰\")\n    }\n    u.CONVERT_CHINESE = settings.CONVERT_CHINESE\n    u.SEARCH_ILLUSTS = settings.SEARCH_ILLUSTS\n    u.SHOW_ORIGINAL_LINK = settings.SHOW_ORIGINAL_LINK\n    u.DEBUG = settings.DEBUG\n\n    if (u.DEBUG === true) {\n        java.log(JSON.stringify(settings, null, 4))\n        java.log(`DEBUG = ${u.DEBUG}`)\n    }\n    u.debugFunc = (func) => {\n        if (util.DEBUG) {\n            func()\n        }\n    }\n\n    u.handIllusts = function (illusts) {\n        illusts.forEach(illust => {\n            // illust.id = illust.id\n            // illust.title = illust.title\n            // illust.userName = illust.userName\n            // illust.tags = illust.tags\n            if (!(illust.tags instanceof Array)) {\n                illust.tags = illust.tags.tags.map(item => item.tag)\n                illust.coverUrl = illust.url = illust.urls.regular  // å…¼å®¹æ­£æ–‡æœç´¢\n                illust.updateDate = illust.uploadDate\n            }\n            illust.textCount = null\n            // illust.pageCount = illust.pageCount\n            // illust.description = illust.description\n            illust.coverUrl = illust.url\n            illust.detailedUrl = urlIllustDetailed(illust.id)\n            // illust.createDate = illust.createDate\n            // illust.updateDate = illust.updateDate\n            // illust.aiType = illust.aiType\n\n            if (illust.seriesNavData === undefined || illust.seriesNavData === null) {\n                illust.latestChapter = illust.title\n            } else {\n                illust.seriesId = illust.seriesNavData.seriesId\n                illust.title = illust.seriesNavData.title\n            }\n\n            if (illust.seriesId !== undefined) {\n                let resp = getAjaxJson(urlSeriesDetailed(illust.seriesId)).body\n                let series = resp.illustSeries.filter(item => item.id === illust.seriesId)[0]\n                // illust.title = illust.title\n                illust.tags = illust.tags.concat(series.tags)\n                illust.latestChapter = resp.thumbnails.illust.filter(item => item.id === series.latestIllustId)[0].title\n                illust.description = series.description\n                if (series.url === undefined) {\n                    let firstChapter = getAjaxJson(urlIllustDetailed(series.firstIllustId)).body\n                    illust.coverUrl = firstChapter.urls.regular\n                    illust.tags = illust.tags.concat(firstChapter.tags.tags.map(item => item.tag))\n                }\n                illust.createDate = series.createDate\n                illust.updateDate = series.updateDate\n                illust.total = series.total\n            }\n        })\n        return illusts\n    }\n\n    u.formatIllusts = function (illusts) {\n        illusts.forEach(illust => {\n            illust.title = illust.title.replace(RegExp(/^\\s+|\\s+$/g), \"\")\n            illust.tags = Array.from(new Set(illust.tags))\n            illust.tags = illust.tags.join(\",\")\n            illust.coverUrl = urlCoverUrl(illust.coverUrl)\n            illust.createDate = dateFormat(illust.createDate)\n            illust.updateDate = dateFormat(illust.updateDate)\n            if (util.MORE_INFORMATION) {\n                illust.description = `\\nä¹¦åï¼š${illust.title}\\nä½œè€…ï¼š${illust.userName}\\næ ‡ç­¾ï¼š${illust.tags}\\né¡µé¢ï¼š${illust.pageCount}\\nä¸Šä¼ ï¼š${illust.createDate}\\næ›´æ–°ï¼š${illust.updateDate}\\nç®€ä»‹ï¼š${illust.description}`\n            } else {\n                illust.description = `\\n${illust.title}ï¼Œå…±${illust.pageCount}é¡µ\\n${illust.description}\\nä¸Šä¼ æ—¶é—´ï¼š${illust.createDate}\\næ›´æ–°æ—¶é—´ï¼š${illust.updateDate}`\n            }\n        })\n        return illusts\n    }\n\n    u.getIllustRes = function (result) {\n        let illustId = 0, res = {}\n        let isJson = isJsonString(result)\n        let isHtml = result.startsWith(\"<!DOCTYPE html>\")\n        if (!isJson && isHtml) {\n            let pattern1 = \"(https?://)?(www\\\\.)?pixiv\\\\.net/(artworks|ajax/illust)/(\\\\d+)\"\n            let isIllust = baseUrl.match(new RegExp(pattern1))\n            let pattern2 = \"(https?://)?(www\\\\.)?pixiv\\\\.net/(user/\\\\d+|ajax)/series/(\\\\d+)\"\n            let isSeries = baseUrl.match(new RegExp(pattern2))\n\n            if (isIllust) {\n                illustId = isIllust[4]\n            } else if (isSeries) {\n                seriesId = isSeries[4]\n                java.log(`åŒ¹é…ç³»åˆ—IDï¼š${seriesId}`)\n                illustId = getAjaxJson(urlSeriesDetailed(seriesId)).body.page.series.reverse()[0].workId\n            }\n        }\n        if (isJson) {\n            res = JSON.parse(result)\n        }\n\n        if (illustId) {\n            java.log(`åŒ¹é…æ’ç”»IDï¼š${illustId}`)\n            res = getAjaxJson(urlIllustDetailed(illustId))\n        }\n        if (res.error) {\n            java.log(`æ— æ³•ä» Pixiv è·å–å½“å‰æ¼«ç”»`)\n            java.log(JSON.stringify(res))\n            return []\n        }\n        return res.body\n    }\n\n    util = u\n    java.put(\"util\", objStringify(u))\n}\n\npublicFunc()\n\n// è·å–è¯·æ±‚çš„user idæ–¹ä¾¿å…¶ä»–ajaxè¯·æ±‚æ„é€ \nlet uid = java.getResponse().headers().get(\"x-userid\")\nif (uid != null) {\n    cache.put(\"pixiv:uid\", uid)\n}\njava.getStrResponse(null, null)",
        "loginUrl": "https://accounts.pixiv.net/login",
        "respondTime": 180000,
        "ruleBookInfo": {
            "author": "userName",
            "canReName": "true",
            "coverUrl": "coverUrl",
            "init": "@js:\nvar util = objParse(String(java.get(\"util\")))\n\nfunction objParse(obj) {\n    return JSON.parse(obj, (n, v) => {\n        if (typeof v == \"string\" && v.match(\"()\")) {\n            return eval(`(${v})`)\n        }\n        return v;\n    })\n}\n\nfunction illustHandler(illust){\n    illust = util.formatIllusts(util.handIllusts([illust]))[0]\n    illust.detailedUrl = urlIllustUrl(illust.id)\n    illust.catalogUrl = urlIllustDetailed(illust.id)\n    return illust\n}\n\n(() => {\n    try {\n        return illustHandler(util.getIllustRes(result))\n    } catch (e) {\n        java.log(e)\n        java.log(`å— Pixiv çš„é™åˆ¶ï¼Œæ— æ³•è·å–å½“å‰æ’ç”»çš„æ•°æ®`)\n    }\n})()",
            "intro": "description",
            "kind": "tags",
            "lastChapter": "latestChapter",
            "name": "title",
            "tocUrl": "catalogUrl",
            "wordCount": ""
        },
        "ruleContent": {
            "content": "@js:\nvar util = objParse(String(java.get(\"util\")))\n\nfunction objParse(obj) {\n    return JSON.parse(obj, (n, v) => {\n        if (typeof v == \"string\" && v.match(\"()\")) {\n            return eval(`(${v})`)\n        }\n        return v;\n    })\n}\n\nfunction getContent(res) {\n    let content = [\"\"]\n    // li = \"mini thumb small regular original\".split(\" \")\n    let illustLink = getAjaxJson(urlIllustDetailed(res.id)).body.urls.regular\n    for (let order = 0; order < res.pageCount; order++) {\n        content.push(`<img src=\"${illustLink}\">`)\n        illustLink = illustLink.replace(`_p${order}`, `_p${order + 1}`)\n    }\n    content = content.join(\"\\n\")\n    return content\n}\n\n(function () {\n    return getContent(util.getIllustRes(result))\n})()",
            "imageStyle": "FULL"
        },
        "ruleExplore": {
            "author": "userName",
            "bookList": "@js:\nvar util = objParse(String(java.get(\"util\")))\nvar seriesSet = new Set();  // å­˜å‚¨seriesID æœ‰BUGæ— æ³•å¤„ç†ç¿»é¡µ\n\nfunction objParse(obj) {\n    return JSON.parse(obj, (n, v) => {\n        if (typeof v == \"string\" && v.match(\"()\")) {\n            return eval(`(${v})`)\n        }\n        return v;\n    })\n}\n\nfunction handlerFactory() {\n    if (baseUrl.includes(\"https://cdn.jsdelivr.net\")) {\n        return () => {updateSource(); return []}\n    }\n    if (!isLogin()) {\n        return handlerNoLogin()\n    }\n    if (baseUrl.includes(\"/follow_latest\")) {\n        return handlerFollowLatest()\n    }\n    if (baseUrl.includes(\"/watch_list\")) {\n        return handlerWatchList()\n    }\n    if (baseUrl.includes(\"/top\")) {\n        return handlerRecommend()\n    }\n    if (baseUrl.includes(\"/discovery\")) {\n        return handlerDiscovery()\n    }\n    if (baseUrl.includes(\"/bookmark\")) {\n        return handlerBookMarks()\n    }\n    if (baseUrl.includes(\"/new\")) {\n        return handlerDiscovery()\n    }\n    if (baseUrl.includes(\"/commission/\")) {\n        return handlerFollowLatest()\n    }\n    if (baseUrl.includes(\"/user_event/portal\")) {\n        return handlerFollowLatest()\n    }\n    // æ­£åˆ™åŒ¹é…ç½‘å€å†…å®¹\n    if (baseUrl.includes(\"/ranking\") && (baseUrl.endsWith(\"json\"))) {\n        return handlerRanking()\n    }\n    if (baseUrl.includes(\"/ranking\")) {\n        return handlerRegexIllusts()\n    }\n    else {\n        return []\n    }\n}\n\nfunction handlerNoLogin() {\n    return () => {\n        sleepToast(\"æ­¤åŠŸèƒ½éœ€è¦åœ¨ä¹¦æºç™»å½•åæ‰èƒ½ä½¿ç”¨\")\n        sleepToast('å‘ç° - é•¿æŒ‰\"Pixiv\" - ç™»å½• - ç™»å½•è´¦å·')\n        return []\n    }\n}\n\n//å…³æ³¨ä½œè€…ï¼Œæ¼«ç”»å§”æ‰˜ï¼Œæ¼«ç”»ä¼åˆ’\nfunction handlerFollowLatest() {\n    return () => {\n        let res = JSON.parse(result)\n        return util.formatIllusts(util.handIllusts(res.body.thumbnails.illust))\n    }\n}\n\n// è¿½æ›´åˆ—è¡¨\nfunction handlerWatchList() {\n    return () => {\n        let res = JSON.parse(result)\n        // li =  res.body.page.watchedSeriesIds\n        return util.formatIllusts(util.handIllusts(res.body.thumbnails.illust))\n    }\n}\n\n// æ¨èæ¼«ç”»\nfunction handlerRecommend() {\n    return () => {\n        let res = JSON.parse(result)\n        const recommend = res.body.page.recommend\n        const illusts = res.body.thumbnails.illust\n        let nidSet = new Set(recommend.ids)\n        // java.log(nidSet.size)\n        let list = illusts.filter(illust => nidSet.has(String(illust.id)))\n        // java.log(`è¿‡æ»¤ç»“æœ:${JSON.stringify(list)}`)\n        return util.formatIllusts(util.handIllusts(list))\n    }\n}\n\n//å‘ç°æ¼«ç”»\nfunction handlerDiscovery() {\n    return () => {\n        let res = JSON.parse(result)\n        return util.formatIllusts(util.handIllusts(res.body.illusts))\n    }\n}\n\n// æ”¶è—æ¼«ç”»\nfunction handlerBookMarks() {\n    return () => {\n        let res = JSON.parse(result).body.works\n        if (res === undefined || res.length === 0) {\n            //æµç¨‹æ— æ³•æœ¬ç¯èŠ‚ä¸­æ­¢ åªèƒ½äº¤ç»™ä¸‹ä¸€æµç¨‹å¤„ç†\n            return []\n        }\n        return util.formatIllusts(util.handIllusts(res))\n    }\n}\n\n// æ’è¡Œæ¦œï¼Œé¡ºåºç›¸åŒ\nfunction handlerRanking() {\n    return () => {\n        let res = JSON.parse(result)\n        res.contents.forEach(item =>{\n            item.id = item.illust_id\n            // item.title = item.title\n            item.userName = item.user_name\n            // item.tags = item.tags\n            item.latestChapter = item.title\n            item.description = null\n            item.coverUrl = item.url\n            item.detailedUrl = urlIllustDetailed(item.id)\n            item.createDate = item.updateDate = item.illust_upload_timestamp * 1000\n\n            if (item.illust_series !== false) {\n                let series = item.illust_series\n                item.seriesId = series.illust_series_id\n                item.order = series.illust_series_content_order\n                item.total = series.illust_series_content_count\n                if (item.order === item.total) item.latestChapter = item.title\n                item.title = series.illust_series_title\n                item.description = series.illust_series_caption\n                item.pageCount = series.illust_page_count\n                item.createDate = item.updateDate = series.illust_series_create_datetime\n            }\n        })\n        return util.formatIllusts(util.handIllusts(res.contents))\n    }\n}\n\n//é¦–é¡µï¼Œç¼–è¾‘éƒ¨æ¨èï¼Œé¡ºåºéšæœº\nfunction handlerRegexIllusts() {\n    return () => {\n        let illustIds = []  // æ­£åˆ™è·å–ç½‘å€ä¸­çš„ illustId\n        let matched = result.match(RegExp(/\\/artworks\\/\\d{5,}/gm))\n        for (let i in matched) {\n            let illustId = matched[i].match(RegExp(/\\d{5,}/))[0]\n            if (illustIds.indexOf(illustId) === -1) {\n                illustIds.push(illustId)\n            }\n        }\n        let userIllusts = getWebviewJson(\n            urlIllustsDetailed(`${cache.get(\"pixiv:uid\")}`, illustIds), html => {\n                return (html.match(new RegExp(\">\\\\{.*?}<\"))[0].replace(\">\", \"\").replace(\"<\", \"\"))\n            }).body\n        return util.formatIllusts(util.handIllusts(Object.values(userIllusts)))\n    }\n}\n\n(() => {\n    return handlerFactory()()\n})()",
            "bookUrl": "detailedUrl",
            "coverUrl": "coverUrl",
            "intro": "description",
            "kind": "tags",
            "lastChapter": "latestChapter",
            "name": "title",
            "wordCount": ""
        },
        "ruleSearch": {
            "author": "userName",
            "bookList": "@js:\nvar util = objParse(String(java.get(\"util\")))\n\nfunction objParse(obj) {\n    return JSON.parse(obj, (n, v) => {\n        if (typeof v == \"string\" && v.match(\"()\")) {\n            return eval(`(${v})`)\n        }\n        return v;\n    })\n}\n\nfunction getManga() {\n    if (JSON.parse(result).error === true) {\n        return []\n    }\n    let illusts = JSON.parse(result).body.illustManga.data\n    illusts.forEach(illust => {illust.tags.unshift(\"æ¼«ç”»\")})\n    return illusts\n}\n\nfunction getConvertManga() {\n    let MAXPAGES = 2, illusts = []\n    let novelName = String(java.get(\"key\"))\n    let name = java.s2t(java.t2s(java.s2t(novelName)))\n    let resp = getAjaxJson(urlSearchManga(name, 1)).body\n    java.log(urlSearchManga(name, 1))\n    illusts = illusts.concat(resp.illustManga.data)\n    // for (let page = 2; page < resp.lastPage, page < MAXPAGES; page++) {\n    //     illusts = illusts.concat(getAjaxJson(urlSearchManga(name, page)).body.illustManga.data)\n    //     java.log(urlSearchManga(name, page))\n    // }\n    illusts.forEach(illust => {illust.tags.unshift(\"æ¼«ç”»\")})\n    return illusts\n}\n\nfunction getIllust() {\n    let MAXPAGES = 3, illusts = []\n    let name = String(java.get(\"key\"))\n    java.log(urlSearchIllust(name, 1))\n    let resp = getAjaxJson(urlSearchIllust(name, 1))\n    if (resp.error === true) {\n        return []\n    }\n    illusts = illusts.concat(resp.body.illustManga.data)\n    for (let page = Number(java.get(\"page\")) + 1; page < resp.body.illustManga.lastPage, page < MAXPAGES; page++) {\n        java.log(`æ­£åœ¨æœç´¢ç¬¬${page}é¡µ`)\n        let resp = getAjaxJson(urlSearchIllust(name, page))\n        if (resp.error === true) {\n            return []\n        }\n        illusts = illusts.concat(resp.body.illustManga.data)\n    }\n    illusts.forEach(illust => {illust.tags.unshift(\"æ’ç”»\")})\n    return illusts\n}\n\n(() => {\n    let artworks = []\n    artworks = artworks.concat(getManga())\n    if (util.CONVERT_CHINESE) artworks = artworks.concat(getConvertManga())\n    if (util.SEARCH_ILLUSTS) artworks = artworks.concat(getIllust())\n    // java.log(JSON.stringify(artworks))\n    // è¿”å›ç©ºåˆ—è¡¨ä¸­æ­¢æµç¨‹\n    if (artworks.length === 0) {\n        return []\n    }\n    return util.formatIllusts(util.handIllusts(artworks))\n})()",
            "bookUrl": "detailedUrl",
            "checkKeyWord": "æµ‹è¯•",
            "coverUrl": "coverUrl",
            "intro": "description",
            "kind": "tags",
            "lastChapter": "latestChapter",
            "name": "title",
            "wordCount": ""
        },
        "ruleToc": {
            "chapterList": "@js:\nvar util = objParse(String(java.get(\"util\")))\n\nfunction objParse(obj) {\n    return JSON.parse(obj, (n, v) => {\n        if (typeof v == \"string\" && v.match(\"()\")) {\n            return eval(`(${v})`)\n        }\n        return v;\n    })\n}\n\nfunction urlIllust(novelId){\n    if (util.SHOW_ORIGINAL_LINK) {\n        return urlIllustUrl(novelId)\n    } else {\n        return urlIllustDetailed(novelId)\n    }\n}\n\nfunction oneShotHandler(res) {\n    return [{\n        title: res.title.replace(RegExp(/^\\s+|\\s+$/g), \"\"),\n        chapterUrl: urlIllust(res.id),\n        chapterInfo: `${timeTextFormat(res.createDate)}`\n    }]\n}\n\nfunction seriesHandler(res) {\n    let limit = 12, total = 0, illusts = []\n    let seriesId = res.seriesNavData.seriesId\n    if (res.seriesId === undefined) {\n        total = getAjaxJson(urlSeriesDetailed(res.seriesNavData.seriesId)).body.page.total\n    } else {\n        total = res.total\n    }\n    util.debugFunc(() => {\n        java.log(`æœ¬ç³»åˆ— ${seriesId} ä¸€å…±æœ‰${total}ç« `);\n    })\n\n    //è¦çˆ¬å–çš„æ€»æ¬¡æ•°\n    let max = (total / limit) + 1\n    for (let page = 1; page < max; page++) {\n        // java.log(urlSeriesDetailed(seriesId, page))\n        res = getAjaxJson(urlSeriesDetailed(seriesId, page)).body\n        let illusts_id = res.page.series.map(item => item.workId)\n        illusts = illusts.concat(res.thumbnails.illust.filter(illust => illusts_id.includes(illust.id)))\n    }\n    illusts.reverse().forEach(illust => {\n        illust.title = illust.title.replace(RegExp(/^\\s+|\\s+$/g), \"\")\n        illust.chapterUrl = urlIllust(illust.id)\n        illust.chapterInfo = timeTextFormat(illust.createDate)\n    })\n    // java.log(JSON.stringify(illusts))\n    return illusts\n}\n\n(() => {\n    let res = util.getIllustRes(result)\n    if (res.seriesNavData !== null) {\n        return seriesHandler(res)\n    } else {\n        return oneShotHandler(res)\n    }\n})()",
            "chapterName": "title",
            "chapterUrl": "chapterUrl",
            "isPay": "",
            "isVip": "",
            "updateTime": "chapterInfo"
        },
        "searchUrl": "@js:\njava.put(\"key\",key)\njava.put(\"page\",page)\nurlSearchManga(key, page)",
        "variableComment": "âš™ï¸ è‡ªå®šä¹‰ä¹¦æºè®¾ç½®ï¼š\nâš™ï¸ è‡ªå®šä¹‰è®¾ç½®ï¼šè¯·åœ¨åŸºæœ¬-å˜é‡è¯´æ˜å¤„ä¿®æ”¹ä»£ç \nâš™ï¸ è‡ªå®šä¹‰è®¾ç½®ï¼šå°† true æ”¹ä¸º falseï¼Œæˆ–ç›¸å\nâš ï¸ è®¾ç½®æºå˜é‡ã€æ— æ³•ã€‘æ›´æ”¹ä¹¦æºè‡ªå®šä¹‰è®¾ç½®\nâš ï¸ æ³¨æ„ä¸è¦æ·»åŠ æˆ–åˆ é™¤å°¾éšé€—å·\",\"\nâš ï¸ å‘ç°é¡µéœ€è¦é•¿æŒ‰\"Pixiv\"ï¼Œæ‰‹åŠ¨åˆ·æ–°\nä»¥ä¸‹å†…å®¹ä¸ºä¹¦æºè®¾ç½®ï¼š\n{\n\"CONVERT_CHINESE\": true,\n\"SEARCH_ILLUSTS\": false,\n\"SHOW_GENERAL_NEW\": false,\n\n\"DEBUG\": false,\n\n\"SHOW_GENERAL_RANK\": false,\n\"SHOW_ORIGINAL_LINK\": true\n}\n\n// CONVERT_CHINESE\n// æœç´¢ï¼šæœç´¢æ—¶è¿›è¡Œç¹ç®€è½¬æ¢\n// SEARCH_ILLUSTS\n// æœç´¢ï¼šåŒæ—¶æœç´¢æ’ç”»\n// SHOW_ORIGINAL_LINK\n// ç›®å½•ï¼šæ˜¾ç¤ºæºé“¾æ¥ï¼Œä½†ä¼šå¢åŠ è¯·æ±‚æ¬¡æ•°\n\n// DEBUG\n// è°ƒè¯•æ¨¡å¼\n\n// SHOW_GENERAL_NEW\n// å‘ç°ï¼šæœ€æ–°ã€ä¼åˆ’ã€çº¦ç¨¿æ˜¾ç¤ºä¸€èˆ¬æ¼«ç”»\n// SHOW_GENERAL_RANK\n// å‘ç°ï¼šæ’è¡Œæ¦œæ˜¾ç¤ºä¸€èˆ¬æ¼«ç”»\n\n",
        "weight": 0
    }
]