[
    {
        "bookSourceComment": "Pixiv ä¹¦æºï¼ˆç³»åˆ—ï¼‰ï¼ˆæ›´æ–°ğŸ“†ï¼š2025-02-15ï¼‰\n\nä½¿ç”¨è¯´æ˜ï¼šä¸¤ä¹¦æºåŠŸèƒ½å®Œå…¨ç›¸åŒï¼Œå¯ç”¨å…¶ä¸€å³å¯  \nå¯ç”¨åŠŸèƒ½ï¼šâœ…æœç´¢âœ…å‘ç°âœ…æ·»åŠ ç½‘å€âœ…è®¢é˜…æº  \næœç´¢å°è¯´ï¼šâœ…å•ç¯‡âœ…ç³»åˆ—âœ…ä½œè€…âœ…æ ‡ç­¾âœ…é“¾æ¥  \nå‘ç°å°è¯´ï¼šâœ…å…³æ³¨âœ…è¿½æ›´âœ…æ¨èâœ…å‘ç°âœ…æ”¶è—  \næ·»åŠ ç½‘å€ï¼šâœ…Pixiv å°è¯´é“¾æ¥âœ…Pixiv ç³»åˆ—é“¾æ¥  \næœç´¢ç½‘å€ï¼šâœ…Pixiv é“¾æ¥âœ…Linpx é“¾æ¥  \nè®¢é˜…ç”¨æ³•ï¼šç‚¹å‡»è®¢é˜…æºæ‰“å¼€å°è¯´/ç³»åˆ—å°è¯´ï¼Œã€åˆ·æ–°ã€‘ï¼Œç‚¹å‡»ã€åŠ å…¥ä¹¦æ¶ã€‘æŒ‰é’®ï¼Œæ·»åŠ å°è¯´åˆ°ä¹¦æ¶\n\nä¹¦æºå‘å¸ƒï¼šå…½äººé˜…è¯»é¢‘é“ https://t.me/FurryReading\né¡¹ç›®åœ°å€ï¼šhttps://github.com/windyhusky/PixivSource\nä½¿ç”¨æ•™ç¨‹ï¼šhttps://github.com/windyhusky/PixivSource/blob/main/doc/Pixiv.md\n\nè§„åˆ™è®¢é˜…ï¼šImport è®¢é˜…æº\nhttps://cdn.jsdelivr.net/gh/windyhusky/PixivSource@main/import.json\nhttps://raw.githubusercontent.com/windyhusky/PixivSource/main/import.json\n\nâš™ï¸ ä¹¦æºè®¾ç½®ï¼š\nä¹¦æºç®¡ç† - ç¼–è¾‘ä¹¦æº - åŸºæœ¬ - å˜é‡è¯´æ˜ - ä¿®æ”¹å¹¶ä¿å­˜\n\nâ¤ï¸ æŸ¥çœ‹ä»–äººæ”¶è—ï¼š\nå‘ç° - é•¿æŒ‰\"Pixiv\" - ç¼–è¾‘ - å³ä¸Šè§’èœå• - è®¾ç½®æºå˜é‡  \nè®¾ç½®æºå˜é‡ï¼šè¾“å…¥ä½œè€…IDï¼Œä¸€è¡Œä¸€ä¸ªï¼Œå¯æ·»åŠ ä½œè€…åï¼Œä¿å­˜  \nå‘ç° - é•¿æŒ‰\"Pixiv\" - åˆ·æ–° - æŸ¥çœ‹ä»–äººæ”¶è—",
        "bookSourceGroup": "ğŸ” Pixiv",
        "bookSourceName": "Pixiv",
        "bookSourceType": 0,
        "bookSourceUrl": "https://www.pixiv.net/novel",
        "bookUrlPattern": ".*(https?://)?(www\\.)?pixiv\\.net(/ajax)?/novel/(show\\.php\\?id=|series/)?\\d+.*",
        "customOrder": 0,
        "enabled": true,
        "enabledCookieJar": false,
        "enabledExplore": true,
        "exploreUrl": "@js:\ntry {\n    settings = JSON.parse(String(source.variableComment).match(RegExp(/{([\\s\\S]*?)}/gm)))\n    SHOW_GENERAL_NOVELS_RANK = settings.SHOW_GENERAL_NOVELS_RANK  // å‘ç°ï¼šæ’è¡Œæ¦œæ˜¾ç¤ºä¸€èˆ¬å°è¯´\n} catch (e) {\n    SHOW_GENERAL_NOVELS_RANK = false\n}\n\nli = [\n    {\"å…³æ³¨\": \"https://www.pixiv.net/ajax/follow_latest/novel?p={{page}}&mode=all&lang=zh\"},\n    {\"è¿½æ›´\": \"https://www.pixiv.net/ajax/watch_list/novel?p={{page}}&new=1&lang=zh\"},\n    {\"æ¨è\": \"https://www.pixiv.net/ajax/top/novel?mode=all&lang=zh\"},\n    {\"å‘ç°\": \"https://www.pixiv.net/ajax/novel/discovery?mode=all\"},\n    {\"æ”¶è—\": \"https://www.pixiv.net/ajax/user/{{cache.get(\\\"pixiv:uid\\\")}}/novels/bookmarks?tag=&offset={{(page-1)*24}}&limit=24&rest=show&lang=zh\"}\n]\n\nr18 = [\n    {\"\\uD83D\\uDD1E æ’è¡Œæ¦œ\": \"\"},\n    {\"ä»Šæ—¥\": \"https://www.pixiv.net/novel/ranking.php?mode=daily_r18\"},\n    {\"æœ¬å‘¨\": \"https://www.pixiv.net/novel/ranking.php?mode=weekly_r18\"},\n    {\"R18G\": \"https://www.pixiv.net/novel/ranking.php?mode=r18g\"},\n    {\"ç”·æ€§\": \"https://www.pixiv.net/novel/ranking.php?mode=male_r18\"},\n    {\"å¥³æ€§\": \"https://www.pixiv.net/novel/ranking.php?mode=female_r18\"}\n]\n\ngeneral = [\n    {\"\\uD83C\\uDD97 æ’è¡Œæ¦œ\": \"\"},\n    {\"ä»Šæ—¥\": \"https://www.pixiv.net/novel/ranking.php?mode=daily\"},\n    {\"æœ¬å‘¨\": \"https://www.pixiv.net/novel/ranking.php?mode=weekly\"},\n    {\"æœ¬æœˆ\": \"https://www.pixiv.net/novel/ranking.php?mode=monthly\"},\n    {\"ç”·æ€§\": \"https://www.pixiv.net/novel/ranking.php?mode=male\"},\n    {\"å¥³æ€§\": \"https://www.pixiv.net/novel/ranking.php?mode=female\"}\n]\n\nbookmarks = [{\"â¤ï¸ æ”¶è—\": \"\"}]\n\nli = li.concat(r18)\nif (SHOW_GENERAL_NOVELS_RANK === true) {\n    li = li.concat(general)\n}\ntry {\n    authors = String(source.getVariable()).split(\"\\n\")\n    if (authors[0].trim() !== \"\" && authors.length >= 1) {\n        for (let i in authors) {\n            if (authors[i] !== \"\") {\n                let authorId = authors[i].match(RegExp(/\\d+/))[0]\n                let resp = JSON.parse(java.ajax(`https://www.pixiv.net/ajax/user/${authorId}`))\n                if (resp.error !== true) {\n                    let bookmark = {}\n                    bookmark[resp.body.name] = `https://www.pixiv.net/ajax/user/${authorId}/novels/bookmarks?tag=&offset={{(page-1)*24}}&limit=24&rest=show&lang=zh`\n                    bookmarks.push(bookmark)\n                }\n            }\n        }\n        li = li.concat(bookmarks)\n    }\n} catch (e) {\n    java.longToast(\"æºå˜é‡è®¾ç½®æœ‰è¯¯\")\n}\n\nli.forEach(item => {\n    item.title = Object.keys(item)[0]\n    item.url = Object.values(item)[0]\n    delete item[Object.keys(item)[0]]\n    item.style = {}\n    item.style.layout_flexGrow = 1\n    item.style.layout_flexShrink = 1\n    item.style.layout_alignSelf = \"auto\"\n    item.style.layout_wrapBefore = \"false\"\n    if (item.url === \"\") {\n        item.style.layout_flexBasisPercent = 1\n    } else {\n        item.style.layout_flexBasisPercent = -1\n    }\n})\n\nJSON.stringify(li)",
        "header": "{\"referer\":\"https://www.pixiv.net\"}",
        "lastUpdateTime": 1739548800251,
        "loginCheckJs": "var util = {}\n\nfunction objStringify(obj) {\n    return JSON.stringify(obj, (n, v) => {\n        if (typeof v == \"function\")\n            return v.toString();\n        return v;\n    });\n}\n\nfunction publicFunc() {\n    let u = {}, settings = {}\n    java.log(String(source.bookSourceComment).split(\"\\n\")[0]) // è¾“å‡ºä¹¦æºä¿¡æ¯\n    java.log(`æ‰‹åŠ¨æ›´æ–°æ—¶é—´ï¼š${java.timeFormat(source.lastUpdateTime)}`) // è¾“å‡ºä¹¦æºä¿¡æ¯\n    settings = JSON.parse(String(source.variableComment).match(RegExp(/{([\\s\\S]*?)}/gm)))\n    if (settings !== null) {\n        java.log(\"âš™ï¸ ä½¿ç”¨è‡ªå®šä¹‰è®¾ç½®\")\n    } else {\n        settings = {}\n        settings.SHOW_ORIGINAL_NOVEL_LINK = true\n        settings.REPLACE_BOOK_TITLE_MARKS = true\n        settings.MORE_INFO_IN_DESCRIPTION = false\n        settings.SHOW_NOVEL_CAPTIONS = true\n        settings.SHOW_NOVEL_COMMENTS = true\n        settings.DEBUG = false\n        java.log(\"âš™ï¸ ä½¿ç”¨é»˜è®¤è®¾ç½®ï¼ˆæ— è‡ªå®šä¹‰è®¾ç½® æˆ– è‡ªå®šä¹‰è®¾ç½®æœ‰è¯¯ï¼‰\")\n    }\n    u.SHOW_ORIGINAL_NOVEL_LINK = settings.SHOW_ORIGINAL_NOVEL_LINK  // ç›®å½•å¤„æ˜¾ç¤ºå°è¯´æºé“¾æ¥ï¼Œä½†ä¼šå¢åŠ è¯·æ±‚æ¬¡æ•°\n    u.REPLACE_BOOK_TITLE_MARKS = settings.REPLACE_BOOK_TITLE_MARKS  // æ³¨éŸ³å†…å®¹ä¸ºæ±‰å­—æ—¶ï¼Œæ›¿æ¢ä¸ºä¹¦åå·\n    u.MORE_INFO_IN_DESCRIPTION = settings.MORE_INFO_IN_DESCRIPTION  // ä¹¦ç±ç®€ä»‹æ˜¾ç¤ºæ›´å¤šä¿¡æ¯\n    u.SHOW_NOVEL_CAPTIONS = settings.SHOW_NOVEL_CAPTIONS  // ä¹¦ç±ç®€ä»‹æ˜¾ç¤ºæ›´å¤šä¿¡æ¯\n    u.SHOW_NOVEL_COMMENTS = settings.SHOW_NOVEL_COMMENTS  // ä¹¦ç±ç®€ä»‹æ˜¾ç¤ºæ›´å¤šä¿¡æ¯\n    u.DEBUG = settings.DEBUG // è°ƒè¯•æ¨¡å¼\n\n    if (u.DEBUG === true) {\n        java.log(JSON.stringify(settings, null, 4))\n        java.log(`DEBUG = ${u.DEBUG}`)\n    }\n\n\n    u.debugFunc = (func) => {\n        if (util.DEBUG) {\n            func()\n        }\n    }\n    u.cacheGetAndSet = (key, supplyFunc) => {\n        let v = cache.get(key)\n        if (v === undefined || v === null) {\n            v = JSON.stringify(supplyFunc())\n            // ç¼“å­˜10åˆ†é’Ÿ\n            cache.put(key, v, 600)\n        }\n        return JSON.parse(v)\n    }\n    u.getAjaxJson = (url) => {\n        return util.cacheGetAndSet(url, () => {\n            return JSON.parse(java.ajax(url))\n        })\n    }\n    u.getWebviewJson = (url, parseFunc) => {\n        return util.cacheGetAndSet(url, () => {\n            let html = java.webView(null, url, null)\n            return JSON.parse(parseFunc(html))\n        })\n    }\n\n    u.urlNovelUrl = (novelId) => {\n        return `https://www.pixiv.net/novel/show.php?id=${novelId}`\n    }\n    u.urlNovelDetailed = (novelId) => {\n        return `https://www.pixiv.net/ajax/novel/${novelId}`\n    }\n    u.urlNovelsDetailed = (userId, nidList) => {\n        return `https://www.pixiv.net/ajax/user/${userId}/novels?${nidList.map(v => \"ids[]=\" + v).join(\"&\")}`\n    }\n    u.urlNovelComments = (novelId, offset, limit) => {\n        return `https://www.pixiv.net/ajax/novels/comments/roots?novel_id=${novelId}&offset=${offset}&limit=${limit}&lang=zh`\n    }\n    u.urlNovelCommentsReply = (commentId, page) => {\n        return `https://www.pixiv.net/ajax/novels/comments/replies?comment_id=${commentId}&page=${page}&lang=zh`\n    }\n    u.urlNovel = (novelId) => {\n        if (util.SHOW_ORIGINAL_NOVEL_LINK) {\n            return util.urlNovelUrl(novelId)\n        } else {\n            return util.urlNovelDetailed(novelId)\n        }\n    }\n\n    u.urlSeriesUrl = (seriesId) => {\n        return `https://www.pixiv.net/novel/series/${seriesId}`\n    }\n    u.urlSeriesDetailed = (seriesId) => {\n        return `https://www.pixiv.net/ajax/novel/series/${seriesId}?lang=zh`\n    }\n    u.urlSeriesNovels = (seriesId, limit, offset) => {\n        if (limit > 30) {\n            limit = 30\n        }\n        if (limit < 10) {\n            limit = 10\n        }\n        return `https://www.pixiv.net/ajax/novel/series_content/${seriesId}?limit=${limit}&last_order=${offset}&order_by=asc&lang=zh`\n    }\n    u.urlSeries = (seriesId) => {\n        if (util.SHOW_ORIGINAL_NOVEL_LINK) {\n            return util.urlSeriesUrl(seriesId)\n        } else {\n            return util.urlSeriesDetailed(seriesId)\n        }\n    }\n\n    u.urlUserUrl = (userId) => {\n        return `https://www.pixiv.net/users/${userId}`\n    }\n    u.urlUserDetailed = (userId) => {\n        return `https://www.pixiv.net/ajax/user/${userId}`\n    }\n    u.urlUserAllWorks = (userId) => {\n        return `https://www.pixiv.net/ajax/user/${userId}/profile/all?lang=zh`\n    }\n\n    u.urlSearchNovel = (novelName, page) =>{\n        return `https://www.pixiv.net/ajax/search/novels/${encodeURI(novelName)}?word=${encodeURI(novelName)}&order=date_d&mode=all&p=${page}&s_mode=s_tag&lang=zh`\n    }\n    u.urlSearchSeries = (seriesName, page) => {\n        return`https://www.pixiv.net/ajax/search/novels/${encodeURI(seriesName)}?word=${encodeURI(seriesName)}&order=date_d&mode=all&p=${page}&s_mode=s_tag&gs=1&lang=zh`\n    }\n    // å®Œå…¨åŒ¹é…ç”¨æˆ·å\n    u.urlSearchUser = (userName) => {\n        return `https://www.pixiv.net/search/users?nick=${encodeURI(userName)}&s_mode=s_usr&nick_mf=1`\n    }\n\n    u.urlCoverUrl = (url) => {\n        return `${url}, {\"headers\": {\"Referer\":\"https://www.pixiv.net/\"}}`\n    }\n    u.urlIllustUrl = (illustId) => {\n        return `https://www.pixiv.net/artworks/${illustId}`\n    }\n    u.urlIllustDetailed = (illustId) => {\n        return `https://www.pixiv.net/ajax/illust/${illustId}?lang=zh`\n    }\n    u.urlIllustOriginal = (illustId, order) => {\n        let illustOriginal = util.getAjaxJson(util.urlIllustDetailed(illustId)).body.urls.original\n        if (order >= 1) {\n            illustOriginal = illustOriginal.replace(`_p0`, `_p${order - 1}`)\n        }\n        return illustOriginal\n    }\n\n    u.urlSeriesIllustsUrl = (userId, seriesId) => {\n        return `https://www.pixiv.net/user/${userId}/series/${seriesId}`\n    }\n    u.urlSeriesIllustsDetailed = (seriesId) => {\n        return `https://www.pixiv.net/ajax/series/${seriesId}?p=1&lang=zh`\n    }\n\n    // å°†å¤šä¸ªé•¿ç¯‡å°è¯´è§£æä¸ºä¸€æœ¬ä¹¦\n    u.combineNovels = function (novels) {\n        return novels.filter(novel => {\n            // å•æœ¬ç›´æ¥è§£æä¸ºä¸€æœ¬ä¹¦\n            if (novel.seriesId === undefined || novel.seriesId === null) {\n                return true\n            }\n            // é›†åˆä¸­æ²¡æœ‰è¯¥ç³»åˆ—è§£æä¸ºä¸€æœ¬ä¹¦\n            if (!seriesSet.has(novel.seriesId)) {\n                seriesSet.add(novel.seriesId)\n                return true\n            }\n            return false\n        })\n    }\n\n    // å¤„ç† novels åˆ—è¡¨\n    u.handNovels = function (novels) {\n        novels.forEach(novel => {\n            // å¤„ç†æ­£æ–‡ tag\n            if (!(novel.tags instanceof Array)) {\n                novel.tags = novel.tags.tags.map(item => item.tag)\n                novel.updateDate = novel.uploadDate\n                if (novel.seriesNavData !== null){\n                    novel.seriesId = novel.seriesNavData.seriesId\n                }\n            }\n            if (novel.tags === undefined || novel.tags === null) {\n                novel.tags = []\n            }\n            // novel.id = novel.id\n            // novel.title = novel.title\n            // novel.userName = novel.userName\n            if (novel.isOneshot !== undefined) { // æœç´¢ç³»åˆ—\n                if (novel.isOneshot === true) {\n                    novel.seriesId = undefined\n                    novel.id = novel.novelId  // è·å–çœŸæ­£çš„ novelId\n                } else {  //ç³»åˆ—\n                    novel.seriesId = novel.id  // è·å–ç³»åˆ—å°è¯´id\n                    // novel.id = novel.latestEpisodeId  // æœ€è¿‘ä¸€ç¯‡\n                }\n                novel.textCount = novel.textLength\n                novel.description = novel.caption\n                novel.coverUrl = novel.cover.urls[\"480mw\"]\n                if (novel.createDate === undefined) {  // å…¼å®¹æœç´¢ä½œè€…è·å–è·å–ç³»åˆ—å°è¯´\n                    novel.createDate = novel.createDateTime\n                    novel.updateDate = novel.updateDateTime\n                }\n\n            } else {  // æœç´¢ä½œè€…ï¼Œå‘ç°æ’è¡Œæ¦œ\n                // novel.textCount = novel.textCount\n                // novel.description = novel.description\n                if (novel.coverUrl === undefined) {  // å…¼å®¹å‘ç°æ’è¡Œæ¦œ\n                    novel.coverUrl = novel.url\n                }\n                // novel.createDate = novel.createDate\n                // novel.updateDate = novel.updateDate\n            }\n\n            if (novel.seriesId === undefined || novel.seriesId === null) {  // å•ç¯‡\n                novel.tags.unshift(\"å•æœ¬\")\n                novel.latestChapter = novel.title\n                novel.detailedUrl = util.urlNovelDetailed(novel.id)\n            } else { // ç³»åˆ—\n                // novel.seriesId = novel.seriesId\n                let series = util.getAjaxJson(util.urlSeriesDetailed(novel.seriesId)).body\n                novel.id = series.firstNovelId\n                novel.title = series.title\n                // novel.userName = novel.userName\n                novel.tags = series.tags\n                novel.textCount = series.publishedTotalCharacterCount\n                // novel.lastChapter = util.getAjaxJson(util.urlNovelDetailed(series.lastNovelId)).body.title\n                novel.description = series.caption\n                novel.coverUrl = series.cover.urls[\"480mw\"]\n                novel.detailedUrl = util.urlSeriesDetailed(novel.seriesId)\n\n                // å‘é€è¯·æ±‚è·å–ç¬¬ä¸€ç«  è·å–æ ‡ç­¾ä¸ç®€ä»‹\n                let firstNovel = {}\n                try {\n                    firstNovel = util.getAjaxJson(util.urlNovelDetailed(series.firstNovelId)).body\n                    novel.tags = novel.tags.concat(firstNovel.tags.tags.map(item => item.tag))\n                } catch (e) {  // é˜²æ­¢ç³»åˆ—é¦–ç¯‡æ— æƒé™è·å–\n                    firstNovel = util.getAjaxJson(util.urlSeriesNovels(novel.seriesId, 30, 0)).body.thumbnails.novel[0]\n                    novel.id = novel.firstNovelId = firstNovel.id\n                    novel.tags = novel.tags.concat(firstNovel.tags)\n                }\n                novel.tags.unshift(\"é•¿ç¯‡\")\n                novel.tags = Array.from(new Set(novel.tags))\n                if (novel.description === \"\") {\n                    novel.description = firstNovel.description\n                }\n            }\n        })\n        util.debugFunc(() => {\n            java.log(`å¤„ç†å°è¯´å®Œæˆ`)\n        })\n        return novels\n    }\n\n    // å°è¯´ä¿¡æ¯æ ¼å¼åŒ–\n    u.formatNovels = function (novels) {\n        novels.forEach(novel => {\n            novel.title = novel.title.replace(RegExp(/^\\s+|\\s+$/g), \"\")\n            novel.tags = novel.tags.join(\",\")\n            novel.coverUrl = this.urlCoverUrl(novel.coverUrl)\n            novel.readingTime = `${novel.readingTime / 60} åˆ†é’Ÿ`\n            novel.createDate = this.dateFormat(novel.createDate);\n            novel.updateDate = this.dateFormat(novel.updateDate);\n            if (util.MORE_INFO_IN_DESCRIPTION) {\n                novel.description = `\\nä¹¦åï¼š${novel.title}\\nä½œè€…ï¼š${novel.userName}\\næ ‡ç­¾ï¼š${novel.tags}\\nä¸Šä¼ ï¼š${novel.createDate}\\næ›´æ–°ï¼š${novel.updateDate}\\nç®€ä»‹ï¼š${novel.description}`\n            } else {\n                novel.description = `\\n${novel.description}\\nä¸Šä¼ æ—¶é—´ï¼š${novel.createDate}\\næ›´æ–°æ—¶é—´ï¼š${novel.updateDate}`\n            }\n        })\n        return novels\n    }\n\n    // æ­£æ–‡ï¼Œæœç´¢ï¼šä»ç½‘å€è·å–idï¼Œè¿”å›å•ç¯‡å°è¯´ resï¼Œç³»åˆ—è¿”å›é¦–ç¯‡å°è¯´ res\n    u.getNovelRes = function (result) {\n        let novelId = 0, seriesId = 0, res = {}\n        // å…¼å®¹æœç´¢ç›´æ¥è¾“å…¥é“¾æ¥\n        pattern = \"(https?://)?(api\\\\.|www\\\\.)?((furrynovel\\\\.(ink|xyz))|pixiv\\\\.net)(/ajax)?/(pn|(pixiv/)?novel)/(show\\\\.php\\\\?id=|series/)?\\\\d+(/cache)?\"\n        // pattern = String(bookSourceUrl).replace(\".*\", \"\")\n        if (RegExp(pattern).test(result) && !(result.startsWith(\"<!DOCTYPE html>\"))) {\n            baseUrl = result.match(RegExp(pattern))[0]\n            result = \"<!DOCTYPE html>\"\n            java.log(`åŒ¹é…é“¾æ¥ï¼š${baseUrl}`)\n        }\n\n        let isHtml = result.startsWith(\"<!DOCTYPE html>\")\n        if (isHtml) {\n            let id = baseUrl.match(new RegExp(\"\\\\d+\"))[0]\n            let pattern = \"(https?://)?(www\\\\.)?pixiv\\\\.net(/ajax)?/novel/(series/)?\\\\d+\"\n            let isSeries = baseUrl.match(new RegExp(pattern))\n            if (isSeries) {\n                java.log(`ç³»åˆ—IDï¼š${id}`)\n                seriesId = id\n            } else {\n                let pattern = \"((furrynovel\\\\.(ink|xyz))|pixiv\\\\.net)/(pn|(pixiv/)?novel)/(show\\\\.php\\\\?id=)?\\\\d+\"\n                let isNovel = baseUrl.match(new RegExp(pattern))\n                if (isNovel) {\n                    res = util.getAjaxJson(util.urlNovelDetailed(id))\n                    novelId = id\n                }\n            }\n        } else {\n            res = JSON.parse(result)\n        }\n\n        if (res.body !== undefined && res.body.firstNovelId !== undefined && res.body.firstNovelId !== null) {\n            seriesId = res.body.seriesNavData.seriesId\n        }\n        if (seriesId) {  // é˜²æ­¢ç³»åˆ—é¦–ç¯‡æ— æƒé™è·å–\n            res = util.getAjaxJson(util.urlSeriesNovels(seriesId, 30, 0))\n            res.body = res.body.thumbnails.novel[0]\n            novelId = res.body.id\n        }\n        java.log(`åŒ¹é…å°è¯´IDï¼š${novelId}`)\n        if (res.error === true) {\n            java.log(`æ— æ³•ä» Pixiv è·å–å½“å‰å°è¯´`)\n            java.log(JSON.stringify(res))\n            return {}\n        }\n        return res.body\n    }\n\n    // è¯¦æƒ…ã€ç›®å½•ï¼šä»ç½‘å€è·å–idï¼Œå°½å¯èƒ½è¿”å›ç³»åˆ— resï¼Œå•ç¯‡å°è¯´è¿”å›å°è¯´ res\n    u.getNovelResSeries = function (result) {\n        let seriesId = 0, res = {}\n        // å…¼å®¹è¯¦æƒ…ï¼Œæ·»åŠ ç½‘å€ç›´æ¥è¾“å…¥é“¾æ¥\n        // pixiv é»˜è®¤åˆ†äº«ä¿¡æ¯ä¸­æœ‰ # å·ï¼Œä¸ä¼šè¢«è¯†åˆ«æˆé“¾æ¥ï¼Œæ— æ³•ä½¿ç”¨æ·»åŠ ç½‘å€\n        // baseUrl = baseUrl.replace(\"#\", \"%23\")\n        pattern = \"(https?://)?(api\\\\.|www\\\\.)?((furrynovel\\\\.(ink|xyz))|pixiv\\\\.net)(/ajax)?/(pn|(pixiv/)?novel)/(show\\\\.php\\\\?id=|series/)?\\\\d+(/cache)?\"\n        // pattern = String(bookSourceUrl).replace(\".*\", \"\")\n        if (!(result.startsWith(\"<!DOCTYPE html>\")) && JSON.parse(result).error === true && RegExp(pattern).test(baseUrl)) {\n            baseUrl = baseUrl.match(RegExp(pattern))[0]\n            result = \"<!DOCTYPE html>\"\n            java.log(`åŒ¹é…é“¾æ¥ï¼š${baseUrl}`)\n        }\n\n        let isHtml = result.startsWith(\"<!DOCTYPE html>\")\n        if (isHtml) {\n            let id = baseUrl.match(new RegExp(\"\\\\d+\"))[0]\n            let pattern = \"(https?://)?(www\\\\.)?pixiv\\\\.net(/ajax)?/novel/(series/)?\\\\d+\"\n            let isSeries = baseUrl.match(new RegExp(pattern))\n            if (isSeries) {\n                seriesId = id\n            } else {\n                let pattern = \"((furrynovel\\\\.(ink|xyz))|pixiv\\\\.net)/(pn|(pixiv/)?novel)/(show\\\\.php\\\\?id=)?\\\\d+\"\n                let isNovel = baseUrl.match(new RegExp(pattern))\n                if (isNovel) {\n                    java.log(`åŒ¹é…å°è¯´IDï¼š${id}`)\n                    res = util.getAjaxJson(util.urlNovelDetailed(id))\n                }\n            }\n        } else {\n            res = JSON.parse(result)\n        }\n        if (res.body !== undefined && res.body.seriesNavData !== undefined && res.body.seriesNavData !== null) {\n            seriesId = res.body.seriesNavData.seriesId\n        }\n        if (seriesId) {\n            java.log(`ç³»åˆ—IDï¼š${seriesId}`)\n            res = util.getAjaxJson(util.urlSeriesDetailed(seriesId))\n        }\n        if (res.error === true) {\n            java.log(`æ— æ³•ä» Pixiv è·å–å½“å‰å°è¯´`)\n            java.log(JSON.stringify(res))\n        }\n        return res.body\n    }\n\n    u.dateFormat = function (str) {\n        let addZero = function (num) {\n            return num < 10 ? '0' + num : num;\n        }\n        let time = new Date(str);\n        let Y = time.getFullYear() + \"å¹´\";\n        let M = addZero(time.getMonth() + 1) + \"æœˆ\";\n        let D = addZero(time.getDate()) + \"æ—¥\";\n        return Y + M + D;\n    }\n    u.timeTextFormat = function (text) {\n        return `${text.slice(0, 10)} ${text.slice(11, 19)}`\n    }\n    u.sleep = function (time) {\n        let endTime = new Date().getTime() + time\n        while(true){\n            if (new Date().getTime() > endTime){\n                return;\n            }\n        }\n    }\n\n    util = u\n    java.put(\"util\", objStringify(u))\n}\n\npublicFunc()\n\n// è·å–è¯·æ±‚çš„user idæ–¹ä¾¿å…¶ä»–ajaxè¯·æ±‚æ„é€ \nlet uid = java.getResponse().headers().get(\"x-userid\")\nif (uid != null) {\n    cache.put(\"pixiv:uid\", uid)\n}\njava.getStrResponse(null, null)",
        "loginUrl": "https://accounts.pixiv.net/login",
        "respondTime": 180000,
        "ruleBookInfo": {
            "author": "userName",
            "canReName": "true",
            "coverUrl": "coverUrl",
            "init": "@js:\nvar util = objParse(String(java.get(\"util\")))\n\nfunction objParse(obj) {\n    return JSON.parse(obj, (n, v) => {\n        if (typeof v == \"string\" && v.match(\"()\")) {\n            return eval(`(${v})`)\n        }\n        return v;\n    })\n}\n\nfunction oneShotHandler(res) {\n    let info = {}\n    info.seriesId = undefined\n    info.id = info.novelId = res.id\n    info.title = info.latestChapter = res.title.replace(RegExp(/^\\s+|\\s+$/g), \"\")\n    info.userName = res.userName\n    info.tags = res.tags.tags.map(item => item.tag)\n    info.tags.unshift('å•æœ¬')\n    // info.textCount = res.textCount  // æ— æ•°æ®\n    info.textCount = res.userNovels[`${info.novelId}`].textCount\n    info.description = res.description\n    info.coverUrl = util.urlCoverUrl(res.coverUrl)\n    info.detailedUrl = util.urlNovelUrl(info.novelId)\n    info.catalogUrl = util.urlNovelDetailed(info.novelId)\n    info.createDate = util.dateFormat(res.createDate)\n    info.updateDate = util.dateFormat(res.uploadDate)\n\n    info.readingTime = `${res.userNovels[`${info.novelId}`].readingTime / 60} åˆ†é’Ÿ`\n    return info\n}\n\nfunction seriesHandler(res) {\n    let info = {}\n    info.seriesId = res.id\n    info.id = info.novelId = res.firstNovelId\n    info.title = res.title.replace(RegExp(/^\\s+|\\s+$/g), \"\")\n    info.userName = res.userName\n    info.tags = res.tags   //åˆå¹¶å½“å‰ç« èŠ‚ tags\n    info.tags.unshift('é•¿ç¯‡')\n    info.textCount = res.publishedTotalCharacterCount\n    info.description = res.caption\n    info.coverUrl = util.urlCoverUrl(res.cover.urls[\"480mw\"]) // 240mw, 480mw, 1200x1200, 128x128, original\n    info.detailedUrl = util.urlSeriesUrl(info.seriesId)\n    info.catalogUrl = util.urlSeriesDetailed(info.seriesId)\n    info.createDate = util.dateFormat(res.createDate)\n    info.updateDate = util.dateFormat(res.updateDate)\n\n    // å‘é€è¯·æ±‚è·å–ç¬¬ä¸€ç«  è·å–æ ‡ç­¾ä¸ç®€ä»‹\n    let firstNovel = {}\n    try {\n        firstNovel = util.getAjaxJson(util.urlNovelDetailed(info.novelId)).body\n        info.tags = info.tags.concat(firstNovel.tags.tags.map(item => item.tag))\n    } catch (e) {  // é˜²æ­¢ç³»åˆ—é¦–ç¯‡æ— æƒé™è·å–\n        firstNovel = util.getAjaxJson(util.urlSeriesNovels(info.seriesId, 30, 0)).body.thumbnails.novel[0]\n        info.id = info.novelId = firstNovel.id\n        info.tags = info.tags.concat(firstNovel.tags)\n    }\n    info.tags = Array.from(new Set(info.tags))\n    if (info.description === \"\") {\n        info.description = firstNovel.description\n    }\n\n    info.readingTime = `${res.publishedReadingTime / 60} åˆ†é’Ÿ`\n    info.latestChapter = \"\"\n    info.language = res.language\n    info.totalChapterNum = info.total = res.total  //ç« èŠ‚æ€»æ•°\n    info.latestNovelId = res.latestNovelId\n    return info\n}\n\nfunction novelHandler(res){\n    let info = {}\n    if (res.firstNovelId !== undefined) {\n        info = seriesHandler(res)\n    } else {\n        info = oneShotHandler(res)\n    }\n    info.tags = info.tags.join(\",\")\n    if (util.MORE_INFO_IN_DESCRIPTION) {\n        info.description = `\\nä¹¦åï¼š${info.title}\\nä½œè€…ï¼š${info.userName}\\næ ‡ç­¾ï¼š${info.tags}\\nä¸Šä¼ ï¼š${info.createDate}\\næ›´æ–°ï¼š${info.updateDate}\\nç®€ä»‹ï¼š${info.description}`\n    } else {\n        info.description = `\\n${info.description}\\nä¸Šä¼ æ—¶é—´ï¼š${info.createDate}\\næ›´æ–°æ—¶é—´ï¼š${info.updateDate}`\n    }\n    return info\n}\n\n(function (res) {\n    res = util.getNovelResSeries(result)\n    // res = util.getNovelRes(result)\n    // if (res.seriesNavData !== null) {     // ä½¿ç”¨ util.getNovelRes(result) æ—¶\n    //     res = util.getAjaxJson(util.urlSeriesDetailed(res.seriesNavData.seriesId)).body\n    // }\n    try {\n        return novelHandler(res)\n    } catch (e) {\n        java.log(e)\n        java.log(`å— Pixiv çš„é™åˆ¶ï¼Œæ— æ³•è·å–å½“å‰å°è¯´æ•°æ®`)\n    }\n})();",
            "intro": "description",
            "kind": "tags",
            "lastChapter": "latestChapter",
            "name": "title",
            "tocUrl": "catalogUrl",
            "wordCount": "textCount"
        },
        "ruleContent": {
            "content": "@js:\nvar util = objParse(String(java.get(\"util\")))\n\nfunction objParse(obj) {\n    return JSON.parse(obj, (n, v) => {\n        if (typeof v == \"string\" && v.match(\"()\")) {\n            return eval(`(${v})`)\n        }\n        return v;\n    })\n}\n\nfunction getContent(res) {\n    let content = res.content\n    // åœ¨æ­£æ–‡å†…éƒ¨æ·»åŠ å°è¯´æè¿°\n    if (util.SHOW_NOVEL_COMMENTS === true && res.description !== \"\") {\n        content = res.description + \"\\n\" + \"â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”\\n\".repeat(2) + content\n    }\n\n    // è·å– [uploadedimage:] çš„å›¾ç‰‡é“¾æ¥\n    let hasEmbeddedImages = res.textEmbeddedImages !== undefined && res.textEmbeddedImages !== null\n    if (hasEmbeddedImages) {\n        Object.keys(res.textEmbeddedImages).forEach((key) => {\n            content = content.replace(`[uploadedimage:${key}]`, `<img src=\"${res.textEmbeddedImages[key].urls.original}\">`)\n        })\n    }\n\n    // è·å– [pixivimage:] çš„å›¾ç‰‡é“¾æ¥ [pixivimage:1234] [pixivimage:1234-1]\n    let matched = content.match(RegExp(/\\[pixivimage:(\\d+)-?(\\d+)]/gm))\n    if (matched) {\n        for (let i in matched) {\n            let illustId, order\n            let matched2 = matched[i].match(RegExp(\"(\\\\d+)-?(\\\\d+)\"))\n            let temp = matched2[0].split(\"-\")\n            illustId = temp[0]\n            if (temp.length >= 2) {\n                order = temp[1]\n            }\n            content = content.replace(`${matched[i]}`, `<img src=\"${util.urlIllustOriginal(illustId, order)}\">`)\n        }\n    }\n\n    // æ›¿æ¢ Pixiv åˆ†é¡µæ ‡è®°ç¬¦å· [newpage]\n    matched = content.match(RegExp(/[ ã€€]*\\[newpage][ ã€€]*/gm))\n    if (matched) {\n        for (let i in matched) {\n            content = content.replace(`${matched[i]}`, `${\"<p>â€‹<p/>\".repeat(3)}`)\n        }\n    }\n\n    // æ›¿æ¢ Pixiv ç« èŠ‚æ ‡è®°ç¬¦å· [chapter:]\n    matched = content.match(RegExp(/\\[chapter:(.*?)]/gm))\n    if (matched) {\n        for (let i in matched) {\n            let matched2 = matched[i].match(/\\[chapter:(.*?)]/m)\n            let chapter = matched2[1].trim()\n            content = content.replace(`${matched[i]}`, `${chapter}<p>â€‹<p/>`)\n        }\n    }\n\n    // æ›¿æ¢ Pixiv è·³è½¬é¡µé¢æ ‡è®°ç¬¦å· [[jump:]]\n    matched = content.match(RegExp(/\\[jump:(\\d+)]/gm))\n    if (matched) {\n        for (let i in matched) {\n            let page = matched[i].match(/\\d+/)\n            content = content.replace(`${matched[i]}`, `\\n\\nè·³è½¬è‡³ç¬¬${page}èŠ‚`)\n        }\n    }\n\n    // æ›¿æ¢ Pixiv é“¾æ¥æ ‡è®°ç¬¦å· [[jumpuri: > ]]\n    matched = content.match(RegExp(/\\[\\[jumpuri:(.*?)>(.*?)]]/gm))\n    if (matched) {\n        for (let i in matched) {\n            let matched2 = matched[i].match(/\\[\\[jumpuri:(.*?)>(.*?)]]/m)\n            let matchedText = matched2[0]\n            let urlName = matched2[1].trim()\n            let urlLink = matched2[2].trim()\n            // é˜…è¯»ä¸æ”¯æŒè¶…é“¾æ¥\n            //content = content.replace(`${matchedText}`, `<a href=${urlLink}>${urlName}</a>`)\n            if (urlLink === urlName) {\n                content = content.replace(`${matchedText}`, `${urlName}`)\n            } else {\n                content = content.replace(`${matchedText}`, `${urlName}: ${urlLink}`)\n            }\n        }\n    }\n\n    // æ›¿æ¢ Pixiv æ³¨éŸ³æ ‡è®°ç¬¦å· [[rb: > ]]\n    matched = content.match(RegExp(/\\[\\[rb:(.*?)>(.*?)]]/gm))\n    if (matched) {\n        for (let i in matched) {\n            let matched2 = matched[i].match(/\\[\\[rb:(.*?)>(.*?)]]/m)\n            let matchedText = matched2[0]\n            let kanji = matched2[1].trim()\n            let kana = matched2[2].trim()\n\n            if (!util.REPLACE_BOOK_TITLE_MARKS) {\n                // é»˜è®¤æ›¿æ¢æˆï¼ˆæ‹¬å·ï¼‰\n                content = content.replace(`${matchedText}`, `${kanji}ï¼ˆ${kana}ï¼‰`)\n            } else {\n                let reg = RegExp(\"[\\\\u4E00-\\\\u9FFF]+\", \"g\");\n                if (reg.test(kana)) {\n                    // kanaä¸ºä¸­æ–‡ï¼Œåˆ™æ›¿æ¢å›ã€Šä¹¦åå·ã€‹\n                    content = content.replace(`${matchedText}`, `${kanji}ã€Š${kana}ã€‹`)\n                } else {\n                    // é˜…è¯»ä¸æ”¯æŒ <ruby> <rt> æ³¨éŸ³\n                    // content = content.replace(`${matchedText}`, `<ruby>${kanji}<rt>${kana}</rt></ruby>`)\n                    content = content.replace(`${matchedText}`, `${kanji}ï¼ˆ${kana}ï¼‰`)\n                }\n            }\n        }\n    }\n\n    if (util.SHOW_NOVEL_COMMENTS === true) {\n        return content + getComment(res)\n    } else {\n        return content\n    }\n}\n\nfunction getComment(res) {\n    let comments = \"\"\n    let resp = util.getAjaxJson(util.urlNovelComments(res.id, 0, 50))\n    if (resp.error === true){\n        return \"\"\n    }\n    resp.body.comments.forEach(comment =>{\n        comments += `${comment.userName}ï¼š${comment.comment}\\n`\n        if (comment.hasReplies === true) {\n            let resp = util.getAjaxJson(util.urlNovelCommentsReply(comment.id, 1))\n            if (resp.error === true) {\n                return \"\"\n            }\n            resp.body.comments.reverse().forEach(reply =>{\n                comments += `${reply.userName}(â¤´ï¸${reply.replyToUserName})ï¼š${reply.comment}\\n`\n            })\n        }\n    })\n    if (comments) {\n        comments = \"\\n\" + \"â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”\\n\".repeat(2) + \"ç« èŠ‚è¯„è®ºï¼š\\n\" + comments\n    }\n    return comments\n}\n\n(function () {\n    return getContent(util.getNovelRes(result))\n})()\n",
            "imageStyle": "SINGLE"
        },
        "ruleExplore": {
            "author": "userName",
            "bookList": "@js:\nvar util = objParse(String(java.get(\"util\")))\nvar seriesSet = new Set();  // å­˜å‚¨seriesID æœ‰BUGæ— æ³•å¤„ç†ç¿»é¡µ\n\nfunction objParse(obj) {\n    return JSON.parse(obj, (n, v) => {\n        if (typeof v == \"string\" && v.match(\"()\")) {\n            return eval(`(${v})`)\n        }\n        return v;\n    })\n}\n\nfunction handlerFactory() {\n    let cookie = String(java.getCookie(\"https://www.pixiv.net/\", null))\n    if (cookie === null || cookie === undefined || cookie === \"\") {\n        return handlerNoLogin()\n    }\n    if (baseUrl.indexOf(\"/bookmark\") !== -1) {\n        return handlerBookMarks()\n    }\n    if (baseUrl.indexOf(\"/top\") !== -1) {\n        return handlerRecommend()\n    }\n    if (baseUrl.indexOf(\"/follow_latest\") !== -1) {\n        return handlerFollowLatest()\n    }\n    if (baseUrl.indexOf(\"/watch_list\") !== -1) {\n        return handlerWatchList()\n    }\n    if (baseUrl.indexOf(\"/ranking\") !== -1) {\n        return handlerRanking()\n    }\n    if (baseUrl.indexOf(\"/discovery\") !== -1) {\n        return handlerDiscovery()\n    }\n}\n\nfunction handlerNoLogin() {\n    return () => {\n        java.longToast(\"æ­¤åŠŸèƒ½éœ€è¦åœ¨ä¹¦æºç™»å½•åæ‰èƒ½ä½¿ç”¨\")\n        util.sleep(2000)\n        java.longToast('å‘ç°é¡µ - é•¿æŒ‰\"Pixiv\" - ç™»å½• - ç™»å½•è´¦å·')\n        return []\n    }\n}\n\n// æ¨èå°è¯´\nfunction handlerRecommend() {\n    return () => {\n        let res = JSON.parse(result)\n        const recommend = res.body.page.recommend\n        const novels = res.body.thumbnails.novel\n        let nidSet = new Set(recommend.ids)\n        // java.log(nidSet.size)\n        let list = novels.filter(novel => nidSet.has(String(novel.id)))\n        // java.log(`è¿‡æ»¤ç»“æœ:${JSON.stringify(list)}`)\n        return util.formatNovels(util.handNovels(util.combineNovels(list)))\n    }\n}\n\n// æ”¶è—å°è¯´\nfunction handlerBookMarks() {\n    return () => {\n        let res = JSON.parse(result).body.works\n        if (res === undefined || res.length === 0) {\n            //æµç¨‹æ— æ³•æœ¬ç¯èŠ‚ä¸­æ­¢ åªèƒ½äº¤ç»™ä¸‹ä¸€æµç¨‹å¤„ç†\n            return []\n        }\n        return util.formatNovels(util.handNovels(res))\n    }\n}\n\n//å…³æ³¨ä½œè€…ï¼Œè¿‘æœŸå°è¯´\nfunction handlerFollowLatest() {\n    return () => {\n        let res = JSON.parse(result)\n        return util.formatNovels(util.handNovels(util.combineNovels(res.body.thumbnails.novel)))\n    }\n}\n\n//æ¨èå°è¯´\nfunction handlerDiscovery() {\n    return () => {\n        let res = JSON.parse(result)\n        return util.formatNovels(util.handNovels(util.combineNovels(res.body.novels)))\n    }\n}\n\n// è¿½æ›´åˆ—è¡¨\nfunction handlerWatchList(){\n    return () => {\n        let res = JSON.parse(result)\n        return util.formatNovels(util.handNovels(res.body.thumbnails.novelSeries))\n    }\n}\n\n// æ’è¡Œæ¦œ\nfunction handlerRanking(){\n    return () => {\n        let novels = [], novelIds = []\n        // let result = result + java.ajax(`${baseUrl}&p=2`)  // æ­£åˆ™è·å–ç½‘å€ä¸­çš„ novelId\n        let matched = result.match(RegExp(/\\/novel\\/show\\.php\\?id=\\d{5,}/gm))\n        for (let i in matched) {\n            let novelId = matched[i].match(RegExp(/\\d{5,}/))[0]\n            if (novelIds.indexOf(novelId) === -1) {\n                novelIds.push(novelId)\n            }\n        }\n        novelIds.forEach(novelId => {\n            java.log(util.urlNovelDetailed(novelId))\n            let res = util.getAjaxJson(util.urlNovelDetailed(novelId))\n            if (res.error !== true) {\n                novel = res.body\n                novel.updateDate = novel.uploadDate\n                novel.tags = novel.tags.tags.map(item => item.tag)\n                novel.textCount = novel.userNovels[`${novelId}`].textCount\n                if (novel.seriesNavData !== null) {\n                    novel.seriesId = novel.seriesNavData.seriesId\n                    novel.title = novel.seriesNavData.title\n                }\n                novels.push(novel)\n            } else {\n                java.log(JSON.stringify(res))\n            }\n        })\n        return util.formatNovels(util.handNovels(util.combineNovels(novels)))\n    }\n}\n\n(() => {\n    return handlerFactory()()\n})()",
            "bookUrl": "detailedUrl",
            "coverUrl": "coverUrl",
            "intro": "description",
            "kind": "tags",
            "lastChapter": "latestChapter",
            "name": "title",
            "wordCount": "textCount"
        },
        "ruleSearch": {
            "author": "userName",
            "bookList": "@js:\nvar util = objParse(String(java.get(\"util\")))\n\nfunction objParse(obj) {\n    return JSON.parse(obj, (n, v) => {\n        if (typeof v == \"string\" && v.match(\"()\")) {\n            return eval(`(${v})`)\n        }\n        return v;\n    })\n}\n\nvar first = true;\n// å­˜å‚¨seriesID\nvar seriesSet = {\n    keywords: \"Pixiv:Search\",\n    has: (value) => {\n        let page = Number(java.get(\"page\"))\n        if (page === 1 && first) {\n            first = false\n            cache.deleteMemory(this.keywords)\n            return false\n        }\n\n        let v = cache.getFromMemory(this.keywords)\n        if (v === undefined || v === null) {\n            return false\n        }\n        let set = new Set(JSON.parse(v))\n        return set.has(value)\n    },\n\n    add: (value) => {\n        let v = cache.getFromMemory(this.keywords)\n        if (v === undefined || v === null) {\n            cache.putMemory(this.keywords, JSON.stringify([value]))\n\n        } else {\n            let arr = JSON.parse(v)\n            if (typeof arr === \"string\") {\n                arr = Array(arr)\n            }\n            arr.push(value)\n            cache.putMemory(this.keywords, JSON.stringify(arr))\n        }\n    },\n};\n\nfunction isLogin() {\n    let cookie = String(java.getCookie(\"https://www.pixiv.net/\", null))\n    return typeof cookie === \"string\" && cookie !== \"\"\n}\n\nfunction getUserNovels() {\n    if (!isLogin()) {\n        return []\n    }\n\n    let username = String(java.get(\"key\"))\n    let html = java.ajax(util.urlSearchUser(username))\n    // java.log(html)\n    // ä»…åŒ¹é…æœ‰æŠ•ç¨¿ä½œå“çš„ç”¨æˆ·\n    let match = html.match(new RegExp(`\"userIds\":\\\\[(?:(?:\\\\d+,?)+)]`))\n    // java.log(JSON.stringify(match))\n    if (match === null || match.length === 0) {\n        return []\n    }\n\n    match = JSON.stringify(match).replace(\"\\\\\",\"\").split(\",\")\n    // java.log(JSON.stringify(match))\n    let regNumber = new RegExp(\"\\\\d+\")\n    let uidList = match.map(v => {\n        return v.match(regNumber)[0]\n    })\n\n    // ä»…é™3ä¸ªä½œè€…\n    java.log(JSON.stringify(uidList))\n    if (uidList.length >= 3) {\n        uidList.length = 3\n    }\n\n    let novels = []\n    let page = Number(java.get(\"page\"))\n\n    uidList.forEach(id => {\n        // è·å–ç³»åˆ—å°è¯´\n        let resp = util.getAjaxJson(util.urlUserAllWorks(id))\n        // java.log(util.urlUserAllWorks(id))\n        if (resp.error === true) {\n            return []\n        }\n        // resp.body.novelSeries.forEach(novel =>{\n        //     novel.isOneshot = false\n        //     novel.createDate = novel.createDateTime\n        //     novel.updateDate = novel.updateDateTime\n        // })\n        // novels = novels.concat(resp.body.novelSeries)\n\n        // è·å–å•ç¯‡å°è¯´\n        let novelsId = Object.keys(resp.body.novels).reverse().slice((page - 1) * 20, page * 20)\n        let url = util.urlNovelsDetailed(id, novelsId)\n        util.debugFunc(() => {\n            java.log(`å‘é€è·å–ä½œè€…å°è¯´çš„Ajaxè¯·æ±‚:${url}`)\n        })\n        let userNovels = util.getWebviewJson(url, html => {\n            return (html.match(new RegExp(\">\\\\{.*?}<\"))[0].replace(\">\", \"\").replace(\"<\", \"\"))\n        }).body\n        // let userNovels = util.getAjaxJson(url).body\n        // è·å–å¯¹åº”çš„å°è¯´ è¯¥åºåˆ—æ˜¯æŒ‰ç…§idæ’åº\n        // åè½¬ä»¥æŒ‰ç…§æ›´æ–°æ—¶é—´æ’åº\n        novels = novels.concat(Object.values(userNovels).reverse())\n    })\n\n    util.debugFunc(() => {\n        java.log(`è·å–ç”¨æˆ·æœç´¢å°è¯´ç»“æŸ`)\n    })\n    return novels\n}\n\nfunction getSeries(){\n    if (JSON.parse(result).error !== true){\n        return JSON.parse(result).body.novel.data\n    } else {\n        return []\n    }\n}\n\nfunction getNovels(){\n    let MAXPAGES = 3, novels = []\n    let novelName = String(java.get(\"key\"))\n    java.log(util.urlSearchNovel(novelName, 1))\n    let resp = util.getAjaxJson(util.urlSearchNovel(novelName, 1))\n    if (resp.error === true) {\n        return []\n    }\n    novels = novels.concat(resp.body.novel.data)\n    for (let i = Number(java.get(\"page\")) + 1; i < resp.body.novel.lastPage, i < MAXPAGES; i++) {\n        java.log(`é¡µé¢ï¼š${i}`)\n        let resp = util.getAjaxJson(util.urlSearchNovel(novelName, i))\n        if (resp.error === true) {\n            return []\n        }\n        novels = novels.concat(resp.body.novel.data)\n    }\n    return novels\n}\n\nfunction getLinkNovels() {\n    try {\n        return util.getNovelRes(String(java.get(\"key\")))\n    } catch (e) {\n        return []\n    }\n}\n\n(() => {\n    let novels = []\n    novels = novels.concat(getNovels())\n    novels = novels.concat(getSeries())\n    novels = novels.concat(getUserNovels())\n    novels = novels.concat(getLinkNovels())\n    // java.log(JSON.stringify(novels))\n    // è¿”å›ç©ºåˆ—è¡¨ä¸­æ­¢æµç¨‹\n    if (novels.length === 0) {\n        return []\n    }\n    return util.formatNovels(util.handNovels(novels))\n})();",
            "bookUrl": "detailedUrl",
            "checkKeyWord": "æµ‹è¯•é¡µé¢",
            "coverUrl": "coverUrl",
            "intro": "description",
            "kind": "tags",
            "lastChapter": "latestChapter",
            "name": "title",
            "wordCount": "textCount"
        },
        "ruleToc": {
            "chapterList": "@js:\nvar util = objParse(String(java.get(\"util\")))\n\nfunction objParse(obj) {\n    return JSON.parse(obj, (n, v) => {\n        if (typeof v == \"string\" && v.match(\"()\")) {\n            return eval(`(${v})`)\n        }\n        return v;\n    })\n}\n\nfunction oneShotHandler(res) {\n    res.textCount = res.userNovels[`${res.id}`].textCount\n    res.createDate = util.timeTextFormat(res.createDate)\n    return [{\n        title: res.title.replace(RegExp(/^\\s+|\\s+$/g), \"\"),\n        chapterUrl: util.urlNovel(res.id),\n        chapterInfo: `${res.createDate}ã€€ã€€${res.textCount}å­—`\n    }]\n}\n\nfunction seriesHandler(res) {\n    const limit = 30\n    let returnList = []\n    let seriesID = 0, allChaptersCount = 0\n    if (res.seriesNavData !== undefined) {\n        seriesID = res.seriesNavData.seriesId\n        allChaptersCount = util.getAjaxJson(util.urlSeriesDetailed(seriesID)).body.total\n    } else {\n        seriesID = res.id\n        allChaptersCount = res.total\n    }\n    util.debugFunc(() => {\n        java.log(`æœ¬ç³»åˆ— ${seriesID} ä¸€å…±æœ‰${allChaptersCount}ç« `);\n    })\n\n    //å‘é€è¯·æ±‚è·å¾—ç›¸åº”æ•°é‡çš„ç›®å½•åˆ—è¡¨\n    function sendAjaxForGetChapters(lastIndex) {\n        res = util.getAjaxJson(util.urlSeriesNovels(seriesID, limit, lastIndex)).body.thumbnails.novel\n        res.forEach(v => {\n            v.title = v.title.replace(RegExp(/^\\s+|\\s+$/g), \"\").replace(RegExp(/ï¼ˆ|ï¼‰|-/g), \"\")\n            v.chapterUrl = util.urlNovel(v.id)\n            v.updateDate = util.timeTextFormat(v.createDate)\n            v.chapterInfo = `${v.updateDate}ã€€ã€€${v.textCount}å­—`\n            util.debugFunc(() => {\n                java.log(`${v.title}`)\n            })\n        })\n        return res;\n    }\n\n    //é€»è¾‘æ§åˆ¶è€… ä¹Ÿå°±æ˜¯ä½¿ç”¨ä¸Šé¢å®šä¹‰çš„ä¸¤ä¸ªå‡½æ•°æ¥åšå¯¹åº”åŠŸèƒ½\n    //è¦çˆ¬å–çš„æ€»æ¬¡æ•°\n    let max = (allChaptersCount / limit) + 1\n    for (let i = 0; i < max; i++) {\n        //java.log(\"içš„å€¼:\"+i)\n        let list = sendAjaxForGetChapters(i * limit);\n        //å–å‡ºæ¯ä¸ªå€¼\n        returnList = returnList.concat(list)\n        // java.log(JSON.stringify(returnList))\n    }\n    return returnList\n}\n\n(function (res) {\n    res = util.getNovelResSeries(result)\n    if (res.firstNovelId !== undefined || res.seriesNavData !== null) {\n        return seriesHandler(res)\n    } else {\n        return oneShotHandler(res)\n    }\n})()",
            "chapterName": "title",
            "chapterUrl": "chapterUrl",
            "isPay": "false",
            "isVip": "true",
            "updateTime": "chapterInfo"
        },
        "searchUrl": "@js:\njava.put(\"page\",page);java.put(\"key\",key);\n`https://www.pixiv.net/ajax/search/novels/${encodeURI(key)}?word=${encodeURI(key)}&order=date_d&mode=all&p=${page}&s_mode=s_tag&gs=1&lang=zh`;",
        "variableComment": "â¤ï¸ æŸ¥çœ‹ä»–äººæ”¶è—ï¼š\nå‘ç°ï¼šé•¿æŒ‰\"Pixiv\"ï¼Œç¼–è¾‘ï¼Œå³ä¸Šè§’èœå•ï¼Œè®¾ç½®æºå˜é‡\nè®¾ç½®æºå˜é‡ï¼šè¾“å…¥ä½œè€…IDï¼Œä¸€è¡Œä¸€ä¸ªï¼Œå¯æ·»åŠ ä½œè€…åï¼Œä¿å­˜\nå‘ç°ï¼šé•¿æŒ‰\"Pixiv\"ï¼Œåˆ·æ–°ï¼ŒæŸ¥çœ‹ä»–äººæ”¶è—\nä»¥ä¸‹å†…å®¹ä¸ºæºå˜é‡æ¨¡æ¿ï¼š\n12345 ä½œè€…å\n67890 //ä½œè€…å\n\n\nâš™ï¸ è‡ªå®šä¹‰ä¹¦æºè®¾ç½®ï¼š\nâš™ï¸ è‡ªå®šä¹‰è®¾ç½®ï¼šè¯·åœ¨åŸºæœ¬-å˜é‡è¯´æ˜å¤„ä¿®æ”¹ä»£ç \nâš™ï¸ è‡ªå®šä¹‰è®¾ç½®ï¼šå°† true æ”¹ä¸º falseï¼Œæˆ–ç›¸å\nâš ï¸ è®¾ç½®æºå˜é‡ã€æ— æ³•ã€‘æ›´æ”¹ä¹¦æºè‡ªå®šä¹‰è®¾ç½®\nâš ï¸ æ³¨æ„ä¸è¦æ·»åŠ æˆ–åˆ é™¤å°¾éšé€—å·\",\"\nâš ï¸ å‘ç°é¡µéœ€è¦é•¿æŒ‰\"Pixiv\"ï¼Œæ‰‹åŠ¨åˆ·æ–°\nä»¥ä¸‹å†…å®¹ä¸ºä¹¦æºè®¾ç½®ï¼š\n{\n\"SHOW_GENERAL_NOVELS_RANK\": false,\n\"MORE_INFO_IN_DESCRIPTION\": false,\n\"SHOW_ORIGINAL_NOVEL_LINK\": true,\n\"REPLACE_BOOK_TITLE_MARKS\": true,\n\"SHOW_NOVEL_CAPTIONS\": true,\n\"SHOW_NOVEL_COMMENTS\": true,\n\"DEBUG\": false\n}\n\n// SHOW_GENERAL_NOVELS_RANK\n// å‘ç°ï¼šæ˜¾ç¤ºä¸€èˆ¬å°è¯´æ’è¡Œæ¦œ\n// MORE_INFO_IN_DESCRIPTION\n// è¯¦æƒ…ï¼šä¹¦ç±ç®€ä»‹æ˜¾ç¤ºæ›´å¤šä¿¡æ¯\n// SHOW_ORIGINAL_NOVEL_LINK\n// ç›®å½•ï¼šæ˜¾ç¤ºæºé“¾æ¥ï¼Œä½†ä¼šå¢åŠ è¯·æ±‚æ¬¡æ•°\n// REPLACE_BOOK_TITLE_MARKS\n// æ­£æ–‡ï¼šæ³¨éŸ³å†…å®¹ä¸ºæ±‰å­—æ—¶ï¼Œæ›¿æ¢ä¸ºä¹¦åå·\n// SHOW_NOVEL_CAPTIONS\n// æ­£æ–‡ï¼šç« é¦–æ˜¾ç¤ºå°è¯´æè¿°\n// SHOW_NOVEL_COMMENTS\n// æ­£æ–‡ï¼šç« å°¾æ˜¾ç¤ºå°è¯´è¯„è®º\n// DEBUG\n// è°ƒè¯•æ¨¡å¼\n\n",
        "weight": 0
    },
    {
        "bookSourceComment": "Pixiv ä¹¦æºï¼ˆå•ç¯‡ï¼‰ï¼ˆæ›´æ–°ğŸ“†ï¼š2025-02-15ï¼‰\n\nä½¿ç”¨è¯´æ˜ï¼šä¸¤ä¹¦æºåŠŸèƒ½å®Œå…¨ç›¸åŒï¼Œå¯ç”¨å…¶ä¸€å³å¯  \nå¯ç”¨åŠŸèƒ½ï¼šâœ…æœç´¢âœ…å‘ç°âœ…æ·»åŠ ç½‘å€âœ…è®¢é˜…æº  \næœç´¢å°è¯´ï¼šâœ…å•ç¯‡âœ…ç³»åˆ—âœ…ä½œè€…âœ…æ ‡ç­¾âœ…é“¾æ¥  \nå‘ç°å°è¯´ï¼šâœ…å…³æ³¨âœ…è¿½æ›´âœ…æ¨èâœ…å‘ç°âœ…æ”¶è—  \næ·»åŠ ç½‘å€ï¼šâœ…Pixiv å°è¯´é“¾æ¥âœ…Pixiv ç³»åˆ—é“¾æ¥  \næœç´¢ç½‘å€ï¼šâœ…Pixiv é“¾æ¥âœ…Linpx é“¾æ¥  \nè®¢é˜…ç”¨æ³•ï¼šç‚¹å‡»è®¢é˜…æºæ‰“å¼€å°è¯´/ç³»åˆ—å°è¯´ï¼Œã€åˆ·æ–°ã€‘ï¼Œç‚¹å‡»ã€åŠ å…¥ä¹¦æ¶ã€‘æŒ‰é’®ï¼Œæ·»åŠ å°è¯´åˆ°ä¹¦æ¶\n\nä¹¦æºå‘å¸ƒï¼šå…½äººé˜…è¯»é¢‘é“ https://t.me/FurryReading\né¡¹ç›®åœ°å€ï¼šhttps://github.com/windyhusky/PixivSource\nä½¿ç”¨æ•™ç¨‹ï¼šhttps://github.com/windyhusky/PixivSource/blob/main/doc/Pixiv.md\n\nè§„åˆ™è®¢é˜…ï¼šImport è®¢é˜…æº\nhttps://cdn.jsdelivr.net/gh/windyhusky/PixivSource@main/import.json\nhttps://raw.githubusercontent.com/windyhusky/PixivSource/main/import.json\n\nâš™ï¸ ä¹¦æºè®¾ç½®ï¼š\nä¹¦æºç®¡ç† - ç¼–è¾‘ä¹¦æº - åŸºæœ¬ - å˜é‡è¯´æ˜ - ä¿®æ”¹å¹¶ä¿å­˜\n\nâ¤ï¸ æŸ¥çœ‹ä»–äººæ”¶è—ï¼š\nå‘ç° - é•¿æŒ‰\"Pixiv\" - ç¼–è¾‘ - å³ä¸Šè§’èœå• - è®¾ç½®æºå˜é‡  \nè®¾ç½®æºå˜é‡ï¼šè¾“å…¥ä½œè€…IDï¼Œä¸€è¡Œä¸€ä¸ªï¼Œå¯æ·»åŠ ä½œè€…åï¼Œä¿å­˜  \nå‘ç° - é•¿æŒ‰\"Pixiv\" - åˆ·æ–° - æŸ¥çœ‹ä»–äººæ”¶è—",
        "bookSourceGroup": "ğŸ” Pixiv",
        "bookSourceName": "Pixiv å•ç¯‡å°è¯´",
        "bookSourceType": 0,
        "bookSourceUrl": "https://www.pixiv.net",
        "bookUrlPattern": ".*(https?://)?(www\\.)?pixiv\\.net(/ajax)?/novel/(show\\.php\\?id=|series/)?\\d+.*",
        "customOrder": 1,
        "enabled": false,
        "enabledCookieJar": false,
        "enabledExplore": false,
        "exploreUrl": "@js:\ntry {\n    settings = JSON.parse(String(source.variableComment).match(RegExp(/{([\\s\\S]*?)}/gm)))\n    SHOW_GENERAL_NOVELS_RANK = settings.SHOW_GENERAL_NOVELS_RANK  // å‘ç°ï¼šæ’è¡Œæ¦œæ˜¾ç¤ºä¸€èˆ¬å°è¯´\n} catch (e) {\n    SHOW_GENERAL_NOVELS_RANK = false\n}\n\nli = [\n    {\"å…³æ³¨\": \"https://www.pixiv.net/ajax/follow_latest/novel?p={{page}}&mode=all&lang=zh\"},\n    {\"è¿½æ›´\": \"https://www.pixiv.net/ajax/watch_list/novel?p={{page}}&new=1&lang=zh\"},\n    {\"æ¨è\": \"https://www.pixiv.net/ajax/top/novel?mode=all&lang=zh\"},\n    {\"å‘ç°\": \"https://www.pixiv.net/ajax/novel/discovery?mode=all\"},\n    {\"æ”¶è—\": \"https://www.pixiv.net/ajax/user/{{cache.get(\\\"pixiv:uid\\\")}}/novels/bookmarks?tag=&offset={{(page-1)*24}}&limit=24&rest=show&lang=zh\"}\n]\n\nr18 = [\n    {\"\\uD83D\\uDD1E æ’è¡Œæ¦œ\": \"\"},\n    {\"ä»Šæ—¥\": \"https://www.pixiv.net/novel/ranking.php?mode=daily_r18\"},\n    {\"æœ¬å‘¨\": \"https://www.pixiv.net/novel/ranking.php?mode=weekly_r18\"},\n    {\"R18G\": \"https://www.pixiv.net/novel/ranking.php?mode=r18g\"},\n    {\"ç”·æ€§\": \"https://www.pixiv.net/novel/ranking.php?mode=male_r18\"},\n    {\"å¥³æ€§\": \"https://www.pixiv.net/novel/ranking.php?mode=female_r18\"}\n]\n\ngeneral = [\n    {\"\\uD83C\\uDD97 æ’è¡Œæ¦œ\": \"\"},\n    {\"ä»Šæ—¥\": \"https://www.pixiv.net/novel/ranking.php?mode=daily\"},\n    {\"æœ¬å‘¨\": \"https://www.pixiv.net/novel/ranking.php?mode=weekly\"},\n    {\"æœ¬æœˆ\": \"https://www.pixiv.net/novel/ranking.php?mode=monthly\"},\n    {\"ç”·æ€§\": \"https://www.pixiv.net/novel/ranking.php?mode=male\"},\n    {\"å¥³æ€§\": \"https://www.pixiv.net/novel/ranking.php?mode=female\"}\n]\n\nbookmarks = [{\"â¤ï¸ æ”¶è—\": \"\"}]\n\nli = li.concat(r18)\nif (SHOW_GENERAL_NOVELS_RANK === true) {\n    li = li.concat(general)\n}\n// æ·»åŠ ä»–äººæ”¶è—\ntry {\n    authors = String(source.getVariable()).split(\"\\n\")\n    if (authors[0].trim() !== \"\" && authors.length >= 1) {\n        for (let i in authors) {\n            if (authors[i] !== \"\") {\n                let authorId = authors[i].match(RegExp(/\\d+/))[0]\n                let resp = JSON.parse(java.ajax(`https://www.pixiv.net/ajax/user/${authorId}`))\n                if (resp.error !== true) {\n                    let bookmark = {}\n                    bookmark[resp.body.name] = `https://www.pixiv.net/ajax/user/${authorId}/novels/bookmarks?tag=&offset={{(page-1)*24}}&limit=24&rest=show&lang=zh`\n                    bookmarks.push(bookmark)\n                }\n            }\n        }\n        li = li.concat(bookmarks)\n    }\n} catch (e) {\n    java.longToast(\"æºå˜é‡è®¾ç½®æœ‰è¯¯\")\n}\n\nli.forEach(item => {\n    item.title = Object.keys(item)[0]\n    item.url = Object.values(item)[0]\n    delete item[Object.keys(item)[0]]\n    item.style = {}\n    item.style.layout_flexGrow = 1\n    item.style.layout_flexShrink = 1\n    item.style.layout_alignSelf = \"auto\"\n    item.style.layout_wrapBefore = \"false\"\n    if (item.url === \"\") {\n        item.style.layout_flexBasisPercent = 1\n    } else {\n        item.style.layout_flexBasisPercent = -1\n    }\n})\n\nJSON.stringify(li)",
        "header": "{\"referer\":\"https://www.pixiv.net\"}",
        "lastUpdateTime": 1739548800251,
        "loginCheckJs": "var util = {}\n\nfunction objStringify(obj) {\n    return JSON.stringify(obj, (n, v) => {\n        if (typeof v == \"function\")\n            return v.toString();\n        return v;\n    });\n}\n\nfunction publicFunc() {\n    let u = {}, settings = {}\n    java.log(String(source.bookSourceComment).split(\"\\n\")[0]) // è¾“å‡ºä¹¦æºä¿¡æ¯\n    java.log(`æ‰‹åŠ¨æ›´æ–°æ—¶é—´ï¼š${java.timeFormat(source.lastUpdateTime)}`) // è¾“å‡ºä¹¦æºä¿¡æ¯\n    settings = JSON.parse(String(source.variableComment).match(RegExp(/{([\\s\\S]*?)}/gm)))\n    if (settings !== null) {\n        java.log(\"âš™ï¸ ä½¿ç”¨è‡ªå®šä¹‰è®¾ç½®\")\n    } else {\n        settings = {}\n        settings.SHOW_ORIGINAL_NOVEL_LINK = true\n        settings.REPLACE_BOOK_TITLE_MARKS = true\n        settings.MORE_INFO_IN_DESCRIPTION = false\n        settings.SHOW_NOVEL_CAPTIONS = true\n        settings.SHOW_NOVEL_COMMENTS = true\n        settings.DEBUG = false\n        java.log(\"âš™ï¸ ä½¿ç”¨é»˜è®¤è®¾ç½®ï¼ˆæ— è‡ªå®šä¹‰è®¾ç½® æˆ– è‡ªå®šä¹‰è®¾ç½®æœ‰è¯¯ï¼‰\")\n    }\n    u.SHOW_ORIGINAL_NOVEL_LINK = settings.SHOW_ORIGINAL_NOVEL_LINK  // ç›®å½•å¤„æ˜¾ç¤ºå°è¯´æºé“¾æ¥ï¼Œä½†ä¼šå¢åŠ è¯·æ±‚æ¬¡æ•°\n    u.REPLACE_BOOK_TITLE_MARKS = settings.REPLACE_BOOK_TITLE_MARKS  // æ³¨éŸ³å†…å®¹ä¸ºæ±‰å­—æ—¶ï¼Œæ›¿æ¢ä¸ºä¹¦åå·\n    u.MORE_INFO_IN_DESCRIPTION = settings.MORE_INFO_IN_DESCRIPTION  // ä¹¦ç±ç®€ä»‹æ˜¾ç¤ºæ›´å¤šä¿¡æ¯\n    u.SHOW_NOVEL_CAPTIONS = settings.SHOW_NOVEL_CAPTIONS  // ä¹¦ç±ç®€ä»‹æ˜¾ç¤ºæ›´å¤šä¿¡æ¯\n    u.SHOW_NOVEL_COMMENTS = settings.SHOW_NOVEL_COMMENTS  // ä¹¦ç±ç®€ä»‹æ˜¾ç¤ºæ›´å¤šä¿¡æ¯\n    u.DEBUG = settings.DEBUG // è°ƒè¯•æ¨¡å¼\n\n    if (u.DEBUG === true) {\n        java.log(JSON.stringify(settings, null, 4))\n        java.log(`DEBUG = ${u.DEBUG}`)\n    }\n\n\n    u.debugFunc = (func) => {\n        if (util.DEBUG) {\n            func()\n        }\n    }\n    u.cacheGetAndSet = (key, supplyFunc) => {\n        let v = cache.get(key)\n        if (v === undefined || v === null) {\n            v = JSON.stringify(supplyFunc())\n            // ç¼“å­˜10åˆ†é’Ÿ\n            cache.put(key, v, 600)\n        }\n        return JSON.parse(v)\n    }\n    u.getAjaxJson = (url) => {\n        return util.cacheGetAndSet(url, () => {\n            return JSON.parse(java.ajax(url))\n        })\n    }\n    u.getWebviewJson = (url, parseFunc) => {\n        return util.cacheGetAndSet(url, () => {\n            let html = java.webView(null, url, null)\n            return JSON.parse(parseFunc(html))\n        })\n    }\n\n    u.urlNovelUrl = (novelId) => {\n        return `https://www.pixiv.net/novel/show.php?id=${novelId}`\n    }\n    u.urlNovelDetailed = (novelId) => {\n        return `https://www.pixiv.net/ajax/novel/${novelId}`\n    }\n    u.urlNovelsDetailed = (userId, nidList) => {\n        return `https://www.pixiv.net/ajax/user/${userId}/novels?${nidList.map(v => \"ids[]=\" + v).join(\"&\")}`\n    }\n    u.urlNovelComments = (novelId, offset, limit) => {\n        return `https://www.pixiv.net/ajax/novels/comments/roots?novel_id=${novelId}&offset=${offset}&limit=${limit}&lang=zh`\n    }\n    u.urlNovelCommentsReply = (commentId, page) => {\n        return `https://www.pixiv.net/ajax/novels/comments/replies?comment_id=${commentId}&page=${page}&lang=zh`\n    }\n    u.urlNovel = (novelId) => {\n        if (util.SHOW_ORIGINAL_NOVEL_LINK) {\n            return util.urlNovelUrl(novelId)\n        } else {\n            return util.urlNovelDetailed(novelId)\n        }\n    }\n\n    u.urlSeriesUrl = (seriesId) => {\n        return `https://www.pixiv.net/novel/series/${seriesId}`\n    }\n    u.urlSeriesDetailed = (seriesId) => {\n        return `https://www.pixiv.net/ajax/novel/series/${seriesId}?lang=zh`\n    }\n    u.urlSeriesNovels = (seriesId, limit, offset) => {\n        if (limit > 30) {\n            limit = 30\n        }\n        if (limit < 10) {\n            limit = 10\n        }\n        return `https://www.pixiv.net/ajax/novel/series_content/${seriesId}?limit=${limit}&last_order=${offset}&order_by=asc&lang=zh`\n    }\n    u.urlSeries = (seriesId) => {\n        if (util.SHOW_ORIGINAL_NOVEL_LINK) {\n            return util.urlSeriesUrl(seriesId)\n        } else {\n            return util.urlSeriesDetailed(seriesId)\n        }\n    }\n\n    u.urlUserUrl = (userId) => {\n        return `https://www.pixiv.net/users/${userId}`\n    }\n    u.urlUserDetailed = (userId) => {\n        return `https://www.pixiv.net/ajax/user/${userId}`\n    }\n    u.urlUserAllWorks = (userId) => {\n        return `https://www.pixiv.net/ajax/user/${userId}/profile/all?lang=zh`\n    }\n\n    u.urlSearchNovel = (novelName, page) =>{\n        return `https://www.pixiv.net/ajax/search/novels/${encodeURI(novelName)}?word=${encodeURI(novelName)}&order=date_d&mode=all&p=${page}&s_mode=s_tag&lang=zh`\n    }\n    u.urlSearchSeries = (seriesName, page) => {\n        return`https://www.pixiv.net/ajax/search/novels/${encodeURI(seriesName)}?word=${encodeURI(seriesName)}&order=date_d&mode=all&p=${page}&s_mode=s_tag&gs=1&lang=zh`\n    }\n    // å®Œå…¨åŒ¹é…ç”¨æˆ·å\n    u.urlSearchUser = (userName) => {\n        return `https://www.pixiv.net/search/users?nick=${encodeURI(userName)}&s_mode=s_usr&nick_mf=1`\n    }\n\n    u.urlCoverUrl = (url) => {\n        return `${url}, {\"headers\": {\"Referer\":\"https://www.pixiv.net/\"}}`\n    }\n    u.urlIllustUrl = (illustId) => {\n        return `https://www.pixiv.net/artworks/${illustId}`\n    }\n    u.urlIllustDetailed = (illustId) => {\n        return `https://www.pixiv.net/ajax/illust/${illustId}?lang=zh`\n    }\n    u.urlIllustOriginal = (illustId, order) => {\n        let illustOriginal = util.getAjaxJson(util.urlIllustDetailed(illustId)).body.urls.original\n        if (order >= 1) {\n            illustOriginal = illustOriginal.replace(`_p0`, `_p${order - 1}`)\n        }\n        return illustOriginal\n    }\n\n    u.urlSeriesIllustsUrl = (userId, seriesId) => {\n        return `https://www.pixiv.net/user/${userId}/series/${seriesId}`\n    }\n    u.urlSeriesIllustsDetailed = (seriesId) => {\n        return `https://www.pixiv.net/ajax/series/${seriesId}?p=1&lang=zh`\n    }\n\n    // å°†å¤šä¸ªé•¿ç¯‡å°è¯´è§£æä¸ºä¸€æœ¬ä¹¦\n    u.combineNovels = function (novels) {\n        return novels.filter(novel => {\n            // å•æœ¬ç›´æ¥è§£æä¸ºä¸€æœ¬ä¹¦\n            if (novel.seriesId === undefined || novel.seriesId === null) {\n                return true\n            }\n            // é›†åˆä¸­æ²¡æœ‰è¯¥ç³»åˆ—è§£æä¸ºä¸€æœ¬ä¹¦\n            if (!seriesSet.has(novel.seriesId)) {\n                seriesSet.add(novel.seriesId)\n                return true\n            }\n            return false\n        })\n    }\n\n    // å¤„ç† novels åˆ—è¡¨\n    u.handNovels = function (novels) {\n        novels.forEach(novel => {\n            // å¤„ç†æ­£æ–‡ tag\n            if (!(novel.tags instanceof Array)) {\n                novel.tags = novel.tags.tags.map(item => item.tag)\n                novel.updateDate = novel.uploadDate\n                if (novel.seriesNavData !== null){\n                    novel.seriesId = novel.seriesNavData.seriesId\n                }\n            }\n            if (novel.tags === undefined || novel.tags === null) {\n                novel.tags = []\n            }\n            // novel.id = novel.id\n            // novel.title = novel.title\n            // novel.userName = novel.userName\n            if (novel.isOneshot !== undefined) { // æœç´¢ç³»åˆ—\n                if (novel.isOneshot === true) {\n                    novel.seriesId = undefined\n                    novel.id = novel.novelId  // è·å–çœŸæ­£çš„ novelId\n                } else {  //ç³»åˆ—\n                    novel.seriesId = novel.id  // è·å–ç³»åˆ—å°è¯´id\n                    // novel.id = novel.latestEpisodeId  // æœ€è¿‘ä¸€ç¯‡\n                }\n                novel.textCount = novel.textLength\n                novel.description = novel.caption\n                novel.coverUrl = novel.cover.urls[\"480mw\"]\n                if (novel.createDate === undefined) {  // å…¼å®¹æœç´¢ä½œè€…è·å–è·å–ç³»åˆ—å°è¯´\n                    novel.createDate = novel.createDateTime\n                    novel.updateDate = novel.updateDateTime\n                }\n\n            } else {  // æœç´¢ä½œè€…ï¼Œå‘ç°æ’è¡Œæ¦œ\n                // novel.textCount = novel.textCount\n                // novel.description = novel.description\n                if (novel.coverUrl === undefined) {  // å…¼å®¹å‘ç°æ’è¡Œæ¦œ\n                    novel.coverUrl = novel.url\n                }\n                // novel.createDate = novel.createDate\n                // novel.updateDate = novel.updateDate\n            }\n\n            if (novel.seriesId === undefined || novel.seriesId === null) {  // å•ç¯‡\n                novel.tags.unshift(\"å•æœ¬\")\n                novel.latestChapter = novel.title\n                novel.detailedUrl = util.urlNovelDetailed(novel.id)\n            } else { // ç³»åˆ—\n                // novel.seriesId = novel.seriesId\n                let series = util.getAjaxJson(util.urlSeriesDetailed(novel.seriesId)).body\n                novel.id = series.firstNovelId\n                novel.title = series.title\n                // novel.userName = novel.userName\n                novel.tags = series.tags\n                novel.textCount = series.publishedTotalCharacterCount\n                // novel.lastChapter = util.getAjaxJson(util.urlNovelDetailed(series.lastNovelId)).body.title\n                novel.description = series.caption\n                novel.coverUrl = series.cover.urls[\"480mw\"]\n                novel.detailedUrl = util.urlSeriesDetailed(novel.seriesId)\n\n                // å‘é€è¯·æ±‚è·å–ç¬¬ä¸€ç«  è·å–æ ‡ç­¾ä¸ç®€ä»‹\n                let firstNovel = {}\n                try {\n                    firstNovel = util.getAjaxJson(util.urlNovelDetailed(series.firstNovelId)).body\n                    novel.tags = novel.tags.concat(firstNovel.tags.tags.map(item => item.tag))\n                } catch (e) {  // é˜²æ­¢ç³»åˆ—é¦–ç¯‡æ— æƒé™è·å–\n                    firstNovel = util.getAjaxJson(util.urlSeriesNovels(novel.seriesId, 30, 0)).body.thumbnails.novel[0]\n                    novel.id = novel.firstNovelId = firstNovel.id\n                    novel.tags = novel.tags.concat(firstNovel.tags)\n                }\n                novel.tags.unshift(\"é•¿ç¯‡\")\n                novel.tags = Array.from(new Set(novel.tags))\n                if (novel.description === \"\") {\n                    novel.description = firstNovel.description\n                }\n            }\n        })\n        util.debugFunc(() => {\n            java.log(`å¤„ç†å°è¯´å®Œæˆ`)\n        })\n        return novels\n    }\n\n    // å°è¯´ä¿¡æ¯æ ¼å¼åŒ–\n    u.formatNovels = function (novels) {\n        novels.forEach(novel => {\n            novel.title = novel.title.replace(RegExp(/^\\s+|\\s+$/g), \"\")\n            novel.tags = novel.tags.join(\",\")\n            novel.coverUrl = this.urlCoverUrl(novel.coverUrl)\n            novel.readingTime = `${novel.readingTime / 60} åˆ†é’Ÿ`\n            novel.createDate = this.dateFormat(novel.createDate);\n            novel.updateDate = this.dateFormat(novel.updateDate);\n            if (util.MORE_INFO_IN_DESCRIPTION) {\n                novel.description = `\\nä¹¦åï¼š${novel.title}\\nä½œè€…ï¼š${novel.userName}\\næ ‡ç­¾ï¼š${novel.tags}\\nä¸Šä¼ ï¼š${novel.createDate}\\næ›´æ–°ï¼š${novel.updateDate}\\nç®€ä»‹ï¼š${novel.description}`\n            } else {\n                novel.description = `\\n${novel.description}\\nä¸Šä¼ æ—¶é—´ï¼š${novel.createDate}\\næ›´æ–°æ—¶é—´ï¼š${novel.updateDate}`\n            }\n        })\n        return novels\n    }\n\n    // æ­£æ–‡ï¼Œæœç´¢ï¼šä»ç½‘å€è·å–idï¼Œè¿”å›å•ç¯‡å°è¯´ resï¼Œç³»åˆ—è¿”å›é¦–ç¯‡å°è¯´ res\n    u.getNovelRes = function (result) {\n        let novelId = 0, seriesId = 0, res = {}\n        // å…¼å®¹æœç´¢ç›´æ¥è¾“å…¥é“¾æ¥\n        pattern = \"(https?://)?(api\\\\.|www\\\\.)?((furrynovel\\\\.(ink|xyz))|pixiv\\\\.net)(/ajax)?/(pn|(pixiv/)?novel)/(show\\\\.php\\\\?id=|series/)?\\\\d+(/cache)?\"\n        // pattern = String(bookSourceUrl).replace(\".*\", \"\")\n        if (RegExp(pattern).test(result) && !(result.startsWith(\"<!DOCTYPE html>\"))) {\n            baseUrl = result.match(RegExp(pattern))[0]\n            result = \"<!DOCTYPE html>\"\n            java.log(`åŒ¹é…é“¾æ¥ï¼š${baseUrl}`)\n        }\n\n        let isHtml = result.startsWith(\"<!DOCTYPE html>\")\n        if (isHtml) {\n            let id = baseUrl.match(new RegExp(\"\\\\d+\"))[0]\n            let pattern = \"(https?://)?(www\\\\.)?pixiv\\\\.net(/ajax)?/novel/(series/)?\\\\d+\"\n            let isSeries = baseUrl.match(new RegExp(pattern))\n            if (isSeries) {\n                java.log(`ç³»åˆ—IDï¼š${id}`)\n                seriesId = id\n            } else {\n                let pattern = \"((furrynovel\\\\.(ink|xyz))|pixiv\\\\.net)/(pn|(pixiv/)?novel)/(show\\\\.php\\\\?id=)?\\\\d+\"\n                let isNovel = baseUrl.match(new RegExp(pattern))\n                if (isNovel) {\n                    res = util.getAjaxJson(util.urlNovelDetailed(id))\n                    novelId = id\n                }\n            }\n        } else {\n            res = JSON.parse(result)\n        }\n\n        if (res.body !== undefined && res.body.firstNovelId !== undefined && res.body.firstNovelId !== null) {\n            seriesId = res.body.seriesNavData.seriesId\n        }\n        if (seriesId) {  // é˜²æ­¢ç³»åˆ—é¦–ç¯‡æ— æƒé™è·å–\n            res = util.getAjaxJson(util.urlSeriesNovels(seriesId, 30, 0))\n            res.body = res.body.thumbnails.novel[0]\n            novelId = res.body.id\n        }\n        java.log(`åŒ¹é…å°è¯´IDï¼š${novelId}`)\n        if (res.error === true) {\n            java.log(`æ— æ³•ä» Pixiv è·å–å½“å‰å°è¯´`)\n            java.log(JSON.stringify(res))\n            return {}\n        }\n        return res.body\n    }\n\n    // è¯¦æƒ…ã€ç›®å½•ï¼šä»ç½‘å€è·å–idï¼Œå°½å¯èƒ½è¿”å›ç³»åˆ— resï¼Œå•ç¯‡å°è¯´è¿”å›å°è¯´ res\n    u.getNovelResSeries = function (result) {\n        let seriesId = 0, res = {}\n        // å…¼å®¹è¯¦æƒ…ï¼Œæ·»åŠ ç½‘å€ç›´æ¥è¾“å…¥é“¾æ¥\n        // pixiv é»˜è®¤åˆ†äº«ä¿¡æ¯ä¸­æœ‰ # å·ï¼Œä¸ä¼šè¢«è¯†åˆ«æˆé“¾æ¥ï¼Œæ— æ³•ä½¿ç”¨æ·»åŠ ç½‘å€\n        // baseUrl = baseUrl.replace(\"#\", \"%23\")\n        pattern = \"(https?://)?(api\\\\.|www\\\\.)?((furrynovel\\\\.(ink|xyz))|pixiv\\\\.net)(/ajax)?/(pn|(pixiv/)?novel)/(show\\\\.php\\\\?id=|series/)?\\\\d+(/cache)?\"\n        // pattern = String(bookSourceUrl).replace(\".*\", \"\")\n        if (!(result.startsWith(\"<!DOCTYPE html>\")) && JSON.parse(result).error === true && RegExp(pattern).test(baseUrl)) {\n            baseUrl = baseUrl.match(RegExp(pattern))[0]\n            result = \"<!DOCTYPE html>\"\n            java.log(`åŒ¹é…é“¾æ¥ï¼š${baseUrl}`)\n        }\n\n        let isHtml = result.startsWith(\"<!DOCTYPE html>\")\n        if (isHtml) {\n            let id = baseUrl.match(new RegExp(\"\\\\d+\"))[0]\n            let pattern = \"(https?://)?(www\\\\.)?pixiv\\\\.net(/ajax)?/novel/(series/)?\\\\d+\"\n            let isSeries = baseUrl.match(new RegExp(pattern))\n            if (isSeries) {\n                seriesId = id\n            } else {\n                let pattern = \"((furrynovel\\\\.(ink|xyz))|pixiv\\\\.net)/(pn|(pixiv/)?novel)/(show\\\\.php\\\\?id=)?\\\\d+\"\n                let isNovel = baseUrl.match(new RegExp(pattern))\n                if (isNovel) {\n                    java.log(`åŒ¹é…å°è¯´IDï¼š${id}`)\n                    res = util.getAjaxJson(util.urlNovelDetailed(id))\n                }\n            }\n        } else {\n            res = JSON.parse(result)\n        }\n        if (res.body !== undefined && res.body.seriesNavData !== undefined && res.body.seriesNavData !== null) {\n            seriesId = res.body.seriesNavData.seriesId\n        }\n        if (seriesId) {\n            java.log(`ç³»åˆ—IDï¼š${seriesId}`)\n            res = util.getAjaxJson(util.urlSeriesDetailed(seriesId))\n        }\n        if (res.error === true) {\n            java.log(`æ— æ³•ä» Pixiv è·å–å½“å‰å°è¯´`)\n            java.log(JSON.stringify(res))\n        }\n        return res.body\n    }\n\n    u.dateFormat = function (str) {\n        let addZero = function (num) {\n            return num < 10 ? '0' + num : num;\n        }\n        let time = new Date(str);\n        let Y = time.getFullYear() + \"å¹´\";\n        let M = addZero(time.getMonth() + 1) + \"æœˆ\";\n        let D = addZero(time.getDate()) + \"æ—¥\";\n        return Y + M + D;\n    }\n    u.timeTextFormat = function (text) {\n        return `${text.slice(0, 10)} ${text.slice(11, 19)}`\n    }\n    u.sleep = function (time) {\n        let endTime = new Date().getTime() + time\n        while(true){\n            if (new Date().getTime() > endTime){\n                return;\n            }\n        }\n    }\n\n    util = u\n    java.put(\"util\", objStringify(u))\n}\n\npublicFunc()\n\n// è·å–è¯·æ±‚çš„user idæ–¹ä¾¿å…¶ä»–ajaxè¯·æ±‚æ„é€ \nlet uid = java.getResponse().headers().get(\"x-userid\")\nif (uid != null) {\n    cache.put(\"pixiv:uid\", uid)\n}\njava.getStrResponse(null, null)",
        "loginUrl": "https://accounts.pixiv.net/login",
        "respondTime": 180000,
        "ruleBookInfo": {
            "author": "userName",
            "canReName": "true",
            "coverUrl": "coverUrl",
            "init": "@js:\nvar util = objParse(String(java.get(\"util\")))\n\nfunction objParse(obj) {\n    return JSON.parse(obj, (n, v) => {\n        if (typeof v == \"string\" && v.match(\"()\")) {\n            return eval(`(${v})`)\n        }\n        return v;\n    })\n}\n\nfunction oneShotHandler(res) {\n    let info = {}\n    info.seriesId = undefined\n    info.id = info.novelId = res.id\n    info.title = info.latestChapter = res.title.replace(RegExp(/^\\s+|\\s+$/g), \"\")\n    info.userName = res.userName\n    info.tags = res.tags.tags.map(item => item.tag)\n    info.tags.unshift('å•æœ¬')\n    // info.textCount = res.textCount  // æ— æ•°æ®\n    info.textCount = res.userNovels[`${info.novelId}`].textCount\n    info.description = res.description\n    info.coverUrl = util.urlCoverUrl(res.coverUrl)\n    info.detailedUrl = util.urlNovelUrl(info.novelId)\n    info.catalogUrl = util.urlNovelDetailed(info.novelId)\n    info.createDate = util.dateFormat(res.createDate)\n    info.updateDate = util.dateFormat(res.uploadDate)\n\n    info.readingTime = `${res.userNovels[`${info.novelId}`].readingTime / 60} åˆ†é’Ÿ`\n    return info\n}\n\nfunction seriesHandler(res) {\n    let info = {}\n    info.seriesId = res.id\n    info.id = info.novelId = res.firstNovelId\n    info.title = res.title.replace(RegExp(/^\\s+|\\s+$/g), \"\")\n    info.userName = res.userName\n    info.tags = res.tags   //åˆå¹¶å½“å‰ç« èŠ‚ tags\n    info.tags.unshift('é•¿ç¯‡')\n    info.textCount = res.publishedTotalCharacterCount\n    info.description = res.caption\n    info.coverUrl = util.urlCoverUrl(res.cover.urls[\"480mw\"]) // 240mw, 480mw, 1200x1200, 128x128, original\n    info.detailedUrl = util.urlSeriesUrl(info.seriesId)\n    info.catalogUrl = util.urlSeriesDetailed(info.seriesId)\n    info.createDate = util.dateFormat(res.createDate)\n    info.updateDate = util.dateFormat(res.updateDate)\n\n    // å‘é€è¯·æ±‚è·å–ç¬¬ä¸€ç«  è·å–æ ‡ç­¾ä¸ç®€ä»‹\n    let firstNovel = {}\n    try {\n        firstNovel = util.getAjaxJson(util.urlNovelDetailed(info.novelId)).body\n        info.tags = info.tags.concat(firstNovel.tags.tags.map(item => item.tag))\n    } catch (e) {  // é˜²æ­¢ç³»åˆ—é¦–ç¯‡æ— æƒé™è·å–\n        firstNovel = util.getAjaxJson(util.urlSeriesNovels(info.seriesId, 30, 0)).body.thumbnails.novel[0]\n        info.id = info.novelId = firstNovel.id\n        info.tags = info.tags.concat(firstNovel.tags)\n    }\n    info.tags = Array.from(new Set(info.tags))\n    if (info.description === \"\") {\n        info.description = firstNovel.description\n    }\n\n    info.readingTime = `${res.publishedReadingTime / 60} åˆ†é’Ÿ`\n    info.latestChapter = \"\"\n    info.language = res.language\n    info.totalChapterNum = info.total = res.total  //ç« èŠ‚æ€»æ•°\n    info.latestNovelId = res.latestNovelId\n    return info\n}\n\nfunction novelHandler(res){\n    let info = {}\n    if (res.firstNovelId !== undefined) {\n        info = seriesHandler(res)\n    } else {\n        info = oneShotHandler(res)\n    }\n    info.tags = info.tags.join(\",\")\n    if (util.MORE_INFO_IN_DESCRIPTION) {\n        info.description = `\\nä¹¦åï¼š${info.title}\\nä½œè€…ï¼š${info.userName}\\næ ‡ç­¾ï¼š${info.tags}\\nä¸Šä¼ ï¼š${info.createDate}\\næ›´æ–°ï¼š${info.updateDate}\\nç®€ä»‹ï¼š${info.description}`\n    } else {\n        info.description = `\\n${info.description}\\nä¸Šä¼ æ—¶é—´ï¼š${info.createDate}\\næ›´æ–°æ—¶é—´ï¼š${info.updateDate}`\n    }\n    return info\n}\n\n(function (res) {\n    res = util.getNovelResSeries(result)\n    // res = util.getNovelRes(result)\n    // if (res.seriesNavData !== null) {     // ä½¿ç”¨ util.getNovelRes(result) æ—¶\n    //     res = util.getAjaxJson(util.urlSeriesDetailed(res.seriesNavData.seriesId)).body\n    // }\n    try {\n        return novelHandler(res)\n    } catch (e) {\n        java.log(e)\n        java.log(`å— Pixiv çš„é™åˆ¶ï¼Œæ— æ³•è·å–å½“å‰å°è¯´æ•°æ®`)\n    }\n})();",
            "intro": "description",
            "kind": "tags",
            "lastChapter": "latestChapter",
            "name": "title",
            "tocUrl": "catalogUrl",
            "wordCount": "textCount"
        },
        "ruleContent": {
            "content": "@js:\nvar util = objParse(String(java.get(\"util\")))\n\nfunction objParse(obj) {\n    return JSON.parse(obj, (n, v) => {\n        if (typeof v == \"string\" && v.match(\"()\")) {\n            return eval(`(${v})`)\n        }\n        return v;\n    })\n}\n\nfunction getContent(res) {\n    let content = res.content\n    // åœ¨æ­£æ–‡å†…éƒ¨æ·»åŠ å°è¯´æè¿°\n    if (util.SHOW_NOVEL_COMMENTS === true && res.description !== \"\") {\n        content = res.description + \"\\n\" + \"â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”\\n\".repeat(2) + content\n    }\n\n    // è·å– [uploadedimage:] çš„å›¾ç‰‡é“¾æ¥\n    let hasEmbeddedImages = res.textEmbeddedImages !== undefined && res.textEmbeddedImages !== null\n    if (hasEmbeddedImages) {\n        Object.keys(res.textEmbeddedImages).forEach((key) => {\n            content = content.replace(`[uploadedimage:${key}]`, `<img src=\"${res.textEmbeddedImages[key].urls.original}\">`)\n        })\n    }\n\n    // è·å– [pixivimage:] çš„å›¾ç‰‡é“¾æ¥ [pixivimage:1234] [pixivimage:1234-1]\n    let matched = content.match(RegExp(/\\[pixivimage:(\\d+)-?(\\d+)]/gm))\n    if (matched) {\n        for (let i in matched) {\n            let illustId, order\n            let matched2 = matched[i].match(RegExp(\"(\\\\d+)-?(\\\\d+)\"))\n            let temp = matched2[0].split(\"-\")\n            illustId = temp[0]\n            if (temp.length >= 2) {\n                order = temp[1]\n            }\n            content = content.replace(`${matched[i]}`, `<img src=\"${util.urlIllustOriginal(illustId, order)}\">`)\n        }\n    }\n\n    // æ›¿æ¢ Pixiv åˆ†é¡µæ ‡è®°ç¬¦å· [newpage]\n    matched = content.match(RegExp(/[ ã€€]*\\[newpage][ ã€€]*/gm))\n    if (matched) {\n        for (let i in matched) {\n            content = content.replace(`${matched[i]}`, `${\"<p>â€‹<p/>\".repeat(3)}`)\n        }\n    }\n\n    // æ›¿æ¢ Pixiv ç« èŠ‚æ ‡è®°ç¬¦å· [chapter:]\n    matched = content.match(RegExp(/\\[chapter:(.*?)]/gm))\n    if (matched) {\n        for (let i in matched) {\n            let matched2 = matched[i].match(/\\[chapter:(.*?)]/m)\n            let chapter = matched2[1].trim()\n            content = content.replace(`${matched[i]}`, `${chapter}<p>â€‹<p/>`)\n        }\n    }\n\n    // æ›¿æ¢ Pixiv è·³è½¬é¡µé¢æ ‡è®°ç¬¦å· [[jump:]]\n    matched = content.match(RegExp(/\\[jump:(\\d+)]/gm))\n    if (matched) {\n        for (let i in matched) {\n            let page = matched[i].match(/\\d+/)\n            content = content.replace(`${matched[i]}`, `\\n\\nè·³è½¬è‡³ç¬¬${page}èŠ‚`)\n        }\n    }\n\n    // æ›¿æ¢ Pixiv é“¾æ¥æ ‡è®°ç¬¦å· [[jumpuri: > ]]\n    matched = content.match(RegExp(/\\[\\[jumpuri:(.*?)>(.*?)]]/gm))\n    if (matched) {\n        for (let i in matched) {\n            let matched2 = matched[i].match(/\\[\\[jumpuri:(.*?)>(.*?)]]/m)\n            let matchedText = matched2[0]\n            let urlName = matched2[1].trim()\n            let urlLink = matched2[2].trim()\n            // é˜…è¯»ä¸æ”¯æŒè¶…é“¾æ¥\n            //content = content.replace(`${matchedText}`, `<a href=${urlLink}>${urlName}</a>`)\n            if (urlLink === urlName) {\n                content = content.replace(`${matchedText}`, `${urlName}`)\n            } else {\n                content = content.replace(`${matchedText}`, `${urlName}: ${urlLink}`)\n            }\n        }\n    }\n\n    // æ›¿æ¢ Pixiv æ³¨éŸ³æ ‡è®°ç¬¦å· [[rb: > ]]\n    matched = content.match(RegExp(/\\[\\[rb:(.*?)>(.*?)]]/gm))\n    if (matched) {\n        for (let i in matched) {\n            let matched2 = matched[i].match(/\\[\\[rb:(.*?)>(.*?)]]/m)\n            let matchedText = matched2[0]\n            let kanji = matched2[1].trim()\n            let kana = matched2[2].trim()\n\n            if (!util.REPLACE_BOOK_TITLE_MARKS) {\n                // é»˜è®¤æ›¿æ¢æˆï¼ˆæ‹¬å·ï¼‰\n                content = content.replace(`${matchedText}`, `${kanji}ï¼ˆ${kana}ï¼‰`)\n            } else {\n                let reg = RegExp(\"[\\\\u4E00-\\\\u9FFF]+\", \"g\");\n                if (reg.test(kana)) {\n                    // kanaä¸ºä¸­æ–‡ï¼Œåˆ™æ›¿æ¢å›ã€Šä¹¦åå·ã€‹\n                    content = content.replace(`${matchedText}`, `${kanji}ã€Š${kana}ã€‹`)\n                } else {\n                    // é˜…è¯»ä¸æ”¯æŒ <ruby> <rt> æ³¨éŸ³\n                    // content = content.replace(`${matchedText}`, `<ruby>${kanji}<rt>${kana}</rt></ruby>`)\n                    content = content.replace(`${matchedText}`, `${kanji}ï¼ˆ${kana}ï¼‰`)\n                }\n            }\n        }\n    }\n\n    if (util.SHOW_NOVEL_COMMENTS === true) {\n        return content + getComment(res)\n    } else {\n        return content\n    }\n}\n\nfunction getComment(res) {\n    let comments = \"\"\n    let resp = util.getAjaxJson(util.urlNovelComments(res.id, 0, 50))\n    if (resp.error === true){\n        return \"\"\n    }\n    resp.body.comments.forEach(comment =>{\n        comments += `${comment.userName}ï¼š${comment.comment}\\n`\n        if (comment.hasReplies === true) {\n            let resp = util.getAjaxJson(util.urlNovelCommentsReply(comment.id, 1))\n            if (resp.error === true) {\n                return \"\"\n            }\n            resp.body.comments.reverse().forEach(reply =>{\n                comments += `${reply.userName}(â¤´ï¸${reply.replyToUserName})ï¼š${reply.comment}\\n`\n            })\n        }\n    })\n    if (comments) {\n        comments = \"\\n\" + \"â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”\\n\".repeat(2) + \"ç« èŠ‚è¯„è®ºï¼š\\n\" + comments\n    }\n    return comments\n}\n\n(function () {\n    return getContent(util.getNovelRes(result))\n})()\n",
            "imageStyle": "SINGLE"
        },
        "ruleExplore": {
            "author": "userName",
            "bookList": "@js:\nvar util = objParse(String(java.get(\"util\")))\nvar seriesSet = new Set();  // å­˜å‚¨seriesID æœ‰BUGæ— æ³•å¤„ç†ç¿»é¡µ\n\nfunction objParse(obj) {\n    return JSON.parse(obj, (n, v) => {\n        if (typeof v == \"string\" && v.match(\"()\")) {\n            return eval(`(${v})`)\n        }\n        return v;\n    })\n}\n\nfunction handlerFactory() {\n    let cookie = String(java.getCookie(\"https://www.pixiv.net/\", null))\n    if (cookie === null || cookie === undefined || cookie === \"\") {\n        return handlerNoLogin()\n    }\n    if (baseUrl.indexOf(\"/bookmark\") !== -1) {\n        return handlerBookMarks()\n    }\n    if (baseUrl.indexOf(\"/top\") !== -1) {\n        return handlerRecommend()\n    }\n    if (baseUrl.indexOf(\"/follow_latest\") !== -1) {\n        return handlerFollowLatest()\n    }\n    if (baseUrl.indexOf(\"/watch_list\") !== -1) {\n        return handlerWatchList()\n    }\n    if (baseUrl.indexOf(\"/ranking\") !== -1) {\n        return handlerRanking()\n    }\n    if (baseUrl.indexOf(\"/discovery\") !== -1) {\n        return handlerDiscovery()\n    }\n}\n\nfunction handlerNoLogin() {\n    return () => {\n        java.longToast(\"æ­¤åŠŸèƒ½éœ€è¦åœ¨ä¹¦æºç™»å½•åæ‰èƒ½ä½¿ç”¨\")\n        util.sleep(2000)\n        java.longToast('å‘ç°é¡µ - é•¿æŒ‰\"Pixiv\" - ç™»å½• - ç™»å½•è´¦å·')\n        return []\n    }\n}\n\n// æ¨èå°è¯´\nfunction handlerRecommend() {\n    return () => {\n        let res = JSON.parse(result)\n        const recommend = res.body.page.recommend\n        const novels = res.body.thumbnails.novel\n        let nidSet = new Set(recommend.ids)\n        // java.log(nidSet.size)\n        let list = novels.filter(novel => nidSet.has(String(novel.id)))\n        // java.log(`è¿‡æ»¤ç»“æœ:${JSON.stringify(list)}`)\n        return util.formatNovels(util.handNovels(util.combineNovels(list)))\n    }\n}\n\n// æ”¶è—å°è¯´\nfunction handlerBookMarks() {\n    return () => {\n        let res = JSON.parse(result).body.works\n        if (res === undefined || res.length === 0) {\n            //æµç¨‹æ— æ³•æœ¬ç¯èŠ‚ä¸­æ­¢ åªèƒ½äº¤ç»™ä¸‹ä¸€æµç¨‹å¤„ç†\n            return []\n        }\n        return util.formatNovels(util.handNovels(res))\n    }\n}\n\n//å…³æ³¨ä½œè€…ï¼Œè¿‘æœŸå°è¯´\nfunction handlerFollowLatest() {\n    return () => {\n        let res = JSON.parse(result)\n        return util.formatNovels(util.handNovels(util.combineNovels(res.body.thumbnails.novel)))\n    }\n}\n\n//æ¨èå°è¯´\nfunction handlerDiscovery() {\n    return () => {\n        let res = JSON.parse(result)\n        return util.formatNovels(util.handNovels(util.combineNovels(res.body.novels)))\n    }\n}\n\n// è¿½æ›´åˆ—è¡¨\nfunction handlerWatchList(){\n    return () => {\n        let res = JSON.parse(result)\n        return util.formatNovels(util.handNovels(res.body.thumbnails.novelSeries))\n    }\n}\n\n// æ’è¡Œæ¦œ\nfunction handlerRanking(){\n    return () => {\n        let novels = [], novelIds = []\n        // let result = result + java.ajax(`${baseUrl}&p=2`)  // æ­£åˆ™è·å–ç½‘å€ä¸­çš„ novelId\n        let matched = result.match(RegExp(/\\/novel\\/show\\.php\\?id=\\d{5,}/gm))\n        for (let i in matched) {\n            let novelId = matched[i].match(RegExp(/\\d{5,}/))[0]\n            if (novelIds.indexOf(novelId) === -1) {\n                novelIds.push(novelId)\n            }\n        }\n        novelIds.forEach(novelId => {\n            java.log(util.urlNovelDetailed(novelId))\n            let res = util.getAjaxJson(util.urlNovelDetailed(novelId))\n            if (res.error !== true) {\n                novel = res.body\n                novel.updateDate = novel.uploadDate\n                novel.tags = novel.tags.tags.map(item => item.tag)\n                novel.textCount = novel.userNovels[`${novelId}`].textCount\n                if (novel.seriesNavData !== null) {\n                    novel.seriesId = novel.seriesNavData.seriesId\n                    novel.title = novel.seriesNavData.title\n                }\n                novels.push(novel)\n            } else {\n                java.log(JSON.stringify(res))\n            }\n        })\n        return util.formatNovels(util.handNovels(util.combineNovels(novels)))\n    }\n}\n\n(() => {\n    return handlerFactory()()\n})()",
            "bookUrl": "detailedUrl",
            "coverUrl": "coverUrl",
            "intro": "description",
            "kind": "tags",
            "lastChapter": "latestChapter",
            "name": "title",
            "wordCount": "textCount"
        },
        "ruleSearch": {
            "author": "userName",
            "bookList": "@js:\nvar util = objParse(String(java.get(\"util\")))\n\nfunction objParse(obj) {\n    return JSON.parse(obj, (n, v) => {\n        if (typeof v == \"string\" && v.match(\"()\")) {\n            return eval(`(${v})`)\n        }\n        return v;\n    })\n}\n\nvar first = true;\n// å­˜å‚¨seriesID\nvar seriesSet = {\n    keywords: \"Pixiv:Search\",\n    has: (value) => {\n        let page = Number(java.get(\"page\"))\n        if (page === 1 && first) {\n            first = false\n            cache.deleteMemory(this.keywords)\n            return false\n        }\n\n        let v = cache.getFromMemory(this.keywords)\n        if (v === undefined || v === null) {\n            return false\n        }\n        let set = new Set(JSON.parse(v))\n        return set.has(value)\n    },\n\n    add: (value) => {\n        let v = cache.getFromMemory(this.keywords)\n        if (v === undefined || v === null) {\n            cache.putMemory(this.keywords, JSON.stringify([value]))\n\n        } else {\n            let arr = JSON.parse(v)\n            if (typeof arr === \"string\") {\n                arr = Array(arr)\n            }\n            arr.push(value)\n            cache.putMemory(this.keywords, JSON.stringify(arr))\n        }\n    },\n};\n\nfunction isLogin() {\n    let cookie = String(java.getCookie(\"https://www.pixiv.net/\", null))\n    return typeof cookie === \"string\" && cookie !== \"\"\n}\n\nfunction getUserNovels() {\n    if (!isLogin()) {\n        return []\n    }\n\n    let username = String(java.get(\"key\"))\n    let html = java.ajax(util.urlSearchUser(username))\n    // java.log(html)\n    // ä»…åŒ¹é…æœ‰æŠ•ç¨¿ä½œå“çš„ç”¨æˆ·\n    let match = html.match(new RegExp(`\"userIds\":\\\\[(?:(?:\\\\d+,?)+)]`))\n    // java.log(JSON.stringify(match))\n    if (match === null || match.length === 0) {\n        return []\n    }\n\n    match = JSON.stringify(match).replace(\"\\\\\",\"\").split(\",\")\n    // java.log(JSON.stringify(match))\n    let regNumber = new RegExp(\"\\\\d+\")\n    let uidList = match.map(v => {\n        return v.match(regNumber)[0]\n    })\n\n    // ä»…é™3ä¸ªä½œè€…\n    java.log(JSON.stringify(uidList))\n    if (uidList.length >= 3) {\n        uidList.length = 3\n    }\n\n    let novels = []\n    let page = Number(java.get(\"page\"))\n\n    uidList.forEach(id => {\n        // è·å–ç³»åˆ—å°è¯´\n        let resp = util.getAjaxJson(util.urlUserAllWorks(id))\n        // java.log(util.urlUserAllWorks(id))\n        if (resp.error === true) {\n            return []\n        }\n        // resp.body.novelSeries.forEach(novel =>{\n        //     novel.isOneshot = false\n        //     novel.createDate = novel.createDateTime\n        //     novel.updateDate = novel.updateDateTime\n        // })\n        // novels = novels.concat(resp.body.novelSeries)\n\n        // è·å–å•ç¯‡å°è¯´\n        let novelsId = Object.keys(resp.body.novels).reverse().slice((page - 1) * 20, page * 20)\n        let url = util.urlNovelsDetailed(id, novelsId)\n        util.debugFunc(() => {\n            java.log(`å‘é€è·å–ä½œè€…å°è¯´çš„Ajaxè¯·æ±‚:${url}`)\n        })\n        let userNovels = util.getWebviewJson(url, html => {\n            return (html.match(new RegExp(\">\\\\{.*?}<\"))[0].replace(\">\", \"\").replace(\"<\", \"\"))\n        }).body\n        // let userNovels = util.getAjaxJson(url).body\n        // è·å–å¯¹åº”çš„å°è¯´ è¯¥åºåˆ—æ˜¯æŒ‰ç…§idæ’åº\n        // åè½¬ä»¥æŒ‰ç…§æ›´æ–°æ—¶é—´æ’åº\n        novels = novels.concat(Object.values(userNovels).reverse())\n    })\n\n    util.debugFunc(() => {\n        java.log(`è·å–ç”¨æˆ·æœç´¢å°è¯´ç»“æŸ`)\n    })\n    return novels\n}\n\nfunction getSeries(){\n    let MAXPAGES = 3, novels = []\n    let seriesName = String(java.get(\"key\"))\n    java.log(util.urlSearchSeries(seriesName, 1))\n    let resp = util.getAjaxJson(util.urlSearchSeries(seriesName, 1))\n    if (resp.error === true) {\n        return []\n    }\n    novels = novels.concat(resp.body.novel.data)\n    for (let i = Number(java.get(\"page\")) + 1; i < resp.body.novel.lastPage, i < MAXPAGES; i++) {\n        java.log(`é¡µé¢ï¼š${i}`)\n        let resp = util.getAjaxJson(util.urlSearchSeries(seriesName, i))\n        if (resp.error === true) {\n            return []\n        }\n        novels = novels.concat(resp.body.novel.data)\n    }\n    return novels\n}\n\nfunction getNovels(){\n    if (JSON.parse(result).error !== true){\n        return JSON.parse(result).body.novel.data\n    } else {\n        return []\n    }\n}\n\nfunction getLinkNovels() {\n    try {\n        return util.getNovelRes(String(java.get(\"key\")))\n    } catch (e) {\n        return []\n    }\n}\n\n(() => {\n    let novels = []\n    novels = novels.concat(getNovels())\n    novels = novels.concat(getSeries())\n    novels = novels.concat(getUserNovels())\n    novels = novels.concat(getLinkNovels())\n    // java.log(JSON.stringify(novels))\n    // è¿”å›ç©ºåˆ—è¡¨ä¸­æ­¢æµç¨‹\n    if (novels.length === 0) {\n        return []\n    }\n    return util.formatNovels(util.handNovels(util.combineNovels(novels)))\n})();",
            "bookUrl": "detailedUrl",
            "checkKeyWord": "æµ‹è¯•é¡µé¢",
            "coverUrl": "coverUrl",
            "intro": "description",
            "kind": "tags",
            "lastChapter": "latestChapter",
            "name": "title",
            "wordCount": "textCount"
        },
        "ruleToc": {
            "chapterList": "@js:\nvar util = objParse(String(java.get(\"util\")))\n\nfunction objParse(obj) {\n    return JSON.parse(obj, (n, v) => {\n        if (typeof v == \"string\" && v.match(\"()\")) {\n            return eval(`(${v})`)\n        }\n        return v;\n    })\n}\n\nfunction oneShotHandler(res) {\n    res.textCount = res.userNovels[`${res.id}`].textCount\n    res.createDate = util.timeTextFormat(res.createDate)\n    return [{\n        title: res.title.replace(RegExp(/^\\s+|\\s+$/g), \"\"),\n        chapterUrl: util.urlNovel(res.id),\n        chapterInfo: `${res.createDate}ã€€ã€€${res.textCount}å­—`\n    }]\n}\n\nfunction seriesHandler(res) {\n    const limit = 30\n    let returnList = []\n    let seriesID = 0, allChaptersCount = 0\n    if (res.seriesNavData !== undefined) {\n        seriesID = res.seriesNavData.seriesId\n        allChaptersCount = util.getAjaxJson(util.urlSeriesDetailed(seriesID)).body.total\n    } else {\n        seriesID = res.id\n        allChaptersCount = res.total\n    }\n    util.debugFunc(() => {\n        java.log(`æœ¬ç³»åˆ— ${seriesID} ä¸€å…±æœ‰${allChaptersCount}ç« `);\n    })\n\n    //å‘é€è¯·æ±‚è·å¾—ç›¸åº”æ•°é‡çš„ç›®å½•åˆ—è¡¨\n    function sendAjaxForGetChapters(lastIndex) {\n        res = util.getAjaxJson(util.urlSeriesNovels(seriesID, limit, lastIndex)).body.thumbnails.novel\n        res.forEach(v => {\n            v.title = v.title.replace(RegExp(/^\\s+|\\s+$/g), \"\").replace(RegExp(/ï¼ˆ|ï¼‰|-/g), \"\")\n            v.chapterUrl = util.urlNovel(v.id)\n            v.updateDate = util.timeTextFormat(v.createDate)\n            v.chapterInfo = `${v.updateDate}ã€€ã€€${v.textCount}å­—`\n            util.debugFunc(() => {\n                java.log(`${v.title}`)\n            })\n        })\n        return res;\n    }\n\n    //é€»è¾‘æ§åˆ¶è€… ä¹Ÿå°±æ˜¯ä½¿ç”¨ä¸Šé¢å®šä¹‰çš„ä¸¤ä¸ªå‡½æ•°æ¥åšå¯¹åº”åŠŸèƒ½\n    //è¦çˆ¬å–çš„æ€»æ¬¡æ•°\n    let max = (allChaptersCount / limit) + 1\n    for (let i = 0; i < max; i++) {\n        //java.log(\"içš„å€¼:\"+i)\n        let list = sendAjaxForGetChapters(i * limit);\n        //å–å‡ºæ¯ä¸ªå€¼\n        returnList = returnList.concat(list)\n        // java.log(JSON.stringify(returnList))\n    }\n    return returnList\n}\n\n(function (res) {\n    res = util.getNovelResSeries(result)\n    if (res.firstNovelId !== undefined || res.seriesNavData !== null) {\n        return seriesHandler(res)\n    } else {\n        return oneShotHandler(res)\n    }\n})()",
            "chapterName": "title",
            "chapterUrl": "chapterUrl",
            "updateTime": "chapterInfo"
        },
        "searchUrl": "@js:\njava.put(\"page\",page);java.put(\"key\",key);\n`https://www.pixiv.net/ajax/search/novels/${encodeURI(key)}?word=${encodeURI(key)}&order=date_d&mode=all&p=${page}&s_mode=s_tag&lang=zh`;",
        "variableComment": "â¤ï¸ æŸ¥çœ‹ä»–äººæ”¶è—ï¼š\nå‘ç°ï¼šé•¿æŒ‰\"Pixiv\"ï¼Œç¼–è¾‘ï¼Œå³ä¸Šè§’èœå•ï¼Œè®¾ç½®æºå˜é‡\nè®¾ç½®æºå˜é‡ï¼šè¾“å…¥ä½œè€…IDï¼Œä¸€è¡Œä¸€ä¸ªï¼Œå¯æ·»åŠ ä½œè€…åï¼Œä¿å­˜\nå‘ç°ï¼šé•¿æŒ‰\"Pixiv\"ï¼Œåˆ·æ–°ï¼ŒæŸ¥çœ‹ä»–äººæ”¶è—\nä»¥ä¸‹å†…å®¹ä¸ºæºå˜é‡æ¨¡æ¿ï¼š\n12345 ä½œè€…å\n67890 //ä½œè€…å\n\n\nâš™ï¸ è‡ªå®šä¹‰ä¹¦æºè®¾ç½®ï¼š\nâš™ï¸ è‡ªå®šä¹‰è®¾ç½®ï¼šè¯·åœ¨åŸºæœ¬-å˜é‡è¯´æ˜å¤„ä¿®æ”¹ä»£ç \nâš™ï¸ è‡ªå®šä¹‰è®¾ç½®ï¼šå°† true æ”¹ä¸º falseï¼Œæˆ–ç›¸å\nâš ï¸ è®¾ç½®æºå˜é‡ã€æ— æ³•ã€‘æ›´æ”¹ä¹¦æºè‡ªå®šä¹‰è®¾ç½®\nâš ï¸ æ³¨æ„ä¸è¦æ·»åŠ æˆ–åˆ é™¤å°¾éšé€—å·\",\"\nâš ï¸ å‘ç°é¡µéœ€è¦é•¿æŒ‰\"Pixiv\"ï¼Œæ‰‹åŠ¨åˆ·æ–°\nä»¥ä¸‹å†…å®¹ä¸ºä¹¦æºè®¾ç½®ï¼š\n{\n\"SHOW_GENERAL_NOVELS_RANK\": false,\n\"MORE_INFO_IN_DESCRIPTION\": false,\n\"SHOW_ORIGINAL_NOVEL_LINK\": true,\n\"REPLACE_BOOK_TITLE_MARKS\": true,\n\"DEBUG\": false\n}\n\n// SHOW_GENERAL_NOVELS_RANK\n// å‘ç°ï¼šæ˜¾ç¤ºä¸€èˆ¬å°è¯´æ’è¡Œæ¦œ\n// MORE_INFO_IN_DESCRIPTION\n// è¯¦æƒ…ï¼šä¹¦ç±ç®€ä»‹æ˜¾ç¤ºæ›´å¤šä¿¡æ¯\n// SHOW_ORIGINAL_NOVEL_LINK\n// ç›®å½•ï¼šæ˜¾ç¤ºæºé“¾æ¥ï¼Œä½†ä¼šå¢åŠ è¯·æ±‚æ¬¡æ•°\n// REPLACE_BOOK_TITLE_MARKS\n// æ­£æ–‡ï¼šæ³¨éŸ³å†…å®¹ä¸ºæ±‰å­—æ—¶ï¼Œæ›¿æ¢ä¸ºä¹¦åå·\n// DEBUG\n// è°ƒè¯•æ¨¡å¼\n\n",
        "weight": 0
    }
]