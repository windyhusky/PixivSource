[
    {
        "bookSourceComment": "Linpx ä¹¦æºï¼ˆæ›´æ–°æ—¶é—´ï¼š2024-10-08ï¼‰\n\nå¯ç”¨åŠŸèƒ½ï¼šâœ…æœç´¢âœ…å‘ç°âœ…æ·»åŠ ç½‘å€âœ…è®¢é˜…æº\næœç´¢å°è¯´ï¼šâœ…å°è¯´åç§°âŒä½œè€…åç§°âœ…å°è¯´æ ‡ç­¾\nå‘ç°å°è¯´ï¼šâŒæ¨èä½œè€…âœ…æœ€è¿‘æ›´æ–°\næ·»åŠ ç½‘å€ï¼šâœ…Linpxå°è¯´é“¾æ¥(âœ…åˆ†äº«é“¾æ¥âœ…åŸé“¾æ¥)\nè®¢é˜…ç”¨æ³•ï¼šç‚¹å‡»è®¢é˜…æºæ‰“å¼€å°è¯´ï¼Œç‚¹å‡»ã€æ·»åŠ åˆ°ä¹¦æ¶ã€‘æŒ‰é’®æ·»åŠ å°è¯´åˆ°ä¹¦æ¶\næ¸©é¦¨æç¤ºï¼šâš ï¸ Linpx çš„ç³»åˆ—å°è¯´ api ç›®å‰ä¸ä¼šè¿”å›å°è¯´idï¼Œæ·»åŠ ç³»åˆ—å°è¯´åï¼Œæ— æ³•è·å–ç›®å½•\n\nä¹¦æºå‘å¸ƒï¼šå…½äººé˜…è¯»é¢‘é“ https://t.me/FurryReading\né¡¹ç›®åœ°å€ï¼šhttps://github.com/windyhusky/PixivSource\nè§„åˆ™è®¢é˜…ï¼š\nhttps://cdn.jsdelivr.net/gh/windyhusky/PixivSource@main/linpx.json\nhttps://raw.githubusercontent.com/windyhusky/PixivSource/main/linpx.json",
        "bookSourceGroup": "ğŸ” Pixiv",
        "bookSourceName": "Linpx",
        "bookSourceType": 0,
        "bookSourceUrl": "https://furrynovel.ink",
        "bookUrlPattern": "(https?://)?(api\\.|www\\.)?(furrynovel\\.(ink|xyz))/(pn|pixiv/novel)/\\d+(/cache)?",
        "customOrder": 2,
        "enabled": true,
        "enabledCookieJar": false,
        "enabledExplore": true,
        "exploreUrl": "[\n  {\n    \"title\": \"æ¨èä½œè€…\",\n    \"url\": \"https://api.furrynovel.ink/fav/user/cache\",\n    \"style\": {\n      \"layout_flexGrow\": 1,\n      \"layout_flexBasisPercent\":0.3\n    }\n  },\n  {\n    \"title\": \"æœ€æ–°å°è¯´\",\n    \"url\": \"https://api.furrynovel.ink/pixiv/novels/recent/cache?page={{page}}\",\n    \"style\": {\n      \"layout_flexGrow\": 1,\n      \"layout_flexBasisPercent\":0.3\n    }\n  }\n]",
        "header": "{\"referer\":\"https://furrynovel.ink/\"}",
        "lastUpdateTime": 1728398617323,
        "loginCheckJs": "var util = {}\n\nfunction objStringify(obj) {\n    return JSON.stringify(obj, (n, v) => {\n        if (typeof v == \"function\")\n            return v.toString();\n        return v;\n    });\n}\n\nfunction publicFunc() {\n    let u = {}\n\n    u.cacheGetAndSet = function (key, supplyFunc) {\n        let v = cache.get(key)\n        if (v === undefined || v === null) {\n            v = JSON.stringify(supplyFunc())\n            // ç¼“å­˜10åˆ†é’Ÿ\n            cache.put(key, v, 600)\n        }\n        return JSON.parse(v)\n    }\n    u.getAjaxJson = function (url) {\n        return util.cacheGetAndSet(url, () => {\n            return JSON.parse(java.ajax(url))\n        })\n    }\n    u.getWebviewJson = function (url) {\n        return util.cacheGetAndSet(url, () => {\n            let html = java.webView(null, url, null)\n            return JSON.parse((html.match(new RegExp(\">\\\\[\\\\{.*?}]<\"))[0].replace(\">\", \"\").replace(\"<\", \"\")))\n        })\n    }\n\n\n    u.debugFunc = (func) => {\n        if (String(source.getVariable()) === \"debug\") {\n            func()\n        }\n    }\n\n    u.urlNovelUrl = function (id){\n        return `https://api.furrynovel.ink/pixiv/novel/${id}/cache`\n    }\n    u.urlSeriesUrl = function (id){\n        return `https://api.furrynovel.ink/pixiv/series/${id}/cache`\n    }\n    u.urlUserUrl = function (id) {\n        return `https://api.furrynovel.ink/pixiv/user/${id}/cache`\n    }\n    u.urlSearchNovel = function (novelname) {\n        return `https://api.furrynovel.ink/pixiv/search/novel/${novelname}/cache`\n    }\n    u.urlSearchUsers = function (username) {\n        return `https://api.furrynovel.ink/pixiv/search/user/${username}/cache`\n    }\n    u.urlNovelsDetailed = function (nidList) {\n        return `https://api.furrynovel.ink/pixiv/novels/cache?${nidList.map(v => \"ids[]=\" + v).join(\"&\")}`\n    }\n    u.urlUserDetailed = function (uidList) {\n        return `https://api.furrynovel.ink/pixiv/users/cache?${uidList.map(v => \"ids[]=\" + v).join(\"&\")}`\n    }\n    u.urlCoverUrl = function (pxImgUrl) {\n        return `https://pximg.furrynovel.ink/?url=${pxImgUrl}&w=800`\n    }\n    u.urlIllustOriginal = function (illustId, order) {\n        // ä½¿ç”¨ pixiv.cat è·å–æ’å›¾\n        let illustOriginal = `https://pixiv.re/${illustId}.png`\n        // let illustOriginal = `https://pixiv.nl/${illustId}.png`\n        if (order >= 1) {\n            illustOriginal = `https://pixiv.re/${illustId}-${order}.png`\n            // illustOriginal = `https://pixiv.nl/${illustId}-${order}.png`\n        }\n        return illustOriginal\n    }\n\n    util = u\n    java.put(\"util\", objStringify(u))\n}\n\npublicFunc()\n\n// è·å–è¯·æ±‚çš„user idæ–¹ä¾¿å…¶ä»–ajaxè¯·æ±‚æ„é€ \nlet uid = java.getResponse().headers().get(\"x-userid\")\nif (uid != null) {\n    cache.put(\"pixiv:uid\", uid)\n}\njava.getStrResponse(null, null)",
        "loginUrl": "",
        "respondTime": 180000,
        "ruleBookInfo": {
            "author": "author",
            "coverUrl": "cover_url",
            "init": "@js:\nvar util = objParse(String(java.get(\"util\")))\n\nfunction objParse(obj) {\n    return JSON.parse(obj, (n, v) => {\n        if (typeof v == \"string\" && v.match(\"()\")) {\n            return eval(`(${v})`)\n        }\n        return v;\n    })\n}\n\n(function (res) {\n    result = {} //å…¼å®¹æœç´¢ for å¾ªç¯\n    result.novels = []\n    // java.log(JSON.stringify(res))\n    let isHtml = res.startsWith(\"<!DOCTYPE html>\")\n    if (isHtml) {\n        let matchResult = baseUrl.match(new RegExp(\"pn|pixiv/novel|pixiv.net/novel\"))\n        if (matchResult == null) {\n            return []\n        }\n        let id = baseUrl.match(new RegExp(\"\\\\d+\"))[0]\n        java.log(`åŒ¹é…å°è¯´IDï¼š${id}`)\n        // res = util.getAjaxJson(util.urlNovelUrl(id))\n        result.novels.push(util.getAjaxJson(util.urlNovelUrl(id)))\n    } else {\n        // å…¼å®¹ api é“¾æ¥\n        let isApiJson = baseUrl.match(new RegExp(\"pn|pixiv/novel|pixiv.net/novel\"))\n        if (isApiJson && typeof(JSON.parse(res)) === \"object\") {\n            result.novels.push(JSON.parse(res))\n        } else {\n            result = JSON.parse(res)\n            if (result.total === 0) {\n                return []\n            }\n        }\n    }\n\n\n    // apiæ›´æ–°åï¼Œéœ€è¦ä½¿ç”¨ for å¾ªç¯\n    for (let i in result.novels) {\n        res = result.novels[i]\n        let prop = {}\n        //ä¸ºäº†å…¼é¡¾å¯¼å…¥ä¹¦æ¶ç›´æ¥èµ°è¯¦æƒ…é¡µé€»è¾‘\n        //è¿™é‡Œä¸èƒ½ç›´æ¥ç”¨book.xxx æ¥å¤ç”¨æœç´¢é¡µå¤„ç†ç»“æœ\n        prop.author = res.userName\n        prop.tags = res.tags\n        prop.count = res.length\n        prop.desc = res.desc\n        prop.cover_url = util.urlCoverUrl(res.coverUrl)\n\n        if (res.series === undefined || res.series === null) {\n            prop.name = res.title\n            prop.tags.unshift('å•æœ¬')\n            // prop.catalog = `https://api.furrynovel.ink/pixiv/novel/${res.id}/cache`\n            prop.catalog = util.urlNovelUrl(res.id)\n\n        } else {\n            prop.name = res.series.title\n            prop.tags.unshift('é•¿ç¯‡')\n            // prop.catalog = `https://api.furrynovel.ink/pixiv/series/${res.series.id}/cache`\n            prop.catalog = util.urlSeriesUrl(res.series.id)\n        }\n        prop.tags = prop.tags.join(\",\")\n        return prop\n    }\n})(result)\n",
            "intro": "desc",
            "kind": "tags",
            "lastChapter": "latest_chapter",
            "name": "name",
            "tocUrl": "catalog",
            "wordCount": "count"
        },
        "ruleContent": {
            "content": "@js:\nvar util = objParse(String(java.get(\"util\")))\n\nfunction objParse(obj) {\n    return JSON.parse(obj, (n, v) => {\n        if (typeof v == \"string\" && v.match(\"()\")) {\n            return eval(`(${v})`)\n        }\n        return v;\n    })\n}\n\n(function (res) {\n    res = JSON.parse(res)\n    let content = res.content\n    if (res.series !== null && res.desc !== undefined && res.desc !== \"\") {\n        content = res.desc + \"\\n\" + \"â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”\\n\".repeat(2) + content\n    }\n\n    // è·å– [uploadedimage:] çš„å›¾ç‰‡é“¾æ¥\n    //å°†å­˜åœ¨çš„pixivå›¾ç‰‡é“¾æ¥æ›¿æ¢ä¸ºå¯è®¿é—®çš„ç›´è¿\n    if (res.images !== undefined && res.images !== null) {\n        Object.keys(res.images).forEach((key) => {\n            content = content.replace(`[uploadedimage:${key}]`, `<img src=\"${util.urlCoverUrl(res.images[key].origin)}\">`)\n        })\n    }\n\n    // è·å– [pixivimage:] çš„å›¾ç‰‡é“¾æ¥ [pixivimage:1234] [pixivimage:1234-1]\n    let matched = content.match(RegExp(/\\[pixivimage:(\\d+)-?(\\d+)]/gm))\n    if (matched) {\n        for (let i in matched) {\n            let illustId, order\n            let matched2 = matched[i].match(RegExp(\"(\\\\d+)-?(\\\\d+)\"))\n            let temp = matched2[0].split(\"-\")\n            illustId = temp[0]\n            if (temp.length >= 1) {\n                order = temp[1]\n            }\n            content = content.replace(`${matched[i]}`, `<img src=\"${util.urlIllustOriginal(illustId, order)}\">`)\n        }\n    }\n\n    // æ›¿æ¢ Pixiv åˆ†é¡µæ ‡è®°ç¬¦å· [newpage]\n    matched = content.match(RegExp(/[ ã€€]*\\[newpage][ ã€€]*/gm))\n    if (matched) {\n        for (let i in matched){\n            java.log(matched[i])\n            content = content.replace(`${matched[i]}`, `${\"<p>â€‹<p/>\".repeat(3)}`)\n        }\n    }\n\n    // æ›¿æ¢ Pixiv ç« èŠ‚æ ‡è®°ç¬¦å· [chapter:]\n    matched = content.match(RegExp(/\\[chapter:(.*?)]/gm))\n    if (matched) {\n        for (let i in matched) {\n            let matched2 = matched[i].match(/\\[chapter:(.*?)]/m)\n            let chapter = matched2[1].trim()\n            // content = content.replace(`${matched[i]}`, `${\"<p>â€‹<p/>\".repeat(3)}${chapter}<p>â€‹<p/>`)\n            content = content.replace(`${matched[i]}`, `${chapter}<p>â€‹<p/>`)\n        }\n    }\n\n    // æ›¿æ¢ Pixiv è·³è½¬é¡µé¢æ ‡è®°ç¬¦å· [[jump:]]\n    matched = content.match(/\\[jump:(\\d+)]/gm)\n    if (matched) {\n        for (let i in matched) {\n            let page = matched[i].match(/\\d+/)\n            content = content.replace(`${matched[i]}`, `\\n\\nè·³è½¬è‡³ç¬¬${page}èŠ‚`)\n        }\n    }\n\n    // æ›¿æ¢ Pixiv é“¾æ¥æ ‡è®°ç¬¦å· [[jumpuri: > ]]\n    matched = content.match(/\\[\\[jumpuri:(.*?)>(.*?)]]/gm)\n    if (matched) {\n        for (let i in matched) {\n            let matched2 = matched[i].match(/\\[\\[jumpuri:(.*?)>(.*?)]]/m)\n            let matchedText = matched2[0]\n            let urlName = matched2[1].trim()\n            let urlLink = matched2[2].trim()\n            // é˜…è¯»ä¸æ”¯æŒè¶…é“¾æ¥\n            //content = content.replace(`${matchedText}`, `<a href=${urlLink}>${urlName}</a>`)\n            if (urlLink === urlName) {\n                content = content.replace(`${matchedText}`, `${urlName}`)\n            } else {\n                content = content.replace(`${matchedText}`, `${urlName}: ${urlLink}`)\n            }\n        }\n    }\n\n    // æ›¿æ¢ Pixiv æ³¨éŸ³æ ‡è®°ç¬¦å· [[rb: > ]]\n    matched = content.match(/\\[\\[rb:(.*?)>(.*?)]]/gm)\n    if (matched) {\n        for (let i in matched) {\n            let matched2 = matched[i].match(/\\[\\[rb:(.*?)>(.*?)]]/m)\n            let matchedText = matched2[0]\n            let kanji = matched2[1].trim()\n            let kana = matched2[2].trim()\n            // kanaä¸ºä¸­æ–‡ï¼Œåˆ™æ›¿æ¢å›ã€Šä¹¦åå·ã€‹\n            var reg = new RegExp(\"[\\\\u4E00-\\\\u9FFF]+\",\"g\");\n            if (reg.test(kana)) {\n                content = content.replace(`${matchedText}`, `${kanji}ã€Š${kana}ã€‹`)\n            } else{\n                // é˜…è¯»ä¸æ”¯æŒ <ruby> <rt> æ³¨éŸ³\n                // content = content.replace(`${matchedText}`, `<ruby>${kanji}<rt>${kana}</rt></ruby>`)\n                content = content.replace(`${matchedText}`, `${kanji}ï¼ˆ${kana}ï¼‰`)\n            }\n        }\n    }\n\n    return content\n})(result)",
            "imageStyle": "DEFAULT",
            "replaceRegex": "",
            "sourceRegex": ""
        },
        "ruleExplore": {
            "author": "userName",
            "bookList": "@js:\nvar util = objParse(String(java.get(\"util\")))\n\nfunction objParse(obj) {\n    return JSON.parse(obj, (n, v) => {\n        if (typeof v == \"string\" && v.match(\"()\")) {\n            return eval(`(${v})`)\n        }\n        return v;\n    })\n}\n\n// å­˜å‚¨seriesID\nvar seriesSet = new Set();\n// å°†å¤šä¸ªé•¿ç¯‡å°è¯´è§£æä¸ºä¸€æœ¬ä¹¦\nfunction combineNovels(novels) {\n    return novels.filter(novel => {\n        //å•æœ¬ç›´æ¥è§£æä¸ºä¸€æœ¬ä¹¦\n        //éœ€è¦åˆ¤æ–­æ˜¯å¦ä¸ºnull\n        if (novel.seriesId === undefined || novel.seriesId === null) {\n            return true\n        }\n\n        //é›†åˆä¸­æ²¡æœ‰è¯¥ç³»åˆ—è§£æä¸ºä¸€æœ¬ä¹¦\n        if (!seriesSet.has(novel.seriesId)) {\n            seriesSet.add(novel.seriesId)\n            return true\n        }\n\n        return false\n    })\n}\n\n// å°†å°è¯´çš„å°é¢è§„åˆ™ä¸è¯¦æƒ…åœ°å€æ›¿æ¢\nfunction handlerNovels(novels) {\n    novels.forEach(novel => {\n        // novel.detailedUrl = `https://api.furrynovel.ink/pixiv/novel/${novel.id}/cache`\n        novel.detailedUrl = util.urlNovelUrl(novel.id)\n        if (novel.seriesId !== undefined && novel.seriesId !== null) {\n            novel.title = novel.seriesTitle\n            novel.length = null\n\n            java.log(`æ­£åœ¨è·å–ç³»åˆ—å°è¯´ï¼š${novel.seriesId}`)\n            let series = util.getAjaxJson(util.urlSeriesUrl(novel.seriesId))\n            // åç«¯ç›®å‰æ²¡æœ‰ç³»åˆ—çš„coverUrlå­—æ®µ\n            // novel.coverUrl = `https://api.furrynovel.ink/proxy/pximg?url=${series.imageUrl}`\n            // novel.coverUrl = `https://api.furrynovel.ink/proxy/pximg?url=${series.novels[0].coverUrl}`\n            novel.coverUrl = util.urlCoverUrl(series.novels[0].coverUrl)\n\n            if (series.caption === \"\") {\n                let firstNovels = util.getAjaxJson(util.urlNovelsDetailed([series.novels[0].id]))\n                if (firstNovels.length > 0) {\n                    novel.desc = firstNovels[0].desc\n                } else {\n                    novel.desc = \"è¯¥å°è¯´å¯èƒ½éƒ¨åˆ†ç« èŠ‚å› ä¸ºæƒé™æˆ–è€…è¢«åˆ é™¤æ— æ³•æŸ¥çœ‹\"\n                }\n            } else {\n                novel.desc = series.caption\n            }\n\n            //å¦‚æœæ²¡æœ‰æ ‡ç­¾ å–ç¬¬ä¸€ç« çš„tag\n            if (series.tags.length === 0) {\n                // ç³»åˆ—è‡³å°‘ä¼šæœ‰ä¸€ç« \n                novel.tags = series.novels[0].tags\n            } else {\n                novel.tags = series.tags\n            }\n\n            if (novel.tags === undefined) {\n                novel.tags = []\n            }\n            novel.tags.unshift(\"é•¿ç¯‡\")\n\n\n        } else {\n            novel.tags.unshift(\"å•æœ¬\")\n            // novel.coverUrl = `https://api.furrynovel.ink/proxy/pximg?url=${novel.coverUrl}`\n            novel.coverUrl = util.urlCoverUrl(novel.coverUrl)\n        }\n\n        novel.tags = novel.tags.join(\",\")\n    })\n    return novels\n}\n\n/**\n * @params arr ä¼ å…¥çš„æºæ•°ç»„\n * @params length éœ€è¦è·å–çš„å…ƒç´ çš„ä¸ªæ•°\n */\nfunction randomChoseArrayItem(arr, length) {\n    let copyArr = JSON.parse(JSON.stringify(arr))\n    let newArr = [];\n    for (let i = 0; i < length; i++) {\n        let index = Math.floor(Math.random() * copyArr.length);\n        let item = copyArr[index];\n        newArr.push(item)\n        copyArr.splice(index, 1)\n    }\n    return newArr.reverse()\n}\n\n\nfunction handlerRecommendUsers() {\n    const MAX_FETCH_USER_NUMBER = 2;\n\n    return () => {\n        let novelList = []\n        let userIds = JSON.parse(result).map(i => i.id)\n        // java.log(`ç”¨æˆ·idä¸ªæ•°:${userIds.length}`)\n        if (userIds.length > MAX_FETCH_USER_NUMBER) {\n            userIds = randomChoseArrayItem(userIds, MAX_FETCH_USER_NUMBER);\n        }\n\n        // java.log(`æŸ¥è¯¢çš„ç”¨æˆ·Ids:${userIds}`)\n\n        let usersInfo = util.getWebviewJson(util.urlUserDetailed(userIds))\n        // java.log(`è¿”å›çš„${JSON.stringify(usersInfo)}`)\n        let queryNovelIds = []\n        // java.log(`${JSON.stringify(usersInfo)}`)\n        usersInfo.filter(user => user.novels && user.novels.length > 0)\n            .map(user => user.novels)\n            // å°†listå±•å¹³[1,2,3]å˜ä¸º1,2,3 æ·»åŠ åˆ°novelListä¸­\n            .forEach(novels => {\n                novels.forEach(novel => {\n                    queryNovelIds.push(novel)\n                })\n            })\n        // æš‚æ—¶é™åˆ¶æœ€å¤§è·å–æ•°é‡\n        if (queryNovelIds.length > 10) {\n            queryNovelIds = randomChoseArrayItem(queryNovelIds, 10)\n        }\n        novelList = util.getWebviewJson(util.urlNovelsDetailed(queryNovelIds))\n        return handlerNovels(combineNovels(novelList))\n    }\n}\n\nfunction handlerFollowLatest() {\n    return () => {\n        let resp = JSON.parse(result)\n        return handlerNovels(combineNovels(resp))\n    }\n}\n\nfunction handlerFactory() {\n    if (baseUrl.indexOf(\"/fav/user\") !== -1) {\n        return handlerRecommendUsers()\n    }\n\n    if (baseUrl.indexOf(\"/pixiv/novels/recent\") !== -1) {\n        return handlerFollowLatest()\n    }\n\n}\n\n(() => {\n    return handlerFactory()()\n})()\n",
            "bookUrl": "detailedUrl",
            "coverUrl": "coverUrl",
            "intro": "desc",
            "kind": "tags",
            "lastChapter": "",
            "name": "title",
            "wordCount": "length"
        },
        "ruleSearch": {
            "author": "userName",
            "bookList": "@js:\nvar util = objParse(String(java.get(\"util\")))\n\nfunction objParse(obj) {\n    return JSON.parse(obj, (n, v) => {\n        if (typeof v == \"string\" && v.match(\"()\")) {\n            return eval(`(${v})`)\n        }\n        return v;\n    })\n}\n\nfunction cacheGetAndSet(key, supplyFunc) {\n    let v = cache.get(key)\n    if (v === undefined || v === null) {\n        v = JSON.stringify(supplyFunc())\n        // ç¼“å­˜10åˆ†é’Ÿ\n        cache.put(key, v, 600)\n    }\n    return JSON.parse(v)\n}\n\nfunction getAjaxJson(url) {\n    return cacheGetAndSet(url, () => {\n        return JSON.parse(java.ajax(url))\n    })\n}\n\nfunction getWebviewJson(url) {\n    return cacheGetAndSet(url, () => {\n        let html = java.webView(null, url, null)\n        // todoï¼šæœç´¢ä½œè€…æœ‰é—®é¢˜\n        return JSON.parse((html.match(new RegExp(\">\\\\[\\{.*?}]<\"))[0].replace(\">\", \"\").replace(\"<\", \"\")))\n    })\n}\n\n\nfunction getUser(username, exactMatch) {\n    // ä¿®å¤ä¼ å…¥objectçš„bug\n    username = String(username)\n    let resp = getAjaxJson(util.urlSearchUsers(username))\n    if (resp.users.length === 0) {\n        return []\n    }\n    if (!exactMatch) {\n        return resp.users\n    }\n    // åªè¿”å›ç”¨æˆ·åå®Œå…¨ä¸€æ ·çš„ç”¨æˆ·\n    return resp.users.filter(user => {\n        return user.name === username\n    })\n}\n\n// åŒ…å«æ‰€æœ‰å°è¯´æ•°æ®\nfunction getUserDetailedList(uidList) {\n    // java.log(`UIDLIST:${JSON.stringify(uidList)}`)\n    return getWebviewJson(util.urlUserDetailed(uidList))\n}\n\nfunction getNovels(nidList) {\n    let page = Number(java.get(\"page\"))\n    // åˆ†é¡µ\n    let list = nidList.slice((page - 1) * 20, page * 20)\n    if (list.length === 0) {\n        return []\n    }\n\n    // java.log(`NIDURL:${util.urlNovelsDetailed(list)}`)\n    return getWebviewJson(util.urlNovelsDetailed(list))\n}\n\n// å­˜å‚¨seriesID\nvar first = true;\nvar seriesSet = {\n    keywords: \"Linpx:Search\",\n    has: (value) => {\n        let page = Number(java.get(\"page\"))\n        if (page === 1 && first) {\n            first = false\n            cache.deleteMemory(this.keywords)\n            return false\n        }\n\n        let v = cache.getFromMemory(this.keywords)\n        if (v === undefined || v === null) {\n            return false\n        }\n        let set = new Set(JSON.parse(v))\n        return set.has(value)\n    },\n\n    add: (value) => {\n        let v = cache.getFromMemory(this.keywords)\n        if (v === undefined || v === null) {\n            cache.putMemory(this.keywords, JSON.stringify([value]))\n\n        } else {\n            let arr = JSON.parse(v)\n            if (typeof arr === \"string\") {\n                arr = Array(arr)\n            }\n            arr.push(value)\n            cache.putMemory(this.keywords, JSON.stringify(arr))\n        }\n    },\n};\n\n// å°†å¤šä¸ªé•¿ç¯‡å°è¯´è§£æä¸ºä¸€æœ¬ä¹¦\nfunction combineNovels(novels) {\n    return novels.filter(novel => {\n        //å•æœ¬ç›´æ¥è§£æä¸ºä¸€æœ¬ä¹¦\n        //éœ€è¦åˆ¤æ–­æ˜¯å¦ä¸ºnull\n        if (novel.seriesId === undefined || novel.seriesId === null) {\n            return true\n        }\n\n        //é›†åˆä¸­æ²¡æœ‰è¯¥ç³»åˆ—è§£æä¸ºä¸€æœ¬ä¹¦\n        if (!seriesSet.has(novel.seriesId)) {\n            seriesSet.add(novel.seriesId)\n            return true\n        }\n\n        return false\n    })\n}\n\n// å°†å°è¯´çš„å°é¢è§„åˆ™ä¸è¯¦æƒ…åœ°å€æ›¿æ¢\nfunction formatNovels(novels) {\n    novels.forEach(novel => {\n        // novel.detailedUrl = `https://api.furrynovel.ink/pixiv/novel/${novel.id}`\n        novel.detailedUrl = util.urlNovelUrl(novel.id)\n        if (novel.seriesId !== undefined && novel.seriesId !== null) {\n            novel.title = novel.seriesTitle\n            novel.length = null\n\n            let series = getAjaxJson(util.urlSeriesUrl(novel.seriesId))\n            // åç«¯ç›®å‰æ²¡æœ‰ç³»åˆ—çš„coverUrlå­—æ®µ\n            // novel.coverUrl = `https://api.furrynovel.ink/proxy/pximg?url=${series.imageUrl}`\n            // novel.coverUrl = `https://api.furrynovel.ink/proxy/pximg?url=${series.novels[0].coverUrl}`\n            novel.coverUrl = util.urlCoverUrl(series.novels[0].coverUrl)\n            if (series.caption === \"\") {\n                let firstNovels = getAjaxJson(util.urlNovelsDetailed([series.novels[0].id]))\n                if (firstNovels.length > 0) {\n                    novel.desc = firstNovels[0].desc\n                } else {\n                    novel.desc = \"è¯¥å°è¯´å¯èƒ½éƒ¨åˆ†ç« èŠ‚å› ä¸ºæƒé™æˆ–è€…è¢«åˆ é™¤æ— æ³•æŸ¥çœ‹\"\n                }\n            } else {\n                novel.desc = series.caption\n            }\n\n            //å¦‚æœæ²¡æœ‰æ ‡ç­¾ å–ç¬¬ä¸€ç« çš„tag\n            if (series.tags.length === 0) {\n                // ç³»åˆ—è‡³å°‘ä¼šæœ‰ä¸€ç« \n                novel.tags = series.novels[0].tags\n            } else {\n                novel.tags = series.tags\n            }\n\n            if (novel.tags === undefined) {\n                novel.tags = []\n            }\n            novel.tags.unshift(\"é•¿ç¯‡\")\n\n\n        } else {\n            if (novel.tags === undefined) {\n                novel.tags = []\n            }\n            novel.tags.unshift(\"å•æœ¬\")\n            // novel.coverUrl = `https://api.furrynovel.ink/proxy/pximg?url=${novel.coverUrl}`\n            novel.coverUrl = util.urlCoverUrl(novel.coverUrl)\n        }\n\n        novel.tags = novel.tags.join(\",\")\n    })\n    return novels\n}\n\nfunction findUserNovels(username) {\n    let novelList = []\n    // æŸ¥è¯¢ç”¨æˆ·\n    let userArr = getUser(username, true)\n    // è·å–ç”¨æˆ·æ‰€æœ‰å°è¯´\n    let uidList = userArr.filter(user => {\n        return user.novels.length > 0\n    }).map(user => user.id)\n\n    if (uidList.length > 0) {\n        let list = getUserDetailedList(uidList)\n        let nidList = []\n        // ä»ä¸¤å±‚æ•°ç»„ä¸­æå–novelsId\n        list.forEach(user => {\n            user.novels\n                // æŒ‰idé™åºæ’åº-ç›¸å½“äºæŒ‰æ—¶é—´é™åºæ’åº\n                .reverse()\n                .forEach(nid => nidList.push(nid))\n        })\n        getNovels(nidList).forEach(novel => {\n            novelList.push(novel)\n        })\n    }\n    return novelList\n}\n\n(function (res) {\n    res = JSON.parse(res)\n    let novels = []\n    findUserNovels(java.get(\"key\")).forEach(v => {\n        novels.push(v)\n    })\n    novels = novels.concat(res.novels)\n    // è¿”å›ç©ºåˆ—è¡¨ä¸­æ­¢æµç¨‹\n    if (novels.length === 0) {\n        return []\n    }\n    return formatNovels(combineNovels(novels))\n}(result))",
            "bookUrl": "detailedUrl",
            "coverUrl": "coverUrl",
            "intro": "desc",
            "kind": "tags",
            "name": "title",
            "wordCount": "length"
        },
        "ruleToc": {
            "chapterList": "@js:\nvar util = objParse(String(java.get(\"util\")))\n\nfunction objParse(obj) {\n    return JSON.parse(obj, (n, v) => {\n        if (typeof v == \"string\" && v.match(\"()\")) {\n            return eval(`(${v})`)\n        }\n        return v;\n    })\n}\n\n(function (res) {\n    res = JSON.parse(res)\n    if (res.novels !== undefined) {\n        res.novels.forEach(v => {\n            // v['url'] = `https://api.furrynovel.ink/pixiv/novel/${v.id}${cache}`\n            v['url'] = util.urlNovelUrl(v.id)\n        })\n        return res.novels\n    }\n    return [{\n        id: res.id,\n        title: res.title\n    }]\n})(result)\n",
            "chapterName": "title",
            "chapterUrl": "url"
        },
        "searchUrl": "@js:\njava.put(\"page\",page);java.put(\"key\",key);\n`https://api.furrynovel.ink/pixiv/search/novel/${encodeURI(key)}/cache?page=${page}`;",
        "variableComment": "",
        "weight": 0
    }
]