[
    {
        "bookSourceComment": "Pixiv å°è¯´ï¼ˆæ›´æ–°ğŸ“†ï¼š2025-10-31ï¼‰\r\n\r\nä¹¦æºç‰ˆæœ¬ï¼š240\r\nä½¿ç”¨è¯´æ˜ï¼šğŸ“Œé˜…è¯»ç‰ˆæœ¬ 3.25.0527 åŠä¹‹åç‰ˆæœ¬å¯ç”¨\r\nå¯ç”¨åŠŸèƒ½ï¼šâœ…æœç´¢âœ…å‘ç°âœ…æ·»åŠ ç½‘å€âœ…è®¢é˜…æº\r\næœç´¢å°è¯´ï¼šâœ…å•ç¯‡âœ…ç³»åˆ—âœ…æ ‡ç­¾âœ…ä½œè€…\r\nå‘ç°å°è¯´ï¼šâœ…å…³æ³¨âœ…è¿½æ›´âœ…æ¨èâœ…å‘ç°\r\nå‘ç°å°è¯´ï¼šâœ…æ”¶è—âœ…ä¹¦ç­¾âœ…é¦–é¡µâœ…æ’è¡Œ\r\næ·»åŠ ç½‘å€ï¼šâœ…å°è¯´âœ…ç³»åˆ—âœ…ä½œè€…\r\nè®¢é˜…ç”¨æ³•ï¼šç‚¹å‡»è®¢é˜…æºæ‰“å¼€å°è¯´/ç³»åˆ—å°è¯´ï¼Œã€åˆ·æ–°ã€‘ï¼Œç‚¹å‡»ã€åŠ å…¥ä¹¦æ¶ã€‘æŒ‰é’®ï¼Œæ·»åŠ åˆ°ä¹¦æ¶\r\n\r\nä¹¦æºå‘å¸ƒï¼šå…½äººé˜…è¯»é¢‘é“ https://t.me/FurryReading\r\né¡¹ç›®åœ°å€ï¼šhttps://github.com/windyhusky/PixivSource\r\nä½¿ç”¨æ•™ç¨‹ï¼šhttps://github.com/windyhusky/PixivSource/blob/main/doc/Pixiv.md\r\n\r\næ—§ç‰ˆä¹¦æºï¼š\r\nhttps://cdn.jsdelivr.net/gh/windyhusky/PixivSource@191/pixiv.json\r\nhttps://raw.githubusercontent.com/windyhusky/PixivSource/191/pixiv.json\r\n\r\nè§„åˆ™è®¢é˜…ï¼šimport è®¢é˜…æº\r\nhttps://cdn.jsdelivr.net/gh/windyhusky/PixivSource@main/import.json\r\nhttps://raw.githubusercontent.com/windyhusky/PixivSource/main/import.json\r\n\r\nâš™ï¸ ä¹¦æºè®¾ç½®ï¼š\r\nè®¾ç½®1ï¸âƒ£ï¼šæ‰“å¼€å°è¯´ - èœå• - ç™»å½• - ç‚¹å‡»ä¸‹æ–¹æŒ‰é’®\r\nè®¾ç½®2ï¸âƒ£ï¼šç¼–è¾‘ä¹¦æº - åŸºæœ¬ - å˜é‡è¯´æ˜ - ä¿®æ”¹å¹¶ä¿å­˜\r\n\r\nğŸš« å±è”½ä½œè€…(æœ¬åœ°)ï¼š\r\nâ–¶ï¸è®¾ç½®æ–¹æ³•ï¼šæ‰“å¼€å°è¯´ - èœå• - ç™»å½• - ğŸš« å±è”½ä½œè€…\r\n\r\nğŸš« å±è”½æ ‡ç­¾/æè¿°(æœ¬åœ°)ï¼š\r\n1ï¸âƒ£ç¼–è¾‘ä¹¦æºï¼šèœå• - ç™»å½• - ç‚¹å‡»ã€ ğŸ‘€ æŸ¥çœ‹å±è”½ã€‘\r\n2ï¸âƒ£åˆ‡æ¢åˆ—è¡¨ï¼šç‚¹å‡»æŒ‰é’®ï¼Œåˆ‡æ¢è‡³ã€ç›¸åº”å±è”½åˆ—è¡¨ã€‘\r\n3ï¸âƒ£è¾“å…¥å†…å®¹ï¼šåœ¨ã€è¾“å…¥å†…å®¹ã€‘å¤„è¾“å…¥å±è”½å†…å®¹\r\n4ï¸âƒ£å±è”½ä½œè€…ï¼šç‚¹å‡»ã€ğŸš« åŠ å…¥å±è”½ã€‘ï¼Œå±è”½è¯¥å†…å®¹\r\n\r\nğŸ“Œ å–œæ¬¢æ ‡ç­¾(æœ¬åœ°)ï¼š\r\n1ï¸âƒ£ç¼–è¾‘ä¹¦æºï¼šèœå• - ç™»å½• ï¼Œæ‰¾åˆ°è¾“å…¥å†…å®¹\r\n2ï¸âƒ£è¾“å…¥å†…å®¹ï¼šè¾“å…¥æ ‡ç­¾ï¼Œç‚¹å‡»ã€ğŸ“Œ å–œæ¬¢æ ‡ç­¾ã€‘\r\n\r\nâ¤ï¸ æŸ¥çœ‹ä»–äººæ”¶è—ï¼š\r\n1ï¸âƒ£ç¼–è¾‘ä¹¦æºï¼šèœå• - ç™»å½• ï¼Œæ‰¾åˆ°è¾“å…¥å†…å®¹\r\n2ï¸âƒ£è¾“å…¥å†…å®¹ï¼šè¾“å…¥ä½œè€…IDï¼Œç‚¹å‡»ã€â¤ï¸ ä»–äººæ”¶è—ã€‘",
        "bookSourceGroup": "ğŸ” Pixiv",
        "bookSourceName": "ğŸ…¿ï¸ Pixiv å°è¯´",
        "bookSourceType": 0,
        "bookSourceUrl": "https://www.pixiv.net/novel",
        "bookUrlPattern": "(https?://)?(www\\.)?pixiv\\.net(/ajax)?/(novel/(show\\.php\\?id=|series/)?|users?/)\\d+.*",
        "concurrentRate": "3/2000",
        "customButton": false,
        "customOrder": 0,
        "enabled": true,
        "enabledCookieJar": true,
        "enabledExplore": true,
        "eventListener": false,
        "exploreUrl": "@js:\n@js:\r\nlet SHOW_R18_GENRE, SHOW_GENERAL_NEW, SHOW_GENERAL_RANK, SHOW_GENERAL_GENRE\r\ntry {\r\n    settings = JSON.parse(String(source.variableComment).match(RegExp(/{([\\s\\S]*?)}/gm)))\r\n    SHOW_R18_GENRE = settings.SHOW_R18_GENRE         // å‘ç°ï¼šçƒ­é—¨åˆ†ç±»æ˜¾ç¤ºR18å°è¯´\r\n    SHOW_GENERAL_NEW = settings.SHOW_GENERAL_NEW     // å‘ç°ï¼šæœ€æ–°ã€ä¼åˆ’ã€çº¦ç¨¿æ˜¾ç¤ºä¸€èˆ¬å°è¯´\r\n    SHOW_GENERAL_RANK = settings.SHOW_GENERAL_RANK   // å‘ç°ï¼šæ’è¡Œæ¦œæ˜¾ç¤ºä¸€èˆ¬å°è¯´\r\n    SHOW_GENERAL_GENRE = settings.SHOW_GENERAL_GENRE // å‘ç°ï¼šçƒ­é—¨åˆ†ç±»æ˜¾ç¤ºä¸€èˆ¬å°è¯´\r\n} catch (e) {\r\n    SHOW_R18_GENRE = false\r\n    SHOW_GENERAL_NEW = false\r\n    SHOW_GENERAL_RANK = false\r\n    SHOW_GENERAL_GENRE = false\r\n}\r\n\r\nli = [\r\n    {\"â­ï¸ å…³æ³¨\": \"https://www.pixiv.net/ajax/follow_latest/novel?p={{page}}&mode=r18&lang=zh\"},\r\n    {\"ğŸ“ƒ è¿½æ›´\": \"https://www.pixiv.net/ajax/watch_list/novel?p={{page}}&new=1&lang=zh\"},\r\n    {\"ğŸ’¯ æ¨è\": \"https://www.pixiv.net/ajax/top/novel?mode=r18&lang=zh\"},\r\n    {\"ğŸ” å‘ç°\": \"https://www.pixiv.net/ajax/novel/discovery?mode=r18&lang=zh\"},\r\n    {\"â¤ï¸ æ”¶è—\": \"https://www.pixiv.net/ajax/user/{{cache.get(\\\"pixiv:uid\\\")}}/novels/bookmarks?tag=&offset={{(page-1)*24}}&limit=24&rest=show&lang=zh\"},\r\n    {\"ãŠ™ï¸ æ”¶è—\": \"https://www.pixiv.net/ajax/user/{{cache.get(\\\"pixiv:uid\\\")}}/novels/bookmarks?tag=&offset={{(page-1)*24}}&limit=24&rest=hide&lang=zh\"},\r\n    {\"ğŸ·ï¸ ä¹¦ç­¾\": \"https://www.pixiv.net/novel/marker_all.php\"},\r\n    {\"ğŸ  é¦–é¡µ\": \"https://www.pixiv.net\"},\r\n]\r\n\r\nnormal = [\r\n    {\"âœ… å¸¸è§„ å°è¯´ æ¨è âœ…\": \"\"},\r\n    {\"â­ï¸ å…³æ³¨\": \"https://www.pixiv.net/ajax/follow_latest/novel?p={{page}}&mode=all&lang=zh\"},\r\n    {\"ğŸ’¯ æ¨è\": \"https://www.pixiv.net/ajax/top/novel?mode=all&lang=zh\"},\r\n    {\"ğŸ” å‘ç°\": \"https://www.pixiv.net/ajax/novel/discovery?mode=safe&lang=zh\"},\r\n    {\"ğŸ†™ æ›´æ–°\": \"https://cdn.jsdelivr.net/gh/windyhusky/PixivSource@main/pixiv.json\"},\r\n]\r\n\r\nr18New = [\r\n    {\"ğŸ†• æœ€æ–° ä¼åˆ’ çº¦ç¨¿ ğŸ’°\": \"\"},\r\n    {\"ğŸ†• æœ€æ–°\": \"https://www.pixiv.net/ajax/novel/new?lastId=0&limit=20&r18=true&lang=zh\"},\r\n    {\"ğŸ“‘ ä¼åˆ’\": \"https://www.pixiv.net/ajax/user_event/portal/novels?mode=r18&p={{page}}&lang=zh\"},\r\n    {\"ğŸ’° çº¦ç¨¿\": \"https://www.pixiv.net/ajax/commission/page/request/complete/novels?mode=r18&p={{page}}&lang=zh\"},\r\n    {\"ğŸ” å‘ç°\": \"https://www.pixiv.net/ajax/novel/discovery?mode=all&lang=zh\"},\r\n]\r\n\r\ngeneralNew = [\r\n    {\"âœ… æœ€æ–° ä¼åˆ’ çº¦ç¨¿ âœ…\": \"\"},\r\n    {\"æœ€æ–°\": \"https://www.pixiv.net/ajax/novel/new?lastId=0&limit=20&r18=false&lang=zh\"},\r\n    {\"ä¼åˆ’\": \"https://www.pixiv.net/ajax/user_event/portal/novels?mode=all&p={{page}}&lang=zh\"},\r\n    {\"çº¦ç¨¿\": \"https://www.pixiv.net/ajax/commission/page/request/complete/novels?mode=all&p={{page}}&lang=zh\"},\r\n    {\"ç¼–è¾‘\": \"https://www.pixiv.net/novel/editors_picks\"},\r\n]\r\n\r\nr18Rank = [\r\n    {\"ğŸ‘‘ æ’è¡Œæ¦œå• ğŸ‘‘\": \"\"},\r\n    {\"ä»Šæ—¥\": \"https://www.pixiv.net/novel/ranking.php?mode=daily_r18\"},\r\n    {\"æœ¬å‘¨\": \"https://www.pixiv.net/novel/ranking.php?mode=weekly_r18\"},\r\n    {\"R18G\": \"https://www.pixiv.net/novel/ranking.php?mode=r18g\"},\r\n    {\"ç”·æ€§\": \"https://www.pixiv.net/novel/ranking.php?mode=male_r18\"},\r\n    {\"å¥³æ€§\": \"https://www.pixiv.net/novel/ranking.php?mode=female_r18\"}\r\n]\r\n\r\ngeneralRank = [\r\n    {\"ğŸ† æ’è¡Œæ¦œå• ğŸ†\": \"\"},\r\n    {\"ä»Šæ—¥\": \"https://www.pixiv.net/novel/ranking.php?mode=daily\"},\r\n    {\"æœ¬å‘¨\": \"https://www.pixiv.net/novel/ranking.php?mode=weekly\"},\r\n    {\"æœ¬æœˆ\": \"https://www.pixiv.net/novel/ranking.php?mode=monthly\"},\r\n    {\"ç”·æ€§\": \"https://www.pixiv.net/novel/ranking.php?mode=male\"},\r\n    {\"å¥³æ€§\": \"https://www.pixiv.net/novel/ranking.php?mode=female\"},\r\n    {\"æ–°äºº\": \"https://www.pixiv.net/novel/ranking.php?mode=rookie\"},\r\n    {\"åŸåˆ›\": \"https://www.pixiv.net/novel/ranking.php?mode=weekly_original\"},\r\n    {\"AIç”Ÿæˆ\": \"https://www.pixiv.net/novel/ranking.php?mode=weekly_ai\"}\r\n]\r\n\r\nr18Genre = [\r\n    {\"ğŸ”¥ åŸåˆ›çƒ­é—¨ ğŸ”¥\": \"\"},\r\n    {\"ç”·æ€§\": \"https://www.pixiv.net/ajax/genre/novel/male?mode=r18&lang=zh\"},\r\n    {\"å¥³æ€§\": \"https://www.pixiv.net/ajax/genre/novel/female?mode=r18&lang=zh\"},\r\n    {\"æ‹çˆ±\": \"https://www.pixiv.net/ajax/genre/novel/romance?mode=r18&lang=zh\"},\r\n    {\"å¼‚ä¸–ç•Œå¥‡å¹»\": \"https://www.pixiv.net/ajax/genre/novel/isekai_fantasy?mode=r18&lang=zh\"},\r\n    {\"ç°ä»£å¥‡å¹»\": \"https://www.pixiv.net/ajax/genre/novel/contemporary_fantasy?mode=r18&lang=zh\"},\r\n    {\"æ‚¬ç–‘\": \"https://www.pixiv.net/ajax/genre/novel/mystery?mode=r18&lang=zh\"},\r\n    {\"ææ€–\": \"https://www.pixiv.net/ajax/genre/novel/horror?mode=r18&lang=zh\"},\r\n    {\"ç§‘å¹»\": \"https://www.pixiv.net/ajax/genre/novel/sci-fi?mode=r18&lang=zh\"},\r\n    {\"æ–‡å­¦\": \"https://www.pixiv.net/ajax/genre/novel/literature?mode=r18&lang=zh\"},\r\n    {\"æƒ…æ„Ÿ\": \"https://www.pixiv.net/ajax/genre/novel/drama?mode=r18&lang=zh\"},\r\n    {\"å†å²\": \"https://www.pixiv.net/ajax/genre/novel/historical_pieces?mode=r18&lang=zh\"},\r\n    {\"è€½ç¾\": \"https://www.pixiv.net/ajax/genre/novel/bl?mode=r18&lang=zh\"},\r\n    {\"ç™¾åˆ\": \"https://www.pixiv.net/ajax/genre/novel/yuri?mode=r18&lang=zh\"},\r\n    {\"æ•£æ–‡Â·è¯—æ­Œ\": \"https://www.pixiv.net/ajax/genre/novel/poetry?mode=r18&lang=zh\"},\r\n    {\"éšç¬”Â·çºªå®\": \"https://www.pixiv.net/ajax/genre/novel/non-fiction??mode=r18&lang=zh\"},\r\n    {\"å‰§æœ¬\": \"https://www.pixiv.net/ajax/genre/novel/screenplays?mode=r18&lang=zh\"},\r\n    {\"è¯„è®º\": \"https://www.pixiv.net/ajax/genre/novel/reviews?mode=r18&lang=zh\"},\r\n    {\"å…¶ä»–\": \"https://www.pixiv.net/ajax/genre/novel/other?mode=r18&lang=zh\"}\r\n]\r\n\r\ngeneralgGenre = [\r\n    {\"â¤ï¸â€ğŸ”¥ åŸåˆ›çƒ­é—¨ â¤ï¸â€ğŸ”¥\": \"\"},\r\n    {\"ç»¼åˆ\": \"https://www.pixiv.net/ajax/genre/novel/all?mode=safe&lang=zh\"},\r\n    {\"æ‹çˆ±\": \"https://www.pixiv.net/ajax/genre/novel/romance?mode=safe&lang=zh\"},\r\n    {\"å¼‚ä¸–ç•Œå¥‡å¹»\": \"https://www.pixiv.net/ajax/genre/novel/isekai_fantasy?mode=safe&lang=zh\"},\r\n    {\"ç°ä»£å¥‡å¹»\": \"https://www.pixiv.net/ajax/genre/novel/contemporary_fantasy?mode=safe&lang=zh\"},\r\n    {\"æ‚¬ç–‘\": \"https://www.pixiv.net/ajax/genre/novel/mystery?mode=safe&lang=zh\"},\r\n    {\"ææ€–\": \"https://www.pixiv.net/ajax/genre/novel/horror?mode=safe&lang=zh\"},\r\n    {\"ç§‘å¹»\": \"https://www.pixiv.net/ajax/genre/novel/sci-fi?mode=safe&lang=zh\"},\r\n    {\"æ–‡å­¦\": \"https://www.pixiv.net/ajax/genre/novel/literature?mode=safe&lang=zh\"},\r\n    {\"æƒ…æ„Ÿ\": \"https://www.pixiv.net/ajax/genre/novel/drama?mode=safe&lang=zh\"},\r\n    {\"å†å²\": \"https://www.pixiv.net/ajax/genre/novel/historical_pieces?mode=safe&lang=zh\"},\r\n    {\"è€½ç¾\": \"https://www.pixiv.net/ajax/genre/novel/bl?mode=safe&lang=zh\"},\r\n    {\"ç™¾åˆ\": \"https://www.pixiv.net/ajax/genre/novel/yuri?mode=safe&lang=zh\"},\r\n    {\"æ•£æ–‡Â·è¯—æ­Œ\": \"https://www.pixiv.net/ajax/genre/novel/poetry?mode=safe&lang=zh\"},\r\n    {\"éšç¬”Â·çºªå®\": \"https://www.pixiv.net/ajax/genre/novel/non-fiction??mode=safe&lang=zh\"},\r\n    {\"å‰§æœ¬\": \"https://www.pixiv.net/ajax/genre/novel/screenplays?mode=safe&lang=zh\"},\r\n    {\"è¯„è®º\": \"https://www.pixiv.net/ajax/genre/novel/reviews?mode=safe&lang=zh\"},\r\n    {\"å…¶ä»–\": \"https://www.pixiv.net/ajax/genre/novel/other?mode=safe&lang=zh\"}\r\n]\r\n\r\nlet likeTagLinks = [{\"ğŸ“Œ å–œæ¬¢æ ‡ç­¾ ğŸ“Œ\":\"\"}]\r\nlet othersBookmarks = [{\"â¤ï¸ ä»–äººæ”¶è— â¤ï¸\": \"\"}]\r\n\r\nli = li.concat(normal)\r\nli = li.concat(r18New)\r\nif (SHOW_GENERAL_NEW === true) {\r\n    li = li.concat(generalNew)\r\n}\r\nli = li.concat(r18Rank)\r\nif (SHOW_GENERAL_RANK === true) {\r\n    li = li.concat(generalRank)\r\n}\r\nif (SHOW_R18_GENRE === true) {\r\n    li = li.concat(r18Genre)\r\n}\r\nif (SHOW_GENERAL_GENRE === true) {\r\n    li = li.concat(generalgGenre)\r\n}\r\nsleepToast('ä½¿ç”¨æŒ‡å—ğŸ”–\\n\\nå‘ç° - æ›´æ–° - ç‚¹å‡»\"ğŸ”° ä½¿ç”¨æŒ‡å—\" - æŸ¥çœ‹')\r\n\r\n// æ”¶è—æ ‡ç­¾\r\nlet likeTags = getFromCache(\"likeTags\")\r\nif (likeTags !== null && likeTags.length >= 1) {\r\n    likeTags.forEach(tag => {\r\n        let tagLink = {}\r\n        tagLink[tag] = `${urlSearchNovel(tag, \"{{page}}\")}`\r\n        likeTagLinks.push(tagLink)\r\n    })\r\n    li = li.concat(likeTagLinks)\r\n}\r\n\r\n// ä»–äººæ”¶è—\r\nlet likeAuthors = getFromCacheMap(\"likeAuthors\")\r\nif (likeAuthors.size > 0) {\r\n    likeAuthors.forEach((authorName, authorId) => {\r\n        let bookmark = {}\r\n        bookmark[authorName] = urlUserBookmarks(authorId)\r\n        othersBookmarks.push(bookmark)\r\n    })\r\n    li = li.concat(othersBookmarks)\r\n}\r\n\r\n// æ·»åŠ æ ¼å¼\r\nli.forEach(item => {\r\n    item.title = Object.keys(item)[0]\r\n    item.url = Object.values(item)[0]\r\n    delete item[Object.keys(item)[0]]\r\n    item.style = {}\r\n    item.style.layout_flexGrow = 1\r\n    item.style.layout_flexShrink = 1\r\n    item.style.layout_alignSelf = \"auto\"\r\n    item.style.layout_wrapBefore = \"false\"\r\n    if (item.url === \"\") {\r\n        item.style.layout_flexBasisPercent = 1\r\n    } else {\r\n        item.style.layout_flexBasisPercent = -1\r\n    }\r\n})\r\n\r\nJSON.stringify(li)",
        "header": "{\"referer\":\"https://www.pixiv.net\"}",
        "jsLib": "var checkTimes = 0\r\nvar cacheSaveSeconds = 7*24*60*60  // é•¿æœŸç¼“å­˜æ—¶é—´ 7å¤©\r\nvar cacheTempSeconds = 10*60*1000  // çŸ­æœŸç¼“å­˜ 10min\r\n\r\nfunction cacheGetAndSet(cache, key, supplyFunc) {\r\n    let v = cache.get(key)\r\n    // ç¼“å­˜ä¿¡æ¯é”™è¯¯æ—¶ï¼Œä¿å­˜ 10min åé‡æ–°è¯·æ±‚\r\n    if (v && JSON.parse(v).error === true) {\r\n        if (new Date().getTime() >= JSON.parse(v).timestamp + cacheTempSeconds) {\r\n            cache.delete(key)\r\n            v = cache.get(key)\r\n        }\r\n    }\r\n    // æ— ç¼“å­˜ä¿¡æ¯æ—¶ï¼Œè¿›è¡Œè¯·æ±‚\r\n    if (v === undefined || v === null) {\r\n        v = supplyFunc()\r\n        v.timestamp = new Date().getTime()\r\n        v = JSON.stringify(v)\r\n        cache.put(key, v, cacheSaveSeconds)\r\n    }\r\n    return JSON.parse(v)\r\n}\r\n\r\nfunction putInCache(objectName, object, saveSeconds) {\r\n    const {java, cache} = this\r\n    if (object === undefined) object = null\r\n    if (saveSeconds === undefined) saveSeconds = 0\r\n    cache.put(objectName, JSON.stringify(object), saveSeconds)\r\n}\r\nfunction getFromCache(objectName) {\r\n    const {java, cache} = this\r\n    let object = cache.get(objectName)\r\n    if (object === undefined) return null  // å…¼å®¹æºé˜…\r\n    return JSON.parse(object)\r\n}\r\n\r\nfunction putInCacheMap(mapName, mapObject, saveSeconds) {\r\n    const {java, cache} = this\r\n    let orderedArray = []\r\n    mapObject.forEach((value, key) => {\r\n        const item = {}\r\n        item[key] = value\r\n        orderedArray.push(item)\r\n    })\r\n    // [{'key1': 'value1'}, {'key2': 'value2'}]\r\n    if (saveSeconds === undefined) saveSeconds = 0\r\n    cache.put(mapName, JSON.stringify(orderedArray), saveSeconds)\r\n}\r\nfunction getFromCacheMap(mapName) {\r\n    const {java, cache} = this\r\n    let cached = cache.get(mapName)\r\n    let newMap = new Map()\r\n    if (cached === null || cached === undefined) {\r\n        return newMap\r\n    }\r\n\r\n    let parsedData\r\n    try {\r\n        parsedData = JSON.parse(cached)\r\n    } catch (e) {\r\n        return newMap\r\n    }\r\n\r\n    if (Array.isArray(parsedData)) {\r\n        parsedData.forEach(item => {\r\n            for (let key in item) {\r\n                newMap.set(key, item[key])\r\n            }\r\n        })\r\n    } else {\r\n        for (let key in parsedData) {\r\n            newMap.set(key, parsedData[key])\r\n        }\r\n    }\r\n    return newMap\r\n}\r\n\r\nfunction isHtmlString(str) {\r\n    return str.startsWith(\"<!DOCTYPE html>\")\r\n}\r\nfunction isJsonString(str) {\r\n    try {\r\n        if (typeof JSON.parse(str) === \"object\") return true\r\n    } catch(e) {}\r\n    return false\r\n}\r\n\r\nfunction getWebViewUA() {\r\n    const {java, cache} = this\r\n    let userAgent = String(java.getWebViewUA())\r\n    if (userAgent.includes(\"Windows NT 10.0; Win64; x64\")) {\r\n        userAgent = \"Mozilla/5.0 (Linux; Android 10; K) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/119.0.0.0 Mobile Safari/537.36\"\r\n    }\r\n    // java.log(`userAgent=${userAgent}`)\r\n    cache.put(\"userAgent\", userAgent)\r\n    return String(userAgent)\r\n}\r\nfunction isLogin() {\r\n    const {java, cache} = this\r\n    return !!cache.get(\"csfrToken\")\r\n}\r\n\r\nfunction getAjaxJson(url, forceUpdate) {\r\n    const {java, cache} = this\r\n    let v = cache.get(url)\r\n    if (forceUpdate && v && new Date().getTime() >= JSON.parse(v).timestamp + cacheTempSeconds) cache.delete(url)\r\n    return cacheGetAndSet(cache, url, () => {\r\n        return JSON.parse(java.ajax(url))\r\n    })\r\n}\r\nfunction getAjaxAllJson(urls, forceUpdate) {\r\n    const {java, cache} = this\r\n    let v = cache.get(urls)\r\n    if (forceUpdate && v && new Date().getTime() >= JSON.parse(v).timestamp + cacheTempSeconds) cache.delete(urls)\r\n    return cacheGetAndSet(cache, urls, () => {\r\n        let result = java.ajaxAll(urls).map(resp => JSON.parse(resp.body()))\r\n        cache.put(urls, JSON.stringify(result), cacheSaveSeconds)\r\n        for (let i in urls) cache.put(urls[i], JSON.stringify(result[i]), cacheSaveSeconds)\r\n        return result\r\n    })\r\n}\r\nfunction getWebviewJson(url, parseFunc) {\r\n    const {java, cache} = this\r\n    return cacheGetAndSet(cache, url, () => {\r\n        let html = java.webView(null, url, null)\r\n        return JSON.parse(parseFunc(html))\r\n    })\r\n}\r\n\r\nfunction urlNovelUrl(novelId) {\r\n    return `https://www.pixiv.net/novel/show.php?id=${novelId}`\r\n}\r\nfunction urlNovelDetailed(novelId) {\r\n    return `https://www.pixiv.net/ajax/novel/${novelId}`\r\n}\r\nfunction urlNovelsDetailed(userId, nidList) {\r\n    return `https://www.pixiv.net/ajax/user/${userId}/novels?${nidList.map(v => `ids[]=${v}`).join(\"&\")}`\r\n}\r\nfunction urlNovelBookmarkData(novelId) {\r\n    return `https://www.pixiv.net/ajax/novel/${novelId}/bookmarkData`\r\n}\r\nfunction urlNovelComments(novelId, offset, limit) {\r\n    return `https://www.pixiv.net/ajax/novels/comments/roots?novel_id=${novelId}&offset=${offset}&limit=${limit}&lang=zh`\r\n}\r\nfunction urlNovelCommentsReply(commentId, page) {\r\n    return `https://www.pixiv.net/ajax/novels/comments/replies?comment_id=${commentId}&page=${page}&lang=zh`\r\n}\r\nfunction urlNovelsRecommendInit(novelId, limit) {\r\n    if (limit === undefined) limit = 9\r\n    return `https://www.pixiv.net/ajax/novel/${novelId}/recommend/init?limit=${limit}&lang=zh`\r\n}\r\nfunction urlNovelsRecommendDetailed(nidList) {\r\n    if (nidList.length >= 9) nidList.length = 9\r\n    return `https://www.pixiv.net/ajax/novel/recommend/novels?${nidList.map(v => `novelIds[]=${v}`).join(\"&\")}`\r\n}\r\n\r\nfunction urlSeriesUrl(seriesId) {\r\n    return `https://www.pixiv.net/novel/series/${seriesId}`\r\n}\r\nfunction urlSeriesDetailed(seriesId) {\r\n    return `https://www.pixiv.net/ajax/novel/series/${seriesId}?lang=zh`\r\n}\r\nfunction urlSeriesNovelsTitles(seriesId) {\r\n    return `https://www.pixiv.net/ajax/novel/series/${seriesId}/content_titles`\r\n}\r\nfunction urlSeriesNovels(seriesId, limit, offset) {\r\n    if (limit > 30) limit = 30\r\n    if (limit < 10) limit = 10\r\n    return `https://www.pixiv.net/ajax/novel/series_content/${seriesId}?limit=${limit}&last_order=${offset}&order_by=asc&lang=zh`\r\n}\r\n\r\nfunction urlUserUrl(userID) {\r\n    return `https://www.pixiv.net/users/${userID}/novels`\r\n}\r\nfunction urlUserDetailed(userID) {\r\n    return `https://www.pixiv.net/ajax/user/${userID}`\r\n}\r\nfunction urlUserWorkLatest(userID) {\r\n    return `https://www.pixiv.net/ajax/user/${userID}/works/latest`\r\n}\r\nfunction urlUserAllWorks(userId) {\r\n    return `https://www.pixiv.net/ajax/user/${userId}/profile/all?lang=zh`\r\n}\r\nfunction urlUserBookmarks(userId) {\r\n    return `https://www.pixiv.net/ajax/user/${userId}/novels/bookmarks?tag=&offset={{(page-1)*30}}&limit=30&rest=show&lang=zh`\r\n}\r\n\r\nfunction urlSearchNovel(novelName, page) {\r\n    return `https://www.pixiv.net/ajax/search/novels/${encodeURI(novelName)}?word=${encodeURI(novelName)}&order=date_d&mode=all&p=${page}&s_mode=s_tag&lang=zh`\r\n}\r\nfunction urlSearchSeries(seriesName, page) {\r\n    return`https://www.pixiv.net/ajax/search/novels/${encodeURI(seriesName)}?word=${encodeURI(seriesName)}&order=date_d&mode=all&p=${page}&s_mode=s_tag&gs=1&lang=zh`\r\n}\r\n// ä¸å®Œå…¨åŒ¹é…ç”¨æˆ·å\r\nfunction urlSearchUser(userName, full) {\r\n    if (full === undefined || full === false) {\r\n        return `https://www.pixiv.net/search/users?nick=${userName}&s_mode=s_usr&nick_mf=1`\r\n    } else {\r\n        return `https://www.pixiv.net/search/users?nick=${userName}&s_mode=s_usr_full&i=1`\r\n    }\r\n}\r\n\r\nfunction urlCoverUrl(url) {\r\n    return `${url}, {\"headers\": {\"Referer\":\"https://www.pixiv.net/\"}}`\r\n}\r\nfunction urlIllustDetailed(illustId) {\r\n    return `https://www.pixiv.net/ajax/illust/${illustId}?lang=zh`\r\n}\r\nfunction urlIllustOriginal(illustId, order) {\r\n    const {java, cache} = this\r\n    if (order <= 1) order = 1\r\n    let url = urlIllustDetailed(illustId)\r\n    let illustOriginal = cacheGetAndSet(cache, url, () => {\r\n        return JSON.parse(java.ajax(url))\r\n    }).body.urls.original\r\n    return urlCoverUrl(illustOriginal.replace(`_p0`, `_p${order - 1}`))\r\n}\r\nfunction urlEmojiUrl(emojiId) {\r\n    return urlCoverUrl(`https://s.pximg.net/common/images/emoji/${emojiId}.png`)\r\n}\r\nfunction urlStampUrl(stampId) {\r\n    return urlCoverUrl(`https://s.pximg.net/common/images/stamp/generated-stamps/${stampId}_s.jpg`)\r\n}\r\n\r\nfunction urlMessageThreadLatest(max) {\r\n    if (max === undefined || max <= 5) max = 5\r\n    return `https://www.pixiv.net/rpc/index.php?mode=latest_message_threads2&num=${max}&lang=zh`\r\n}\r\nfunction urlMessageThreadContents(threadId, max) {\r\n    return `https://www.pixiv.net/rpc/index.php?mode=message_thread_contents&thread_id=${threadId}&num=${max}`\r\n}\r\nfunction urlMessageThreadDetail(threadId) {\r\n    return `https://www.pixiv.net/rpc/index.php?mode=message_thread&thread_id=${threadId}`\r\n}\r\nfunction urlNotification() {\r\n    return `https://www.pixiv.net/ajax/notification&lang=zh`\r\n}\r\n\r\nfunction dateFormat(str) {\r\n    let addZero = function (num) {\r\n        return num < 10 ? '0' + num : num;\r\n    }\r\n    let time = new Date(str);\r\n    let Y = time.getFullYear() + \"å¹´\";\r\n    let M = addZero(time.getMonth() + 1) + \"æœˆ\";\r\n    let D = addZero(time.getDate()) + \"æ—¥\";\r\n    return Y + M + D;\r\n}\r\nfunction timeFormat(str) {\r\n    let addZero = function (num) {\r\n        return num < 10 ? '0' + num : num;\r\n    }\r\n    let time = new Date(str);\r\n    let YY = time.getFullYear()\r\n    let MM = addZero(time.getMonth() + 1)\r\n    let DD = addZero(time.getDate())\r\n    let hh = addZero(time.getHours())\r\n    let mm = addZero(time.getMinutes())\r\n    let ss = addZero(time.getSeconds())\r\n    return `${YY}-${MM}-${DD} ${hh}:${mm}:${ss}`\r\n}\r\nfunction timeTextFormat(text) {\r\n    return `${text.slice(0, 10)} ${text.slice(11, 19)}`\r\n}\r\nfunction sleep(time) {\r\n    let endTime = new Date().getTime() + time\r\n    while(true){\r\n        if (new Date().getTime() > endTime){\r\n            return;\r\n        }\r\n    }\r\n}\r\nfunction sleepToast(text, second) {\r\n    const {java} = this\r\n    java.log(text)\r\n    // java.toast(text)\r\n    java.longToast(text)\r\n    if (second === undefined) second = 0.01\r\n    sleep(1000*second)\r\n}\r\n\r\nfunction updateSource() {\r\n    const {java, source} = this\r\n    java.longToast(\"ğŸ†™ æ›´æ–°ä¹¦æº\\n\\nJsdelivr CDN æ›´æ–°æœ‰å»¶è¿Ÿ\\nGithub æ›´æ–°éœ€ä»£ç†\")\r\n    let onlineSource, comment, sourceName, sourceNameCapitalize, index = 0\r\n    if (source.bookSourceUrl.includes(\"pixiv\")) sourceName = \"pixiv\"\r\n    else if (source.bookSourceUrl.includes(\"furrynovel\")) sourceName = \"linpx\"\r\n    sourceNameCapitalize = sourceName[0].toUpperCase() + sourceName.substring(1)\r\n\r\n    if (source.bookSourceName.includes(\"å¤‡ç”¨\")) index = 1\r\n    else if (source.bookSourceName.includes(\"æ¼«ç”»\")) index = 2\r\n    if (source.bookSourceUrl.includes(\"furrynovel.com\")) {\r\n        sourceNameCapitalize = \"FurryNovel\"\r\n        index = 1\r\n    }\r\n\r\n    try {\r\n        let updateUrl = `https://cdn.jsdelivr.net/gh/windyhusky/PixivSource@main/${sourceName}.json`\r\n        onlineSource = JSON.parse(java.get(updateUrl,{'User-Agent': 'Mozilla/5.0 (Linux; Android 14)','X-Requested-With': 'XMLHttpRequest'}).body())[index]\r\n    } catch (e) {\r\n        try {\r\n            let updateUrl = `https://raw.githubusercontent.com/windyhusky/PixivSource/main/${sourceName}.json`\r\n            onlineSource = JSON.parse(java.get(updateUrl,{'User-Agent': 'Mozilla/5.0 (Linux; Android 14)','X-Requested-With': 'XMLHttpRequest'}).body())[index]\r\n        } catch (e) {\r\n            onlineSource = {lastUpdateTime: new Date().getTime(), bookSourceComment: source.bookSourceComment}\r\n        }\r\n    }\r\n    comment = onlineSource.bookSourceComment.split(\"\\n\")\r\n    // onlineSource = source\r\n    // comment = source.bookSourceComment.split(\"\\n\")\r\n\r\n    let htm = `\r\n<!DOCTYPE html>\r\n<html lang=\"zh-CN\">\r\n<head>\r\n    <meta charset=\"UTF-8\">\r\n    <meta name=\"viewport\" content=\"width=device-width, initial-scale=1.0\">\r\n    <title>æ›´æ–° ${source.bookSourceName} ä¹¦æº</title>\r\n    <style> \r\n    table { text-align: center; margin: 0 auto; } .ann { display: flex; justify-content: center; align-items: center; height: 5vh; } \r\n    button { background-color: rgb(76, 175, 80); color: white; border: none; border-radius: 4px; height: 6vh; width: 30vw; overflow: hidden; } \r\n    button span { cursor: pointer; display: inline-block; position: relative; transition: 0.4s; } \r\n    button span:after { content: '>'; position: absolute; opacity: 0; top: 0; right: 30px; transition: 0.2s; } \r\n    button:active span { padding-right: 20px; } \r\n    button:active span:after { opacity: 1; right: -40px; }\r\n    </style>\r\n</head>\r\n\r\n<body>\r\n    <table border=\"1\" cellspacing=\"0\">\r\n        <th colspan=\"2\"> ${source.bookSourceName} ä¹¦æº <a href=\"https://github.com/windyhusky/PixivSource/blob/main/doc/${sourceNameCapitalize}.md\">ğŸ”° ä½¿ç”¨æŒ‡å—</a></th>\r\n        <tr>\r\n            <td>â˜ï¸ è¿œç¨‹ç‰ˆæœ¬ï¼š${onlineSource.bookSourceComment.split(\"\\n\")[2].replace(\"ä¹¦æºç‰ˆæœ¬ï¼š\", \"\")}</td>\r\n            <td>ğŸ“† æ›´æ–°ï¼š${timeFormat(onlineSource.lastUpdateTime)}</td>\r\n        </tr>\r\n        <tr>\r\n            <td>ğŸ“¥ æœ¬åœ°ç‰ˆæœ¬ï¼š${source.bookSourceComment.split(\"\\n\")[2].replace(\"ä¹¦æºç‰ˆæœ¬ï¼š\", \"\")}</td>\r\n            <td>ğŸ“† æ›´æ–°ï¼š${timeFormat(source.lastUpdateTime)}</td>\r\n        </tr> \r\n        <tr><td colspan=\"2\" style=\"text-align: left;\">${comment.slice(3, 10).join(\"<br>\")}</td></tr>\r\n        <tr><td colspan=\"2\" style=\"text-align: left;\">${comment.slice(comment.length-20, comment.length).join(\"<br>\")}</td></tr>\r\n    </table>\r\n    \r\n    <table border=\"0\" cellspacing=\"20\">\r\n        <th colspan=\"2\"> æ›´æ–° ${source.bookSourceName} ä¹¦æº </th>\r\n        <tr><td><div class=\"ann\">\r\n            <a href=\"legado://import/importonline?src=https://cdn.jsdelivr.net/gh/windyhusky/PixivSource@main/${sourceName}.json\">\r\n            <button><span>æ›´æ–°ä¹¦æº<br>(Jsdelivr CDN)</span></button>\r\n            </a></div></td>\r\n            \r\n            <td><div class=\"ann\">\r\n            <a href=\"legado://import/importonline?src=https://cdn.jsdelivr.net/gh/windyhusky/PixivSource@main/btsrk.json\">\r\n            <button><span>æ›´æ–°è®¢é˜…<br>(Jsdelivr CDN)</span></button>\r\n            </a></div></td>\r\n        </tr>\r\n        \r\n        <tr><td><div class=\"ann\">\r\n            <a href=\"legado://import/importonline?src=https://raw.githubusercontent.com/windyhusky/PixivSource/main/${sourceName}.json\">\r\n            <button><span>ä¹¦æºé“¾æ¥<br>(GitHub)</span></button>\r\n            </a></div></td>\r\n            \r\n            <td><div class=\"ann\">\r\n            <a href=\"legado://import/importonline?src=https://raw.githubusercontent.com/windyhusky/PixivSource/main/btsrk.json\">\r\n            <button><span>è®¢é˜…é“¾æ¥<br>(GitHub)</span></button>\r\n            </a></div></td>\r\n        </tr>\r\n        \r\n        <tr><td><div class=\"ann\">\r\n            <a href=\"legado://import/importonline?src=https://codeberg.org/DowneyRem/PixivSource/raw/branch/main/${sourceName}.json\">\r\n            <button><span>å¤‡ç”¨ä¹¦æºé“¾æ¥<br>(Codeberg)</span></button>\r\n            </a></div></td>\r\n            \r\n            <td><div class=\"ann\">\r\n            <a href=\"legado://import/importonline?src=https://codeberg.org/DowneyRem/PixivSource/raw/branch/main/btsrk.json\">\r\n            <button><span>å¤‡ç”¨è®¢é˜…é“¾æ¥<br>(Codeberg)</span></button>\r\n            </a></div></td>\r\n        </tr>\r\n    </table>\r\n</body>\r\n</html>`;\r\n    java.startBrowser(`data:text/html;charset=utf-8;base64, ${java.base64Encode(htm)}`, 'æ›´æ–°ä¹¦æº');\r\n    return []\r\n}",
        "lastUpdateTime": "1762442228251",
        "loginCheckJs": "var util = {}\r\n\r\nfunction objStringify(obj) {\r\n    return JSON.stringify(obj, (n, v) => {\r\n        if (typeof v == \"function\")\r\n            return v.toString();\r\n        return v;\r\n    });\r\n}\r\nfunction isBackupSource() {\r\n    let isBackupSource = source.bookSourceName.includes(\"å¤‡ç”¨\")\r\n    cache.put(\"isBackupSource\", isBackupSource)\r\n    return isBackupSource\r\n}\r\n// æ£€æµ‹ æºé˜…\r\n// å¯ç”¨ java.ajax() ä¸å¯ç”¨ java.webview() java.ajaxAll()\r\n// å¯ç”¨ java.getCookie() cache.put() cache.get() é»˜è®¤å€¼ä¸º undefined\r\n// å¯ç”¨ java.startBrowser() ä¸å¯ç”¨ java.startBrowserAwaitAwait\r\n// å¯ç”¨ source.bookSourceName source.getVariable() source.setVariable()ç­‰\r\n// java.getUserAgent() java.getWebViewUA() ç›®å‰è¿”å›å†…å®¹ç›¸åŒ\r\nfunction isSourceRead() {\r\n    let isSourceReadStatus = java.getUserAgent() === java.getWebViewUA()\r\n    cache.put(\"isSourceRead\", isSourceReadStatus)\r\n    return isSourceReadStatus\r\n}\r\n\r\nfunction isLegadoOfficial() {\r\n    let isLegadoOfficialStatus\r\n    try {\r\n        eval('({})?.value')\r\n        isLegadoOfficialStatus = false\r\n    } catch (e) {\r\n        isLegadoOfficialStatus = true\r\n    }\r\n    cache.put(\"isLegadoOfficial\", isLegadoOfficialStatus)\r\n    return isLegadoOfficialStatus\r\n}\r\n\r\nfunction publicFunc() {\r\n    let u = {}, settings\r\n    // è¾“å‡ºä¹¦æºä¿¡æ¯\r\n    java.log(`ğŸ…¿ï¸ ${source.bookSourceComment.split(\"\\n\")[0]}`)\r\n    java.log(`ğŸ“Œ ${source.bookSourceComment.split(\"\\n\")[2]}`)\r\n    java.log(`ğŸ“† æ›´æ–°æ—¶é—´ï¼š${java.timeFormat(source.lastUpdateTime)}`)\r\n    if (isSourceRead()) {\r\n        java.log(\"ğŸ“± è½¯ä»¶å¹³å°ï¼šğŸ æºé˜… SourceRead\")\r\n    } else if (isLegadoOfficial()) {\r\n        java.log(\"ğŸ“± è½¯ä»¶å¹³å°ï¼šğŸ¤– å¼€æºé˜…è¯» ã€æ­£å¼ç‰ˆã€‘\")\r\n        java.log(\"å½“å‰è½¯ä»¶ä¸ºï¼šé˜…è¯»ã€æ­£å¼ç‰ˆã€‘\\n\\nã€æ­£å¼ç‰ˆã€‘å·²å¹´ä¹…å¤±ä¿®ï¼Œä¸æ¨èç»§ç»­ä½¿ç”¨\\næ¨èä½¿ç”¨ã€Betaç‰ˆã€‘ã€å…±å­˜/æ–°å…±å­˜ç‰ˆã€‘\\n\\nBetaç‰ˆæœ¬ä¸‹è½½é“¾æ¥ï¼š\\nhttps://miaogongzi.lanzout.com/b01rgkhhe\\nå¦‚éœ€æ›´æ–°ï¼Œå¯å»ä¹¦æºè°ƒè¯•ç•Œé¢\\næ‰“å¼€ä¸‹è½½é“¾æ¥åˆ‡æ¢é˜…è¯»ç‰ˆæœ¬\\n\")\r\n    } else if (!isLegadoOfficial()) {\r\n        java.log(\"ğŸ“± è½¯ä»¶å¹³å°ï¼šğŸ¤– å¼€æºé˜…è¯» Beta ç‰ˆ\")\r\n    }\r\n\r\n    // è·å–è®¾ç½®ï¼Œå¤‡ç”¨ä¹¦æºä½¿ç”¨æ—§ç‰ˆè®¾ç½®ï¼Œä¹¦æºä»ç¼“å­˜è·å–è®¾ç½®\r\n    if (isBackupSource()) {\r\n        settings = JSON.parse(String(source.variableComment).match(RegExp(/{([\\s\\S]*?)}/gm)))\r\n    } else {\r\n        // cache.delete(\"pixivSettings\")\r\n        settings = getFromCache(\"pixivSettings\")\r\n    }\r\n    if (settings !== null) {\r\n        java.log(\"âš™ï¸ ä½¿ç”¨è‡ªå®šä¹‰è®¾ç½®\")\r\n    } else {\r\n        settings = {}\r\n        settings.SEARCH_AUTHOR = true       // æœç´¢ï¼šé»˜è®¤æœç´¢ä½œè€…åç§°\r\n        settings.CONVERT_CHINESE = true     // æœç´¢ï¼šæœç´¢æ—¶è¿›è¡Œç¹ç®€è½¬æ¢\r\n        settings.SHOW_LIKE_NOVELS = true    // æœç´¢ï¼šæœç´¢ç»“æœæ˜¾ç¤ºæ”¶è—å°è¯´\r\n        settings.SHOW_WATCHED_SERIES = true // æœç´¢ï¼šæœç´¢ç»“æœæ˜¾ç¤ºè¿½æ•´ç³»åˆ—å°è¯´\r\n        settings.MORE_INFORMATION = false   // è¯¦æƒ…ï¼šä¹¦ç±ç®€ä»‹æ˜¾ç¤ºæ›´å¤šä¿¡æ¯\r\n        settings.SHOW_UPDATE_TIME = true    // ç›®å½•ï¼šæ˜¾ç¤ºæ›´æ–°æ—¶é—´ï¼Œä½†ä¼šå¢åŠ å°‘è®¸è¯·æ±‚\r\n        settings.SHOW_ORIGINAL_LINK = true  // ç›®å½•ï¼šæ˜¾ç¤ºåŸå§‹é“¾æ¥ï¼Œä½†ä¼šå¢åŠ å¤§é‡è¯·æ±‚\r\n        settings.REPLACE_TITLE_MARKS = true // æ­£æ–‡ï¼šæ³¨éŸ³å†…å®¹ä¸ºæ±‰å­—æ—¶ï¼Œæ›¿æ¢ä¸ºä¹¦åå·\r\n        settings.SHOW_CAPTIONS = true       // æ­£æ–‡ï¼šç« é¦–æ˜¾ç¤ºæè¿°\r\n        settings.SHOW_COMMENTS = true       // æ­£æ–‡ï¼šç« å°¾æ˜¾ç¤ºè¯„è®º\r\n        settings.FAST  = false              // å…¨å±€ï¼šå¿«é€Ÿæ¨¡å¼\r\n        settings.DEBUG = false              // å…¨å±€ï¼šè°ƒè¯•æ¨¡å¼\r\n        java.log(\"âš™ï¸ ä½¿ç”¨é»˜è®¤è®¾ç½®ï¼ˆæ— è‡ªå®šä¹‰è®¾ç½® æˆ– è‡ªå®šä¹‰è®¾ç½®æœ‰è¯¯ï¼‰\")\r\n    }\r\n    if (settings.FAST === true) {\r\n        settings.SEARCH_AUTHOR = false        // æœç´¢ï¼šé»˜è®¤æœç´¢ä½œè€…åç§°\r\n        settings.CONVERT_CHINESE = false      // æœç´¢ï¼šç¹ç®€é€šæœ\r\n        settings.SHOW_UPDATE_TIME = false     // ç›®å½•ï¼šæ˜¾ç¤ºç« èŠ‚æ›´æ–°æ—¶é—´\r\n        settings.SHOW_ORIGINAL_LINK = false   // ç›®å½•ï¼šæ˜¾ç¤ºç« èŠ‚æºé“¾æ¥\r\n        settings.SHOW_COMMENTS = false        // æ­£æ–‡ï¼šæ˜¾ç¤ºè¯„è®º\r\n    } else {\r\n        settings.SEARCH_AUTHOR = true        // æœç´¢ï¼šé»˜è®¤æœç´¢ä½œè€…åç§°\r\n    }\r\n    settings.IS_LEGADO = !isSourceRead()\r\n    settings.IS_SOURCE_READ = isSourceRead()\r\n    settings.IS_BACKUP_SOURCE = isBackupSource()\r\n    u.settings = settings\r\n    putInCache(\"pixivSettings\", settings)  // è®¾ç½®å†™å…¥ç¼“å­˜\r\n\r\n    u.debugFunc = (func) => {\r\n        if (util.settings.DEBUG === true) {\r\n            func()\r\n        }\r\n    }\r\n\r\n    u.checkStatus = function(status) {\r\n        if (status === true) return \"âœ… å·²\"\r\n        else if (status === false) return \"âŒ æœª\"\r\n        else if (status === undefined) return \"ğŸˆšï¸ æ— æ•°æ®ï¼š\"\r\n    }\r\n\r\n    u.login = function() {\r\n        let resp = java.startBrowserAwait(`https://accounts.pixiv.net/login,\r\n    {\"headers\": {\"User-Agent\": \"${java.getWebViewUA()}\"}}`, 'ç™»å½•è´¦å·', false)\r\n        if (resp.code() === 200) {\r\n            this.getCsrfToken(); this.getCookie()\r\n        } else {\r\n            java.log(resp.code()); sleepToast(\"âš ï¸ ç™»å½•å¤±è´¥\")\r\n        }\r\n    }\r\n\r\n    u.logout = function() {\r\n        this.removeCookie()\r\n        java.startBrowser(\"https://www.pixiv.net/logout.php\", \"é€€å‡ºè´¦å·\")\r\n        this.removeCookie()\r\n        sleepToast(`âœ… å·²é€€å‡ºå½“å‰è´¦å·\\n\\né€€å‡ºåè¯·ç‚¹å‡»å³ä¸Šè§’çš„ âœ”ï¸ é€€å‡º\\n\\nç™»å½•è¯·ç‚¹å‡»ã€ç™»å½•è´¦å·ã€‘è¿›è¡Œç™»å½•`)\r\n    }\r\n\r\n    u.getCookie = function() {\r\n        let pixivCookie = String(java.getCookie(\"https://www.pixiv.net/\", null))\r\n        if (isLogin()) cache.put(\"pixivCookie\", pixivCookie, 60*60)  // ç¼“å­˜1h\r\n    }\r\n\r\n    u.removeCookie = function() {\r\n        cookie.removeCookie('https://www.pixiv.net')\r\n        cookie.removeCookie('https://accounts.pixiv.net')\r\n        cookie.removeCookie('https://accounts.google.com')\r\n        cookie.removeCookie('https://api.weibo.com')\r\n        cache.delete(\"pixivCookie\")\r\n        cache.delete(\"pixiv:uid\")\r\n        cache.delete(\"csfrToken\")  // ä¸ç™»å½•è®¾å¤‡æœ‰å…³\r\n        cache.delete(\"headers\")\r\n    }\r\n\r\n    // è·å– Csrf Tokenï¼Œä»¥ä¾¿è¿›è¡Œæ”¶è—ç­‰è¯·æ±‚\r\n    // è·å–æ–¹æ³•æ¥è‡ªè„šæœ¬ Pixiv Previewer\r\n    // https://github.com/Ocrosoft/PixivPreviewer\r\n    // https://greasyfork.org/zh-CN/scripts/30766-pixiv-previewer/code\r\n    u.getCsrfToken = function() {\r\n        let csfrToken = cache.get(\"csfrToken\")\r\n        if (!csfrToken) {\r\n            let html = java.webView(null, \"https://www.pixiv.net/\", null)\r\n            try {\r\n                csfrToken = html.match(/token\\\\\":\\\\\"([a-z0-9]{32})/)[1]\r\n                cache.put(\"csfrToken\", csfrToken)  // ä¸ç™»å½•è®¾å¤‡æœ‰å…³ï¼Œæ— æ³•å­˜å‚¨ nul\r\n            } catch (e) {\r\n                csfrToken = null\r\n                cache.delete(\"csfrToken\")  // ä¸ç™»å½•è®¾å¤‡æœ‰å…³ï¼Œæ— æ³•å­˜å‚¨ nul\r\n                // sleepToast(\"âš ï¸ æœªç™»å½•è´¦å·(csfrToken)\")\r\n            }\r\n            java.log(`csfrToken:\\n${csfrToken}`)\r\n        }\r\n        return csfrToken\r\n    }\r\n\r\n    // å°†å¤šä¸ªé•¿ç¯‡å°è¯´è§£æä¸ºä¸€æœ¬ä¹¦\r\n    u.combineNovels = function(novels) {\r\n        return novels.filter(novel => {\r\n            // å•æœ¬ç›´æ¥è§£æä¸ºä¸€æœ¬ä¹¦\r\n            if (novel.seriesId === undefined || novel.seriesId === null) {\r\n                return true\r\n            }\r\n            // é›†åˆä¸­æ²¡æœ‰è¯¥ç³»åˆ—è§£æä¸ºä¸€æœ¬ä¹¦\r\n            if (!seriesSet.has(novel.seriesId)) {\r\n                seriesSet.add(novel.seriesId)\r\n                return true\r\n            }\r\n            return false\r\n        })\r\n    }\r\n\r\n    // å±è”½ä½œè€…\r\n    u.authorFilter = function(novels) {\r\n        let authors = getFromCache(\"blockAuthorList\")\r\n        if (authors !== null && authors.length >= 0) {\r\n            java.log(`ğŸš« å±è”½ä½œè€…IDï¼š${JSON.stringify(authors)}`)\r\n            authors.forEach(author => {\r\n                novels = novels.filter(novel => novel.userId !== String(author))\r\n            })\r\n        }\r\n        return novels\r\n    }\r\n\r\n\r\n    // è¿‡æ»¤æ”¶è—ä¸è¿½æ›´\r\n    u.novelFilter = function(novels) {\r\n        let novels1 = [], novels2 = [], msg\r\n        let likeNovels = getFromCache(\"likeNovels\")\r\n        let watchedSeries = getFromCache(\"watchedSeries\")\r\n        let novels0 = novels.map(novel => novel.id)\r\n\r\n        msg = util.checkStatus(util.settings.SHOW_LIKE_NOVELS).replace(\"æœª\",\"ä¸\")\r\n        java.log(`${msg}æ˜¾ç¤ºæ”¶è—å°è¯´`)\r\n        if (util.settings.SHOW_LIKE_NOVELS === false) {\r\n            novels = novels.filter(novel => !likeNovels.includes(Number(novel.id)))\r\n            novels1 = novels.map(novel => novel.id)\r\n            java.log(`â¬ è¿‡æ»¤æ”¶è—ï¼šè¿‡æ»¤å‰${novels0.length}ï¼›è¿‡æ»¤å${novels1.length}`)\r\n        }\r\n\r\n        msg = util.checkStatus(util.settings.SHOW_WATCHED_SERIES).replace(\"æœª\",\"ä¸\")\r\n        java.log(`${msg}æ˜¾ç¤ºè¿½æ›´ç³»åˆ—`)\r\n        if (util.settings.SHOW_WATCHED_SERIES === false) {\r\n            novels = novels.filter(novel => !watchedSeries.includes(Number(novel.seriesId)))\r\n            novels2 = novels.map(novel => novel.id)\r\n            if (novels1.length >= 1) novels0 = novels1\r\n            java.log(`â¬ è¿‡æ»¤è¿½æ›´ï¼šè¿‡æ»¤å‰${novels0.length}ï¼›è¿‡æ»¤å${novels2.length}`)\r\n        }\r\n\r\n        let novels3 = novels.map(novel => novel.id)\r\n        if (novels0.length >= 1 && novels3.length === 0) {\r\n            let msg = `â¬ è¿‡æ»¤å°è¯´\\nâš ï¸ è¿‡æ»¤åæ— ç»“æœ\\n\\nè¯·æ ¹æ®éœ€è¦\\n`\r\n            if (util.settings.SHOW_LIKE_NOVELS === false) msg += \"å¼€å¯æ˜¾ç¤ºæ”¶è—å°è¯´\\n\"\r\n            if (util.settings.SHOW_WATCHED_SERIES === false) msg += \"å¼€å¯æ˜¾ç¤ºè¿½æ›´ç³»åˆ—\"\r\n            sleepToast(msg, 1)\r\n        }\r\n\r\n        util.debugFunc(() => {\r\n            // java.log(JSON.stringify(novels0))\r\n            java.log(JSON.stringify(novels0.length))\r\n            // java.log(JSON.stringify(novels1))\r\n            java.log(JSON.stringify(novels1.length))\r\n            // java.log(JSON.stringify(novels2))\r\n            java.log(JSON.stringify(novels2.length))\r\n        })\r\n        return novels\r\n    }\r\n\r\n    // è¿‡æ»¤æè¿°ä¸æ ‡ç­¾ï¼ˆå±è”½æ ‡ç­¾/å±è”½æè¿°ï¼‰\r\n    u.novelFilter2 = function(novels) {\r\n        let novels0 = novels.map(novel => novel.id)\r\n        let captionBlockWords = getFromCache(\"captionBlockWords\")\r\n        if (captionBlockWords === null) captionBlockWords = []\r\n        if (captionBlockWords) {\r\n            // ä»…ä¿ç•™æ²¡æœ‰ä»»ä½•å±è”½è¯çš„å°è¯´\r\n            // novels = novels.filter(novel => {\r\n            //     return !captionBlockWords.some(item => {\r\n            //         if (novel.description !== undefined) return novel.description.includes(item)\r\n            //     })\r\n            // })\r\n            novels = novels.filter(novel => !captionBlockWords.some(item => novel.description.includes(item)))\r\n            let novels2 = novels.map(novel => novel.id)\r\n            java.log(`ğŸš« å±è”½æè¿°ï¼š${captionBlockWords.join(\"\\n\")}`)\r\n            java.log(`ğŸš« å±è”½æè¿°ï¼šè¿‡æ»¤å‰${novels0.length}ï¼›è¿‡æ»¤å${novels2.length}`)\r\n        }\r\n\r\n        let tagsBlockWords = getFromCache(\"tagsBlockWords\")\r\n        if (tagsBlockWords === null) tagsBlockWords = []\r\n        if (tagsBlockWords) {\r\n            // ä»…ä¿ç•™æ²¡æœ‰ä»»ä½•å±è”½è¯çš„å°è¯´\r\n            // novels = novels.filter(novel => {\r\n            //     return !tagsBlockWords.some(item => {\r\n            //         if (novel.tags !== undefined) return novel.tags.includes(item)\r\n            //     })\r\n            // })\r\n            novels = novels.filter(novel => !tagsBlockWords.some(item => novel.tags.includes(item)))\r\n            let novels2 = novels.map(novel => novel.id)\r\n            java.log(`ğŸš« å±è”½æ ‡ç­¾ï¼š${tagsBlockWords.join(\"ã€\")}`)\r\n            java.log(`ğŸš« å±è”½æ ‡ç­¾ï¼šè¿‡æ»¤å‰${novels0.length}ï¼›è¿‡æ»¤å${novels2.length}`)\r\n        }\r\n        return novels\r\n    }\r\n\r\n    // æ”¶è—å°è¯´/è¿½æ›´ç³»åˆ— å†™å…¥ç¼“å­˜\r\n    u.saveNovels = function(listInCacheName, list) {\r\n        let listInCache = getFromCache(listInCacheName)\r\n        if (listInCache === null) listInCache = []\r\n\r\n        listInCache = listInCache.concat(list)\r\n        listInCache = Array.from(new Set(listInCache))\r\n        cache.put(listInCacheName, JSON.stringify(listInCache))\r\n\r\n        if (listInCacheName === \"likeNovels\") listInCacheName = \"â¤ï¸ æ”¶è—å°è¯´ID\"\r\n        else if (listInCacheName === \"watchedSeries\") listInCacheName = \"ğŸ“ƒ è¿½æ›´ç³»åˆ—ID\"\r\n        java.log(`${listInCacheName}ï¼š${JSON.stringify(listInCache)}`)\r\n    }\r\n\r\n    // å¤„ç† novels åˆ—è¡¨\r\n    u.handNovels = function(novels) {\r\n        let likeNovels = [], watchedSeries = []\r\n        novels = util.authorFilter(novels)\r\n        novels.forEach(novel => {\r\n            // novel.id = novel.id\r\n            // novel.title = novel.title\r\n            // novel.userName = novel.userName\r\n            // novel.userId = novel.userId\r\n            // novel.tags = novel.tags\r\n            cache.put(`${novel.userName}`, novel.userId)  // åŠ å…¥ç¼“å­˜ï¼Œä¾¿äºæœç´¢ä½œè€…\r\n            if (novel.tags === undefined || novel.tags === null) {\r\n                novel.tags = []\r\n            }\r\n            // æœç´¢å•ç¯‡\r\n            if (novel.isOneshot === undefined) {\r\n                // novel.seriesId = novel.seriesId\r\n                // novel.seriesTitle = novel.seriesTitle\r\n                // novel.textCount = novel.textCount\r\n                // novel.description = novel.description\r\n                novel.coverUrl = novel.url\r\n                // novel.createDate = novel.createDate\r\n                // novel.updateDate = novel.updateDate\r\n            }\r\n\r\n            // æœç´¢ç³»åˆ—\r\n            if (novel.isOneshot !== undefined) {\r\n                if (novel.isOneshot === true) {\r\n                    novel.seriesId = undefined\r\n                    novel.id = novel.novelId  // è·å–çœŸæ­£çš„ novelId\r\n                    novel.seriesTitle = undefined\r\n                } else {\r\n                    novel.seriesId = novel.id\r\n                    novel.id = novel.novelId = novel.latestEpisodeId  // è·å–çœŸæ­£çš„ novelId\r\n                    novel.seriesTitle = novel.title\r\n                    // novel.isWatched = novel.isWatched  // æœç´¢ç³»åˆ—å¯è·å–\r\n                }\r\n                novel.textCount = novel.textLength\r\n                novel.description = novel.caption\r\n                novel.coverUrl = novel.cover.urls[\"480mw\"]\r\n                novel.createDate = novel.createDateTime\r\n                novel.updateDate = novel.updateDateTime\r\n            }\r\n\r\n            // å•ç¯‡æ­£æ–‡è¯¦æƒ…é¡µ\r\n            if (novel.content) {\r\n                novel.novelId = novel.id\r\n                novel.tags = novel.tags.tags.map(item => item.tag)\r\n                novel.textCount = novel.userNovels[`${novel.id}`].textCount\r\n                // novel.latestChapter = novel.title\r\n                // novel.description = novel.description\r\n                novel.coverUrl = novel.userNovels[`${novel.id}`].url\r\n                // novel.createDate = novel.createDate\r\n                novel.updateDate = novel.uploadDate\r\n\r\n                if (novel.seriesNavData) {\r\n                    novel.seriesId = novel.seriesNavData.seriesId\r\n                    novel.seriesTitle = novel.seriesNavData.title\r\n                }\r\n            }\r\n\r\n            // ç³»åˆ—è¯¦æƒ…\r\n            if (novel.firstNovelId) {\r\n                novel.seriesId = novel.id\r\n                novel.id = novel.novelId = novel.firstNovelId\r\n                novel.seriesTitle = novel.title\r\n                novel.coverUrl = novel.cover.urls[\"480mw\"]\r\n                // novel.isWatched = novel.isWatched  // æœç´¢ç³»åˆ—å¯è·å–\r\n            }\r\n\r\n            // å•ç¯‡åŠ æ›´å¤šä¿¡æ¯\r\n            if (!novel.seriesId) {\r\n                novel.tags.unshift(\"å•æœ¬\")\r\n                novel.latestChapter = novel.title\r\n                novel.detailedUrl = urlNovelDetailed(novel.id)\r\n                novel.total = 1\r\n                if (novel.bookmarkData) {\r\n                    novel.isBookmark = true\r\n                    cache.put(`collect${novel.id}`, novel.bookmarkData.id)\r\n                    likeNovels.push(Number(novel.id))\r\n                } else {\r\n                    novel.isBookmark = false\r\n                }\r\n            }\r\n            // ç³»åˆ—æ·»åŠ æ›´å¤šä¿¡æ¯\r\n            if (novel.seriesId) {\r\n                let series = getAjaxJson(urlSeriesDetailed(novel.seriesId)).body\r\n                novel.id = series.firstNovelId\r\n                novel.title = series.title\r\n                novel.tags = novel.tags.concat(series.tags)\r\n                novel.tags.unshift(\"é•¿ç¯‡\")\r\n                novel.textCount = series.publishedTotalCharacterCount\r\n                novel.description = series.caption\r\n                novel.coverUrl = series.cover.urls[\"480mw\"]\r\n                novel.detailedUrl = urlSeriesDetailed(novel.seriesId)\r\n                novel.createDate = series.createDate\r\n                novel.updateDate = series.updateDate\r\n                novel.total = series.publishedContentCount\r\n                novel.isWatched = series.isWatched\r\n                if (novel.isWatched === true) {\r\n                    watchedSeries.push(Number(novel.seriesId))\r\n                }\r\n\r\n                // å‘é€è¯·æ±‚è·å–ç¬¬ä¸€ç«  è·å–æ ‡ç­¾ä¸ç®€ä»‹\r\n                let firstNovel = {}\r\n                try {\r\n                    firstNovel = getAjaxJson(urlNovelDetailed(series.firstNovelId)).body\r\n                    novel.tags = novel.tags.concat(firstNovel.tags.tags.map(item => item.tag))\r\n                    if (firstNovel.bookmarkData) {\r\n                        firstNovel.isBookmark = true\r\n                        cache.put(`collect${firstNovel.id}`, firstNovel.bookmarkData.id)\r\n                        likeNovels.push(Number(firstNovel.id))\r\n                    }\r\n                } catch (e) {  // é˜²æ­¢ç³»åˆ—é¦–ç¯‡æ— æƒé™è·å–\r\n                    try {\r\n                        firstNovel = getAjaxJson(urlSeriesNovels(novel.seriesId, 30, 0)).body.thumbnails.novel[0]\r\n                        novel.id = novel.firstNovelId = firstNovel.id\r\n                        novel.tags = novel.tags.concat(firstNovel.tags)\r\n                    } catch (e) { // é˜²æ­¢ç³»åˆ—é¦–ç¯‡æ— æƒé™è·å–\r\n                        firstNovel = {}\r\n                        firstNovel.description = \"\"\r\n                    }\r\n                }\r\n                novel.tags.unshift(\"é•¿ç¯‡\")\r\n                if (novel.description === \"\") {\r\n                    novel.description = firstNovel.description\r\n                }\r\n            }\r\n        })\r\n        // æ”¶è—å°è¯´/è¿½æ›´ç³»åˆ— å†™å…¥ç¼“å­˜\r\n        util.saveNovels(\"likeNovels\", likeNovels)\r\n        util.saveNovels(\"watchedSeries\", watchedSeries)\r\n        util.debugFunc(() => {\r\n            java.log(`å¤„ç†å°è¯´å®Œæˆ`)\r\n        })\r\n        return novels\r\n    }\r\n\r\n    // å°è¯´ä¿¡æ¯æ ¼å¼åŒ–\r\n    u.formatNovels = function(novels) {\r\n        novels = util.novelFilter(novels)\r\n        novels.forEach(novel => {\r\n            if (novel.title) novel.title = novel.title.trim()\r\n            if (!novel.userName.startsWith(\"@\")) novel.userName = `@${novel.userName}`\r\n            novel.coverUrl = urlCoverUrl(novel.coverUrl)\r\n            novel.readingTime = `${novel.readingTime / 60} åˆ†é’Ÿ`\r\n            novel.createDate = dateFormat(novel.createDate)\r\n            novel.updateDate = dateFormat(novel.updateDate)\r\n\r\n            novel.tags2 = []\r\n            for (let i in novel.tags) {\r\n                let tag = novel.tags[i]\r\n                if (tag.includes(\"/\")) {\r\n                    let tags = tag.split(\"/\")\r\n                    novel.tags2 = novel.tags2.concat(tags)\r\n                } else {\r\n                    novel.tags2.push(tag)\r\n                }\r\n            }\r\n            novel.tags = Array.from(new Set(novel.tags2))\r\n            novel.tags = novel.tags.join(\",\")\r\n            if (novel.seriesId) {\r\n                collectMsg = `ğŸ“ƒ è¿½æ›´ï¼š${util.checkStatus(novel.isWatched)}è¿½æ›´ç³»åˆ—`\r\n            } else {\r\n                collectMsg = `â¤ï¸ æ”¶è—ï¼š${util.checkStatus(novel.isBookmark)}åŠ å…¥æ”¶è—`\r\n            }\r\n\r\n            if (util.settings.MORE_INFORMATION) {\r\n                novel.description = `\\nğŸ…¿ï¸ ç™»å½•ï¼š${util.checkStatus(isLogin())}ç™»å½•è´¦å·\r\n                ${collectMsg}\\nğŸ“– ä¹¦åï¼š${novel.title}\\nğŸ‘¤ ä½œè€…ï¼š${novel.userName}\r\n                #ï¸ æ ‡ç­¾ï¼š${novel.tags}\\nâ¬†ï¸ ä¸Šä¼ ï¼š${novel.createDate}\r\n                ğŸ”„ æ›´æ–°ï¼š${novel.updateDate}\\nğŸ“„ ç®€ä»‹ï¼š${novel.description}`\r\n            } else {\r\n                novel.description = `\\nğŸ…¿ï¸ ç™»å½•ï¼š${util.checkStatus(isLogin())}ç™»å½•è´¦å·\r\n                ${collectMsg}\\nâ¬†ï¸ ä¸Šä¼ ï¼š${novel.createDate}\\nğŸ”„ æ›´æ–°ï¼š${novel.updateDate}\r\n                ğŸ“„ ç®€ä»‹ï¼š${novel.description}`\r\n            }\r\n        })\r\n        novels = util.novelFilter2(novels)\r\n        return novels\r\n    }\r\n\r\n    // æ­£æ–‡ï¼Œè¯¦æƒ…ï¼Œæœç´¢ï¼šä»ç½‘å€è·å–idï¼Œè¿”å›å•ç¯‡å°è¯´ resï¼Œç³»åˆ—è¿”å›é¦–ç¯‡å°è¯´ res\r\n    // pixiv é»˜è®¤åˆ†äº«ä¿¡æ¯ä¸­æœ‰#å·ï¼Œä¸ä¼šè¢«è¯†åˆ«æˆé“¾æ¥ï¼Œæ— æ³•ä½¿ç”¨æ·»åŠ ç½‘å€\r\n    u.getNovelRes = function(result) {\r\n        let novelId = 0, res = {\"body\": {}}\r\n        let isJson = isJsonString(result)\r\n        let isHtml = isHtmlString(result)\r\n\r\n        if (!isJson && isHtml) {\r\n            let id = baseUrl.match(new RegExp(\"\\\\d+\"))[0]\r\n            let pattern = \"(https?://)?(www\\\\.)?pixiv\\\\.net(/ajax)?/users?/\\\\d+\"\r\n            let isAuthor = baseUrl.match(new RegExp(pattern))\r\n            if (isAuthor) {\r\n                java.log(`ä½œè€…IDï¼š${id}`)\r\n                novelId = Object.keys(getAjaxJson(urlUserWorkLatest(id)).body.novels).reverse()[0]\r\n            }\r\n\r\n            pattern = \"(https?://)?(www\\\\.)?pixiv\\\\.net/novel/series/\\\\d+\"\r\n            let isSeries = baseUrl.match(new RegExp(pattern))\r\n            if (isSeries) {\r\n                java.log(`ç³»åˆ—IDï¼š${id}`)\r\n                try {\r\n                    novelId = getAjaxJson(urlSeriesDetailed(id)).body.firstNovelId\r\n                } catch (e) {\r\n                    novelId = getAjaxJson(urlSeriesNovels(id, 30, 0)).body.thumbnails.novel[0].id\r\n                }\r\n            } else {\r\n                let pattern = \"(https?://)?(www\\\\.)?pixiv\\\\.net/novel/(show\\\\.php\\\\?id=)?\\\\d+\"\r\n                let isNovel = baseUrl.match(new RegExp(pattern))\r\n                if (isNovel) {\r\n                    novelId = id\r\n                }\r\n            }\r\n        }\r\n        if (isJson) {\r\n            res = JSON.parse(result)\r\n        }\r\n\r\n        if (novelId) {\r\n            java.log(`åŒ¹é…å°è¯´IDï¼š${novelId}`)\r\n            res = getAjaxJson(urlNovelDetailed(novelId))\r\n        }\r\n        if (res.error === true) {\r\n            java.log(`æ— æ³•ä» Pixiv è·å–å½“å‰å°è¯´`)\r\n            java.log(JSON.stringify(res))\r\n        }\r\n        return res.body\r\n    }\r\n\r\n    // ç›®å½•ï¼šä»ç½‘å€è·å–idï¼Œå°½å¯èƒ½è¿”å›ç³»åˆ— resï¼Œå•ç¯‡å°è¯´è¿”å›å°è¯´ res\r\n    u.getNovelResSeries = function(result) {\r\n        let seriesId = 0, res = {\"body\": {}}\r\n        let isJson = isJsonString(result)\r\n        let isHtml = isHtmlString(result)\r\n\r\n        if (!isJson && isHtml) {\r\n            let id = baseUrl.match(new RegExp(\"\\\\d+\"))[0]\r\n            let pattern = \"(https?://)?(www\\\\.)?pixiv\\\\.net/novel/series/\\\\d+\"\r\n            let isSeries = baseUrl.match(new RegExp(pattern))\r\n            if (isSeries) {\r\n                seriesId = id\r\n            } else {\r\n                let pattern = \"(https?://)?(www\\\\.)?pixiv\\\\.net/novel/(show\\\\.php\\\\?id=)?\\\\d+\"\r\n                let isNovel = baseUrl.match(new RegExp(pattern))\r\n                if (isNovel) {\r\n                    java.log(`åŒ¹é…å°è¯´IDï¼š${id}`)\r\n                    res = getAjaxJson(urlNovelDetailed(id))\r\n                }\r\n            }\r\n        }\r\n        if (isJson) {\r\n            res = JSON.parse(result)\r\n        }\r\n\r\n        if (res.body && res.body.seriesNavData) {\r\n            seriesId = res.body.seriesNavData.seriesId\r\n        }\r\n        if (seriesId) {\r\n            java.log(`ç³»åˆ—IDï¼š${seriesId}`)\r\n            res = getAjaxJson(urlSeriesDetailed(seriesId))\r\n        }\r\n        if (res.error === true) {\r\n            java.log(`æ— æ³•ä» Pixiv è·å–å½“å‰å°è¯´`)\r\n            java.log(JSON.stringify(res))\r\n        }\r\n        return res.body\r\n    }\r\n\r\n    util = u\r\n    java.put(\"util\", objStringify(u))\r\n}\r\n\r\nfunction checkMessageThread(checkTimes) {\r\n    if (checkTimes === undefined) {\r\n        checkTimes = Number(cache.get(\"checkTimes\"))\r\n    }\r\n    if (checkTimes === 0 && isLogin()) {\r\n        let latestMsg = getAjaxJson(urlMessageThreadLatest(5))\r\n        if (latestMsg.error === true) {\r\n            java.log(JSON.stringify(latestMsg))\r\n        } else if (latestMsg.body.total >= 1) {\r\n            let msg = latestMsg.body.message_threads.filter(item => item.thread_name === \"pixiväº‹å‹™å±€\")[0]\r\n            if (msg && new Date().getTime()- 1000*msg.modified_at <= 3*24*60*60*1000) { // 3å¤©å†…è¿›è¡Œæç¤º\r\n                sleepToast(`æ‚¨äº ${timeFormat(1000*msg.modified_at)} è§¦å‘ Pixiv ã€è¿‡åº¦è®¿é—®ã€‘ï¼Œè¯·ä¿®æ”¹å¯†ç å¹¶é‡æ–°ç™»å½•ã€‚\\nå¦‚å·²ä¿®æ”¹è¯·å¿½ç•¥`, 3)\r\n                sleepToast(`${msg.latest_content}`, 5)\r\n                java.startBrowser(\"https://accounts.pixiv.net/password/change\",'ä¿®æ”¹å¯†ç ')\r\n            }\r\n        }\r\n    }\r\n    cache.put(\"checkTimes\", checkTimes + 1, 4*60*60)  // ç¼“å­˜4hï¼Œæ¯4hæé†’ä¸€æ¬¡\r\n    // cache.put(\"checkTimes\", checkTimes + 1, 60)  // æµ‹è¯•ç”¨ï¼Œç¼“å­˜60sï¼Œæ¯åˆ†é’Ÿæé†’ä¸€æ¬¡\r\n    // java.log(checkTimes + 1)\r\n}\r\n\r\n// è·å–è¯·æ±‚çš„user idæ–¹ä¾¿å…¶ä»–ajaxè¯·æ±‚æ„é€ \r\nfunction getPixivUid() {\r\n    let uid = cache.get(\"pixiv:uid\")\r\n    if (!uid || String(uid) === \"null\") {\r\n        let html = java.webView(null, \"https://www.pixiv.net/\", null)\r\n        try {\r\n            uid = html.match(/user_id:'(\\d+)'/)[1]\r\n        } catch (e) {\r\n            uid = null\r\n        }\r\n        cache.put(\"pixiv:uid\", String(uid))\r\n    }\r\n}\r\n\r\nfunction getHeaders() {\r\n    let headers = {\r\n        \"accept\": \"application/json\",\r\n        \"accept-encoding\": \"gzip, deflate, br, zstd\",\r\n        \"accept-language\": \"zh-CN\",\r\n        // \"content-type\": \"application/json; charset=utf-8\",\r\n        // \"content-type\": \"application/x-www-form-urlencoded; charset=utf-8\",\r\n        \"origin\": \"https//www.pixiv.net\",\r\n        \"referer\": \"https://www.pixiv.net/\",\r\n        // \"sec-ch-ua\": `\"Not/A)Brand\";v=\"8\", \"Chromium\";v=\"132\", \"Google Chrome\";v=\"132\"`,\r\n        // \"sec-ch-ua-mobile\": \"?0\",\r\n        // \"sec-ch-ua-platform\": \"Windows\",\r\n        // \"sec-fetch-dest\": \"empty\",\r\n        // \"sec-fetch-mode\": \"cors\",\r\n        // \"sec-fetch-site\": \"same-origin\",\r\n        \"user-agent\": cache.get(\"userAgent\"),\r\n        \"x-csrf-token\": cache.get(\"csfrToken\"),\r\n        \"Cookie\": cache.get(\"pixivCookie\")\r\n    }\r\n    putInCache(\"headers\", headers)\r\n    return headers\r\n}\r\n\r\npublicFunc()\r\nif (result.code() === 200) {\r\n    getPixivUid(); getWebViewUA(); util.getCookie(); util.getCsrfToken(); getHeaders()\r\n    if (!util.settings.FAST) checkMessageThread()   // æ£€æµ‹è¿‡åº¦è®¿é—®\r\n}\r\n\r\nutil.debugFunc(() => {\r\n    java.log(`DEBUG = ${util.settings.DEBUG}\\n`)\r\n    java.log(JSON.stringify(util.settings, null, 4))\r\n    java.log(`${getWebViewUA()}\\n`)\r\n    java.log(`${cache.get(\"csfrToken\")}\\n`)\r\n    java.log(`${cache.get(\"pixivCookie\")}\\n`)\r\n    java.log(`${cache.get(\"headers\")}\\n`)\r\n})\r\n\r\njava.getStrResponse(null, null)",
        "loginUi": "[\r\n    {\r\n        \"name\": \"\\uD83C\\uDD7Fï¸ ç™»å½•è´¦å·\",\r\n        \"type\": \"button\",\r\n        \"action\": \"login()\",\r\n        \"style\": {\r\n            \"layout_flexGrow\": 1,\r\n            \"layout_flexBasisPercent\": -1\r\n        }\r\n    },\r\n    {\r\n        \"name\": \"âš™ï¸ è´¦å·è®¾ç½®\",\r\n        \"type\": \"button\",\r\n        \"action\": \"startPixivSettings()\",\r\n        \"style\": {\r\n            \"layout_flexGrow\": 1,\r\n            \"layout_flexBasisPercent\": -1\r\n        }\r\n    },\r\n    {\r\n        \"name\": \"\\uD83D\\uDD19 é€€å‡ºè´¦å·\",\r\n        \"type\": \"button\",\r\n        \"action\": \"logout()\",\r\n        \"style\": {\r\n            \"layout_flexGrow\": 1,\r\n            \"layout_flexBasisPercent\": -1\r\n        }\r\n    },\r\n    {\r\n        \"name\": \"ğŸ†™ æ›´æ–°ä¹¦æº\",\r\n        \"type\": \"button\",\r\n        \"action\": \"updateSource()\",\r\n        \"style\": {\r\n            \"layout_flexGrow\": 1,\r\n            \"layout_flexBasisPercent\": -1\r\n        }\r\n    },\r\n    {\r\n        \"name\": \"\\uD83D\\uDD30 ä½¿ç”¨æŒ‡å—\",\r\n        \"type\": \"button\",\r\n        \"action\": \"startGithubReadme()\",\r\n        \"style\": {\r\n            \"layout_flexGrow\": 1,\r\n            \"layout_flexBasisPercent\": -1\r\n        }\r\n    },\r\n    {\r\n        \"name\": \"\\uD83D\\uDC1E åé¦ˆé—®é¢˜\",\r\n        \"type\": \"button\",\r\n        \"action\": \"startGithubIssue()\",\r\n        \"style\": {\r\n            \"layout_flexGrow\": 1,\r\n            \"layout_flexBasisPercent\": -1\r\n        }\r\n    },\r\n    {\r\n        \"name\": \"â¤ï¸ å…¬å¼€æ”¶è—\",\r\n        \"type\": \"button\",\r\n        \"action\": \"novelBookmarkFactory(1)\",\r\n        \"style\": {\r\n            \"layout_flexGrow\": 1,\r\n            \"layout_flexBasisPercent\": -1\r\n        }\r\n    },\r\n    {\r\n        \"name\": \"\\uD83D\\uDCC3 è¿½æ›´ç³»åˆ—\",\r\n        \"type\": \"button\",\r\n        \"action\": \"seriesWatchFactory()\",\r\n        \"style\": {\r\n            \"layout_flexGrow\": 1,\r\n            \"layout_flexBasisPercent\": -1\r\n        }\r\n    },\r\n    {\r\n        \"name\": \"â¤ï¸ æ”¶è—ç³»åˆ—\",\r\n        \"type\": \"button\",\r\n        \"action\": \"novelsBookmarkAdd()\",\r\n        \"style\": {\r\n            \"layout_flexGrow\": 1,\r\n            \"layout_flexBasisPercent\": -1\r\n        }\r\n    },\r\n    {\r\n        \"name\": \"\\uD83D\\uDDA4 å–æ¶ˆæ”¶è—\",\r\n        \"type\": \"button\",\r\n        \"action\": \"novelsBookmarkDelete()\",\r\n        \"style\": {\r\n            \"layout_flexGrow\": 1,\r\n            \"layout_flexBasisPercent\": -1\r\n        }\r\n    },\r\n    {\r\n        \"name\": \"â­ï¸ å…³æ³¨ä½œè€…\",\r\n        \"type\": \"button\",\r\n        \"action\": \"userFollowFactory()\",\r\n        \"style\": {\r\n            \"layout_flexGrow\": 1,\r\n            \"layout_flexBasisPercent\": -1\r\n        }\r\n    },\r\n    {\r\n        \"name\": \"\\uD83D\\uDEAB å±è”½ä½œè€…\",\r\n        \"type\": \"button\",\r\n        \"action\": \"userBlock()\",\r\n        \"style\": {\r\n            \"layout_flexGrow\": 1,\r\n            \"layout_flexBasisPercent\": -1\r\n        }\r\n    },\r\n\r\n    {\r\n        \"name\": \"è¾“å…¥å†…å®¹\",\r\n        \"type\": \"text\"\r\n    },\r\n    {\r\n        \"name\": \"âœ… å‘é€è¯„è®º\",\r\n        \"type\": \"button\",\r\n        \"action\": \"novelCommentAdd()\",\r\n        \"style\": {\r\n            \"layout_flexGrow\": 1,\r\n            \"layout_flexBasisPercent\": -1\r\n        }\r\n    },\r\n    {\r\n        \"name\": \"\\uD83D\\uDDD1 åˆ é™¤è¯„è®º\",\r\n        \"type\": \"button\",\r\n        \"action\": \"novelCommentDelete()\",\r\n        \"style\": {\r\n            \"layout_flexGrow\": 1,\r\n            \"layout_flexBasisPercent\": -1\r\n        }\r\n    },\r\n    {\r\n        \"name\": \"\\uD83E\\uDDF9 æ¸…é™¤ç¼“å­˜\",\r\n        \"type\": \"button\",\r\n        \"action\": \"cleanCache()\",\r\n        \"style\": {\r\n            \"layout_flexGrow\": 1,\r\n            \"layout_flexBasisPercent\": -1\r\n        }\r\n    },\r\n\r\n    {\r\n        \"name\": \"\\uD83D\\uDEAB æ·»åŠ å±è”½\",\r\n        \"type\": \"button\",\r\n        \"action\": \"blockAddFactory()\",\r\n        \"style\": {\r\n            \"layout_flexGrow\": 1,\r\n            \"layout_flexBasisPercent\": -1\r\n        }\r\n    },\r\n    {\r\n        \"name\": \"â­•ï¸ åˆ é™¤å±è”½\",\r\n        \"type\": \"button\",\r\n        \"action\": \"blockDeleteFactory()\",\r\n        \"style\": {\r\n            \"layout_flexGrow\": 1,\r\n            \"layout_flexBasisPercent\": -1\r\n        }\r\n    },\r\n    {\r\n        \"name\": \"\\uD83D\\uDC40 æŸ¥çœ‹å±è”½\",\r\n        \"type\": \"button\",\r\n        \"action\": \"blockShowFactory()\",\r\n        \"style\": {\r\n            \"layout_flexGrow\": 1,\r\n            \"layout_flexBasisPercent\": -1\r\n        }\r\n    },\r\n\r\n    {\r\n        \"name\": \"\\uD83D\\uDCCC å–œæ¬¢æ ‡ç­¾\",\r\n        \"type\": \"button\",\r\n        \"action\": \"likeTagsAdd()\",\r\n        \"style\": {\r\n            \"layout_flexGrow\": 1,\r\n            \"layout_flexBasisPercent\": -1\r\n        }\r\n    },\r\n    {\r\n        \"name\": \"\\uD83D\\uDDD1 åˆ é™¤æ ‡ç­¾\",\r\n        \"type\": \"button\",\r\n        \"action\": \"likeTagsDelete()\",\r\n        \"style\": {\r\n            \"layout_flexGrow\": 1,\r\n            \"layout_flexBasisPercent\": -1\r\n        }\r\n    },\r\n    {\r\n        \"name\": \"\\uD83D\\uDC40 æŸ¥çœ‹æ ‡ç­¾\",\r\n        \"type\": \"button\",\r\n        \"action\": \"likeTagsShow()\",\r\n        \"style\": {\r\n            \"layout_flexGrow\": 1,\r\n            \"layout_flexBasisPercent\": -1\r\n        }\r\n    },\r\n\r\n    {\r\n        \"name\": \"â¤ï¸ ä»–äººæ”¶è—\",\r\n        \"type\": \"button\",\r\n        \"action\": \"likeAuthorsAdd()\",\r\n        \"style\": {\r\n            \"layout_flexGrow\": 1,\r\n            \"layout_flexBasisPercent\": -1\r\n        }\r\n    },\r\n    {\r\n        \"name\": \"\\uD83D\\uDDA4 å–æ¶ˆæ”¶è—\",\r\n        \"type\": \"button\",\r\n        \"action\": \"likeAuthorsDelete()\",\r\n        \"style\": {\r\n            \"layout_flexGrow\": 1,\r\n            \"layout_flexBasisPercent\": -1\r\n        }\r\n    },\r\n    {\r\n        \"name\": \"\\uD83D\\uDC40 æŸ¥çœ‹æ”¶è—\",\r\n        \"type\": \"button\",\r\n        \"action\": \"likeAuthorsShow()\",\r\n        \"style\": {\r\n            \"layout_flexGrow\": 1,\r\n            \"layout_flexBasisPercent\": -1\r\n        }\r\n    },\r\n\r\n    {\r\n        \"name\": \"ä¹¦æºè®¾ç½®\",\r\n        \"type\": \"text\"\r\n    },\r\n    {\r\n        \"name\": \"âš™ï¸ å½“å‰è®¾ç½®\",\r\n        \"type\": \"button\",\r\n        \"action\": \"showSettings()\",\r\n        \"style\": {\r\n            \"layout_flexGrow\": 1,\r\n            \"layout_flexBasisPercent\": -1\r\n        }\r\n    },\r\n    {\r\n        \"name\": \"\\uD83D\\uDD27 é»˜è®¤è®¾ç½®\",\r\n        \"type\": \"button\",\r\n        \"action\": \"editSettings('')\",\r\n        \"style\": {\r\n            \"layout_flexGrow\": 1,\r\n            \"layout_flexBasisPercent\": -1\r\n        }\r\n    },\r\n    {\r\n        \"name\": \"\\uD83D\\uDC64 æœç´¢ä½œè€…\",\r\n        \"type\": \"button\",\r\n        \"action\": \"editSettings('SEARCH_AUTHOR')\",\r\n        \"style\": {\r\n            \"layout_flexGrow\": 1,\r\n            \"layout_flexBasisPercent\": -1\r\n        }\r\n    },\r\n    {\r\n        \"name\": \"\\uD83C\\uDC04 ç¹ç®€é€šæœ\",\r\n        \"type\": \"button\",\r\n        \"action\": \"editSettings('CONVERT_CHINESE')\",\r\n        \"style\": {\r\n            \"layout_flexGrow\": 1,\r\n            \"layout_flexBasisPercent\": -1\r\n        }\r\n    },\r\n    {\r\n        \"name\": \"\\uD83D\\uDCD6 æ›´å¤šç®€ä»‹\",\r\n        \"type\": \"button\",\r\n        \"action\": \"editSettings('MORE_INFORMATION')\",\r\n        \"style\": {\r\n            \"layout_flexGrow\": 1,\r\n            \"layout_flexBasisPercent\": -1\r\n        }\r\n    },\r\n    {\r\n        \"name\": \"\\uD83D\\uDCC5 æ›´æ–°æ—¶é—´\",\r\n        \"type\": \"button\",\r\n        \"action\": \"editSettings('SHOW_UPDATE_TIME')\",\r\n        \"style\": {\r\n            \"layout_flexGrow\": 1,\r\n            \"layout_flexBasisPercent\": -1\r\n        }\r\n    },\r\n    {\r\n        \"name\": \"\\uD83D\\uDD17 åŸå§‹é“¾æ¥\",\r\n        \"type\": \"button\",\r\n        \"action\": \"editSettings('SHOW_ORIGINAL_LINK')\",\r\n        \"style\": {\r\n            \"layout_flexGrow\": 1,\r\n            \"layout_flexBasisPercent\": -1\r\n        }\r\n    },\r\n    {\r\n        \"name\": \"\\uD83D\\uDCDA æ¢å¤ã€Šã€‹\",\r\n        \"type\": \"button\",\r\n        \"action\": \"editSettings('REPLACE_TITLE_MARKS')\",\r\n        \"style\": {\r\n            \"layout_flexGrow\": 1,\r\n            \"layout_flexBasisPercent\": -1\r\n        }\r\n    },\r\n    {\r\n        \"name\": \"\\uD83D\\uDDBCï¸ æ˜¾ç¤ºæè¿°\",\r\n        \"type\": \"button\",\r\n        \"action\": \"editSettings('SHOW_CAPTIONS')\",\r\n        \"style\": {\r\n            \"layout_flexGrow\": 1,\r\n            \"layout_flexBasisPercent\": -1\r\n        }\r\n    },\r\n    {\r\n        \"name\": \"\\uD83D\\uDCAC æ˜¾ç¤ºè¯„è®º\",\r\n        \"type\": \"button\",\r\n        \"action\": \"editSettings('SHOW_COMMENTS')\",\r\n        \"style\": {\r\n            \"layout_flexGrow\": 1,\r\n            \"layout_flexBasisPercent\": -1\r\n        }\r\n    },\r\n    {\r\n        \"name\": \"â¤ï¸ æ˜¾ç¤ºæ”¶è—\",\r\n        \"type\": \"button\",\r\n        \"action\": \"editSettings('SHOW_LIKE_NOVELS')\",\r\n        \"style\": {\r\n            \"layout_flexGrow\": 1,\r\n            \"layout_flexBasisPercent\": -1\r\n        }\r\n    },\r\n    {\r\n        \"name\": \"\\uD83D\\uDCC3 æ˜¾ç¤ºè¿½æ›´\",\r\n        \"type\": \"button\",\r\n        \"action\": \"editSettings('SHOW_WATCHED_SERIES')\",\r\n        \"style\": {\r\n            \"layout_flexGrow\": 1,\r\n            \"layout_flexBasisPercent\": -1\r\n        }\r\n    },\r\n    {\r\n        \"name\": \"â© å¿«é€Ÿæ¨¡å¼\",\r\n        \"type\": \"button\",\r\n        \"action\": \"editSettings('FAST')\",\r\n        \"style\": {\r\n            \"layout_flexGrow\": 1,\r\n            \"layout_flexBasisPercent\": -1\r\n        }\r\n    },\r\n    {\r\n        \"name\": \"\\uD83D\\uDC1E è°ƒè¯•æ¨¡å¼\",\r\n        \"type\": \"button\",\r\n        \"action\": \"editSettings('DEBUG')\",\r\n        \"style\": {\r\n            \"layout_flexGrow\": 1,\r\n            \"layout_flexBasisPercent\": -1\r\n        }\r\n    },\r\n    {\r\n        \"name\": \"\\uD83D\\uDD0D æœç´¢è¯´æ˜\",\r\n        \"type\": \"button\",\r\n        \"action\": \"readMeSearch()\",\r\n        \"style\": {\r\n            \"layout_flexGrow\": 1,\r\n            \"layout_flexBasisPercent\": -1\r\n        }\r\n    },\r\n    {\r\n        \"name\": \"\\uD83D\\uDCC4 æœç´¢é¡µç \",\r\n        \"type\": \"button\",\r\n        \"action\": \"showMaxPages()\",\r\n        \"style\": {\r\n            \"layout_flexGrow\": 1,\r\n            \"layout_flexBasisPercent\": -1\r\n        }\r\n    },\r\n    {\r\n        \"name\": \"â« å¢åŠ é¡µç \",\r\n        \"type\": \"button\",\r\n        \"action\": \"editMaxPages('add')\",\r\n        \"style\": {\r\n            \"layout_flexGrow\": 1,\r\n            \"layout_flexBasisPercent\": -1\r\n        }\r\n    },\r\n    {\r\n        \"name\": \"â¬ å‡å°‘é¡µç \",\r\n        \"type\": \"button\",\r\n        \"action\": \"editMaxPages('minus')\",\r\n        \"style\": {\r\n            \"layout_flexGrow\": 1,\r\n            \"layout_flexBasisPercent\": -1\r\n        }\r\n    }\r\n]",
        "loginUrl": "function login() {\r\n    sleepToast(\"ğŸ”„ æ­£åœ¨æ£€æµ‹ç™»é™†çŠ¶æ€ï¼Œè¯·ç¨å€™\")\r\n    if (isLogin()) {\r\n        sleepToast(\"ï¸ğŸ…¿ï¸ ç™»å½•è´¦å·\\nâœ… å·²ç»ç™»å½•è¿‡è´¦å·äº†\\n\\nå¯ä»¥ç‚¹å‡»ã€ğŸ”™ é€€å‡ºè´¦å·ã€‘æ¥åˆ‡æ¢è´¦å·\")\r\n        return false\r\n    }\r\n\r\n    let resp = java.startBrowserAwait(`https://accounts.pixiv.net/login,\r\n    {\"headers\": {\"User-Agent\": ${getWebViewUA()}}}`, 'ç™»å½•è´¦å·', false)\r\n    if (resp.code() === 200) {\r\n        getCsrfToken(); getCookie()\r\n        return true\r\n    } else {\r\n        java.log(resp.code()); sleepToast(\"ğŸ…¿ï¸ ç™»å½•è´¦å·\\n\\nâš ï¸ ç™»å½•å¤±è´¥\")\r\n        return false\r\n    }\r\n}\r\n\r\nfunction logout() {\r\n    removeCookie()\r\n    java.startBrowser(\"https://www.pixiv.net/logout.php\", \"é€€å‡ºè´¦å·\")\r\n    removeCookie(); removeLikeDataCache(); removeSettingsCache()\r\n    sleepToast(`âœ… å·²é€€å‡ºå½“å‰è´¦å·\\n\\né€€å‡ºåè¯·ç‚¹å‡»å³ä¸Šè§’çš„ âœ”ï¸ é€€å‡º\\n\\nç™»å½•è¯·ç‚¹å‡»ã€ç™»å½•è´¦å·ã€‘è¿›è¡Œç™»å½•`)\r\n}\r\n\r\nfunction removeCookie() {\r\n    cookie.removeCookie('https://www.pixiv.net')\r\n    cookie.removeCookie('https://accounts.pixiv.net')\r\n    cookie.removeCookie('https://accounts.google.com')\r\n    cookie.removeCookie('https://api.weibo.com')\r\n    cache.delete(\"pixivCookie\")\r\n    cache.delete(\"pixiv:uid\")\r\n    cache.delete(\"csfrToken\")  // ä¸ç™»å½•è®¾å¤‡æœ‰å…³\r\n    cache.delete(\"headers\")\r\n}\r\n\r\nfunction removeCacheList(listName) {\r\n    let list = getFromCache(listName)\r\n    list.forEach(item => cache.delete(`collect${item}`))\r\n    if (listName !== \"blockAuthorList\") cache.delete(listName)\r\n}\r\n\r\nfunction removeLikeDataCache() {\r\n    // åˆ é™¤ likeNovels ä¸ watchedSeries\r\n    removeCacheList(\"likeNovels\")\r\n    removeCacheList(\"watchedSeries\")\r\n}\r\n\r\nfunction removeSettingsCache() {\r\n    // åˆ é™¤ è‡ªåŠ¨ç¿»é¡µçš„æœ€å¤§é¡µç \r\n    cache.delete(\"maxPagesKey\")\r\n    cache.delete(\"novelsMaxPages\")\r\n    cache.delete(\"seriesMaxPages\")\r\n\r\n    // åˆ é™¤ å±è”½ä½œè€…åå•\r\n    // removeCacheList(\"blockAuthorList\")\r\n    // åˆ é™¤  å±è”½å…³é”®è¯\r\n    // cache.delete(\"tagsBlockWords\")\r\n    // cache.delete(\"captionBlockWords\")\r\n}\r\n\r\nfunction getCookie() {\r\n    let pixivCookie = String(java.getCookie(\"https://www.pixiv.net/\", null))\r\n    if (isLogin()) cache.put(\"pixivCookie\", pixivCookie, 60*60)\r\n}\r\n\r\n// è·å– Csrf Tokenï¼Œä»¥ä¾¿è¿›è¡Œæ”¶è—ç­‰è¯·æ±‚\r\n// è·å–æ–¹æ³•æ¥è‡ªè„šæœ¬ Pixiv Previewer\r\n// https://github.com/Ocrosoft/PixivPreviewer\r\n// https://greasyfork.org/zh-CN/scripts/30766-pixiv-previewer/code\r\nfunction getCsrfToken() {\r\n    let csfrToken = cache.get(\"csfrToken\")\r\n    if (!csfrToken) {\r\n        let html = java.webView(null, \"https://www.pixiv.net/\", null)\r\n        try {\r\n            csfrToken = html.match(/token\\\\\":\\\\\"([a-z0-9]{32})/)[1]\r\n            cache.put(\"csfrToken\", csfrToken)  // ä¸ç™»å½•è®¾å¤‡æœ‰å…³ï¼Œæ— æ³•å­˜å‚¨ nul\r\n        } catch (e) {\r\n            csfrToken = null\r\n            cache.delete(\"csfrToken\")  // ä¸ç™»å½•è®¾å¤‡æœ‰å…³ï¼Œæ— æ³•å­˜å‚¨ nul\r\n            // sleepToast(\"âš ï¸ æœªç™»å½•è´¦å·(csfrToken)\")\r\n        }\r\n        java.log(`csfrToken:\\n${csfrToken}`)\r\n    }\r\n    return csfrToken\r\n}\r\n\r\nfunction getNovel() {\r\n    let novel = source.getLoginInfoMap()\r\n    if (!novel) novel = getFromCache(\"novel\")\r\n    return novel\r\n}\r\n\r\nfunction getPostBody(url, body, headers) {\r\n    if (headers === undefined) headers = getFromCache(\"headers\")\r\n    if (isJsonString(body)) {\r\n        headers[\"content-type\"] = \"application/json; charset=utf-8\"\r\n    } else if (typeof body === \"string\") {\r\n        headers[\"content-type\"] = \"application/x-www-form-urlencoded; charset=utf-8\"\r\n    }\r\n    try {\r\n        java.log(`getPostBody(${url}, ${body}, ${headers})`)\r\n        return JSON.parse(java.post(url, body, headers).body())\r\n    } catch (e) {\r\n        e = String(e)\r\n        // sleepToast(e)\r\n        // sleepToast(JSON.stringify(headers))\r\n        if (e.includes(\"400\")) sleepToast(`ğŸ“¤ getPostBody\\n\\nâš ï¸ ç¼ºå°‘ headers`, 1)\r\n        else if (e.includes(\"403\")) sleepToast(`ğŸ“¤ getPostBody\\n\\nâš ï¸ ç¼ºå°‘ cookie æˆ– cookie è¿‡æœŸ`, 1)\r\n        else if (e.includes(\"404\")) sleepToast(`ğŸ“¤ getPostBody\\n\\nâš ï¸ 404 ç¼ºå°‘ csfrToken `, 1)\r\n        else if (e.includes(\"422\")) sleepToast(`ğŸ“¤ getPostBody\\n\\nâš ï¸ è¯·æ±‚ä¿¡æ¯æœ‰è¯¯`, 1)\r\n        return {error: true, errMsg:e}\r\n    }\r\n}\r\n\r\nfunction novelBookmarkAdd(restrict) {\r\n    if (restrict === undefined) restrict = 0\r\n    let novel = getNovel()\r\n    let resp = getPostBody(\r\n        \"https://www.pixiv.net/ajax/novels/bookmarks/add\",\r\n        JSON.stringify({\"novel_id\": novel.id, \"restrict\": restrict, \"comment\":\"\", \"tags\":[]})\r\n    )\r\n    if (resp.error === true) {\r\n        sleepToast(`â¤ï¸ æ”¶è—å°è¯´\\n\\nâš ï¸ æ”¶è—ã€${novel.title}ã€‘å¤±è´¥`)\r\n        shareFactory(\"novel\")\r\n    } else if (resp.body === null) {\r\n        sleepToast(`â¤ï¸ æ”¶è—å°è¯´\\n\\nâœ… å·²ç»æ”¶è—ã€${novel.title}ã€‘äº†`)\r\n    } else {\r\n        cache.put(`collect${novel.id}`, resp.body)\r\n        sleepToast(`â¤ï¸ æ”¶è—å°è¯´\\n\\nâœ… å·²æ”¶è—ã€${novel.title}ã€‘`)\r\n\r\n        let likeNovels = getFromCache(\"likeNovels\")\r\n        likeNovels.push(Number(novel.id))\r\n        putInCache(\"likeNovels\", likeNovels)\r\n\r\n        let novelObj = getAjaxJson(urlNovelDetailed(novel.id))\r\n        novelObj.body.isBookmark = true\r\n        putInCache(urlNovelDetailed(novel.id), novelObj, cacheSaveSeconds)\r\n    }\r\n}\r\n\r\nfunction getNovelBookmarkId(novelId) {\r\n    let bookmarkId = getFromCache(`collect${novelId}`)\r\n    if (bookmarkId === null) {\r\n        bookmarkId = getAjaxJson(urlNovelBookmarkData(novelId), true).body.bookmarkData.id\r\n    }\r\n    return bookmarkId\r\n}\r\n\r\nfunction novelBookmarkDelete() {\r\n    let novel = getNovel()\r\n    let resp = getPostBody(\r\n        \"https://www.pixiv.net/ajax/novels/bookmarks/delete\",\r\n        `del=1&book_id=${getNovelBookmarkId(novel.id)}`\r\n    )\r\n    if (resp.error === true) {\r\n        sleepToast(`â¤ï¸ æ”¶è—å°è¯´\\n\\nâš ï¸ å–æ¶ˆæ”¶è—ã€${novel.title}ã€‘å¤±è´¥`)\r\n        shareFactory(\"novel\")\r\n    } else {\r\n        cache.delete(`collect${novel.id}`)\r\n        sleepToast(`â¤ï¸ æ”¶è—å°è¯´\\n\\nâœ… å·²å–æ¶ˆæ”¶è—ã€${novel.title}ã€‘`)\r\n\r\n        let likeNovels = getFromCache(\"likeNovels\")\r\n        likeNovels = likeNovels.filter(item => item !== Number(novel.id))\r\n        putInCache(\"likeNovels\", likeNovels)\r\n\r\n        let novelObj = getAjaxJson(urlNovelDetailed(novel.id))\r\n        novelObj.body.isBookmark = false\r\n        putInCache(urlNovelDetailed(novel.id), novelObj, cacheSaveSeconds)\r\n    }\r\n}\r\n\r\nfunction novelsBookmarkDelete() {\r\n    let novel = getNovel()\r\n    if (!novel.seriesId) {\r\n        sleepToast(`ğŸ–¤ å–æ¶ˆæ”¶è—ç³»åˆ—\\n\\nâš ï¸ ã€${novel.title}ã€‘éç³»åˆ—å°è¯´ï¼Œç°å·²å–æ¶ˆæ”¶è—æœ¬ç¯‡å°è¯´`)\r\n        return novelBookmarkDelete(0)\r\n    } else {\r\n        sleepToast(`ğŸ–¤ å–æ¶ˆæ”¶è—ç³»åˆ—\\n\\nğŸ”„ æ­£åœ¨å–æ¶ˆæ”¶è—ç³»åˆ—ã€${novel.seriesTitle}ã€‘ï¼Œè¯·ç¨åâ€¦â€¦`, 2)\r\n    }\r\n\r\n    let bookmarkIds = []\r\n    let novelIds = getFromCache(`novelIds${novel.seriesId}`)\r\n    novelIds.forEach(novelId => {bookmarkIds.push(getNovelBookmarkId(novelId))})\r\n    let resp = getPostBody(\r\n        \"https://www.pixiv.net/ajax/novels/bookmarks/remove\",\r\n        JSON.stringify({\"bookmarkIds\": bookmarkIds})\r\n    )\r\n    if (resp.error === true) {\r\n        sleepToast(`ğŸ–¤ å–æ¶ˆæ”¶è—ç³»åˆ—\\n\\nâš ï¸ å–æ¶ˆæ”¶è—ã€${novel.seriesTitle}ã€‘çš„ç¯‡ç›®å¤±è´¥`, 2)\r\n        shareFactory(\"series\")\r\n    } else {\r\n        sleepToast(`ğŸ–¤ å–æ¶ˆæ”¶è—ç³»åˆ—\\n\\nâœ… å·²å–æ¶ˆæ”¶è—ã€${novel.seriesTitle}ã€‘çš„å…¨éƒ¨ç¯‡ç›®`)\r\n        novelIds.forEach(novelId => {cache.delete(`collect${novelId}`)})\r\n\r\n        let likeNovels = getFromCache(\"likeNovels\")\r\n        likeNovels = likeNovels.filter(item => !novelIds.includes(Number(item)))\r\n        putInCache(\"likeNovels\", likeNovels)\r\n\r\n        novelIds.forEach(novelId => {\r\n            let novelObj = getAjaxJson(urlNovelDetailed(novelId))\r\n            novelObj.body.isBookmark = false\r\n            putInCache(urlNovelDetailed(novelId), novelObj, cacheSaveSeconds)\r\n        })\r\n    }\r\n}\r\n\r\nfunction novelsBookmarkAdd() {\r\n    let novel = getNovel()\r\n    if (!novel.seriesId) {\r\n        sleepToast(`â¤ï¸ æ”¶è—ç³»åˆ—\\n\\nâš ï¸ ã€${novel.title}ã€‘éç³»åˆ—å°è¯´ï¼Œç°å·²æ”¶è—æœ¬ç¯‡å°è¯´`)\r\n        return novelBookmarkAdd(0)\r\n    } else {\r\n        sleepToast(`â¤ï¸ æ”¶è—ç³»åˆ—\\n\\nğŸ”„ æ­£åœ¨æ”¶è—ç³»åˆ—ã€${novel.seriesTitle}ã€‘ï¼Œè¯·ç¨åâ€¦â€¦`, 2)\r\n    }\r\n\r\n    let novelIds = getFromCache(`novelIds${novel.seriesId}`)\r\n    let likeNovels = getFromCache(\"likeNovels\")\r\n    if (likeNovels === null) likeNovels = []\r\n    novelIds.forEach(novelId => {\r\n        if (likeNovels && !likeNovels.includes(Number(novelId))) {\r\n            sleep(0.5 * 1000 * Math.random())\r\n            let resp = getPostBody(\r\n                \"https://www.pixiv.net/ajax/novels/bookmarks/add\",\r\n                JSON.stringify({\"novel_id\": novelId, \"restrict\": 0, \"comment\": \"\", \"tags\": []})\r\n            )\r\n\r\n            if (resp.error === true) {\r\n                sleepToast(`â¤ï¸ æ”¶è—ç³»åˆ—\\n\\nâš ï¸ æ”¶è—ã€${novelId}ã€‘å¤±è´¥`)\r\n                shareFactory(\"series\")\r\n            } else if (resp.body === null) {\r\n                // sleepToast(`â¤ï¸ æ”¶è—å°è¯´\\n\\nâœ… å·²ç»æ”¶è—ã€${novel.title}ã€‘äº†`)\r\n            } else {\r\n                cache.put(`collect${novelId}`, resp.body)\r\n                likeNovels.push(Number(novelId))\r\n\r\n                let novelObj = getAjaxJson(urlNovelDetailed(novelId))\r\n                novelObj.body.isBookmark = true\r\n                putInCache(urlNovelDetailed(novelId), novelObj, cacheSaveSeconds)\r\n            }\r\n        }\r\n    })\r\n    putInCache(\"likeNovels\", likeNovels)\r\n    sleepToast(`â¤ï¸ æ”¶è—ç³»åˆ—\\n\\nâœ… å·²ç»æ”¶è—ã€${novel.seriesTitle}ã€‘å…¨éƒ¨ç« èŠ‚`)\r\n}\r\n\r\nfunction novelBookmarkFactory(code) {\r\n    let novel = getNovel()\r\n    let collectId = getFromCache(`collect${novel.id}`)\r\n    if (collectId >= 1) code = 0\r\n\r\n    if (code === 0) novelBookmarkDelete()\r\n    else if (code === 1) novelBookmarkAdd(0)\r\n    else if (code === 2) novelBookmarkAdd(1)\r\n}\r\n\r\nfunction novelMarker(page) {\r\n    if (page === undefined) page = 1\r\n    let novel = getNovel()\r\n    let lastMarker = getFromCache(`marker${novel.id}`)\r\n    if (lastMarker === true) page = 0\r\n\r\n    let resp = getPostBody(\r\n        \"https://www.pixiv.net/novel/rpc_marker.php\",\r\n        `mode=save&i_id=${novel.id}&u_id=${getFromCache(\"pixiv:uid\")}&page=${page}`\r\n    )\r\n    java.log(`mode=save&i_id=${novel.id}&u_id=${getFromCache(\"pixiv:uid\")}&page=${page}`)\r\n    if (resp.error === true) {\r\n        sleepToast(\"ğŸ·ï¸ æ·»åŠ ä¹¦ç­¾\\n\\nâš ï¸ æ“ä½œå¤±è´¥\", 1)\r\n        shareFactory(\"novel\")\r\n    } else if (lastMarker === true) {\r\n        cache.put(`marker${novel.id}`, false)\r\n        sleepToast(`ğŸ·ï¸ æ·»åŠ ä¹¦ç­¾\\n\\nâœ… å·²åˆ é™¤ä¹¦ç­¾`)\r\n    } else {\r\n        cache.put(`marker${novel.id}`, true)\r\n        sleepToast(`ğŸ·ï¸ æ·»åŠ ä¹¦ç­¾\\n\\nâœ… å·²åŠ å…¥ä¹¦ç­¾`)\r\n    }\r\n}\r\n\r\nfunction seriesWatch() {\r\n    let novel = getNovel()\r\n    let resp = getPostBody(\r\n        `https://www.pixiv.net/ajax/novel/series/${novel.seriesId}/watch`,\r\n        \"{}\"\r\n    )\r\n    if (resp.error === true) {\r\n        sleepToast(`ğŸ“ƒ è¿½æ›´ç³»åˆ—\\n\\nâš ï¸ è¿½æ›´ã€${novel.seriesTitle}ã€‘å¤±è´¥`, 1)\r\n        shareFactory(\"series\")\r\n    } else {\r\n        cache.put(`watch${novel.seriesId}`, true)\r\n        sleepToast(`ğŸ“ƒ è¿½æ›´ç³»åˆ—\\n\\nâœ… å·²è¿½æ›´ã€${novel.seriesTitle}ã€‘`)\r\n\r\n        let watchedSeries = getFromCache(\"watchedSeries\")\r\n        watchedSeries.push(Number(novel.seriesId))\r\n        putInCache(\"watchedSeries\", watchedSeries)\r\n\r\n        let novelObj = getAjaxJson(urlSeriesDetailed(novel.seriesId))\r\n        novelObj.body.isWatched = true\r\n        putInCache(urlSeriesDetailed(novel.seriesId), novelObj, cacheSaveSeconds)\r\n    }\r\n}\r\n\r\nfunction seriesUnWatch() {\r\n    let novel = getNovel()\r\n    let resp = getPostBody(\r\n        `https://www.pixiv.net/ajax/novel/series/${novel.seriesId}/unwatch`,\r\n        \"{}\"\r\n    )\r\n    if (resp.error === true) {\r\n        sleepToast(`ğŸ“ƒ è¿½æ›´ç³»åˆ—\\n\\nâš ï¸ å–æ¶ˆè¿½æ›´ã€${novel.seriesTitle}ã€‘å¤±è´¥`, 1)\r\n        shareFactory(\"series\")\r\n    } else {\r\n        cache.delete(`watch${novel.seriesId}`)\r\n        sleepToast(`ğŸ“ƒ è¿½æ›´ç³»åˆ—\\n\\nâœ… å·²å–æ¶ˆè¿½æ›´ã€${novel.seriesTitle}ã€‘`)\r\n\r\n        let watchedSeries = getFromCache(\"watchedSeries\")\r\n        watchedSeries = watchedSeries.filter(item => item !== Number(novel.seriesId))\r\n        putInCache(\"watchedSeries\", watchedSeries)\r\n\r\n        let novelObj = getAjaxJson(urlSeriesDetailed(novel.seriesId))\r\n        novelObj.body.isWatched = false\r\n        putInCache(urlSeriesDetailed(novel.seriesId), novelObj, cacheSaveSeconds)\r\n    }\r\n}\r\n\r\nfunction seriesWatchFactory(code) {\r\n    if (code === undefined) code = 1\r\n    let novel = getNovel()\r\n    if (!novel.seriesId) {\r\n        return sleepToast(`ğŸ“ƒ è¿½æ›´ç³»åˆ—\\n\\nâš ï¸ ã€${novel.title}ã€‘éç³»åˆ—å°è¯´ï¼Œæ— æ³•åŠ å…¥è¿½æ›´åˆ—è¡¨`)\r\n    }\r\n\r\n    let lastStatus = getFromCache(`watch${novel.seriesId}`)\r\n    if (lastStatus === true) code = 0\r\n    if (code === 0) seriesUnWatch()\r\n    else if (code === 1) seriesWatch()\r\n}\r\n\r\nfunction userFollow(restrict) {\r\n    if (restrict === undefined) restrict = 0\r\n    let novel = getNovel()\r\n    let resp = getPostBody(\r\n        \"https://www.pixiv.net/bookmark_add.php\",\r\n        `mode=add&type=user&user_id=${novel.userId}&tag=\"\"&restrict=${restrict}&format=json`\r\n    )\r\n    if (resp.error === true) {\r\n        sleepToast(`â­ï¸ å…³æ³¨ä½œè€…\\n\\nâš ï¸ å…³æ³¨ã€${novel.userName}ã€‘å¤±è´¥`, 1)\r\n        shareFactory(\"author\")\r\n    } else {\r\n        sleepToast(`â­ï¸ å…³æ³¨ä½œè€…\\n\\nâœ… å·²å…³æ³¨ã€${novel.userName}ã€‘`)\r\n        cache.put(`follow${novel.userId}`, true)\r\n    }\r\n}\r\n\r\nfunction userUnFollow() {\r\n    let novel = getNovel()\r\n    let resp = getPostBody(\r\n        \"https://www.pixiv.net/rpc_group_setting.php\",\r\n        `mode=del&type=bookuser&id=${novel.userId}`\r\n    )\r\n    if (resp.error === true) {\r\n        sleepToast(`â­ï¸ å…³æ³¨ä½œè€…\\n\\nâš ï¸ å–æ¶ˆå…³æ³¨ã€${novel.userName}ã€‘å¤±è´¥`, 1)\r\n        shareFactory(\"author\")\r\n    } else {\r\n        sleepToast(`â­ï¸ å…³æ³¨ä½œè€…\\n\\nâœ… å·²å–æ¶ˆå…³æ³¨ã€${novel.userName}ã€‘`)\r\n        cache.delete(`follow${novel.userId}`)\r\n    }\r\n}\r\n\r\nfunction userFollowFactory(code) {\r\n    if (code === undefined) code = 1\r\n    let novel = getNovel()\r\n    let lastStatus = getFromCache(`follow${novel.userId}`)\r\n    if (lastStatus === true) code = 0\r\n\r\n    if (code === 0) userUnFollow()\r\n    else if (code === 1) userFollow()\r\n}\r\n\r\nfunction userBlackList() {\r\n    let action = \"block\"  // æ‹‰é»‘ä½œè€…ï¼Œéå±è”½ä½œè€…ä½œå“\r\n    let novel = getNovel()\r\n    let lastStatus = getFromCache(`block${novel.userId}`)\r\n    if (lastStatus === true) action = \"unblock\"\r\n\r\n    let resp = getPostBody(\r\n        `https://www.pixiv.net/ajax/block/save`,\r\n        JSON.stringify({\"user_id\": novel.userId, \"action\": action})\r\n    )\r\n    // java.log(JSON.stringify({\"user_id\": novel.userId, \"action\": action}))\r\n    if (resp.error === true) sleepToast(\"âš ï¸ æ“ä½œå¤±è´¥\", 1)\r\n    else if (lastStatus === true) {\r\n        cache.put(`block${novel.userId}`, false)\r\n        sleepToast(`âœ… å·²å–æ¶ˆæ‹‰é»‘ã€${novel.userName}ã€‘\\n\\nå·²å…è®¸å…¶ç‚¹èµã€è¯„è®ºã€æ”¶è—ã€å…³æ³¨ã€ç§ä¿¡ç­‰`)\r\n    } else {\r\n        cache.put(`block${novel.userId}`, true)\r\n        sleepToast(`âœ… å·²æ‹‰é»‘ã€${novel.userName}ã€‘(Pixiv)\\n\\nå·²ç¦æ­¢å…¶ç‚¹èµã€è¯„è®ºã€æ”¶è—ã€å…³æ³¨ã€ç§ä¿¡ç­‰`)\r\n    }\r\n}\r\n\r\nfunction userBlock() {\r\n    let authors = getFromCache(\"blockAuthorList\")\r\n    if (!authors) authors = []\r\n    let authorsMap = getFromCacheMap(\"blockAuthorMap\")\r\n    if (!authorsMap || authorsMap.size === 0) {\r\n        authorsMap = new Map()\r\n        authors.forEach(author => {\r\n            authorsMap.set(author, getAjaxJson(urlUserDetailed(author)).body.name)\r\n        })\r\n    }\r\n\r\n    let novel = getNovel()\r\n    if (authorsMap.has(String(novel.userId))) {\r\n        authorsMap.delete(String(novel.userId))\r\n        sleepToast(`ğŸš« å±è”½ä½œè€…\\n\\nâœ… å·²å–æ¶ˆå±è”½ã€${novel.userName}ã€‘\\nç°å·²æ¢å¤æ˜¾ç¤ºå…¶å°è¯´`)\r\n    } else if (!!novel.userId) {\r\n        authorsMap.set(String(novel.userId), novel.userName)\r\n        sleepToast(`ğŸš« å±è”½ä½œè€…\\n\\nâœ… æœ¬åœ°å·²å±è”½ã€${novel.userName}ã€‘\\nä»Šåä¸å†æ˜¾ç¤ºå…¶å°è¯´`)\r\n    }\r\n\r\n    authors = Array.from(authorsMap.keys())\r\n    putInCache(\"blockAuthorList\", authors)\r\n    putInCacheMap(\"blockAuthorMap\", authorsMap)\r\n    // source.setVariable(authors.toString())\r\n    // sleepToast(JSON.stringify(authors))\r\n}\r\n\r\nfunction novelCommentAdd() {\r\n    let resp, novel = getNovel()\r\n    let userId = getFromCache(\"pixiv:uid\")\r\n    let comment = String(result.get(\"è¾“å…¥å†…å®¹\")).trim()\r\n    if (comment === \"\") {\r\n        return sleepToast(`âœ… å‘é€è¯„è®º\\nâš ï¸ è¯·åœ¨ã€è¾“å…¥å†…å®¹ã€‘è¾“å…¥è¯„è®º\\n\\nè¾“å…¥ã€è¯„è®ºå†…å®¹ï¼›è¯„è®ºIDã€‘å¯å›å¤è¯¥æ¡è¯„è®ºï¼Œå¦‚ã€éå¸¸å–œæ¬¢ï¼›123456ã€‘\\n\\nğŸ“Œ å½“å‰ç« èŠ‚ï¼š${novel.title}\\nå¦‚éå½“å‰ç« èŠ‚ï¼Œè¯·åˆ·æ–°æ­£æ–‡`)\r\n    }\r\n\r\n    let matched = comment.match(RegExp(/(ï¼›|;\\s*)\\d{8,}/))\r\n    if (matched) {\r\n        let commentId = comment.match(new RegExp(/ï¼›(\\d{8,})/))[1]\r\n        comment = comment.replace(new RegExp(`(ï¼›|;\\s*)${commentId}`), \"\")\r\n        resp = getPostBody(\r\n            \"https://www.pixiv.net/novel/rpc/post_comment.php\",\r\n            `type=comment&novel_id=${novel.id}&author_user_id=${userId}&comment=${encodeURI(comment)}&parent_id=${commentId}`)\r\n    } else {\r\n        resp = getPostBody(\r\n            \"https://www.pixiv.net/novel/rpc/post_comment.php\",\r\n            `type=comment&novel_id=${novel.id}&author_user_id=${userId}&comment=${encodeURI(comment)}`\r\n        )\r\n    }\r\n\r\n    if (resp.error === true) {\r\n        sleepToast(\"âœ… å‘é€è¯„è®º\\n\\nâš ï¸ è¯„è®ºå¤±è´¥\", 1)\r\n        shareFactory(\"novel\")\r\n    } else {\r\n        sleepToast(`âœ… å‘é€è¯„è®º\\n\\nâœ… å·²åœ¨ã€${novel.title}ã€‘å‘å¸ƒè¯„è®ºï¼š\\n${comment}`)\r\n    }\r\n}\r\n\r\nfunction getNovelCommentID(novelId, commentText) {\r\n    let list = [], uid = String(getFromCache(\"pixiv:uid\"))\r\n    let resp = getAjaxJson(urlNovelComments(novelId, 0, 50), true)\r\n    resp.body.comments.forEach(comment => {\r\n        if (comment.userId === uid && comment.comment === commentText) list.push(comment.id)\r\n\r\n        if (comment.hasReplies === true) {\r\n            let resp = getAjaxJson(urlNovelCommentsReply(comment.id, 1), true)\r\n            resp.body.comments.forEach(comment => {\r\n                if (comment.userId === uid && comment.comment === commentText) list.push(comment.id)\r\n            })\r\n        }\r\n    })\r\n    // java.log(JSON.stringify(list))\r\n    return list\r\n}\r\n\r\nfunction novelCommentDelete() {\r\n    let commentIDs, novel = getNovel()\r\n    let comment = String(result.get(\"è¾“å…¥å†…å®¹\")).trim()\r\n    if (comment === \"\") {\r\n        return sleepToast(`ğŸ—‘ åˆ é™¤è¯„è®º\\nâš ï¸ è¯·åœ¨ã€è¾“å…¥å†…å®¹ã€‘è¾“å…¥éœ€è¦åˆ é™¤çš„ã€è¯„è®ºIDã€‘\\næˆ–è¾“å…¥éœ€è¦åˆ é™¤çš„ã€è¯„è®ºå†…å®¹ã€‘\\n\\nğŸ“Œ å½“å‰ç« èŠ‚ï¼š${novel.title}\\nå¦‚éå½“å‰ç« èŠ‚ï¼Œè¯·åˆ·æ–°æ­£æ–‡`)\r\n    }\r\n\r\n    let matched = comment.match(RegExp(/\\d{8,}/))\r\n    if (matched) {\r\n        commentIDs = [matched[0]]\r\n    } else {\r\n        commentIDs = getNovelCommentID(novel.id, comment)\r\n        java.log(JSON.stringify(commentIDs))\r\n        if (commentIDs.length === 0) {\r\n            return sleepToast(`ğŸ—‘ åˆ é™¤è¯„è®º\\n\\nâš ï¸ æœªèƒ½æ‰¾åˆ°è¿™æ¡è¯„è®º\\nè¯·æ£€æŸ¥æ˜¯å¦æœ‰é”™åˆ«å­—æˆ–æ ‡ç‚¹ç¬¦å·æ˜¯å¦ä¸€è‡´`)\r\n        }\r\n    }\r\n\r\n    commentIDs.forEach(commentID =>{\r\n        let resp = getPostBody(\r\n            \"https://www.pixiv.net/novel/rpc_delete_comment.php\",\r\n            `i_id=${novel.id}&del_id=${commentID}`\r\n        )\r\n        // java.log(JSON.stringify(resp))\r\n        if (resp.error === true) {\r\n            sleepToast(\"ğŸ—‘ åˆ é™¤è¯„è®º\\n\\nâš ï¸ è¯„è®ºåˆ é™¤å¤±è´¥\", 1)\r\n            shareFactory(\"novel\")\r\n        } else {\r\n            sleepToast(`ğŸ—‘ åˆ é™¤è¯„è®º\\n\\nâœ… å·²åœ¨ã€${novel.title}ã€‘åˆ é™¤è¯„è®ºï¼š\\n${comment}`)\r\n        }\r\n    })\r\n}\r\n\r\nfunction novelPollAnswer() {\r\n    let novel = getNovel()\r\n    // novel.pollChoicesCount = getAjaxJson(urlNovelDetailed(novel.id)).body.pollData.selectedValue\r\n    if (!novel.pollChoicesCount) {\r\n        return sleepToast(`ğŸ“ƒ å°è¯´æŠ•ç¥¨\\n\\nâš ï¸ è¯¥å°è¯´ã€${novel.title}ã€‘æ— æŠ•ç¥¨ä¿¡æ¯ï¼Œå»ºè®®ã€æ¸…é™¤ç¼“å­˜ã€‘ã€åˆ·æ–°ã€‘åé‡è¯•`)\r\n    }\r\n\r\n    let choiceId = String(result.get(\"è¾“å…¥å†…å®¹\")).trim()\r\n    if (!choiceId) {\r\n        return sleepToast(`ğŸ“ƒ å°è¯´æŠ•ç¥¨\\n\\nâš ï¸ æŠ•ç¥¨å¤±è´¥ï¼šè¯·åœ¨ã€è¾“å…¥å†…å®¹ã€‘è¾“å…¥æŠ•ç¥¨é€‰é¡¹(æ•°å­—)`)\r\n    } else if (Number(choiceId) > novel.pollData.selectedValue) {\r\n        return sleepToast(`ğŸ“ƒ å°è¯´æŠ•ç¥¨\\n\\nâš ï¸ æŠ•ç¥¨å¤±è´¥ï¼šé€‰é¡¹${choiceId}è¶…å‡ºèŒƒå›´`)\r\n    } else if (Number(choiceId) <= 0 || Number(choiceId) > novel.pollChoicesCount) {\r\n        return sleepToast(`ğŸ“ƒ å°è¯´æŠ•ç¥¨\\n\\nâš ï¸ æŠ•ç¥¨å¤±è´¥ï¼šé€‰é¡¹${choiceId}è¶…å‡ºèŒƒå›´`)\r\n    }\r\n\r\n    let resp = getPostBody(\r\n        `https://www.pixiv.net/ajax/novel/${novel.id}/poll/answer`,\r\n        JSON.stringify({\"choice_id\": choiceId})\r\n    )\r\n    // 200 æˆåŠŸï¼Œ403 é‡å¤æŠ•ç¥¨ï¼Œ400 é€‰é¡¹è¶…è¿‡èŒƒå›´\r\n    if (resp.error === true) {\r\n        if (resp.errMsg.includes(\"403\")) {\r\n            sleepToast(`ğŸ“ƒ å°è¯´æŠ•ç¥¨\\n\\nâœ… å·²ç»æŠ•è¿‡ç¥¨äº†`)\r\n        } else {\r\n            sleepToast(`ğŸ“ƒ å°è¯´æŠ•ç¥¨\\n\\nâš ï¸ æŠ•ç¥¨å¤±è´¥`)\r\n            shareFactory(\"novel\")\r\n        }\r\n    } else {\r\n        sleepToast(`ğŸ“ƒ å°è¯´æŠ•ç¥¨\\n\\nâœ… æŠ•ç¥¨æˆåŠŸ`)\r\n    }\r\n}\r\n\r\nlet wordsType = {\r\n    \"caption\": \"ğŸ“ƒ ç®€ä»‹å±è”½åˆ—è¡¨\",\r\n    \"tags\": \"#ï¸ æ ‡ç­¾å±è”½åˆ—è¡¨\",\r\n    \"authors\": \"ğŸ‘¤ ä½œè€…å±è”½åˆ—è¡¨\"\r\n}\r\n\r\nfunction printAuthorMap(map) {\r\n    let text = \"\"\r\n    map.forEach((value, key) => {\r\n        text += `@${value} ${key}\\n`\r\n    })\r\n    return text.trim()\r\n}\r\n\r\nfunction blockShowFactory() {\r\n    let keys = Object.keys(wordsType)\r\n    let key = getFromCache(\"wordsType\")\r\n\r\n    // åˆ‡æ¢å±è”½åˆ—è¡¨\r\n    let index = keys.indexOf(key) + 1\r\n    if (index === keys.length) index = 0\r\n    key = keys[index]\r\n    putInCache(\"wordsType\", key)\r\n\r\n    if (key === \"authors\") {\r\n        let words = printAuthorMap(getFromCacheMap(\"blockAuthorMap\"))\r\n        if (!words) words = \"\"\r\n        sleepToast(`ğŸ‘€ æŸ¥çœ‹å±è”½\\n${wordsType[key]}\\n\\n${words}`, 2)\r\n    } else {\r\n        let words = getFromCache(`${key}BlockWords`)\r\n        if (!words) words = []\r\n        sleepToast(`ğŸ‘€ æŸ¥çœ‹å±è”½\\n${wordsType[key]}\\n\\n${words.join(\"\\n\")}`, 2)\r\n    }\r\n}\r\n\r\nfunction blockWordAdd() {\r\n    let method = getFromCache(\"wordsType\")\r\n    let blockWords = getFromCache(`${method}BlockWords`)\r\n    if (blockWords === null) blockWords = []\r\n\r\n    let word = String(result.get(\"è¾“å…¥å†…å®¹\")).trim()\r\n    if (word === \"\") {\r\n        sleepToast(`ğŸš« æ·»åŠ å±è”½\\n${wordsType[method]}\\n\\nâš ï¸ è¾“å…¥å†…å®¹ä¸èƒ½ä¸ºç©º`)\r\n    } else if (blockWords.includes(word)) {\r\n        sleepToast(`ğŸš« æ·»åŠ å±è”½\\n${wordsType[method]}\\n\\nâœ… ã€${word}ã€‘å·²ç»åŠ å…¥å±è”½åˆ—è¡¨äº†`)\r\n    } else {\r\n        blockWords.push(word)\r\n        putInCache(`${method}BlockWords`, blockWords)\r\n        sleepToast(`ğŸš« æ·»åŠ å±è”½\\n${wordsType[method]}\\n\\nâœ… å·²å°†ã€${word}ã€‘åŠ å…¥å±è”½åˆ—è¡¨ä¸­`)\r\n    }\r\n}\r\n\r\nfunction blockWordDelete() {\r\n    let method = getFromCache(\"wordsType\")\r\n    let blockWords = getFromCache(`${method}BlockWords`)\r\n    if (blockWords === null) blockWords = []\r\n\r\n    let word = String(result.get(\"è¾“å…¥å†…å®¹\")).trim()\r\n    if (word === \"\") {\r\n        sleepToast(`â­•ï¸ åˆ é™¤å±è”½\\n${wordsType[method]}\\n\\nâš ï¸ è¾“å…¥å†…å®¹ä¸èƒ½ä¸ºç©º`)\r\n    } else if (!blockWords.includes(word)) {\r\n        sleepToast(`â­•ï¸ åˆ é™¤å±è”½\\n${wordsType[method]}\\n\\nâš ï¸ ã€${word}ã€‘ä¸åœ¨å±è”½åˆ—è¡¨\\nè¯·æ£€æŸ¥æ˜¯å¦æœ‰é”™åˆ«å­—æˆ–æ ‡ç‚¹ç¬¦å·æ˜¯å¦ä¸€è‡´`)\r\n    } else {\r\n        blockWords = blockWords.filter(item => item !== word)\r\n        putInCache(`${method}BlockWords`, blockWords)\r\n        sleepToast(`â­•ï¸ åˆ é™¤å±è”½\\n${wordsType[method]}\\n\\nâœ… å·²åˆ é™¤å±è”½è¯ã€${word}ã€‘`)\r\n    }\r\n}\r\n\r\nfunction blockAuthorAdd() {\r\n    let method = getFromCache(\"wordsType\")\r\n    let blockAuthors = getFromCacheMap(`blockAuthorMap`)\r\n\r\n    let word = String(result.get(\"è¾“å…¥å†…å®¹\")).trim()\r\n    if (word === \"\") {\r\n        sleepToast(`ğŸš« æ·»åŠ å±è”½\\n${wordsType[method]}\\n\\nâš ï¸ è¾“å…¥å†…å®¹ä¸èƒ½ä¸ºç©º\\nâš ï¸ è¾“å…¥ã€ç”¨æˆ·IDã€‘å¯å±è”½è¯¥ä½œè€…`)\r\n    } else if (blockAuthors.has(word)) {\r\n        let text = `${blockAuthors.get(word)} ${word}`\r\n        sleepToast(`ğŸš« æ·»åŠ å±è”½\\n${wordsType[method]}\\n\\nâœ… ã€${text}ã€‘å·²ç»åŠ å…¥å±è”½åˆ—è¡¨äº†`)\r\n    }\r\n    // è¾“å…¥çº¯æ•°å­—ï¼Œæ·»åŠ å¯¹åº”IDçš„ä½œè€…\r\n    else if (!isNaN(word)) {\r\n        let user = getAjaxJson(urlUserDetailed(word)).body\r\n        blockAuthors.set(user.userId, user.name)\r\n        let text = `@${user.name} ${user.userId}`\r\n        sleepToast(`ğŸš« æ·»åŠ å±è”½\\n${wordsType[method]}\\n\\nâœ… å·²å°†ã€${text}ã€‘åŠ å…¥å±è”½åˆ—è¡¨ä¸­`)\r\n    }\r\n    else if (word) {\r\n        sleepToast(`ğŸš« æ·»åŠ å±è”½\\n${wordsType[method]}\\n\\nâš ï¸ è¾“å…¥ã€ç”¨æˆ·IDã€‘å¯å±è”½è¯¥ä½œè€…`)\r\n    }\r\n    putInCacheMap(`blockAuthorMap`, blockAuthors)\r\n}\r\n\r\nfunction blockAuthorDelete() {\r\n    let method = getFromCache(\"wordsType\")\r\n    let blockAuthors = getFromCacheMap(`blockAuthorMap`)\r\n\r\n    let word = String(result.get(\"è¾“å…¥å†…å®¹\")).trim()\r\n    if (word === \"\") {\r\n        sleepToast(`â­•ï¸ åˆ é™¤å±è”½\\n${wordsType[method]}\\n\\nâš ï¸ è¾“å…¥å†…å®¹ä¸èƒ½ä¸ºç©º\\nâš ï¸ è¾“å…¥ã€ç”¨æˆ·IDã€‘å¯å±è”½è¯¥ä½œè€…`)\r\n    }\r\n    // è¾“å…¥çº¯æ•°å­—ï¼Œåˆ é™¤å¯¹åº”IDçš„ä½œè€…\r\n    else if (!isNaN(word) && blockAuthors.has(word)) {\r\n        let text = `@${blockAuthors.get(word)} ${word}`\r\n        blockAuthors.delete(word)\r\n        sleepToast(`â­•ï¸ åˆ é™¤å±è”½\\n${wordsType[method]}\\n\\nâœ… å·²åˆ é™¤ã€${text}ã€‘`)\r\n    }\r\n    //ä½œè€…åç§°\r\n    else if (Array.from(blockAuthors.values()).includes(word)) {\r\n        let index = Array.from(blockAuthors.values()).indexOf(word)\r\n        let key = Array.from(blockAuthors.keys())[index]\r\n        let text = `@${blockAuthors.get(key)} ${key}`\r\n        blockAuthors.delete(key)\r\n        sleepToast(`â­•ï¸ åˆ é™¤å±è”½\\n${wordsType[method]}\\n\\nâœ… å·²åˆ é™¤ã€${text}ã€‘`)\r\n    }\r\n    else if (word) {\r\n        sleepToast(`â­•ï¸ åˆ é™¤å±è”½\\n${wordsType[method]}\\n\\nâš ï¸ è¾“å…¥ã€ç”¨æˆ·IDã€‘å¯å±è”½è¯¥ä½œè€…`)\r\n    }\r\n    putInCacheMap(`blockAuthorMap`, blockAuthors)\r\n}\r\n\r\nfunction blockAddFactory() {\r\n    if (getFromCache(\"wordsType\") === \"authors\") return blockAuthorAdd()\r\n    else return blockWordAdd()\r\n}\r\n\r\nfunction blockDeleteFactory() {\r\n    if (getFromCache(\"wordsType\") === \"authors\") return blockAuthorDelete()\r\n    else return blockWordDelete()\r\n}\r\n\r\n\r\nfunction likeTagsShow() {\r\n    let likeTags = getFromCache(`likeTags`)\r\n    if (likeTags === null) likeTags = []\r\n    sleepToast(`ğŸ‘€ æŸ¥çœ‹æ ‡ç­¾\\nğŸ“Œ å–œæ¬¢æ ‡ç­¾\\n\\n${likeTags.join(\"ã€\")}`, 5)\r\n}\r\n\r\nfunction likeTagsAdd() {\r\n    let likeTags = getFromCache(`likeTags`)\r\n    if (likeTags === null) likeTags = []\r\n\r\n    let word = String(result.get(\"è¾“å…¥å†…å®¹\")).trim()\r\n    if (word === \"\") {\r\n        sleepToast(`ğŸ“Œ æ·»åŠ æ ‡ç­¾\\nğŸ“Œ å–œæ¬¢æ ‡ç­¾\\n\\nâš ï¸ è¾“å…¥å†…å®¹ä¸èƒ½ä¸ºç©º\\nè¯·ç›´æ¥è¾“å…¥æ ‡ç­¾å†…å®¹`)\r\n    } else if (word.startsWith(\"@\") || word.startsWith(\"ï¼ \")) {\r\n        sleepToast(`ğŸ“Œ æ·»åŠ æ ‡ç­¾\\nğŸ“Œ å–œæ¬¢æ ‡ç­¾\\n\\nâš ï¸ ä»…æ”¯æŒæ·»åŠ ã€æ ‡ç­¾ã€‘\\nä¸æ”¯æŒæ·»åŠ  @ä½œè€…åç§°`)\r\n    } else if (word.startsWith(\"#\") || word.startsWith(\"ï¼ƒ\")) {\r\n        sleepToast(`ğŸ“Œ æ·»åŠ æ ‡ç­¾\\nğŸ“Œ å–œæ¬¢æ ‡ç­¾\\n\\nâš ï¸ ä»…æ”¯æŒæ·»åŠ ã€æ ‡ç­¾ã€‘\\nä¸æ”¯æŒæ·»åŠ  #æ ‡ç­¾åç§°`)\r\n    } else if (likeTags.includes(word)) {\r\n        sleepToast(`ğŸ“Œ æ·»åŠ æ ‡ç­¾\\nğŸ“Œ å–œæ¬¢æ ‡ç­¾\\n\\nâœ… ã€${word}ã€‘å·²ç»åŠ å…¥å–œæ¬¢æ ‡ç­¾äº†\\nè¯·äºå‘ç°é¡µåˆ·æ–°åæŸ¥çœ‹`)\r\n    } else {\r\n        likeTags.push(word)\r\n        putInCache(`likeTags`, likeTags)\r\n        sleepToast(`ğŸ“Œ æ·»åŠ æ ‡ç­¾\\nğŸ“Œ å–œæ¬¢æ ‡ç­¾\\n\\nâœ… å·²å°†ã€${word}ã€‘åŠ å…¥å–œæ¬¢æ ‡ç­¾äº†\\nè¯·äºå‘ç°é¡µåˆ·æ–°åæŸ¥çœ‹`)\r\n    }\r\n}\r\n\r\nfunction likeTagsDelete() {\r\n    let likeTags = getFromCache(`likeTags`)\r\n    if (likeTags === null) likeTags = []\r\n\r\n    let word = String(result.get(\"è¾“å…¥å†…å®¹\")).trim()\r\n    if (word === \"\") {\r\n        sleepToast(`ğŸ—‘ åˆ é™¤æ ‡ç­¾\\n\\nâš ï¸ è¾“å…¥å†…å®¹ä¸èƒ½ä¸ºç©º`)\r\n    } else if (!likeTags.includes(word)) {\r\n        sleepToast(`ğŸ—‘ åˆ é™¤æ ‡ç­¾\\n\\nâš ï¸ ã€${word}ã€‘ä¸åœ¨å–œæ¬¢æ ‡ç­¾\\nè¯·æ£€æŸ¥æ˜¯å¦æœ‰é”™åˆ«å­—`)\r\n    } else {\r\n        likeTags = likeTags.filter(item => item !== word)\r\n        putInCache(`likeTags`, likeTags)\r\n        sleepToast(`ğŸ—‘ åˆ é™¤æ ‡ç­¾\\n\\nâœ… å·²åˆ é™¤è¯¥æ ‡ç­¾ã€${word}ã€‘`)\r\n    }\r\n}\r\n\r\n\r\nfunction likeAuthorsShow() {\r\n    let text = printAuthorMap(getFromCacheMap(`likeAuthors`))\r\n    sleepToast(`ğŸ‘€ æŸ¥çœ‹æ”¶è—\\nâ¤ï¸ ä»–äººæ”¶è—\\n\\n${text.trim()}`, 2)\r\n}\r\n\r\nfunction likeAuthorsAdd() {\r\n    let likeAuthors = getFromCacheMap(`likeAuthors`)\r\n    let word = String(result.get(\"è¾“å…¥å†…å®¹\")).trim()\r\n    if (word.startsWith(\"@\") || word.startsWith(\"ï¼ \")) {\r\n        return sleepToast(`â¤ï¸ æ·»åŠ æ”¶è—\\nâ¤ï¸ ä»–äººæ”¶è—\\n\\nâš ï¸ ä»…æ”¯æŒé€šè¿‡ã€ä½œè€…IDã€‘å…³æ³¨\\nä¸æ”¯æŒæ·»åŠ  @ä½œè€…åç§°`)\r\n    } else if (word.startsWith(\"#\") || word.startsWith(\"ï¼ƒ\")) {\r\n        return sleepToast(`â¤ï¸ æ·»åŠ æ”¶è—\\nâ¤ï¸ ä»–äººæ”¶è—\\n\\nâš ï¸ ä»…æ”¯æŒé€šè¿‡ã€ä½œè€…IDã€‘å…³æ³¨\\nä¸æ”¯æŒæ·»åŠ  #æ ‡ç­¾åç§°`)\r\n    } else if (likeAuthors.has(word)) {\r\n        let text = `${likeAuthors.get(word)} ${word}`\r\n        sleepToast(`â¤ï¸ æ·»åŠ æ”¶è—\\nâ¤ï¸ ä»–äººæ”¶è—\\n\\nâœ… ã€${text}ã€‘å·²ç»åŠ å…¥æ”¶è—åˆ—è¡¨äº†ï¼Œè¯·äºå‘ç°é¡µåˆ·æ–°åæŸ¥çœ‹`)\r\n    }\r\n\r\n    // æ— è¾“å…¥å†…å®¹ï¼Œæ·»åŠ å½“å‰å°è¯´çš„ä½œè€…\r\n    if (word === \"\") {\r\n        let novel = getNovel()\r\n        likeAuthors.set(String(novel.userId), novel.userName)\r\n        let text = `@${novel.userName} ${novel.userId}`\r\n        sleepToast(`â¤ï¸ æ·»åŠ æ”¶è—\\nâ¤ï¸ ä»–äººæ”¶è—\\n\\nâœ… å·²å°†ã€${text}ã€‘åŠ å…¥æ”¶è—åˆ—è¡¨äº†ï¼Œè¯·äºå‘ç°é¡µåˆ·æ–°åæŸ¥çœ‹\\n\\nâš ï¸ è¾“å…¥ã€ç”¨æˆ·IDã€‘å¯å…³æ³¨å…¶ä»–ç”¨æˆ·çš„æ”¶è—\\né»˜è®¤å…³æ³¨å½“å‰ä½œè€…(ç”¨æˆ·)`)\r\n    }\r\n    // è¾“å…¥çº¯æ•°å­—ï¼Œæ·»åŠ å¯¹åº”IDçš„ä½œè€…\r\n    else if (!isNaN(word)) {\r\n        let user = getAjaxJson(urlUserDetailed(word)).body\r\n        likeAuthors.set(user.userId, user.name)\r\n        let text = `@${user.name} ${user.userId}`\r\n        sleepToast(`â¤ï¸ æ·»åŠ æ”¶è—\\nâ¤ï¸ ä»–äººæ”¶è—\\n\\nâœ… å·²å°†ã€${text}ã€‘åŠ å…¥æ”¶è—åˆ—è¡¨äº†ï¼Œè¯·äºå‘ç°é¡µåˆ·æ–°åæŸ¥çœ‹`)\r\n    }\r\n\r\n    else if (word) {\r\n        sleepToast(`â¤ï¸ æ·»åŠ æ”¶è—\\nâ¤ï¸ ä»–äººæ”¶è—\\n\\nâš ï¸ è¾“å…¥ã€ç”¨æˆ·IDã€‘å¯å…³æ³¨å…¶ä»–ç”¨æˆ·çš„æ”¶è—`)\r\n    }\r\n    putInCacheMap(`likeAuthors`, likeAuthors)\r\n}\r\n\r\nfunction likeAuthorsDelete() {\r\n    let likeAuthors = getFromCacheMap(`likeAuthors`)\r\n    let word = String(result.get(\"è¾“å…¥å†…å®¹\")).trim()\r\n    if (word.startsWith(\"@\") || word.startsWith(\"ï¼ \")) {\r\n        return sleepToast(`ğŸ–¤ å–æ¶ˆæ”¶è—\\nâ¤ï¸ ä»–äººæ”¶è—\\n\\nâš ï¸ ä»…æ”¯æŒé€šè¿‡ã€ä½œè€…ID/ä½œè€…åç§°ã€‘å–å…³\\nä¸æ”¯æŒè¾“å…¥ @ä½œè€…åç§°`)\r\n    } else if (word.startsWith(\"#\") || word.startsWith(\"ï¼ƒ\")) {\r\n        return sleepToast(`ğŸ–¤ å–æ¶ˆæ”¶è—\\nâ¤ï¸ ä»–äººæ”¶è—\\n\\nâš ï¸ ä»…æ”¯æŒé€šè¿‡ã€ä½œè€…ID/ä½œè€…åç§°ã€‘å–å…³\\nä¸æ”¯æŒè¾“å…¥ #æ ‡ç­¾åç§°`)\r\n    }\r\n\r\n    if (word === \"\") {\r\n        let novel = getNovel()\r\n        likeAuthors.delete(novel.userId)\r\n        let text = `@${novel.userName} ${novel.userId}`\r\n        sleepToast(`ğŸ–¤ å–æ¶ˆæ”¶è—\\nâ¤ï¸ ä»–äººæ”¶è—\\n\\nâœ… å·²å–å…³ã€${text}ã€‘\\n\\nè¾“å…¥ã€ç”¨æˆ·IDã€‘å¯å–å…³å…¶ä»–ç”¨æˆ·\\né»˜è®¤å–å…³å½“å‰ä½œè€…(ç”¨æˆ·)`)\r\n\r\n    // è¾“å…¥çº¯æ•°å­—ï¼Œåˆ é™¤å¯¹åº”IDçš„ä½œè€…\r\n    } else if (!isNaN(word) && likeAuthors.has(word)) {\r\n        let text = `@${likeAuthors.get(word)} ${word}`\r\n        likeAuthors.delete(word)\r\n        sleepToast(`ğŸ–¤ å–æ¶ˆæ”¶è—\\nâ¤ï¸ ä»–äººæ”¶è—\\n\\nâœ… å·²å–å…³ã€${text}ã€‘`)\r\n\r\n    //ä½œè€…åç§°\r\n    } else if (Array.from(likeAuthors.values()).includes(word)) {\r\n        let index = Array.from(likeAuthors.values()).indexOf(word)\r\n        let key = Array.from(likeAuthors.keys())[index]\r\n        let text = `@${likeAuthors.get(key)} ${key}`\r\n        likeAuthors.delete(key)\r\n        sleepToast(`ğŸ–¤ å–æ¶ˆæ”¶è—\\nâ¤ï¸ ä»–äººæ”¶è—\\n\\nâœ… å·²å–å…³ã€${text}ã€‘`)\r\n    }\r\n    else if (word) {\r\n        sleepToast(`ğŸ–¤ å–æ¶ˆæ”¶è—\\nâ¤ï¸ ä»–äººæ”¶è—\\n\\nâš ï¸ è¾“å…¥ã€ç”¨æˆ·IDã€‘å¯å–å…³å…¶ä»–ç”¨æˆ·çš„æ”¶è—`)\r\n    }\r\n    putInCacheMap(`likeAuthors`, likeAuthors)\r\n}\r\n\r\n\r\nfunction startBrowser(url, title) {\r\n    let msg = \"\", headers = `{\"headers\": {\"User-Agent\":\"${getWebViewUA()}\"}}`\r\n    if (url.includes(\"https://www.pixiv.net\")) {\r\n        if (url.includes(\"settings\")) msg += \"âš™ï¸ è´¦å·è®¾ç½®\"\r\n        else msg += \"â¤´ï¸ åˆ†äº«å°è¯´\"\r\n        msg += \"\\n\\nå³å°†æ‰“å¼€ Pixiv\\nè¯·ç¡®è®¤å·²å¼€å¯ä»£ç†/æ¢¯å­/VPNç­‰\"\r\n    } else if (url.includes(\"https://github.com\")) {\r\n        if (url.includes(\"issues\")) msg += \"ğŸ åé¦ˆé—®é¢˜\"\r\n        else if (url.includes(\"doc\")) msg += \"ğŸ”° ä½¿ç”¨æŒ‡å—\"\r\n        else msg += \"â­ï¸ æ”¶è—é¡¹ç›®\"\r\n        msg += \"\\n\\nå³å°†æ‰“å¼€ Github\\nè¯·ç¡®è®¤å·²å¼€å¯ä»£ç†/æ¢¯å­/VPNç­‰\"\r\n    }\r\n    sleepToast(msg, 0.01)\r\n    java.startBrowser(`${url}, ${headers}`, title)\r\n}\r\n\r\nfunction shareFactory(type) {\r\n    let novel = getNovel()\r\n    if (novel === undefined || novel === null) return sleepToast(\"âš ï¸ è¯·åœ¨å°è¯´é˜…è¯»é¡µé¢ï¼Œä½¿ç”¨æœ¬åŠŸèƒ½\")\r\n    if (type.includes(\"author\")) {\r\n        startBrowser(urlUserUrl(novel.userId), novel.userName)\r\n    }\r\n    else if (type.includes(\"novel\") || (!novel.seriesId)) {\r\n        startBrowser(urlNovelUrl(novel.id), novel.title)\r\n    }\r\n    else if (type.includes(\"series\") && novel.seriesId) {\r\n        startBrowser(urlSeriesUrl(novel.seriesId), novel.seriesTitle)\r\n    }\r\n}\r\n\r\nfunction startPixivSettings() {\r\n    startBrowser(\"https://www.pixiv.net/settings/viewing\", \"è´¦å·è®¾ç½®\")\r\n}\r\nfunction startGithubIssue() {\r\n    startBrowser(\"https://github.com/windyhusky/PixivSource/issues\", \"åé¦ˆé—®é¢˜\")\r\n}\r\nfunction startGithubReadme() {\r\n    startBrowser(\"https://github.com/windyhusky/PixivSource/blob/main/doc/Pixiv.md\", \"ä½¿ç”¨æŒ‡å—\")\r\n}\r\n\r\nfunction checkStatus(status) {\r\n    if (eval(String(status)) === true) return \"â¤ï¸\"\r\n    else return \"ğŸ–¤\"\r\n}\r\n\r\nfunction charpterReading() {\r\n    let novel = getNovel()\r\n    // let novel = source.getLoginInfoMap()\r\n    let msg = `ğŸ“Œ å½“å‰ç« èŠ‚\\n\\n${checkStatus(novel.isWatched)} ç³»åˆ—ï¼š${novel.seriesTitle}\\n${checkStatus(novel.isBookmark)} ç« èŠ‚ï¼š${novel.title}\\nğŸ‘¤ ä½œè€…ï¼š${novel.userName}\\n\\nå¦‚éå½“å‰ç« èŠ‚ï¼Œè¯·åˆ·æ–°æ­£æ–‡`\r\n    msg = msg.replace(\"ğŸ–¤ ç³»åˆ—ï¼š\\n\", \"\")\r\n    sleepToast(msg, 2)\r\n}\r\n\r\nfunction readMeLogin() {\r\n    return sleepToast(`ğŸ…¿ï¸ ç™»å½•ç•Œé¢åŠŸèƒ½\\n\r\n    ä½¿ç”¨æ”¶è—ã€è¿½æ›´ã€å…³æ³¨ä½œè€…ã€è¯„è®ºç­‰åŠŸèƒ½æ—¶ï¼Œéœ€è¦ç™»å½•\r\n    ä½¿ç”¨å‰è¯·å…ˆåˆ·æ–°æ­£æ–‡ï¼Œè·å–å½“å‰ç« èŠ‚ä¿¡æ¯\\n\r\n    ç‚¹å‡»ã€ğŸ“Œ å½“å‰ç« èŠ‚ã€‘æŸ¥çœ‹ä¹¦æºå†…éƒ¨ç« èŠ‚ä¿¡æ¯`.replace(\"    \",\"\"), 5)\r\n}\r\n\r\nfunction readMeSearch() {\r\n    return sleepToast(`ğŸ” æœç´¢è¯´æ˜\\n\r\n    æ ‡ç­¾ä¹‹é—´éœ€è¦ä»¥ã€ç©ºæ ¼ã€‘é—´éš”\r\n    â– æ’é™¤æ ‡ç­¾ï¼š#æ ‡ç­¾1 -æ ‡ç­¾2\r\n    ğŸ‘¤ ä½œè€…ä¸“æœï¼š@æœç´¢ä½œè€…åç§°\r\n    #ï¸ æ ‡ç­¾ä¸“æœï¼š#æ ‡ç­¾1 æ ‡ç­¾2 \r\n    â¬ å­—æ•°ç­›é€‰1ï¼š#æ ‡ç­¾1 æ ‡ç­¾2 å­—æ•°3k5\r\n    â¬ å­—æ•°ç­›é€‰2ï¼š@ä½œè€…çš„åç§° å­—æ•°3w5`.replace(\"    \",\"\"), 5)\r\n}\r\n\r\nlet settingsName = {\r\n    \"SEARCH_AUTHOR\": \"ğŸ” æœç´¢ä½œè€…\",\r\n    \"CONVERT_CHINESE\": \"ğŸ€„ï¸ ç¹ç®€é€šæœ\",\r\n    \"SHOW_UPDATE_TIME\": \"ğŸ“… æ›´æ–°æ—¶é—´\",\r\n    \"SHOW_ORIGINAL_LINK\": \"ğŸ”— åŸå§‹é“¾æ¥\",\r\n    \"SHOW_COMMENTS\": \"ğŸ’¬ æ˜¾ç¤ºè¯„è®º\",\r\n    \"MORE_INFORMATION\": \"ğŸ“– æ›´å¤šç®€ä»‹\",\r\n    \"REPLACE_TITLE_MARKS\": \"ğŸ“š æ¢å¤ã€Šã€‹\",\r\n    \"SHOW_CAPTIONS\": \"ğŸ–¼ï¸ æ˜¾ç¤ºæè¿°\",\r\n    \"SHOW_LIKE_NOVELS\" :\"â¤ï¸ æ˜¾ç¤ºæ”¶è—\",\r\n    \"SHOW_WATCHED_SERIES\" :\"ğŸ“ƒ æ˜¾ç¤ºè¿½æ›´\",\r\n    \"FAST\": \"â© å¿«é€Ÿæ¨¡å¼\",\r\n    \"DEBUG\": \"ğŸ è°ƒè¯•æ¨¡å¼\",\r\n    // \"\":\"Pixiv è®¾ç½®\",\r\n    // \"HIDE_AI_WORKS\":\"éšè—AIä½œå“\",\r\n    // \"SENSITIVE_VIEW\":\"æ•æ„Ÿä½œå“\",\r\n    // \"USER_X_RESTRICT\":\"æˆäººè®¾ç½®\",\r\n    // \"READING_STATUS\":\"é˜…è¯»è¿›åº¦\",\r\n}\r\n\r\nfunction getPixivSettings() {\r\n    let settings = getFromCache(\"pixivSettings\")\r\n    let resp = getAjaxJson(\"https://www.pixiv.net/ajax/settings/self\")\r\n    if (resp.error !== true) {\r\n        let siteSettings = resp.body.user_status\r\n        settings.HIDE_AI_WORKS = siteSettings.hide_ai_works\r\n        settings.SENSITIVE_VIEW = siteSettings.sensitive_view_setting\r\n        settings.USER_X_RESTRICT = siteSettings.user_x_restrict\r\n        settings.READING_STATUS = siteSettings.reading_status_enabled\r\n    } else {\r\n        settings.HIDE_AI_WORKS = false\r\n        settings.SENSITIVE_VIEW = 0\r\n        settings.USER_X_RESTRICT = 0\r\n        settings.READING_STATUS = false\r\n    }\r\n    putInCache(\"pixivSettings\", settings)\r\n    return settings\r\n}\r\n\r\nfunction editPixivSettingsHideAI() {\r\n    let settings = getPixivSettings()\r\n    // let settings = getFromCache(\"pixivSettings\")\r\n    let hideAiWorks = Number(!settings.HIDE_AI_WORKS)\r\n    let resp = getPostBody(\r\n        \"https://www.pixiv.net/ajax/settings/self?lang=zh\",\r\n        {\"hideAiWorks\": hideAiWorks}\r\n    )\r\n\r\n    if (resp.error === true) sleepToast(`âš ï¸ éšè—AIä½œå“ å¤±è´¥`, 1)\r\n    else if (hideAiWorks === 1) sleepToast(`âš ï¸ éšè—AIä½œå“\\n\\nâœ… å·² éšè—AIä½œå“`)\r\n    else sleepToast(`âš ï¸ éšè—AIä½œå“\\n\\nâœ… å·²å–æ¶ˆ éšè—AIä½œå“`)\r\n    settings.HIDE_AI_WORKS = Boolean(hideAiWorks)\r\n    putInCache(\"pixivSettings\", settings)\r\n}\r\n\r\nfunction editPixivSettingsXRestrict() {\r\n    let settings = getPixivSettings()\r\n    // let settings = getFromCache(\"pixivSettings\")\r\n    let userXRestrict = settings.USER_X_RESTRICT + 1\r\n    if (userXRestrict === 3) userXRestrict = 0\r\n    let resp = getPostBody(\r\n        \"https://www.pixiv.net/ajax/settings/user_x_restrict\",\r\n        {\"userXRestrict\": userXRestrict}\r\n    )\r\n\r\n    if (resp.error === true) sleepToast(`âš ï¸ æˆäººä½œå“ å¤±è´¥`, 1)\r\n    else if (hideAiWorks === 0) sleepToast(`âš ï¸ æˆäººä½œå“\\n\\nâœ… å·²å…³é—­ æˆäººä½œå“`)\r\n    else if (hideAiWorks === 1) sleepToast(`âš ï¸ æˆäººä½œå“\\n\\nâœ… å·²å¼€å¯ R-18ä½œå“`)\r\n    else sleepToast(`âš ï¸ æˆäººä½œå“\\n\\nâœ… å·²å¼€å¯ R-18Gä½œå“`)\r\n    settings.HIDE_AI_WORKS = userXRestrict\r\n    putInCache(\"pixivSettings\", settings)\r\n}\r\n\r\nfunction editPixivSettingsSensitiveView() {\r\n    let settings = getPixivSettings()\r\n    // let settings = getFromCache(\"pixivSettings\")\r\n    let sensitiveView = Number(!settings.SENSITIVE_VIEW)\r\n    let resp = getPostBody(\r\n        \"https://www.pixiv.net/ajax/settings/sensitive_view_setting\",\r\n        {\"sensitiveViewSetting\": sensitiveView}\r\n    )\r\n\r\n    if (resp.error === true) sleepToast(`âš ï¸ æ•æ„Ÿä½œå“ å¤±è´¥`, 1)\r\n    else if (sensitiveView === 0) {sleepToast(`âš ï¸ æ•æ„Ÿä½œå“\\n\\nâœ… å·²éšè— æ•æ„Ÿä½œå“`)}\r\n    else sleepToast(`âš ï¸ æ•æ„Ÿä½œå“\\n\\nâœ… å·²æ˜¾ç¤º æ•æ„Ÿä½œå“`)\r\n    settings.SENSITIVE_VIEW = sensitiveView\r\n    putInCache(\"pixivSettings\", settings)\r\n}\r\n\r\nfunction statusMsg(status) {\r\n    if (status === true) return \"âœ… å·²å¼€å¯\"\r\n    else if (status === false) return \"ğŸš« å·²å…³é—­\"\r\n    else return \"ğŸˆšï¸ æœªè®¾ç½®\"\r\n}\r\n\r\n// æ£€æµ‹å¿«é€Ÿæ¨¡å¼ä¿®æ”¹çš„4ä¸ªè®¾ç½®\r\nfunction getSettingStatus(mode) {\r\n    if (mode === undefined) mode = \"\"\r\n    let keys = [], msgList = []\r\n    let settings = getFromCache(\"pixivSettings\")\r\n    if (mode !== \"FAST\") keys = Object.keys(settingsName)\r\n    else keys = Object.keys(settingsName).slice(0, 5)\r\n    for (let i in keys) {\r\n        msgList.push(`${statusMsg(settings[keys[i]])}ã€€${settingsName[keys[i]]}`)\r\n    }\r\n    return msgList.join(\"\\n\").trim()\r\n}\r\n\r\nfunction showSettings() {\r\n    sleepToast(`âš™ï¸ å½“å‰è®¾ç½®\\n\\n${getSettingStatus()}`)\r\n}\r\n\r\nfunction editSettings(object) {\r\n    let msg, status\r\n    let settings = getFromCache(\"pixivSettings\")\r\n    if (object === \"\") {\r\n        settings.SEARCH_AUTHOR = true       // æœç´¢ï¼šé»˜è®¤æœç´¢ä½œè€…åç§°\r\n        settings.CONVERT_CHINESE = true     // æœç´¢ï¼šæœç´¢æ—¶è¿›è¡Œç¹ç®€è½¬æ¢\r\n        settings.SHOW_LIKE_NOVELS = true    // æœç´¢ï¼šæœç´¢ç»“æœæ˜¾ç¤ºæ”¶è—å°è¯´\r\n        settings.SHOW_WATCHED_SERIES = true // æœç´¢ï¼šæœç´¢ç»“æœæ˜¾ç¤ºè¿½æ•´ç³»åˆ—å°è¯´\r\n        settings.MORE_INFORMATION = false   // è¯¦æƒ…ï¼šä¹¦ç±ç®€ä»‹æ˜¾ç¤ºæ›´å¤šä¿¡æ¯\r\n        settings.SHOW_UPDATE_TIME = true    // ç›®å½•ï¼šæ˜¾ç¤ºæ›´æ–°æ—¶é—´ï¼Œä½†ä¼šå¢åŠ å°‘è®¸è¯·æ±‚\r\n        settings.SHOW_ORIGINAL_LINK = true  // ç›®å½•ï¼šæ˜¾ç¤ºåŸå§‹é“¾æ¥ï¼Œä½†ä¼šå¢åŠ å¤§é‡è¯·æ±‚\r\n        settings.REPLACE_TITLE_MARKS = true // æ­£æ–‡ï¼šæ³¨éŸ³å†…å®¹ä¸ºæ±‰å­—æ—¶ï¼Œæ›¿æ¢ä¸ºä¹¦åå·\r\n        settings.SHOW_CAPTIONS = true       // æ­£æ–‡ï¼šç« é¦–æ˜¾ç¤ºæè¿°\r\n        settings.SHOW_COMMENTS = true       // æ­£æ–‡ï¼šç« å°¾æ˜¾ç¤ºè¯„è®º\r\n        settings.FAST  = false              // å…¨å±€ï¼šå¿«é€Ÿæ¨¡å¼\r\n        settings.DEBUG = false              // å…¨å±€ï¼šè°ƒè¯•æ¨¡å¼\r\n        putInCache(\"pixivSettings\", settings)\r\n        msg = `\\nâœ… å·²æ¢å¤ã€€ğŸ”§ é»˜è®¤è®¾ç½®\\n\\n${getSettingStatus()}`\r\n\r\n    } else if (object === \"FAST\") {\r\n        if (settings[object] === true) {\r\n            putInCache(\"pixivLastSettings\", settings)\r\n            settings.CONVERT_CHINESE = false      // æœç´¢ï¼šç¹ç®€é€šæœ\r\n            settings.SEARCH_AUTHOR = false        // æœç´¢ï¼šé»˜è®¤æœç´¢ä½œè€…\r\n            settings.SHOW_UPDATE_TIME = false     // ç›®å½•ï¼šæ˜¾ç¤ºç« èŠ‚æ›´æ–°æ—¶é—´\r\n            settings.SHOW_ORIGINAL_LINK = false   // ç›®å½•ï¼šæ˜¾ç¤ºç« èŠ‚æºé“¾æ¥\r\n            settings.SHOW_COMMENTS = false        // æ­£æ–‡ï¼šæ˜¾ç¤ºè¯„è®º\r\n        } else {\r\n            settings = getFromCache(\"pixivLastSettings\")\r\n            settings.SEARCH_AUTHOR = true\r\n            settings.FAST = false\r\n        }\r\n        putInCache(\"pixivSettings\", settings)\r\n        let status = settings[object]\r\n        let message = getSettingStatus(\"FAST\")\r\n        msg = `\\n${statusMsg(status)}ã€€${settingsName[object]}\\n\\n${message}`\r\n\r\n    } else {\r\n        if (settings[object] !== undefined) {\r\n            status = settings[object] = (!settings[object])\r\n        } else {\r\n            status = settings[object] = true  // æ— è®¾ç½®åˆ™é»˜è®¤å¼€å¯\r\n        }\r\n        msg = `${statusMsg(status)}ã€€${settingsName[object]}`\r\n    }\r\n    sleepToast(msg)\r\n    putInCache(\"pixivSettings\", settings)\r\n}\r\n\r\nfunction cleanCache() {\r\n    let novel = getNovel()\r\n    cache.delete(`${urlNovelUrl(novel.id)}`)\r\n    cache.delete(`${urlNovelDetailed(novel.id)}`)\r\n    // cache.delete(`${urlSearchNovel(novel.title, 1)}`)\r\n    // if (novel.seriesId) {\r\n    //     cache.delete(`${urlSeriesUrl(novel.seriesId)}`)\r\n    //     cache.delete(`${urlSeriesDetailed(novel.seriesId)}`)\r\n    //     cache.delete(`${urlSearchSeries(novel.seriesTitle, 1)}`)\r\n    // }\r\n    sleepToast(`ğŸ§¹ æ¸…é™¤ç¼“å­˜\\n\\nğŸ“Œ å½“å‰ç« èŠ‚ï¼š${novel.title}\\n\\nå·²æ¸…é™¤æœ¬ç« æ­£æ–‡ç¼“å­˜ï¼Œåˆ·æ–°æ­£æ–‡ä»¥æ›´æ–°`, 5)\r\n}\r\n\r\nlet maxPagesName = {\r\n    \"seriesMaxPages\": \"ç³»åˆ—æœ€å¤§é¡µç \",\r\n    \"novelsMaxPages\": \"å•ç¯‡æœ€å¤§é¡µç \"\r\n}\r\n\r\nfunction showMaxPages() {\r\n    let keys = Object.keys(maxPagesName)\r\n    let key = getFromCache(\"maxPagesKey\")\r\n\r\n    // åˆ‡æ¢åˆ—è¡¨\r\n    let index = keys.indexOf(key) + 1\r\n    if (index === keys.length) index = 0\r\n    key = keys[index]\r\n    putInCache(\"maxPagesKey\", key)\r\n\r\n    return sleepToast(`ğŸ“„ æœç´¢é¡µç \\nè®¾ç½® #ï¸âƒ£ æœç´¢æ ‡ç­¾çš„æœ€å¤§é¡µç æ•°\\n\r\n    å½“å‰${maxPagesName[keys[0]]}ï¼š${getFromCache(keys[0])}\\nå½“å‰${maxPagesName[keys[1]]}ï¼š${getFromCache(keys[1])}\\n\r\n    ç‚¹å‡» â« å¢åŠ é¡µç / â¬ å‡å°‘é¡µç \\nè°ƒæ•´ã€${maxPagesName[key]}ã€‘\\n\r\n    ğŸ“Œ é¡µç è¶Šå¤šï¼Œå°è¯´è¶Šå¤šï¼Œé€Ÿåº¦è¶Šæ…¢`.replace(\"    \", \"\"))\r\n}\r\n\r\nfunction editMaxPages(method) {\r\n    let msg = \"\", key = getFromCache(\"maxPagesKey\")\r\n    if (!key) key = Object.keys(maxPagesName)[0]\r\n    let maxPages = getFromCache(key)\r\n    if (!maxPages) maxPages = 1\r\n    if (method.includes(\"add\")) maxPages += 1\r\n    if (method.includes(\"min\")) maxPages -= 1\r\n\r\n    if (maxPages <= 1) {\r\n        maxPages = 1\r\n        msg += \"âš ï¸ æœç´¢é¡µç ä¸èƒ½å†å‡å°äº†\\n\"\r\n    }\r\n    if (maxPages >= 3) {\r\n        msg += \"âš ï¸ æœç´¢é¡µç è¶Šå¤šï¼Œæœç´¢é€Ÿåº¦è¶Šæ…¢\\n\"\r\n    }\r\n    if (maxPages >= 10) {\r\n        maxPages = 10\r\n        msg += \"âš ï¸ æœç´¢é¡µç ä¸èƒ½å†å¢å¤§äº†\\n\"\r\n    }\r\n    putInCache(`${key}`, maxPages)\r\n    sleepToast(`ğŸ“„ æœç´¢é¡µç \\n\\nå½“å‰æœç´¢ã€${maxPagesName[key]}ã€‘ï¼š${maxPages}\\n\\n${(msg)}`.trim())\r\n    return maxPages\r\n}\r\n",
        "respondTime": 180000,
        "ruleBookInfo": {
            "author": "userName",
            "canReName": "true",
            "coverUrl": "coverUrl",
            "init": "@js:\n@js:\r\nvar util = objParse(String(java.get(\"util\")))\r\n\r\nfunction objParse(obj) {\r\n    return JSON.parse(obj, (n, v) => {\r\n        if (typeof v == \"string\" && v.match(\"()\")) {\r\n            return eval(`(${v})`)\r\n        }\r\n        return v;\r\n    })\r\n}\r\n\r\nfunction novelHandler(novel){\r\n    novel = util.formatNovels(util.handNovels([novel]))[0]\r\n    if (novel.seriesId === undefined || novel.seriesId === null) {\r\n        book.bookUrl = novel.detailedUrl = urlNovelUrl(novel.id)\r\n        book.tocUrl = novel.catalogUrl = urlNovelDetailed(novel.id)\r\n    } else {\r\n        book.bookUrl = novel.detailedUrl = urlSeriesUrl(novel.seriesId)\r\n        book.tocUrl = novel.catalogUrl = urlSeriesDetailed(novel.seriesId)\r\n    }\r\n    // æ”¾å…¥ä¿¡æ¯ä»¥ä¾¿ç™»é™†ç•Œé¢ä½¿ç”¨\r\n    source.putLoginInfo(JSON.stringify(novel))\r\n    cache.put(\"novel\", JSON.stringify(novel))\r\n    return novel\r\n}\r\n\r\n(() => {\r\n    return novelHandler(util.getNovelRes(result))\r\n})()",
            "intro": "description",
            "kind": "tags",
            "lastChapter": "latestChapter",
            "name": "title",
            "tocUrl": "catalogUrl",
            "wordCount": "textCount"
        },
        "ruleContent": {
            "content": "@js:\n@js:\r\nvar util = objParse(String(java.get(\"util\")))\r\nlet emoji = {\r\n    \"normal\": 101, \"surprise\": 102, \"series\": 103, \"heaven\": 104, \"happy\": 105,\r\n    \"excited\": 106, \"sing\": 107, \"cry\": 108, \"normal2\": 201, \"shame2\": 202,\r\n    \"love2\": 203, \"interesting2\": 204, \"blush2\": 205, \"fire2\": 206, \"angry2\": 207,\r\n    \"shine2\": 208, \"panic2\": 209, \"normal3\": 301, \"satisfaction3\": 302, \"surprise3\": 303,\r\n    \"smile3\": 304, \"shock3\": 305, \"gaze3\": 306, \"wink3\": 307, \"happy3\": 308,\r\n    \"excited3\": 309, \"love3\": 310, \"normal4\": 401, \"surprise4\": 402, \"series4\": 403,\r\n    \"love4\": 404, \"shine4\": 405, \"sweet4\": 406, \"shame4\": 407, \"sleep4\": 408,\r\n    \"heart\": 501, \"teardrop\": 502, \"star\": 503\r\n}\r\n\r\nfunction objParse(obj) {\r\n    return JSON.parse(obj, (n, v) => {\r\n        if (typeof v == \"string\" && v.match(\"()\")) {\r\n            return eval(`(${v})`)\r\n        }\r\n        return v;\r\n    })\r\n}\r\n\r\nfunction getNovelInfo(res) {\r\n    // æ”¾å…¥å°è¯´ä¿¡æ¯ä»¥ä¾¿ç™»é™†ç•Œé¢ä½¿ç”¨\r\n    let novel = source.getLoginInfoMap()\r\n    if (novel === undefined) novel = JSON.parse(cache.get(\"novel\"))\r\n    if (res && res.error === true) return\r\n    novel.id = Number(res.id)\r\n    novel.title = res.title\r\n    novel.userId = res.userId\r\n    novel.userName = res.userName\r\n\r\n    if (res.bookmarkData) {\r\n        novel.isBookmark = true\r\n        cache.put(`collect${novel.id}`, res.bookmarkData.id)\r\n        util.saveNovels(\"likeNovels\", [Number(novel.id)])\r\n    } else {\r\n        novel.isBookmark = false\r\n    }\r\n\r\n    if (res.seriesNavData) {\r\n        novel.seriesId = Number(res.seriesNavData.seriesId)\r\n        novel.seriesTitle = res.seriesNavData.title\r\n        novel.isWatched = res.seriesNavData.isWatched\r\n        util.saveNovels(\"watchedSeries\", [Number(novel.seriesId)])\r\n    } else {\r\n        novel.seriesId = null\r\n        novel.seriesTitle = \"\"\r\n        novel.isWatched = false\r\n    }\r\n\r\n    // ç³»åˆ— + é˜…è¯»ï¼Œä½¿ç”¨å½“å‰ç« èŠ‚åç§°\r\n    if (novel.seriesId && util.settings.IS_LEGADO) {\r\n        let novelIds = JSON.parse(cache.get(`novelIds${novel.seriesId}`))\r\n        novel.id = novelIds[book.durChapterIndex]\r\n        novel.title = book.durChapterTitle\r\n\r\n        let bookmarkId = JSON.parse(cache.get(`collect${novel.id}`))\r\n        novel.isBookmark = !!bookmarkId\r\n    }\r\n\r\n    // æ·»åŠ æŠ•ç¥¨ä¿¡æ¯\r\n    if (res.pollData) novel.pollChoicesCount = res.pollData.choices.length\r\n    else novel.pollChoicesCount = 0\r\n    source.putLoginInfo(JSON.stringify(novel))\r\n    cache.put(\"novel\", JSON.stringify(novel))\r\n}\r\n\r\nfunction getContent(res) {\r\n    getNovelInfo(res)  // æ”¾å…¥ä¿¡æ¯ä»¥ä¾¿ç™»é™†ç•Œé¢ä½¿ç”¨\r\n    let content = String(res.content)\r\n    // let content = \"undefined\"\r\n    if (content.includes(\"undefined\")) {\r\n        return checkContent()\r\n    }\r\n\r\n    // åœ¨æ­£æ–‡å†…éƒ¨æ·»åŠ å°è¯´æè¿°\r\n    if (util.settings.SHOW_CAPTIONS && res.description !== \"\") {\r\n        content = res.description + \"\\n\" + \"â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”\\n\".repeat(2) + content\r\n    }\r\n\r\n    // è·å– [uploadedimage:] çš„å›¾ç‰‡é“¾æ¥\r\n    let hasEmbeddedImages = res.textEmbeddedImages !== undefined && res.textEmbeddedImages !== null\r\n    if (hasEmbeddedImages) {\r\n        Object.keys(res.textEmbeddedImages).forEach((key) => {\r\n            content = content.replace(`[uploadedimage:${key}]`, `<img src=\"${urlCoverUrl(res.textEmbeddedImages[key].urls.original)}\">`)\r\n        })\r\n    }\r\n\r\n    // è·å– [pixivimage:] çš„å›¾ç‰‡é“¾æ¥ [pixivimage:1234] [pixivimage:1234-1]\r\n    let matched = content.match(RegExp(/\\[pixivimage:(\\d+)-?(\\d+)]/gm))\r\n    if (matched) {\r\n        matched.forEach(pixivimage => {\r\n            let matched2, illustId, order = 0\r\n            if (pixivimage.includes(\"-\")) {\r\n                matched2 = pixivimage.match(RegExp(\"(\\\\d+)-(\\\\d+)\"))\r\n                illustId = matched2[1]; order = matched2[2]\r\n            } else {\r\n                matched2 = pixivimage.match(RegExp(\"\\\\d+\"))\r\n                illustId = matched2[0];\r\n            }\r\n            content = content.replace(`${pixivimage}`, `<img src=\"${urlIllustOriginal(illustId, order)}\">`)\r\n        })\r\n    }\r\n\r\n    // æ›¿æ¢ Pixiv åˆ†é¡µæ ‡è®°ç¬¦å· [newpage]\r\n    matched = content.match(RegExp(/[ ã€€]*\\[newpage][ ã€€]*/gm))\r\n    if (matched) {\r\n        for (let i in matched) {\r\n            content = content.replace(`${matched[i]}`, `${\"<p>â€‹<p/>\".repeat(3)}`)\r\n        }\r\n    }\r\n\r\n    // æ›¿æ¢ Pixiv ç« èŠ‚æ ‡è®°ç¬¦å· [chapter:]\r\n    matched = content.match(RegExp(/\\[chapter:(.*?)]/gm))\r\n    if (matched) {\r\n        for (let i in matched) {\r\n            let matched2 = matched[i].match(/\\[chapter:(.*?)]/m)\r\n            let chapter = matched2[1].trim()\r\n            content = content.replace(`${matched[i]}`, `${chapter}<p>â€‹<p/>`)\r\n        }\r\n    }\r\n\r\n    // æ›¿æ¢ Pixiv è·³è½¬é¡µé¢æ ‡è®°ç¬¦å· [[jump:]]\r\n    matched = content.match(RegExp(/\\[jump:(\\d+)]/gm))\r\n    if (matched) {\r\n        for (let i in matched) {\r\n            let page = matched[i].match(/\\d+/)\r\n            content = content.replace(`${matched[i]}`, `\\n\\nè·³è½¬è‡³ç¬¬${page}èŠ‚`)\r\n        }\r\n    }\r\n\r\n    // æ›¿æ¢ Pixiv é“¾æ¥æ ‡è®°ç¬¦å· [[jumpuri: > ]]\r\n    matched = content.match(RegExp(/\\[\\[jumpuri:(.*?)>(.*?)]]/gm))\r\n    if (matched) {\r\n        for (let i in matched) {\r\n            let matched2 = matched[i].match(/\\[\\[jumpuri:(.*?)>(.*?)]]/m)\r\n            let matchedText = matched2[0]\r\n            let urlName = matched2[1].trim()\r\n            let urlLink = matched2[2].trim()\r\n            // é˜…è¯»ä¸æ”¯æŒè¶…é“¾æ¥\r\n            //content = content.replace(`${matchedText}`, `<a href=${urlLink}>${urlName}</a>`)\r\n            if (urlLink === urlName) {\r\n                content = content.replace(`${matchedText}`, `${urlName}`)\r\n            } else {\r\n                content = content.replace(`${matchedText}`, `${urlName}: ${urlLink}`)\r\n            }\r\n        }\r\n    }\r\n\r\n    // æ›¿æ¢ Pixiv æ³¨éŸ³æ ‡è®°ç¬¦å· [[rb: > ]]\r\n    matched = content.match(RegExp(/\\[\\[rb:(.*?)>(.*?)]]/gm))\r\n    if (matched) {\r\n        for (let i in matched) {\r\n            let matched2 = matched[i].match(/\\[\\[rb:(.*?)>(.*?)]]/m)\r\n            let matchedText = matched2[0]\r\n            let kanji = matched2[1].trim()\r\n            let kana = matched2[2].trim()\r\n\r\n            if (!util.settings.REPLACE_TITLE_MARKS) {\r\n                // é»˜è®¤æ›¿æ¢æˆï¼ˆæ‹¬å·ï¼‰\r\n                content = content.replace(`${matchedText}`, `${kanji}ï¼ˆ${kana}ï¼‰`)\r\n            } else {\r\n                let reg = RegExp(\"[\\\\u4E00-\\\\u9FFF]+\", \"g\");\r\n                if (reg.test(kana)) {\r\n                    // kanaä¸ºä¸­æ–‡ï¼Œåˆ™æ›¿æ¢å›ã€Šä¹¦åå·ã€‹\r\n                    content = content.replace(`${matchedText}`, `${kanji}ã€Š${kana}ã€‹`)\r\n                } else {\r\n                    // é˜…è¯»ä¸æ”¯æŒ <ruby> <rt> æ³¨éŸ³\r\n                    // content = content.replace(`${matchedText}`, `<ruby>${kanji}<rt>${kana}</rt></ruby>`)\r\n                    content = content.replace(`${matchedText}`, `${kanji}ï¼ˆ${kana}ï¼‰`)\r\n                }\r\n            }\r\n        }\r\n    }\r\n\r\n    // æ·»åŠ æŠ•ç¥¨\r\n    if (res.pollData) {\r\n        let poll = `ğŸ“ƒ æŠ•ç¥¨(âœ…${res.pollData.total}å·²æŠ•)ï¼š\\n${res.pollData.question}\\n`\r\n        res.pollData.choices.forEach(choice => {\r\n            poll += `é€‰é¡¹${choice.id}ï¼š${choice.text}(âœ…${choice.count})\\n`\r\n        })\r\n        content += \"\\n\" + \"â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”\\n\".repeat(2) + poll\r\n    }\r\n\r\n    // æ·»åŠ è¯„è®º\r\n    if (util.settings.SHOW_COMMENTS) {\r\n        return content + getComment(res)\r\n    } else {\r\n        return content\r\n    }\r\n}\r\n\r\nfunction getComment(res) {\r\n    // let resp = getAjaxJson(urlNovelComments(res.id, 0, res.commentCount), true)\r\n    const limit = 50  // æ¨¡æ‹Ÿ Pixiv è¯·æ±‚\r\n    let resp = {\"error\": false, \"message\": \"\", \"body\": {comments:[]} }\r\n    let maxPage = (res.commentCount / limit) + 1\r\n    for (let i = 0; i < maxPage; i++) {\r\n        let result = getAjaxJson(urlNovelComments(res.id, i*limit, 50), true)\r\n        if (result.error !== true && result.body.comments !== null) {\r\n            resp.body.comments = resp.body.comments.concat(result.body.comments)\r\n        }\r\n    }\r\n\r\n    // åˆ·æ–°æ—¶ï¼Œåˆ·æ–°è¯„è®ºï¼Œä¸æ›´æ–°æ­£æ–‡\r\n    let commentCount = resp.body.comments.length\r\n    java.log(`ã€${res.title}ã€‘(${res.id})ï¼Œå…±æœ‰${commentCount}æ¡è¯„è®ºï¼Œ${res.commentCount - commentCount}æ¡å›å¤`)\r\n    if (commentCount === 0) {\r\n        return \"\"\r\n    }\r\n\r\n    let comments = `ğŸ’¬ è¯„è®º(å…±è®¡${commentCount}æ¡)ï¼š\\n`\r\n    resp.body.comments.forEach(comment => {\r\n        if (comment.comment === \"\") {\r\n            comment.comment = `<img src=\"${urlStampUrl(comment.stampId)}\">`\r\n        }\r\n        if (Object.keys(emoji).includes(comment.comment.slice(1, -1))) {\r\n            comment.emojiId = emoji[comment.comment.slice(1, -1)]\r\n            comment.comment = `<img src=\"${urlEmojiUrl(comment.emojiId)}\">`\r\n        }\r\n        if (comment.userId === String(cache.get(\"pixiv:uid\"))) {\r\n            comments += `@${comment.userName}ï¼š${comment.comment}(${comment.commentDate})(${comment.id})\\n`\r\n        } else {\r\n            comments += `@${comment.userName}ï¼š${comment.comment}(${comment.commentDate})\\n`\r\n        }\r\n\r\n        // è·å–è¯„è®ºå›å¤\r\n        if (comment.hasReplies === true) {\r\n            let resp = getAjaxJson(urlNovelCommentsReply(comment.id, 1), true)\r\n            if (resp.error === true) return comments\r\n\r\n            resp.body.comments.reverse().forEach(reply => {\r\n                if (reply.comment === \"\") {\r\n                    reply.comment = `<img src=\"${urlStampUrl(reply.stampId)}\">`\r\n                }\r\n                if (Object.keys(emoji).includes(reply.comment.slice(1, -1))) {\r\n                    reply.emojiId = emoji[reply.comment.slice(1, -1)]\r\n                    reply.comment = `<img src=\"${urlEmojiUrl(reply.emojiId)}\">`\r\n                }\r\n                if (comment.userId === String(cache.get(\"pixiv:uid\"))) {\r\n                    comments += `@${reply.userName}(â¤´ï¸@${reply.replyToUserName})ï¼š${reply.comment}(${reply.commentDate})(${reply.id})\\n`\r\n                } else {\r\n                    comments += `@${reply.userName}(â¤´ï¸@${reply.replyToUserName})ï¼š${reply.comment}(${reply.commentDate})\\n`\r\n                }\r\n            })\r\n            comments += \"â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”\\n\"\r\n        }\r\n    })\r\n    if (comments) {\r\n        comments = \"\\n\" + \"â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”\\n\".repeat(2) + comments\r\n    }\r\n    return comments\r\n}\r\n\r\nfunction checkContent() {\r\n    let latestMsg = getAjaxJson(urlMessageThreadLatest(5))\r\n    if (latestMsg.error === true) {\r\n        java.log(JSON.stringify(latestMsg))\r\n\r\n    } else if (latestMsg.body.total >= 1) {\r\n        let msg = latestMsg.body.message_threads.filter(item => item.thread_name === \"pixiväº‹å‹™å±€\")[0]\r\n        if (msg === undefined) {\r\n            sleepToast(`æ‚¨äº ${java.timeFormat(new Date().getTime())} è§¦å‘ Pixiv ã€è¯·æ±‚é™åˆ¶ã€‘ï¼Œå»ºè®®ç¨å€™/é‡æ–°ç™»å½•å†ç»§ç»­`, 3)\r\n            // java.startBrowser(\"https://www.pixiv.net\", 'é€€å‡ºç™»å½•')\r\n            // java.startBrowser(\"https://www.pixiv.net/logout.php\",'é€€å‡ºç™»å½•')  // ä¸æ¸…é™¤ WebView ç¼“å­˜æ— æ³•é‡æ–°ç™»å½•\r\n\r\n        } else if (new Date().getTime()- 1000*msg.modified_at <= 3*24*60*60*1000) { // 3*24hå†…æé†’\r\n            sleepToast(`æ‚¨äº ${java.timeFormat(1000*msg.modified_at)} è§¦å‘ Pixiv ã€è¿‡åº¦è®¿é—®ã€‘ï¼Œè¯·ä¿®æ”¹å¯†ç å¹¶é‡æ–°ç™»å½•`, 3)\r\n            sleepToast(`${msg.latest_content}`, 5)\r\n            java.startBrowser(\"https://accounts.pixiv.net/password/change\",'ä¿®æ”¹å¯†ç ')\r\n        }\r\n    }\r\n}\r\n\r\n(() => {\r\n    return getContent(util.getNovelRes(result))\r\n})()",
            "imageStyle": "DEFAULT"
        },
        "ruleExplore": {
            "author": "userName",
            "bookList": "@js:\n@js:\r\nvar util = objParse(String(java.get(\"util\")))\r\nvar seriesSet = new Set();  // å­˜å‚¨seriesID æœ‰BUGæ— æ³•å¤„ç†ç¿»é¡µ\r\n\r\nfunction objParse(obj) {\r\n    return JSON.parse(obj, (n, v) => {\r\n        if (typeof v == \"string\" && v.match(\"()\")) {\r\n            return eval(`(${v})`)\r\n        }\r\n        return v;\r\n    })\r\n}\r\n\r\nfunction handlerFactory() {\r\n    if (baseUrl.includes(\"https://cdn.jsdelivr.net\")) {\r\n        return () => {updateSource(); return []}\r\n    }\r\n    if (!isLogin()) {\r\n        return handlerNoLogin()\r\n    }\r\n    if (baseUrl.includes(\"/bookmark\")) {\r\n        return handlerBookMarks()\r\n    }\r\n    if (baseUrl.includes(\"/top\")) {\r\n        return handlerRecommend()\r\n    }\r\n    if (baseUrl.includes(\"/follow_latest\")) {\r\n        return handlerFollowLatest()\r\n    }\r\n    if (baseUrl.includes(\"/watch_list\")) {\r\n        return handlerWatchList()\r\n    }\r\n    if (baseUrl.includes(\"/discovery\")) {\r\n        return handlerDiscovery()\r\n    }\r\n    if (baseUrl.includes(\"/new\")) {\r\n        return handlerDiscovery()\r\n    }\r\n    if (baseUrl.includes(\"/commission/\")) {\r\n        return handlerFollowLatest()\r\n    }\r\n    if (baseUrl.includes(\"/user_event/portal\")) {\r\n        return handlerFollowLatest()\r\n    }\r\n    if (baseUrl.includes(\"/genre\")) {\r\n        return handlerWatchList()\r\n    }\r\n    // æ­£åˆ™åŒ¹é…ç½‘å€å†…å®¹\r\n    if (baseUrl.includes(\"/ranking\")) {\r\n        return handlerRanking()\r\n    }\r\n    if (baseUrl.includes(\"/marker_all\")) {\r\n        return handlerRanking()\r\n    }\r\n    if (baseUrl.includes(\"/editors_picks\")) {\r\n        return handlerRanking()\r\n    }\r\n    if (baseUrl.includes(\"/ajax/search/novels\")) {\r\n        return handlerSearch()\r\n    }\r\n    if (baseUrl.startsWith(\"https://www.pixiv.net\")) {\r\n        return handlerRanking()\r\n    }\r\n    else {\r\n        return []\r\n    }\r\n}\r\n\r\nfunction handlerNoLogin() {\r\n    return () => {\r\n        sleepToast(\"âš ï¸ å½“å‰æœªç™»å½•è´¦å·\\n\\nè¯·ç™»å½• Pixiv è´¦å·\", 1.5)\r\n        util.removeCookie(); util.login()\r\n        sleepToast(\"ç™»å½•æˆåŠŸåï¼Œè¯·é‡æ–°è¿›å…¥å‘ç°\", 2)\r\n        return []\r\n    }\r\n}\r\n\r\n// æ¨èå°è¯´\r\nfunction handlerRecommend() {\r\n    return () => {\r\n        let res = JSON.parse(result)\r\n        const recommend = res.body.page.recommend\r\n        const novels = res.body.thumbnails.novel\r\n        let nidSet = new Set(recommend.ids)\r\n        // java.log(nidSet.size)\r\n        let list = novels.filter(novel => nidSet.has(String(novel.id)))\r\n        // java.log(`è¿‡æ»¤ç»“æœ:${JSON.stringify(list)}`)\r\n        return util.formatNovels(util.handNovels(util.combineNovels(list)))\r\n    }\r\n}\r\n\r\n// æ”¶è—å°è¯´ï¼Œä»–äººæ”¶è—\r\nfunction handlerBookMarks() {\r\n    return () => {\r\n        let res = JSON.parse(result).body.works\r\n        if (res === undefined || res.length === 0) {\r\n            //æµç¨‹æ— æ³•æœ¬ç¯èŠ‚ä¸­æ­¢ åªèƒ½äº¤ç»™ä¸‹ä¸€æµç¨‹å¤„ç†\r\n            return []\r\n        }\r\n        return util.formatNovels(util.handNovels(res))\r\n    }\r\n}\r\n\r\n//å…³æ³¨ä½œè€…ï¼Œå°è¯´å§”æ‰˜ï¼Œå°è¯´ä¼åˆ’\r\nfunction handlerFollowLatest() {\r\n    return () => {\r\n        let res = JSON.parse(result)\r\n        return util.formatNovels(util.handNovels(util.combineNovels(res.body.thumbnails.novel)))\r\n    }\r\n}\r\n\r\n//æ¨èå°è¯´ï¼Œæœ€è¿‘å°è¯´\r\nfunction handlerDiscovery() {\r\n    return () => {\r\n        let res = JSON.parse(result)\r\n        return util.formatNovels(util.handNovels(util.combineNovels(res.body.novels)))\r\n    }\r\n}\r\n\r\n// æœç´¢æ ‡ç­¾\r\nfunction handlerSearch() {\r\n    return () => {\r\n        let res = JSON.parse(result)\r\n        return util.formatNovels(util.handNovels(util.combineNovels(res.body.novel.data)))\r\n    }\r\n}\r\n\r\n// è¿½æ›´åˆ—è¡¨ï¼Œçƒ­é—¨åˆ†ç±»\r\nfunction handlerWatchList() {\r\n    return () => {\r\n        let res = JSON.parse(result)\r\n        return util.formatNovels(util.handNovels(res.body.thumbnails.novelSeries))\r\n    }\r\n}\r\n\r\n// æ’è¡Œæ¦œï¼Œä¹¦ç­¾ï¼Œé¦–é¡µï¼Œç¼–è¾‘éƒ¨æ¨èï¼Œé¡ºåºç›¸åŒ\r\nfunction handlerRanking() {\r\n    if (util.settings.IS_LEGADO) return handlerRankingAjaxAll()\r\n    // else if (util.settings.IS_SOURCE_READ) return handlerRankingWebview()\r\n    else if (util.settings.IS_SOURCE_READ) return handlerRankingAjax()\r\n    else return []\r\n}\r\n\r\n// æ’è¡Œæ¦œï¼Œä¹¦ç­¾ï¼Œé¦–é¡µï¼Œç¼–è¾‘éƒ¨æ¨èï¼Œé¡ºåºç›¸åŒ\r\nfunction handlerRankingAjaxAll() {\r\n    return () => {\r\n        let  novelIds = [], novelUrls = []\r\n        // let result = result + java.ajax(`${baseUrl}&p=2`)  // æ­£åˆ™è·å–ç½‘å€ä¸­çš„ novelId\r\n        let matched = result.match(RegExp(/\\/novel\\/show\\.php\\?id=\\d{5,}/gm))\r\n        for (let i in matched) {\r\n            let novelId = matched[i].match(RegExp(/\\d{5,}/))[0]\r\n            if (novelIds.indexOf(novelId) === -1) {\r\n                novelIds.push(novelId)\r\n                novelUrls.push(urlNovelDetailed(novelId))\r\n            }\r\n        }\r\n        // java.log(JSON.stringify(novelIds))\r\n        let novels = getAjaxAllJson(novelUrls).map(resp => resp.body)\r\n        return util.formatNovels(util.handNovels(util.combineNovels(novels)))\r\n    }\r\n}\r\n\r\n// æ’è¡Œæ¦œï¼Œä¹¦ç­¾ï¼Œé¦–é¡µ\r\nfunction handlerRankingWebview() {\r\n    return () => {\r\n        let novelIds = []  // æ­£åˆ™è·å–ç½‘å€ä¸­çš„ novelId\r\n        // let result = result + java.ajax(`${baseUrl}&p=2`)  // æ­£åˆ™è·å–ç½‘å€ä¸­çš„ novelId\r\n        let matched = result.match(RegExp(/\\/novel\\/show\\.php\\?id=\\d{5,}/gm))\r\n        for (let i in matched) {\r\n            let novelId = matched[i].match(RegExp(/\\d{5,}/))[0]\r\n            if (novelIds.indexOf(novelId) === -1) {\r\n                novelIds.push(novelId)\r\n            }\r\n        }\r\n        // java.log(JSON.stringify(novelIds))\r\n        let userNovels = getWebviewJson(\r\n            urlNovelsDetailed(`${cache.get(\"pixiv:uid\")}`, novelIds), html => {\r\n                return (html.match(new RegExp(\">\\\\{.*?}<\"))[0].replace(\">\", \"\").replace(\"<\", \"\"))\r\n            }).body\r\n        return util.formatNovels(util.handNovels(util.combineNovels(Object.values(userNovels))))\r\n    }\r\n}\r\n\r\n// æ’è¡Œæ¦œï¼Œä¹¦ç­¾ï¼Œé¡ºåºç›¸åŒ\r\nfunction handlerRankingAjax() {\r\n    return () => {\r\n        let novels = [], novelIds = []\r\n        // let result = result + java.ajax(`${baseUrl}&p=2`)  // æ­£åˆ™è·å–ç½‘å€ä¸­çš„ novelId\r\n        let matched = result.match(RegExp(/\\/novel\\/show\\.php\\?id=\\d{5,}/gm))\r\n        for (let i in matched) {\r\n            let novelId = matched[i].match(RegExp(/\\d{5,}/))[0]\r\n            if (novelIds.indexOf(novelId) === -1) {\r\n                novelIds.push(novelId)\r\n                // java.log(urlNovelDetailed(novelId))\r\n                let res = getAjaxJson(urlNovelDetailed(novelId))\r\n                if (res.error !== true) {\r\n                    novels.push(res.body)\r\n                } else {\r\n                    java.log(JSON.stringify(res))\r\n                }\r\n            }\r\n        }\r\n        return util.formatNovels(util.handNovels(util.combineNovels(novels)))\r\n    }\r\n}\r\n\r\n(() => {\r\n    return handlerFactory()()\r\n})()",
            "bookUrl": "detailedUrl",
            "coverUrl": "coverUrl",
            "intro": "description",
            "kind": "tags",
            "lastChapter": "latestChapter",
            "name": "title",
            "wordCount": "textCount"
        },
        "ruleSearch": {
            "author": "userName",
            "bookList": "@js:\n@js:\r\nvar util = objParse(String(java.get(\"util\")))\r\n\r\nfunction objParse(obj) {\r\n    return JSON.parse(obj, (n, v) => {\r\n        if (typeof v == \"string\" && v.match(\"()\")) {\r\n            return eval(`(${v})`)\r\n        }\r\n        return v;\r\n    })\r\n}\r\n\r\nvar first = true;\r\n// å­˜å‚¨seriesID\r\nvar seriesSet = {\r\n    keywords: \"Pixiv:Search\",\r\n    has: (value) => {\r\n        let page = Number(java.get(\"page\"))\r\n        if (page === 1 && first) {\r\n            first = false\r\n            cache.deleteMemory(this.keywords)\r\n            return false\r\n        }\r\n\r\n        let v = cache.getFromMemory(this.keywords)\r\n        if (v === undefined || v === null) {\r\n            return false\r\n        }\r\n        let set = new Set(JSON.parse(v))\r\n        return set.has(value)\r\n    },\r\n\r\n    add: (value) => {\r\n        let v = cache.getFromMemory(this.keywords)\r\n        if (v === undefined || v === null) {\r\n            cache.putMemory(this.keywords, JSON.stringify([value]))\r\n\r\n        } else {\r\n            let arr = JSON.parse(v)\r\n            if (typeof arr === \"string\") {\r\n                arr = Array(arr)\r\n            }\r\n            arr.push(value)\r\n            cache.putMemory(this.keywords, JSON.stringify(arr))\r\n        }\r\n    },\r\n};\r\n\r\nfunction getUserNovels() {\r\n    if (!isLogin()) {\r\n        sleepToast(\"ğŸ‘¤ æœç´¢ä½œè€…\\n\\nâš ï¸ å½“å‰æœªç™»å½•è´¦å·\\nè¯·ç™»å½• Pixiv è´¦å·\", 1.5)\r\n        util.removeCookie(); util.login()\r\n        sleepToast(\"ğŸ‘¤ æœç´¢ä½œè€…\\n\\nç™»å½•æˆåŠŸåï¼Œè¯·é‡æ–°æœç´¢\", 2)\r\n        return []\r\n    }\r\n\r\n    let uidList = [], novels = []\r\n    let username = String(java.get(\"keyword\"))\r\n    let page = Number(java.get(\"page\"))\r\n\r\n    // cache.delete(username)\r\n    let userid = cache.get(username)\r\n    if (userid !== undefined && userid !== null) {\r\n        uidList = [userid]\r\n        java.log(`ğŸ‘¤ ç¼“å­˜ä½œè€…IDï¼š${userid}`)\r\n    } else {\r\n        html = java.ajax(urlSearchUser(username))\r\n        // java.log(html)\r\n        // ä»…åŒ¹é…æœ‰æŠ•ç¨¿ä½œå“çš„ç”¨æˆ·\r\n        let match = html.match(new RegExp(`\"userIds\":\\\\[(?:(?:\\\\d+,?)+)]`))\r\n        // java.log(JSON.stringify(match))\r\n        if (match === null || match.length === 0) {\r\n            return []\r\n        }\r\n\r\n        match = JSON.stringify(match).replace(\"\\\\\",\"\").split(\",\")\r\n        // java.log(JSON.stringify(match))\r\n        let regNumber = new RegExp(\"\\\\d+\")\r\n        uidList = match.map(v => {\r\n            return v.match(regNumber)[0]\r\n        })\r\n        java.log(`ğŸ‘¤ è·å–ä½œè€…IDï¼š${JSON.stringify(uidList)}`)\r\n    }\r\n\r\n    let tempUids = []\r\n    for (let i in uidList) {\r\n        let uid = uidList[i]\r\n        let resp = getAjaxJson(urlUserAllWorks(uid), true)\r\n        // java.log(urlUserAllWorks(id))\r\n        // java.log(JSON.stringify(resp))\r\n        if (resp.error === true) {\r\n            return []\r\n        }\r\n\r\n        // ä»…è·å–å‰3ä¸ªæœ‰å°è¯´çš„ä½œè€…\r\n        let novelIds = Object.keys(resp.body.novels)\r\n        // java.log(`${uid}-${novelIds.length}`)\r\n        if (novelIds.length >= 1) tempUids.push(uid)\r\n        if (tempUids.length === 3) {\r\n            java.log(`ğŸ‘¤ æ˜¾ç¤ºä½œè€…IDï¼š${JSON.stringify(tempUids)}`)\r\n            break\r\n        }\r\n\r\n        // è·å–ç³»åˆ—å°è¯´ï¼Œä¸ util.handnovels ç³»åˆ—è¯¦æƒ…å…¼å®¹\r\n        let seriesIds = []\r\n        if (resp.body.novelSeries.length >= 1) {\r\n            resp.body.novelSeries.forEach(novel =>{\r\n                seriesIds.push(novel.id)\r\n                novel.textCount = novel.publishedTotalCharacterCount\r\n                novel.description = novel.caption\r\n            })\r\n            novels = novels.concat(resp.body.novelSeries)\r\n        }\r\n\r\n        // è·å–æ‰€æœ‰ç³»åˆ—å†…éƒ¨çš„å°è¯´ ID\r\n        let seriesNovelIds = []\r\n        seriesIds.forEach(seriesId => {\r\n            let returnList = getAjaxJson(urlSeriesNovelsTitles(seriesId)).body\r\n            returnList.map(novel => {return seriesNovelIds.push(novel.id)})\r\n        })\r\n        // java.log(`æœ‰ç³»åˆ—çš„å°è¯´IDï¼š${JSON.stringify(seriesNovelIds)}`)\r\n        // java.log(JSON.stringify(seriesNovelIds.length))\r\n\r\n        // è·å–å•ç¯‡å°è¯´\r\n        if (novelIds.length >= 1 && util.settings.IS_LEGADO) {\r\n            novelIds = novelIds.filter(novelid => (!seriesNovelIds.includes(novelid)))\r\n            novelIds = novelIds.reverse().slice((page - 1) * 20, page * 20)\r\n            // java.log(`çœŸå•ç¯‡çš„å°è¯´IDï¼š${JSON.stringify(novelIds)}`)\r\n            // java.log(JSON.stringify(novelIds.length))\r\n            let novelUrls = novelIds.map(novelId => {return urlNovelDetailed(novelId)})\r\n            // java.log(JSON.stringify(novelUrls))\r\n            // cache.delete(novelUrls)\r\n            novels = novels.concat(getAjaxAllJson(novelUrls).map(resp => resp.body))\r\n        }\r\n\r\n        // // è·å–å•ç¯‡å°è¯´\r\n        if (novelIds.length >= 1 && util.settings.IS_SOURCE_READ) {\r\n            novelIds = novelIds.filter(novelid => (!seriesNovelIds.includes(novelid)))\r\n            // java.log(`çœŸå•ç¯‡çš„å°è¯´IDï¼š${JSON.stringify(novelIds)}`)\r\n            // java.log(JSON.stringify(novelIds.length))\r\n            novelIds = novelIds.reverse().slice((page - 1) * 20, page * 20)\r\n            novelIds.forEach(novelId => {\r\n                // java.log(urlNovelDetailed(novelId))\r\n                let res = getAjaxJson(urlNovelDetailed(novelId))\r\n                if (res.error !== true) {\r\n                    novels.push(res.body)\r\n                } else {\r\n                    java.log(JSON.stringify(res))\r\n                }\r\n            })\r\n        }\r\n    }\r\n    \r\n    util.debugFunc(() => {\r\n        java.log(`è·å–ç”¨æˆ·æœç´¢å°è¯´ç»“æŸ`)\r\n    })\r\n    return novels\r\n}\r\n\r\nfunction search(name, type, page) {\r\n    let resp = {}\r\n    if (type.includes(\"novel\")) {\r\n        resp = getAjaxJson(urlSearchNovel(name, page))\r\n        java.log(urlSearchNovel(name, page))\r\n    }\r\n    if (type.includes(\"series\")) {\r\n        resp = getAjaxJson(urlSearchSeries(name, page))\r\n        java.log(urlSearchSeries(name, page))\r\n    }\r\n    if (resp.error === true || resp.total === 0) {\r\n        return {\"data\": [], \"total\":0, \"lastPage\": 0}\r\n    }\r\n    return resp.body.novel\r\n}\r\n\r\nfunction getSeries() {\r\n    let novels = []\r\n    let name = String(java.get(\"keyword\"))\r\n    let maxPages = getFromCache(\"maxPages\")  // ä»…é»˜è®¤æœç´¢ä½¿ç”¨\r\n    if (!maxPages) {\r\n        maxPages = getFromCache(\"seriesMaxPages\")  // æœç´¢æ ‡ç­¾ä½¿ç”¨\r\n        if (!maxPages) maxPages = 1\r\n        putInCache(\"seriesMaxPages\", maxPages)\r\n    }\r\n    java.log(`ğŸ“„ æœç´¢ç³»åˆ—æœ€å¤§é¡µç ï¼š${maxPages}`)\r\n\r\n    if (JSON.parse(result).error === true) {\r\n        return []\r\n    }\r\n    let lastPage = JSON.parse(result).body.novel.lastPage\r\n    novels = novels.concat(JSON.parse(result).body.novel.data)\r\n    java.log(urlSearchSeries(name, 1))\r\n    cache.put(urlSearchSeries(name, 1), result, cacheSaveSeconds)  // åŠ å…¥ç¼“å­˜\r\n    for (let page = Number(java.get(\"page\")) + 1; page <= lastPage && page <= maxPages; page++) {\r\n        novels = novels.concat(search(name,\"series\", page).data)\r\n    }\r\n    return novels\r\n}\r\n\r\nfunction getNovels() {\r\n    let novels = []\r\n    let name = String(java.get(\"keyword\"))\r\n    let maxPages = getFromCache(\"maxPages\")  // ä»…é»˜è®¤æœç´¢ä½¿ç”¨\r\n    if (!maxPages) {\r\n        maxPages = getFromCache(\"novelsMaxPages\")  // æœç´¢æ ‡ç­¾ä½¿ç”¨\r\n        if (!maxPages) maxPages = 1\r\n        putInCache(\"novelsMaxPages\", maxPages)\r\n    }\r\n    java.log(`ğŸ“„ æœç´¢å•ç¯‡æœ€å¤§é¡µç ï¼š${maxPages}`)\r\n\r\n    let resp = search(name, \"novel\", 1)\r\n    novels = novels.concat(resp.data)\r\n    for (let page = Number(java.get(\"page\")) + 1; page <= resp.lastPage && page <= maxPages; page++) {\r\n        novels = novels.concat(search(name,\"novel\", page).data)\r\n    }\r\n    return util.combineNovels(novels)\r\n}\r\n\r\nfunction getConvertNovels() {\r\n    let novels = []\r\n    let novelName = String(java.get(\"keyword\"))\r\n    let name1 = String(java.s2t(novelName))\r\n    let name2 = String(java.t2s(novelName))\r\n    if (name1 !== novelName) novels = novels.concat(search(name1, \"novel\", 1).data)\r\n    if (name2 !== novelName) novels = novels.concat(search(name2, \"novel\", 1).data)\r\n    novels = util.combineNovels(novels)\r\n    if (name1 !== novelName) novels = novels.concat(search(name1, \"series\", 1).data)\r\n    if (name2 !== novelName) novels = novels.concat(search(name2, \"series\", 1).data)\r\n    return novels\r\n}\r\n\r\nfunction novelFilter(novels) {\r\n    let textCount = 0, tags = []\r\n    let limitedTextCount = String(java.get(\"limitedTextCount\")).replace(\"å­—æ•°\", \"\").replace(\"å­—æ•¸\", \"\")\r\n    // limitedTextCount = `3w 3k 3w5 3k5`.[0]\r\n    if (limitedTextCount.includes(\"w\") || limitedTextCount.includes(\"W\")) {\r\n        let num = limitedTextCount.toLowerCase().split(\"w\")\r\n        textCount = 10000 * num[0] + 1000 * num[1]\r\n    } else if (limitedTextCount.includes(\"k\") || limitedTextCount.includes(\"K\")) {\r\n        let num = limitedTextCount.toLowerCase().split(\"k\")\r\n        textCount = 1000 * num[0] + 100 * num[1]\r\n    }\r\n\r\n    let novels0 = novels.map(novel => novel.id)\r\n    if (textCount >= 1) {\r\n        novels = novels.filter(novel => novel.textCount >= textCount)\r\n        let novels1 = novels.map(novel => novel.id)\r\n        java.log(`ğŸ”¢ å­—æ•°é™åˆ¶ï¼š${limitedTextCount}`)\r\n        java.log(`â¬ å­—æ•°é™åˆ¶ï¼šè¿‡æ»¤å‰${novels0.length}ï¼›è¿‡æ»¤å${novels1.length}`)\r\n    }\r\n\r\n    let inputTags = String(java.get(\"inputTags\")).split(\" \")\r\n    for (let i in inputTags) {\r\n        let tag = inputTags[i].trim()\r\n        if (tag !== \"\") tags.push(`${tag}`)\r\n    }\r\n\r\n    if (tags.length >= 1) {\r\n        // ä»…ä¿ç•™å«æœ‰æ‰€æœ‰æ ‡ç­¾çš„å°è¯´\r\n        // novels = novels.filter(novel => {\r\n        //     // java.log(`${JSON.stringify(novel.tags)}\\n${tags.every(item => novel.tags.includes(item))}`)\r\n        //     return tags.every(item => novel.tags.includes(item))\r\n        // })\r\n        novels = novels.filter(novel => tags.every(item => novel.tags.includes(item)))\r\n        let novels2 = novels.map(novel => novel.id)\r\n        java.log(`#ï¸âƒ£ è¿‡æ»¤æ ‡ç­¾ï¼š${tags.join(\"ã€\")}`)\r\n        java.log(`#ï¸âƒ£ è¿‡æ»¤æ ‡ç­¾ï¼šè¿‡æ»¤å‰${novels0.length}ï¼›è¿‡æ»¤å${novels2.length}`)\r\n    }\r\n\r\n    let inputAuthor = String(java.get(\"inputAuthor\")).trim()\r\n    if (inputAuthor) {\r\n        // novels = novels.filter(novel => {\r\n        //     java.log(`${novel.userName}-${novel.userName.includes(inputAuthor)}`)\r\n        //     return novel.userName.includes(inputAuthor)\r\n        // })\r\n        novels = novels.filter(novel => novel.userName.includes(inputAuthor))\r\n        let novels2 = novels.map(novel => novel.id)\r\n        java.log(`ğŸ‘¤ è¿‡æ»¤ä½œè€…ï¼š${tags.join(\"ã€\")}`)\r\n        java.log(`ğŸ‘¤ è¿‡æ»¤ä½œè€…ï¼šè¿‡æ»¤å‰${novels0.length}ï¼›è¿‡æ»¤å${novels2.length}`)\r\n    }\r\n    return novels\r\n}\r\n\r\n(() => {\r\n    let novels = []\r\n    let keyword = String(java.get(\"keyword\"))\r\n    if (keyword.startsWith(\"@\") || keyword.startsWith(\"ï¼ \")) {\r\n        java.put(\"keyword\", keyword.slice(1))\r\n        novels = novels.concat(getUserNovels())\r\n    } else if (keyword.startsWith(\"#\") || keyword.startsWith(\"ï¼ƒ\")) {\r\n        java.put(\"keyword\", keyword.slice(1))\r\n        // åˆ é™¤é»˜è®¤æœç´¢æœ€å¤§é¡µç ï¼Œä½¿ç”¨å†…éƒ¨è®¾å®šçš„æœ€å¤§é¡µç \r\n        cache.delete(\"maxPages\")\r\n        novels = novels.concat(getSeries())\r\n        novels = novels.concat(getNovels())\r\n    } else {\r\n        // è®¾ç½®é»˜è®¤æœç´¢æœ€å¤§é¡µç \r\n        putInCache(\"maxPages\", 1)\r\n        novels = novels.concat(getSeries())\r\n        novels = novels.concat(getNovels())\r\n        if (util.settings.SEARCH_AUTHOR) novels = novels.concat(getUserNovels())\r\n        if (util.settings.CONVERT_CHINESE) novels = novels.concat(getConvertNovels())\r\n    }\r\n    // java.log(JSON.stringify(novels))\r\n    // è¿”å›ç©ºåˆ—è¡¨ä¸­æ­¢æµç¨‹\r\n    if (novels.length === 0) {\r\n        return []\r\n    }\r\n    return novelFilter(util.formatNovels(util.handNovels(novels)))\r\n})()",
            "bookUrl": "detailedUrl",
            "checkKeyWord": "æµ‹è¯•é¡µé¢",
            "coverUrl": "coverUrl",
            "intro": "description",
            "kind": "tags",
            "lastChapter": "latestChapter",
            "name": "title",
            "wordCount": "textCount"
        },
        "ruleToc": {
            "chapterList": "@js:\n@js:\r\nvar util = objParse(String(java.get(\"util\")))\r\n\r\nfunction objParse(obj) {\r\n    return JSON.parse(obj, (n, v) => {\r\n        if (typeof v == \"string\" && v.match(\"()\")) {\r\n            return eval(`(${v})`)\r\n        }\r\n        return v;\r\n    })\r\n}\r\n\r\nfunction urlNovel(novelId){\r\n    if (util.settings.SHOW_ORIGINAL_LINK) {\r\n        return urlNovelUrl(novelId)\r\n    } else {\r\n        return urlNovelDetailed(novelId)\r\n    }\r\n}\r\n\r\nfunction oneShotHandler(res) {\r\n    res.textCount = res.userNovels[`${res.id}`].textCount\r\n    res.createDate = timeTextFormat(res.createDate)\r\n    return [{\r\n        title: res.title.replace(RegExp(/^\\s+|\\s+$/g), \"\"),\r\n        chapterUrl: urlNovel(res.id),\r\n        chapterInfo: `${res.createDate}ã€€ã€€${res.textCount}å­—`\r\n    }]\r\n}\r\n\r\nfunction seriesHandler(res) {\r\n    const limit = 30\r\n    let returnList = [], novelIds = []\r\n    let seriesID = res.id, allChaptersCount = res.total\r\n    util.debugFunc(() => {\r\n        java.log(`æœ¬ç³»åˆ— ${seriesID} ä¸€å…±æœ‰${allChaptersCount}ç« `);\r\n    })\r\n\r\n    //å‘é€è¯·æ±‚è·å¾—ç›¸åº”æ•°é‡çš„ç›®å½•åˆ—è¡¨\r\n    function sendAjaxForGetChapters(lastIndex) {\r\n        resp = getAjaxJson(urlSeriesNovels(seriesID, limit, lastIndex), true)\r\n        res = resp.body.thumbnails.novel\r\n        // res = resp.body.page.seriesContents\r\n        res.forEach(v => {\r\n            v.title = v.title.replace(RegExp(/^\\s+|\\s+$/g), \"\").replace(RegExp(/ï¼ˆ|ï¼‰|-/g), \"\")\r\n            v.chapterUrl = urlNovel(v.id)\r\n            novelIds.push(v.id)\r\n            if (v.updateDate !== undefined) {\r\n                v.updateDate = timeTextFormat(v.createDate)\r\n                v.chapterInfo = `${v.updateDate}ã€€ã€€${v.textCount}å­—`\r\n            } else {\r\n                v.updateDate = java.timeFormat(v.uploadTimestamp)\r\n                v.chapterInfo = `${v.updateDate}ã€€ã€€${v.textLength}å­—`\r\n            }\r\n            util.debugFunc(() => {\r\n                java.log(`${v.title}`)\r\n            })\r\n        })\r\n        return res;\r\n    }\r\n\r\n    if (!util.settings.SHOW_UPDATE_TIME) {\r\n        returnList = getAjaxJson(urlSeriesNovelsTitles(seriesID), true).body\r\n        returnList.forEach(v => {\r\n            v.title = v.title.replace(RegExp(/^\\s+|\\s+$/g), \"\").replace(RegExp(/ï¼ˆ|ï¼‰|-/g), \"\")\r\n            v.chapterUrl = urlNovel(v.id)\r\n            novelIds.push(v.id)\r\n        })\r\n    } else {\r\n        //é€»è¾‘æ§åˆ¶è€… ä¹Ÿå°±æ˜¯ä½¿ç”¨ä¸Šé¢å®šä¹‰çš„ä¸¤ä¸ªå‡½æ•°æ¥åšå¯¹åº”åŠŸèƒ½\r\n        //è¦çˆ¬å–çš„æ€»æ¬¡æ•°\r\n        let max = (allChaptersCount / limit) + 1\r\n        for (let i = 0; i < max; i++) {\r\n            //java.log(\"içš„å€¼:\"+i)\r\n            let list = sendAjaxForGetChapters(i * limit);\r\n            //å–å‡ºæ¯ä¸ªå€¼\r\n            returnList = returnList.concat(list)\r\n        }\r\n    }\r\n    // æ”¾å…¥å°è¯´ä¿¡æ¯ä»¥ä¾¿ç™»é™†ç•Œé¢ä½¿ç”¨\r\n    let novel = source.getLoginInfoMap()\r\n    if (novel === undefined) novel = JSON.parse(cache.get(\"novel\"))\r\n    novel.novelIds = novelIds\r\n    cache.put(`novelIds${seriesID}`, JSON.stringify(novelIds), cacheSaveSeconds)\r\n    // java.log(JSON.stringify(returnList))\r\n    source.putLoginInfo(JSON.stringify(novel))\r\n    cache.put(\"novel\", JSON.stringify(novel))\r\n    return returnList\r\n}\r\n\r\n(function (res) {\r\n    res = util.getNovelResSeries(result)\r\n    if (res.firstNovelId === undefined || res.seriesNavData === null) {\r\n        return oneShotHandler(res)\r\n    } else {\r\n        return seriesHandler(res)\r\n    }\r\n})()",
            "chapterName": "title",
            "chapterUrl": "chapterUrl",
            "isPay": "",
            "isVip": "",
            "updateTime": "chapterInfo"
        },
        "searchUrl": "@js:\n@js:\r\njava.put(\"key\", key)\r\njava.put(\"page\", page)\r\nlet keyword = key.split(\" \")\r\nlet limitedTextCount\r\nif (key.includes(\"å­—æ•°\") || key.includes(\"å­—æ•¸\") ) {\r\n    limitedTextCount = keyword.pop()\r\n    keyword = keyword.join(\" \")\r\n} else {\r\n    limitedTextCount = \"\"\r\n    keyword = key\r\n}\r\njava.put(\"keyword\", keyword)\r\njava.put(\"limitedTextCount\", limitedTextCount)\r\n\r\nif (keyword.startsWith(\"@\") || keyword.startsWith(\"ï¼ \")) {\r\n    if (keyword.includes(\"#\") || keyword.includes(\"ï¼ƒ\")) {\r\n        let author = keyword.split(\" \")[0]\r\n        let tags = keyword.replace(author, \"\").trim().slice(1)\r\n        java.put(\"keyword\", author)\r\n        java.put(\"inputTags\", tags)\r\n        java.log(`ğŸ‘¤ æœç´¢ä½œè€…ï¼š${author} #ï¸âƒ£ è¿‡æ»¤æ ‡ç­¾ï¼š${tags.replace(\" \", \"ã€\")}`)\r\n    } else {\r\n        java.put(\"keyword\", keyword)\r\n        java.log(`ğŸ‘¤ æœç´¢ä½œè€…ï¼š${keyword.slice(1)}`)\r\n    }\r\n\r\n} else if (keyword.startsWith(\"#\") || keyword.startsWith(\"ï¼ƒ\")) {\r\n    keyword = keyword.slice(1)\r\n    if (keyword.includes(\"@\") || keyword.includes(\"ï¼ \")) {\r\n        let author = keyword.match(new RegExp(/[@ï¼ ](.*)/))\r\n        keyword = keyword.replace(author[0], \"\").trim()\r\n        java.put(\"inputAuthor\", author[1])\r\n        java.log(`#ï¸âƒ£ æœç´¢æ ‡ç­¾ï¼š${keyword} ğŸ‘¤ è¿‡æ»¤ä½œè€…ï¼š${author[1]}`)\r\n    } else {\r\n        java.log(`#ï¸âƒ£ æœç´¢æ ‡ç­¾ï¼š${keyword}`)\r\n    }\r\n    java.put(\"keyword\", `#${keyword}`)\r\n\r\n} else {\r\n    java.log(`ğŸ” æœç´¢å†…å®¹ï¼š${keyword}`)\r\n}\r\nurlSearchSeries(keyword, page)\r\n\r\n// åŒæ—¶æœç´¢å¤šä¸ªé“¾æ¥çš„æœç´¢ç»“æœ\r\n// let li = [\r\n//     urlSearchSeries(keyword, page),\r\n//     urlSearchNovel(keyword, page)\r\n// ]\r\n// // resp = getAjaxAllJson(li)\r\n// // resp = resp.map(res => JSON.stringify(res)).join(\",\")\r\n// resp = java.ajaxAll(li).map(resp => resp.body()).join(\",\")\r\n// resp = `[${resp}]`",
        "variableComment": "ğŸš« å±è”½ä½œè€…(æœ¬åœ°)ï¼š\r\nâ–¶ï¸è®¾ç½®æ–¹æ³•ï¼šæ‰“å¼€å°è¯´ - èœå• - ç™»å½• - ğŸš« å±è”½ä½œè€…\r\n\r\nğŸš« å±è”½æ ‡ç­¾/æè¿°(æœ¬åœ°)ï¼š\r\n1ï¸âƒ£ç¼–è¾‘ä¹¦æºï¼šèœå• - ç™»å½• - ç‚¹å‡»ã€ ğŸ‘€ æŸ¥çœ‹å±è”½ã€‘\r\n2ï¸âƒ£åˆ‡æ¢åˆ—è¡¨ï¼šç‚¹å‡»æŒ‰é’®ï¼Œåˆ‡æ¢è‡³ã€ç›¸åº”å±è”½åˆ—è¡¨ã€‘\r\n3ï¸âƒ£è¾“å…¥å†…å®¹ï¼šåœ¨ã€è¾“å…¥å†…å®¹ã€‘å¤„è¾“å…¥å±è”½å†…å®¹\r\n4ï¸âƒ£å±è”½ä½œè€…ï¼šç‚¹å‡»ã€ğŸš« åŠ å…¥å±è”½ã€‘ï¼Œå±è”½è¯¥å†…å®¹\r\n\r\nğŸ“Œ å–œæ¬¢æ ‡ç­¾(æœ¬åœ°)ï¼š\r\n1ï¸âƒ£ç¼–è¾‘ä¹¦æºï¼šèœå• - ç™»å½• ï¼Œæ‰¾åˆ°è¾“å…¥å†…å®¹\r\n2ï¸âƒ£è¾“å…¥å†…å®¹ï¼šè¾“å…¥æ ‡ç­¾ï¼Œç‚¹å‡»ã€ğŸ“Œ å–œæ¬¢æ ‡ç­¾ã€‘\r\n\r\nâ¤ï¸ æŸ¥çœ‹ä»–äººæ”¶è—ï¼š\r\n1ï¸âƒ£ç¼–è¾‘ä¹¦æºï¼šèœå• - ç™»å½• ï¼Œæ‰¾åˆ°è¾“å…¥å†…å®¹\r\n2ï¸âƒ£è¾“å…¥å†…å®¹ï¼šè¾“å…¥ä½œè€…IDï¼Œç‚¹å‡»ã€â¤ï¸ ä»–äººæ”¶è—ã€‘\r\n\r\n\r\nâš™ï¸ ä¹¦æºè®¾ç½®ï¼š\r\nè®¾ç½®1ï¸âƒ£ï¼šæ‰“å¼€å°è¯´ - èœå• - ç™»å½• - ç‚¹å‡»ä¸‹æ–¹æŒ‰é’®\r\nâ–¶ï¸ æœç´¢ä»»æ„å°è¯´ï¼ŒåŒæ­¥è®¾ç½®æ•°æ®\r\n\r\nè®¾ç½®2ï¸âƒ£ï¼šç¼–è¾‘ä¹¦æº - åŸºæœ¬ - å˜é‡è¯´æ˜ - ä¿®æ”¹å¹¶ä¿å­˜\r\nâš™ï¸ è‡ªå®šä¹‰è®¾ç½®ï¼šå°† true æ”¹ä¸º falseï¼Œæˆ–ç›¸å\r\nâš ï¸ è®¾ç½®æºå˜é‡ã€æ— æ³•ã€‘æ›´æ”¹ä¹¦æºè‡ªå®šä¹‰è®¾ç½®\r\nâš ï¸ æ³¨æ„ä¸è¦æ·»åŠ æˆ–åˆ é™¤å°¾éšé€—å·\",\"\r\nâš ï¸ æ›´æ–°å‘ç°é¡µéœ€è¦é•¿æŒ‰\"Pixiv\"ï¼Œæ‰‹åŠ¨åˆ·æ–°\r\nä»¥ä¸‹å†…å®¹ä¸ºä¹¦æºè®¾ç½®ï¼š\r\n{\r\n\"SHOW_GENERAL_NEW\": false,\r\n\"SHOW_GENERAL_RANK\": false,\r\n\"SHOW_R18_GENRE\": false,\r\n\"SHOW_GENERAL_GENRE\": false\r\n}\r\n\r\n// SHOW_GENERAL_NEW\r\n// å‘ç°ï¼šæœ€æ–°ã€ä¼åˆ’ã€çº¦ç¨¿æ˜¾ç¤ºä¸€èˆ¬å°è¯´\r\n// SHOW_GENERAL_RANK\r\n// å‘ç°ï¼šæ’è¡Œæ¦œæ˜¾ç¤ºä¸€èˆ¬å°è¯´\r\n// SHOW_R18_GENRE\r\n// å‘ç°ï¼šçƒ­é—¨åˆ†ç±»æ˜¾ç¤ºR18å°è¯´\r\n// SHOW_GENERAL_GENRE\r\n// å‘ç°ï¼šçƒ­é—¨åˆ†ç±»æ˜¾ç¤ºä¸€èˆ¬å°è¯´\r\n\r\n",
        "weight": 0
    },
    {
        "bookSourceComment": "Pixiv å°è¯´å¤‡ç”¨ï¼ˆæ›´æ–°ğŸ“†ï¼š2025-10-31ï¼‰\r\n\r\nä¹¦æºç‰ˆæœ¬ï¼š240\r\nä½¿ç”¨è¯´æ˜ï¼šğŸ“Œé˜…è¯»æ­£å¼ç‰ˆ 3.25 å¯ç”¨\r\nå¯ç”¨åŠŸèƒ½ï¼šâœ…æœç´¢âœ…å‘ç°âœ…æ·»åŠ ç½‘å€âœ…è®¢é˜…æº\r\næœç´¢å°è¯´ï¼šâœ…å•ç¯‡âœ…ç³»åˆ—âœ…æ ‡ç­¾âœ…ä½œè€…\r\nå‘ç°å°è¯´ï¼šâœ…å…³æ³¨âœ…è¿½æ›´âœ…æ¨èâœ…å‘ç°\r\nå‘ç°å°è¯´ï¼šâœ…æ”¶è—âœ…ä¹¦ç­¾âœ…é¦–é¡µâœ…æ’è¡Œ\r\næ·»åŠ ç½‘å€ï¼šâœ…Pixivå°è¯´é“¾æ¥âœ…Pixivç³»åˆ—é“¾æ¥\r\nè®¢é˜…ç”¨æ³•ï¼šç‚¹å‡»è®¢é˜…æºæ‰“å¼€å°è¯´/ç³»åˆ—å°è¯´ï¼Œã€åˆ·æ–°ã€‘ï¼Œç‚¹å‡»ã€åŠ å…¥ä¹¦æ¶ã€‘æŒ‰é’®ï¼Œæ·»åŠ åˆ°ä¹¦æ¶\r\n\r\nä¹¦æºå‘å¸ƒï¼šå…½äººé˜…è¯»é¢‘é“ https://t.me/FurryReading\r\né¡¹ç›®åœ°å€ï¼šhttps://github.com/windyhusky/PixivSource\r\nä½¿ç”¨æ•™ç¨‹ï¼šhttps://github.com/windyhusky/PixivSource/blob/main/doc/Pixiv.md\r\n\r\næ—§ç‰ˆä¹¦æºï¼š\r\nhttps://cdn.jsdelivr.net/gh/windyhusky/PixivSource@191/pixiv.json\r\nhttps://raw.githubusercontent.com/windyhusky/PixivSource/191/pixiv.json\r\n\r\nè§„åˆ™è®¢é˜…ï¼šimport è®¢é˜…æº\r\nhttps://cdn.jsdelivr.net/gh/windyhusky/PixivSource@main/import.json\r\nhttps://raw.githubusercontent.com/windyhusky/PixivSource/main/import.json\r\n\r\nâš™ï¸ ä¹¦æºè®¾ç½®ï¼š\r\nä¹¦æºç®¡ç† - ç¼–è¾‘ä¹¦æº - åŸºæœ¬ - å˜é‡è¯´æ˜ - ä¿®æ”¹å¹¶ä¿å­˜",
        "bookSourceGroup": "ğŸ” Pixiv",
        "bookSourceName": "ğŸ…¿ï¸ Pixiv å°è¯´å¤‡ç”¨",
        "bookSourceType": 0,
        "bookSourceUrl": "https://www.pixiv.net/novel",
        "bookUrlPattern": "(https?://)?(www\\.)?pixiv\\.net(/ajax)?/(novel/(show\\.php\\?id=|series/)?|users?/)\\d+.*",
        "concurrentRate": "3/2000",
        "customButton": false,
        "customOrder": 1,
        "enabled": false,
        "enabledCookieJar": true,
        "enabledExplore": false,
        "eventListener": false,
        "exploreUrl": "@js:\n@js:\r\nlet SHOW_R18_GENRE, SHOW_GENERAL_NEW, SHOW_GENERAL_RANK, SHOW_GENERAL_GENRE\r\ntry {\r\n    settings = JSON.parse(String(source.variableComment).match(RegExp(/{([\\s\\S]*?)}/gm)))\r\n    SHOW_R18_GENRE = settings.SHOW_R18_GENRE         // å‘ç°ï¼šçƒ­é—¨åˆ†ç±»æ˜¾ç¤ºR18å°è¯´\r\n    SHOW_GENERAL_NEW = settings.SHOW_GENERAL_NEW     // å‘ç°ï¼šæœ€æ–°ã€ä¼åˆ’ã€çº¦ç¨¿æ˜¾ç¤ºä¸€èˆ¬å°è¯´\r\n    SHOW_GENERAL_RANK = settings.SHOW_GENERAL_RANK   // å‘ç°ï¼šæ’è¡Œæ¦œæ˜¾ç¤ºä¸€èˆ¬å°è¯´\r\n    SHOW_GENERAL_GENRE = settings.SHOW_GENERAL_GENRE // å‘ç°ï¼šçƒ­é—¨åˆ†ç±»æ˜¾ç¤ºä¸€èˆ¬å°è¯´\r\n} catch (e) {\r\n    SHOW_R18_GENRE = false\r\n    SHOW_GENERAL_NEW = false\r\n    SHOW_GENERAL_RANK = false\r\n    SHOW_GENERAL_GENRE = false\r\n}\r\n\r\nli = [\r\n    {\"â­ï¸ å…³æ³¨\": \"https://www.pixiv.net/ajax/follow_latest/novel?p={{page}}&mode=r18&lang=zh\"},\r\n    {\"ğŸ“ƒ è¿½æ›´\": \"https://www.pixiv.net/ajax/watch_list/novel?p={{page}}&new=1&lang=zh\"},\r\n    {\"ğŸ’¯ æ¨è\": \"https://www.pixiv.net/ajax/top/novel?mode=r18&lang=zh\"},\r\n    {\"ğŸ” å‘ç°\": \"https://www.pixiv.net/ajax/novel/discovery?mode=r18&lang=zh\"},\r\n    {\"â¤ï¸ æ”¶è—\": \"https://www.pixiv.net/ajax/user/{{cache.get(\\\"pixiv:uid\\\")}}/novels/bookmarks?tag=&offset={{(page-1)*24}}&limit=24&rest=show&lang=zh\"},\r\n    {\"ãŠ™ï¸ æ”¶è—\": \"https://www.pixiv.net/ajax/user/{{cache.get(\\\"pixiv:uid\\\")}}/novels/bookmarks?tag=&offset={{(page-1)*24}}&limit=24&rest=hide&lang=zh\"},\r\n    {\"ğŸ·ï¸ ä¹¦ç­¾\": \"https://www.pixiv.net/novel/marker_all.php\"},\r\n    {\"ğŸ  é¦–é¡µ\": \"https://www.pixiv.net\"},\r\n]\r\n\r\nnormal = [\r\n    {\"âœ… å¸¸è§„ å°è¯´ æ¨è âœ…\": \"\"},\r\n    {\"â­ï¸ å…³æ³¨\": \"https://www.pixiv.net/ajax/follow_latest/novel?p={{page}}&mode=all&lang=zh\"},\r\n    {\"ğŸ’¯ æ¨è\": \"https://www.pixiv.net/ajax/top/novel?mode=all&lang=zh\"},\r\n    {\"ğŸ” å‘ç°\": \"https://www.pixiv.net/ajax/novel/discovery?mode=safe&lang=zh\"},\r\n    {\"ğŸ†™ æ›´æ–°\": \"https://cdn.jsdelivr.net/gh/windyhusky/PixivSource@main/pixiv.json\"},\r\n]\r\n\r\nr18New = [\r\n    {\"ğŸ†• æœ€æ–° ä¼åˆ’ çº¦ç¨¿ ğŸ’°\": \"\"},\r\n    {\"ğŸ†• æœ€æ–°\": \"https://www.pixiv.net/ajax/novel/new?lastId=0&limit=20&r18=true&lang=zh\"},\r\n    {\"ğŸ“‘ ä¼åˆ’\": \"https://www.pixiv.net/ajax/user_event/portal/novels?mode=r18&p={{page}}&lang=zh\"},\r\n    {\"ğŸ’° çº¦ç¨¿\": \"https://www.pixiv.net/ajax/commission/page/request/complete/novels?mode=r18&p={{page}}&lang=zh\"},\r\n    {\"ğŸ” å‘ç°\": \"https://www.pixiv.net/ajax/novel/discovery?mode=all&lang=zh\"},\r\n]\r\n\r\ngeneralNew = [\r\n    {\"âœ… æœ€æ–° ä¼åˆ’ çº¦ç¨¿ âœ…\": \"\"},\r\n    {\"æœ€æ–°\": \"https://www.pixiv.net/ajax/novel/new?lastId=0&limit=20&r18=false&lang=zh\"},\r\n    {\"ä¼åˆ’\": \"https://www.pixiv.net/ajax/user_event/portal/novels?mode=all&p={{page}}&lang=zh\"},\r\n    {\"çº¦ç¨¿\": \"https://www.pixiv.net/ajax/commission/page/request/complete/novels?mode=all&p={{page}}&lang=zh\"},\r\n    {\"ç¼–è¾‘\": \"https://www.pixiv.net/novel/editors_picks\"},\r\n]\r\n\r\nr18Rank = [\r\n    {\"ğŸ‘‘ æ’è¡Œæ¦œå• ğŸ‘‘\": \"\"},\r\n    {\"ä»Šæ—¥\": \"https://www.pixiv.net/novel/ranking.php?mode=daily_r18\"},\r\n    {\"æœ¬å‘¨\": \"https://www.pixiv.net/novel/ranking.php?mode=weekly_r18\"},\r\n    {\"R18G\": \"https://www.pixiv.net/novel/ranking.php?mode=r18g\"},\r\n    {\"ç”·æ€§\": \"https://www.pixiv.net/novel/ranking.php?mode=male_r18\"},\r\n    {\"å¥³æ€§\": \"https://www.pixiv.net/novel/ranking.php?mode=female_r18\"}\r\n]\r\n\r\ngeneralRank = [\r\n    {\"ğŸ† æ’è¡Œæ¦œå• ğŸ†\": \"\"},\r\n    {\"ä»Šæ—¥\": \"https://www.pixiv.net/novel/ranking.php?mode=daily\"},\r\n    {\"æœ¬å‘¨\": \"https://www.pixiv.net/novel/ranking.php?mode=weekly\"},\r\n    {\"æœ¬æœˆ\": \"https://www.pixiv.net/novel/ranking.php?mode=monthly\"},\r\n    {\"ç”·æ€§\": \"https://www.pixiv.net/novel/ranking.php?mode=male\"},\r\n    {\"å¥³æ€§\": \"https://www.pixiv.net/novel/ranking.php?mode=female\"},\r\n    {\"æ–°äºº\": \"https://www.pixiv.net/novel/ranking.php?mode=rookie\"},\r\n    {\"åŸåˆ›\": \"https://www.pixiv.net/novel/ranking.php?mode=weekly_original\"},\r\n    {\"AIç”Ÿæˆ\": \"https://www.pixiv.net/novel/ranking.php?mode=weekly_ai\"}\r\n]\r\n\r\nr18Genre = [\r\n    {\"ğŸ”¥ åŸåˆ›çƒ­é—¨ ğŸ”¥\": \"\"},\r\n    {\"ç”·æ€§\": \"https://www.pixiv.net/ajax/genre/novel/male?mode=r18&lang=zh\"},\r\n    {\"å¥³æ€§\": \"https://www.pixiv.net/ajax/genre/novel/female?mode=r18&lang=zh\"},\r\n    {\"æ‹çˆ±\": \"https://www.pixiv.net/ajax/genre/novel/romance?mode=r18&lang=zh\"},\r\n    {\"å¼‚ä¸–ç•Œå¥‡å¹»\": \"https://www.pixiv.net/ajax/genre/novel/isekai_fantasy?mode=r18&lang=zh\"},\r\n    {\"ç°ä»£å¥‡å¹»\": \"https://www.pixiv.net/ajax/genre/novel/contemporary_fantasy?mode=r18&lang=zh\"},\r\n    {\"æ‚¬ç–‘\": \"https://www.pixiv.net/ajax/genre/novel/mystery?mode=r18&lang=zh\"},\r\n    {\"ææ€–\": \"https://www.pixiv.net/ajax/genre/novel/horror?mode=r18&lang=zh\"},\r\n    {\"ç§‘å¹»\": \"https://www.pixiv.net/ajax/genre/novel/sci-fi?mode=r18&lang=zh\"},\r\n    {\"æ–‡å­¦\": \"https://www.pixiv.net/ajax/genre/novel/literature?mode=r18&lang=zh\"},\r\n    {\"æƒ…æ„Ÿ\": \"https://www.pixiv.net/ajax/genre/novel/drama?mode=r18&lang=zh\"},\r\n    {\"å†å²\": \"https://www.pixiv.net/ajax/genre/novel/historical_pieces?mode=r18&lang=zh\"},\r\n    {\"è€½ç¾\": \"https://www.pixiv.net/ajax/genre/novel/bl?mode=r18&lang=zh\"},\r\n    {\"ç™¾åˆ\": \"https://www.pixiv.net/ajax/genre/novel/yuri?mode=r18&lang=zh\"},\r\n    {\"æ•£æ–‡Â·è¯—æ­Œ\": \"https://www.pixiv.net/ajax/genre/novel/poetry?mode=r18&lang=zh\"},\r\n    {\"éšç¬”Â·çºªå®\": \"https://www.pixiv.net/ajax/genre/novel/non-fiction??mode=r18&lang=zh\"},\r\n    {\"å‰§æœ¬\": \"https://www.pixiv.net/ajax/genre/novel/screenplays?mode=r18&lang=zh\"},\r\n    {\"è¯„è®º\": \"https://www.pixiv.net/ajax/genre/novel/reviews?mode=r18&lang=zh\"},\r\n    {\"å…¶ä»–\": \"https://www.pixiv.net/ajax/genre/novel/other?mode=r18&lang=zh\"}\r\n]\r\n\r\ngeneralgGenre = [\r\n    {\"â¤ï¸â€ğŸ”¥ åŸåˆ›çƒ­é—¨ â¤ï¸â€ğŸ”¥\": \"\"},\r\n    {\"ç»¼åˆ\": \"https://www.pixiv.net/ajax/genre/novel/all?mode=safe&lang=zh\"},\r\n    {\"æ‹çˆ±\": \"https://www.pixiv.net/ajax/genre/novel/romance?mode=safe&lang=zh\"},\r\n    {\"å¼‚ä¸–ç•Œå¥‡å¹»\": \"https://www.pixiv.net/ajax/genre/novel/isekai_fantasy?mode=safe&lang=zh\"},\r\n    {\"ç°ä»£å¥‡å¹»\": \"https://www.pixiv.net/ajax/genre/novel/contemporary_fantasy?mode=safe&lang=zh\"},\r\n    {\"æ‚¬ç–‘\": \"https://www.pixiv.net/ajax/genre/novel/mystery?mode=safe&lang=zh\"},\r\n    {\"ææ€–\": \"https://www.pixiv.net/ajax/genre/novel/horror?mode=safe&lang=zh\"},\r\n    {\"ç§‘å¹»\": \"https://www.pixiv.net/ajax/genre/novel/sci-fi?mode=safe&lang=zh\"},\r\n    {\"æ–‡å­¦\": \"https://www.pixiv.net/ajax/genre/novel/literature?mode=safe&lang=zh\"},\r\n    {\"æƒ…æ„Ÿ\": \"https://www.pixiv.net/ajax/genre/novel/drama?mode=safe&lang=zh\"},\r\n    {\"å†å²\": \"https://www.pixiv.net/ajax/genre/novel/historical_pieces?mode=safe&lang=zh\"},\r\n    {\"è€½ç¾\": \"https://www.pixiv.net/ajax/genre/novel/bl?mode=safe&lang=zh\"},\r\n    {\"ç™¾åˆ\": \"https://www.pixiv.net/ajax/genre/novel/yuri?mode=safe&lang=zh\"},\r\n    {\"æ•£æ–‡Â·è¯—æ­Œ\": \"https://www.pixiv.net/ajax/genre/novel/poetry?mode=safe&lang=zh\"},\r\n    {\"éšç¬”Â·çºªå®\": \"https://www.pixiv.net/ajax/genre/novel/non-fiction??mode=safe&lang=zh\"},\r\n    {\"å‰§æœ¬\": \"https://www.pixiv.net/ajax/genre/novel/screenplays?mode=safe&lang=zh\"},\r\n    {\"è¯„è®º\": \"https://www.pixiv.net/ajax/genre/novel/reviews?mode=safe&lang=zh\"},\r\n    {\"å…¶ä»–\": \"https://www.pixiv.net/ajax/genre/novel/other?mode=safe&lang=zh\"}\r\n]\r\n\r\nli = li.concat(normal)\r\nli = li.concat(r18New)\r\nif (SHOW_GENERAL_NEW === true) {\r\n    li = li.concat(generalNew)\r\n}\r\nli = li.concat(r18Rank)\r\nif (SHOW_GENERAL_RANK === true) {\r\n    li = li.concat(generalRank)\r\n}\r\nif (SHOW_R18_GENRE === true) {\r\n    li = li.concat(r18Genre)\r\n}\r\nif (SHOW_GENERAL_GENRE === true) {\r\n    li = li.concat(generalgGenre)\r\n}\r\nsleepToast('ä½¿ç”¨æŒ‡å—ğŸ”–\\n\\nå‘ç° - æ›´æ–° - ç‚¹å‡»\"ğŸ”° ä½¿ç”¨æŒ‡å—\" - æŸ¥çœ‹')\r\n\r\n// æ·»åŠ æ ¼å¼\r\nli.forEach(item => {\r\n    item.title = Object.keys(item)[0]\r\n    item.url = Object.values(item)[0]\r\n    delete item[Object.keys(item)[0]]\r\n    item.style = {}\r\n    item.style.layout_flexGrow = 1\r\n    item.style.layout_flexShrink = 1\r\n    item.style.layout_alignSelf = \"auto\"\r\n    item.style.layout_wrapBefore = \"false\"\r\n    if (item.url === \"\") {\r\n        item.style.layout_flexBasisPercent = 1\r\n    } else {\r\n        item.style.layout_flexBasisPercent = -1\r\n    }\r\n})\r\n\r\nJSON.stringify(li)",
        "header": "{\"referer\":\"https://www.pixiv.net\"}",
        "jsLib": "var checkTimes = 0\r\nvar cacheSaveSeconds = 7*24*60*60  // é•¿æœŸç¼“å­˜æ—¶é—´ 7å¤©\r\nvar cacheTempSeconds = 10*60*1000  // çŸ­æœŸç¼“å­˜ 10min\r\n\r\nfunction cacheGetAndSet(cache, key, supplyFunc) {\r\n    let v = cache.get(key)\r\n    // ç¼“å­˜ä¿¡æ¯é”™è¯¯æ—¶ï¼Œä¿å­˜ 10min åé‡æ–°è¯·æ±‚\r\n    if (v && JSON.parse(v).error === true) {\r\n        if (new Date().getTime() >= JSON.parse(v).timestamp + cacheTempSeconds) {\r\n            cache.delete(key)\r\n            v = cache.get(key)\r\n        }\r\n    }\r\n    // æ— ç¼“å­˜ä¿¡æ¯æ—¶ï¼Œè¿›è¡Œè¯·æ±‚\r\n    if (v === undefined || v === null) {\r\n        v = supplyFunc()\r\n        v.timestamp = new Date().getTime()\r\n        v = JSON.stringify(v)\r\n        cache.put(key, v, cacheSaveSeconds)\r\n    }\r\n    return JSON.parse(v)\r\n}\r\n\r\nfunction putInCache(objectName, object, saveSeconds) {\r\n    const {java, cache} = this\r\n    if (object === undefined) object = null\r\n    if (saveSeconds === undefined) saveSeconds = 0\r\n    cache.put(objectName, JSON.stringify(object), saveSeconds)\r\n}\r\nfunction getFromCache(objectName) {\r\n    const {java, cache} = this\r\n    let object = cache.get(objectName)\r\n    if (object === undefined) return null  // å…¼å®¹æºé˜…\r\n    return JSON.parse(object)\r\n}\r\nfunction isHtmlString(str) {\r\n    return str.startsWith(\"<!DOCTYPE html>\")\r\n}\r\nfunction isJsonString(str) {\r\n    try {\r\n        if (typeof JSON.parse(str) === \"object\") return true\r\n    } catch(e) {}\r\n    return false\r\n}\r\n\r\nfunction getWebViewUA() {\r\n    const {java, cache} = this\r\n    let userAgent = String(java.getWebViewUA())\r\n    if (userAgent.includes(\"Windows NT 10.0; Win64; x64\")) {\r\n        userAgent = \"Mozilla/5.0 (Linux; Android 10; K) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/119.0.0.0 Mobile Safari/537.36\"\r\n    }\r\n    // java.log(`userAgent=${userAgent}`)\r\n    cache.put(\"userAgent\", userAgent)\r\n    return String(userAgent)\r\n}\r\nfunction isLogin() {\r\n    const {java, cache} = this\r\n    return !!cache.get(\"csfrToken\")\r\n}\r\n\r\nfunction getAjaxJson(url, forceUpdate) {\r\n    const {java, cache} = this\r\n    let v = cache.get(url)\r\n    if (forceUpdate && v && new Date().getTime() >= JSON.parse(v).timestamp + cacheTempSeconds) cache.delete(url)\r\n    return cacheGetAndSet(cache, url, () => {\r\n        return JSON.parse(java.ajax(url))\r\n    })\r\n}\r\nfunction getAjaxAllJson(urls, forceUpdate) {\r\n    const {java, cache} = this\r\n    let v = cache.get(urls)\r\n    if (forceUpdate && v && new Date().getTime() >= JSON.parse(v).timestamp + cacheTempSeconds) cache.delete(urls)\r\n    return cacheGetAndSet(cache, urls, () => {\r\n        let result = java.ajaxAll(urls).map(resp => JSON.parse(resp.body()))\r\n        cache.put(urls, JSON.stringify(result), cacheSaveSeconds)\r\n        for (let i in urls) cache.put(urls[i], JSON.stringify(result[i]), cacheSaveSeconds)\r\n        return result\r\n    })\r\n}\r\nfunction getWebviewJson(url, parseFunc) {\r\n    const {java, cache} = this\r\n    return cacheGetAndSet(cache, url, () => {\r\n        let html = java.webView(null, url, null)\r\n        return JSON.parse(parseFunc(html))\r\n    })\r\n}\r\n\r\nfunction urlNovelUrl(novelId) {\r\n    return `https://www.pixiv.net/novel/show.php?id=${novelId}`\r\n}\r\nfunction urlNovelDetailed(novelId) {\r\n    return `https://www.pixiv.net/ajax/novel/${novelId}`\r\n}\r\nfunction urlNovelsDetailed(userId, nidList) {\r\n    return `https://www.pixiv.net/ajax/user/${userId}/novels?${nidList.map(v => `ids[]=${v}`).join(\"&\")}`\r\n}\r\nfunction urlNovelBookmarkData(novelId) {\r\n    return `https://www.pixiv.net/ajax/novel/${novelId}/bookmarkData`\r\n}\r\nfunction urlNovelComments(novelId, offset, limit) {\r\n    return `https://www.pixiv.net/ajax/novels/comments/roots?novel_id=${novelId}&offset=${offset}&limit=${limit}&lang=zh`\r\n}\r\nfunction urlNovelCommentsReply(commentId, page) {\r\n    return `https://www.pixiv.net/ajax/novels/comments/replies?comment_id=${commentId}&page=${page}&lang=zh`\r\n}\r\nfunction urlNovelsRecommendInit(novelId, limit) {\r\n    if (limit === undefined) limit = 9\r\n    return `https://www.pixiv.net/ajax/novel/${novelId}/recommend/init?limit=${limit}&lang=zh`\r\n}\r\nfunction urlNovelsRecommendDetailed(nidList) {\r\n    if (nidList.length >= 9) nidList.length = 9\r\n    return `https://www.pixiv.net/ajax/novel/recommend/novels?${nidList.map(v => `novelIds[]=${v}`).join(\"&\")}`\r\n}\r\n\r\nfunction urlSeriesUrl(seriesId) {\r\n    return `https://www.pixiv.net/novel/series/${seriesId}`\r\n}\r\nfunction urlSeriesDetailed(seriesId) {\r\n    return `https://www.pixiv.net/ajax/novel/series/${seriesId}?lang=zh`\r\n}\r\nfunction urlSeriesNovelsTitles(seriesId) {\r\n    return `https://www.pixiv.net/ajax/novel/series/${seriesId}/content_titles`\r\n}\r\nfunction urlSeriesNovels(seriesId, limit, offset) {\r\n    if (limit > 30) limit = 30\r\n    if (limit < 10) limit = 10\r\n    return `https://www.pixiv.net/ajax/novel/series_content/${seriesId}?limit=${limit}&last_order=${offset}&order_by=asc&lang=zh`\r\n}\r\n\r\nfunction urlUserUrl(userID) {\r\n    return `https://www.pixiv.net/users/${userID}/novels`\r\n}\r\nfunction urlUserDetailed(userID) {\r\n    return `https://www.pixiv.net/ajax/user/${userID}`\r\n}\r\nfunction urlUserWorkLatest(userID) {\r\n    return `https://www.pixiv.net/ajax/user/${userID}/works/latest`\r\n}\r\nfunction urlUserAllWorks(userId) {\r\n    return `https://www.pixiv.net/ajax/user/${userId}/profile/all?lang=zh`\r\n}\r\nfunction urlUserBookmarks(userId) {\r\n    return `https://www.pixiv.net/ajax/user/${userId}/novels/bookmarks?tag=&offset={{(page-1)*30}}&limit=30&rest=show&lang=zh`\r\n}\r\n\r\nfunction urlSearchNovel(novelName, page) {\r\n    return `https://www.pixiv.net/ajax/search/novels/${encodeURI(novelName)}?word=${encodeURI(novelName)}&order=date_d&mode=all&p=${page}&s_mode=s_tag&lang=zh`\r\n}\r\nfunction urlSearchSeries(seriesName, page) {\r\n    return`https://www.pixiv.net/ajax/search/novels/${encodeURI(seriesName)}?word=${encodeURI(seriesName)}&order=date_d&mode=all&p=${page}&s_mode=s_tag&gs=1&lang=zh`\r\n}\r\n// ä¸å®Œå…¨åŒ¹é…ç”¨æˆ·å\r\nfunction urlSearchUser(userName, full) {\r\n    if (full === undefined || full === false) {\r\n        return `https://www.pixiv.net/search/users?nick=${userName}&s_mode=s_usr&nick_mf=1`\r\n    } else {\r\n        return `https://www.pixiv.net/search/users?nick=${userName}&s_mode=s_usr_full&i=1`\r\n    }\r\n}\r\n\r\nfunction urlCoverUrl(url) {\r\n    return `${url}, {\"headers\": {\"Referer\":\"https://www.pixiv.net/\"}}`\r\n}\r\nfunction urlIllustDetailed(illustId) {\r\n    return `https://www.pixiv.net/ajax/illust/${illustId}?lang=zh`\r\n}\r\nfunction urlIllustOriginal(illustId, order) {\r\n    const {java, cache} = this\r\n    if (order <= 1) order = 1\r\n    let url = urlIllustDetailed(illustId)\r\n    let illustOriginal = cacheGetAndSet(cache, url, () => {\r\n        return JSON.parse(java.ajax(url))\r\n    }).body.urls.original\r\n    return urlCoverUrl(illustOriginal.replace(`_p0`, `_p${order - 1}`))\r\n}\r\nfunction urlEmojiUrl(emojiId) {\r\n    return urlCoverUrl(`https://s.pximg.net/common/images/emoji/${emojiId}.png`)\r\n}\r\nfunction urlStampUrl(stampId) {\r\n    return urlCoverUrl(`https://s.pximg.net/common/images/stamp/generated-stamps/${stampId}_s.jpg`)\r\n}\r\n\r\nfunction urlMessageThreadLatest(max) {\r\n    if (max === undefined || max <= 5) max = 5\r\n    return `https://www.pixiv.net/rpc/index.php?mode=latest_message_threads2&num=${max}&lang=zh`\r\n}\r\nfunction urlMessageThreadContents(threadId, max) {\r\n    return `https://www.pixiv.net/rpc/index.php?mode=message_thread_contents&thread_id=${threadId}&num=${max}`\r\n}\r\nfunction urlMessageThreadDetail(threadId) {\r\n    return `https://www.pixiv.net/rpc/index.php?mode=message_thread&thread_id=${threadId}`\r\n}\r\nfunction urlNotification() {\r\n    return `https://www.pixiv.net/ajax/notification&lang=zh`\r\n}\r\n\r\nfunction dateFormat(str) {\r\n    let addZero = function (num) {\r\n        return num < 10 ? '0' + num : num;\r\n    }\r\n    let time = new Date(str);\r\n    let Y = time.getFullYear() + \"å¹´\";\r\n    let M = addZero(time.getMonth() + 1) + \"æœˆ\";\r\n    let D = addZero(time.getDate()) + \"æ—¥\";\r\n    return Y + M + D;\r\n}\r\nfunction timeFormat(str) {\r\n    let addZero = function (num) {\r\n        return num < 10 ? '0' + num : num;\r\n    }\r\n    let time = new Date(str);\r\n    let YY = time.getFullYear()\r\n    let MM = addZero(time.getMonth() + 1)\r\n    let DD = addZero(time.getDate())\r\n    let hh = addZero(time.getHours())\r\n    let mm = addZero(time.getMinutes())\r\n    let ss = addZero(time.getSeconds())\r\n    return `${YY}-${MM}-${DD} ${hh}:${mm}:${ss}`\r\n}\r\nfunction timeTextFormat(text) {\r\n    return `${text.slice(0, 10)} ${text.slice(11, 19)}`\r\n}\r\nfunction sleep(time) {\r\n    let endTime = new Date().getTime() + time\r\n    while(true){\r\n        if (new Date().getTime() > endTime){\r\n            return;\r\n        }\r\n    }\r\n}\r\nfunction sleepToast(text, second) {\r\n    const {java} = this\r\n    java.log(text)\r\n    // java.toast(text)\r\n    java.longToast(text)\r\n    if (second === undefined) second = 0.01\r\n    sleep(1000*second)\r\n}\r\n\r\nfunction updateSource() {\r\n    const {java, source} = this\r\n    java.longToast(\"ğŸ†™ æ›´æ–°ä¹¦æº\\n\\nJsdelivr CDN æ›´æ–°æœ‰å»¶è¿Ÿ\\nGithub æ›´æ–°éœ€ä»£ç†\")\r\n    let onlineSource, comment, sourceName, sourceNameCapitalize, index = 0\r\n    if (source.bookSourceUrl.includes(\"pixiv\")) sourceName = \"pixiv\"\r\n    else if (source.bookSourceUrl.includes(\"furrynovel\")) sourceName = \"linpx\"\r\n    sourceNameCapitalize = sourceName[0].toUpperCase() + sourceName.substring(1)\r\n\r\n    if (source.bookSourceName.includes(\"å¤‡ç”¨\")) index = 1\r\n    else if (source.bookSourceName.includes(\"æ¼«ç”»\")) index = 2\r\n    if (source.bookSourceUrl.includes(\"furrynovel.com\")) {\r\n        sourceNameCapitalize = \"FurryNovel\"\r\n        index = 1\r\n    }\r\n\r\n    try {\r\n        let updateUrl = `https://cdn.jsdelivr.net/gh/windyhusky/PixivSource@main/${sourceName}.json`\r\n        onlineSource = JSON.parse(java.get(updateUrl,{'User-Agent': 'Mozilla/5.0 (Linux; Android 14)','X-Requested-With': 'XMLHttpRequest'}).body())[index]\r\n    } catch (e) {\r\n        try {\r\n            let updateUrl = `https://raw.githubusercontent.com/windyhusky/PixivSource/main/${sourceName}.json`\r\n            onlineSource = JSON.parse(java.get(updateUrl,{'User-Agent': 'Mozilla/5.0 (Linux; Android 14)','X-Requested-With': 'XMLHttpRequest'}).body())[index]\r\n        } catch (e) {\r\n            onlineSource = {lastUpdateTime: new Date().getTime(), bookSourceComment: source.bookSourceComment}\r\n        }\r\n    }\r\n    comment = onlineSource.bookSourceComment.split(\"\\n\")\r\n    // onlineSource = source\r\n    // comment = source.bookSourceComment.split(\"\\n\")\r\n\r\n    let htm = `\r\n<!DOCTYPE html>\r\n<html lang=\"zh-CN\">\r\n<head>\r\n    <meta charset=\"UTF-8\">\r\n    <meta name=\"viewport\" content=\"width=device-width, initial-scale=1.0\">\r\n    <title>æ›´æ–° ${source.bookSourceName} ä¹¦æº</title>\r\n    <style> \r\n    table { text-align: center; margin: 0 auto; } .ann { display: flex; justify-content: center; align-items: center; height: 5vh; } \r\n    button { background-color: rgb(76, 175, 80); color: white; border: none; border-radius: 4px; height: 6vh; width: 30vw; overflow: hidden; } \r\n    button span { cursor: pointer; display: inline-block; position: relative; transition: 0.4s; } \r\n    button span:after { content: '>'; position: absolute; opacity: 0; top: 0; right: 30px; transition: 0.2s; } \r\n    button:active span { padding-right: 20px; } \r\n    button:active span:after { opacity: 1; right: -40px; }\r\n    </style>\r\n</head>\r\n\r\n<body>\r\n    <table border=\"1\" cellspacing=\"0\">\r\n        <th colspan=\"2\"> ${source.bookSourceName} ä¹¦æº <a href=\"https://github.com/windyhusky/PixivSource/blob/main/doc/${sourceNameCapitalize}.md\">ğŸ”° ä½¿ç”¨æŒ‡å—</a></th>\r\n        <tr>\r\n            <td>â˜ï¸ è¿œç¨‹ç‰ˆæœ¬ï¼š${onlineSource.bookSourceComment.split(\"\\n\")[2].replace(\"ä¹¦æºç‰ˆæœ¬ï¼š\", \"\")}</td>\r\n            <td>ğŸ“† æ›´æ–°ï¼š${timeFormat(onlineSource.lastUpdateTime)}</td>\r\n        </tr>\r\n        <tr>\r\n            <td>ğŸ“¥ æœ¬åœ°ç‰ˆæœ¬ï¼š${source.bookSourceComment.split(\"\\n\")[2].replace(\"ä¹¦æºç‰ˆæœ¬ï¼š\", \"\")}</td>\r\n            <td>ğŸ“† æ›´æ–°ï¼š${timeFormat(source.lastUpdateTime)}</td>\r\n        </tr> \r\n        <tr><td colspan=\"2\" style=\"text-align: left;\">${comment.slice(3, 10).join(\"<br>\")}</td></tr>\r\n        <tr><td colspan=\"2\" style=\"text-align: left;\">${comment.slice(comment.length-2, comment.length).join(\"<br>\")}</td></tr>\r\n    </table>\r\n    \r\n    <table border=\"0\" cellspacing=\"20\">\r\n        <th colspan=\"2\"> æ›´æ–° ${source.bookSourceName} ä¹¦æº </th>\r\n        <tr><td><div class=\"ann\">\r\n            <a href=\"legado://import/importonline?src=https://cdn.jsdelivr.net/gh/windyhusky/PixivSource@main/${sourceName}.json\">\r\n            <button><span>æ›´æ–°ä¹¦æº<br>(Jsdelivr CDN)</span></button>\r\n            </a></div></td>\r\n            \r\n            <td><div class=\"ann\">\r\n            <a href=\"legado://import/importonline?src=https://cdn.jsdelivr.net/gh/windyhusky/PixivSource@main/btsrk.json\">\r\n            <button><span>æ›´æ–°è®¢é˜…<br>(Jsdelivr CDN)</span></button>\r\n            </a></div></td>\r\n        </tr>\r\n        \r\n        <tr><td><div class=\"ann\">\r\n            <a href=\"legado://import/importonline?src=https://raw.githubusercontent.com/windyhusky/PixivSource/main/${sourceName}.json\">\r\n            <button><span>ä¹¦æºé“¾æ¥<br>(GitHub)</span></button>\r\n            </a></div></td>\r\n            \r\n            <td><div class=\"ann\">\r\n            <a href=\"legado://import/importonline?src=https://raw.githubusercontent.com/windyhusky/PixivSource/main/btsrk.json\">\r\n            <button><span>è®¢é˜…é“¾æ¥<br>(GitHub)</span></button>\r\n            </a></div></td>\r\n        </tr>\r\n        \r\n        <tr><td><div class=\"ann\">\r\n            <a href=\"legado://import/importonline?src=https://codeberg.org/DowneyRem/PixivSource/raw/branch/main/${sourceName}.json\">\r\n            <button><span>å¤‡ç”¨ä¹¦æºé“¾æ¥<br>(Codeberg)</span></button>\r\n            </a></div></td>\r\n            \r\n            <td><div class=\"ann\">\r\n            <a href=\"legado://import/importonline?src=https://codeberg.org/DowneyRem/PixivSource/raw/branch/main/btsrk.json\">\r\n            <button><span>å¤‡ç”¨è®¢é˜…é“¾æ¥<br>(Codeberg)</span></button>\r\n            </a></div></td>\r\n        </tr>\r\n    </table>\r\n</body>\r\n</html>`;\r\n    java.startBrowser(`data:text/html;charset=utf-8;base64, ${java.base64Encode(htm)}`, 'æ›´æ–°ä¹¦æº');\r\n    return []\r\n}",
        "lastUpdateTime": "1762442228251",
        "loginCheckJs": "var util = {}\r\n\r\nfunction objStringify(obj) {\r\n    return JSON.stringify(obj, (n, v) => {\r\n        if (typeof v == \"function\")\r\n            return v.toString();\r\n        return v;\r\n    });\r\n}\r\n\r\nfunction isBackupSource() {\r\n    let isBackupSource = source.bookSourceName.includes(\"å¤‡ç”¨\")\r\n    cache.put(\"isBackupSource\", isBackupSource)\r\n    return isBackupSource\r\n}\r\n// æ£€æµ‹ æºé˜…\r\n// å¯ç”¨ java.ajax() ä¸å¯ç”¨ java.webview() java.ajaxAll()\r\n// å¯ç”¨ java.getCookie() cache.put() cache.get() é»˜è®¤å€¼ä¸º undefined\r\n// å¯ç”¨ java.startBrowser() ä¸å¯ç”¨ java.startBrowserAwaitAwait\r\n// å¯ç”¨ source.bookSourceName source.getVariable() source.setVariable()ç­‰\r\n// java.getUserAgent() java.getWebViewUA() ç›®å‰è¿”å›å†…å®¹ç›¸åŒ\r\nfunction isSourceRead() {\r\n    let isSourceReadStatus = java.getUserAgent() === java.getWebViewUA()\r\n    cache.put(\"isSourceRead\", isSourceReadStatus)\r\n    return isSourceReadStatus\r\n}\r\n\r\nfunction publicFunc() {\r\n    let u = {}, settings = {}\r\n    // è¾“å‡ºä¹¦æºä¿¡æ¯\r\n    java.log(`ğŸ…¿ï¸ ${source.bookSourceComment.split(\"\\n\")[0]}`)\r\n    java.log(`ğŸ“Œ ${source.bookSourceComment.split(\"\\n\")[2]}`)\r\n    if (isSourceRead()) {\r\n        java.log(`ğŸ“† æ›´æ–°æ—¶é—´ï¼š${java.timeFormat(source.lastUpdateTime)}`)\r\n        java.log(\"ğŸ“± è½¯ä»¶å¹³å°ï¼šğŸ æºé˜… SourceRead\")\r\n    } else {\r\n        java.log(`ğŸ“† æ›´æ–°æ—¶é—´ï¼š${timeFormat(source.lastUpdateTime)}`)\r\n        java.log(\"ğŸ“± è½¯ä»¶å¹³å°ï¼šğŸ¤– å¼€æºé˜…è¯» Leagdo\")\r\n    }\r\n\r\n    // è·å–è®¾ç½®ï¼Œå¤‡ç”¨ä¹¦æºä½¿ç”¨æ—§ç‰ˆè®¾ç½®ï¼Œä¹¦æºä»ç¼“å­˜è·å–è®¾ç½®\r\n    if (isBackupSource()) {\r\n        settings = JSON.parse(String(source.variableComment).match(RegExp(/{([\\s\\S]*?)}/gm)))\r\n    } else {\r\n        // cache.delete(\"pixivSettings\")\r\n        settings = getFromCache(\"pixivSettings\")\r\n    }\r\n    if (settings !== null) {\r\n        java.log(\"âš™ï¸ ä½¿ç”¨è‡ªå®šä¹‰è®¾ç½®\")\r\n    } else {\r\n        settings = {}\r\n        settings.SEARCH_AUTHOR = true       // æœç´¢ï¼šé»˜è®¤æœç´¢ä½œè€…åç§°\r\n        settings.CONVERT_CHINESE = true     // æœç´¢ï¼šæœç´¢æ—¶è¿›è¡Œç¹ç®€è½¬æ¢\r\n        settings.MORE_INFORMATION = false   // è¯¦æƒ…ï¼šä¹¦ç±ç®€ä»‹æ˜¾ç¤ºæ›´å¤šä¿¡æ¯\r\n        settings.SHOW_UPDATE_TIME = true    // ç›®å½•ï¼šæ˜¾ç¤ºæ›´æ–°æ—¶é—´ï¼Œä½†ä¼šå¢åŠ å°‘è®¸è¯·æ±‚\r\n        settings.SHOW_ORIGINAL_LINK = true  // ç›®å½•ï¼šæ˜¾ç¤ºåŸå§‹é“¾æ¥ï¼Œä½†ä¼šå¢åŠ å¤§é‡è¯·æ±‚\r\n        settings.REPLACE_TITLE_MARKS = true // æ­£æ–‡ï¼šæ³¨éŸ³å†…å®¹ä¸ºæ±‰å­—æ—¶ï¼Œæ›¿æ¢ä¸ºä¹¦åå·\r\n        settings.SHOW_CAPTIONS = true       // æ­£æ–‡ï¼šç« é¦–æ˜¾ç¤ºæè¿°\r\n        settings.SHOW_COMMENTS = true       // æ­£æ–‡ï¼šç« å°¾æ˜¾ç¤ºè¯„è®º\r\n        settings.FAST  = false              // å…¨å±€ï¼šå¿«é€Ÿæ¨¡å¼\r\n        settings.DEBUG = false              // å…¨å±€ï¼šè°ƒè¯•æ¨¡å¼\r\n        java.log(\"âš™ï¸ ä½¿ç”¨é»˜è®¤è®¾ç½®ï¼ˆæ— è‡ªå®šä¹‰è®¾ç½® æˆ– è‡ªå®šä¹‰è®¾ç½®æœ‰è¯¯ï¼‰\")\r\n    }\r\n    if (settings.FAST === true) {\r\n        settings.SEARCH_AUTHOR = false        // æœç´¢ï¼šé»˜è®¤æœç´¢ä½œè€…åç§°\r\n        settings.CONVERT_CHINESE = false      // æœç´¢ï¼šç¹ç®€é€šæœ\r\n        settings.SHOW_UPDATE_TIME = false     // ç›®å½•ï¼šæ˜¾ç¤ºç« èŠ‚æ›´æ–°æ—¶é—´\r\n        settings.SHOW_ORIGINAL_LINK = false   // ç›®å½•ï¼šæ˜¾ç¤ºç« èŠ‚æºé“¾æ¥\r\n        settings.SHOW_COMMENTS = false        // æ­£æ–‡ï¼šæ˜¾ç¤ºè¯„è®º\r\n    } else {\r\n        settings.SEARCH_AUTHOR = true        // æœç´¢ï¼šé»˜è®¤æœç´¢ä½œè€…åç§°\r\n    }\r\n\r\n    settings.IS_LEGADO = !isSourceRead()\r\n    settings.IS_SOURCE_READ = isSourceRead()\r\n    settings.IS_BACKUP_SOURCE = isBackupSource()\r\n    u.settings = settings\r\n    putInCache(\"pixivSettings\", settings)  // è®¾ç½®å†™å…¥ç¼“å­˜\r\n\r\n    u.debugFunc = (func) => {\r\n        if (util.settings.DEBUG === true) {\r\n            func()\r\n        }\r\n    }\r\n\r\n    u.checkStatus = function(status) {\r\n        if (status === true) return \"âœ… å·²\"\r\n        else if (status === false) return \"âŒ æœª\"\r\n        else if (status === undefined) return \"ğŸˆšï¸ æ— æ•°æ®ï¼š\"\r\n    }\r\n\r\n    u.login = function() {\r\n        let resp = java.startBrowserAwait(`https://accounts.pixiv.net/login,\r\n    {\"headers\": {\"User-Agent\": \"${java.getWebViewUA()}\"}}`, 'ç™»å½•è´¦å·', false)\r\n        if (resp.code() === 200) {\r\n            this.getCsrfToken(); this.getCookie()\r\n        } else {\r\n            java.log(resp.code()); sleepToast(\"âš ï¸ ç™»å½•å¤±è´¥\")\r\n        }\r\n    }\r\n\r\n    u.logout = function() {\r\n        this.removeCookie()\r\n        java.startBrowser(\"https://www.pixiv.net/logout.php\", \"é€€å‡ºè´¦å·\")\r\n        this.removeCookie()\r\n        sleepToast(`âœ… å·²é€€å‡ºå½“å‰è´¦å·\\n\\né€€å‡ºåè¯·ç‚¹å‡»å³ä¸Šè§’çš„ âœ”ï¸ é€€å‡º\\n\\nç™»å½•è¯·ç‚¹å‡»ã€ç™»å½•è´¦å·ã€‘è¿›è¡Œç™»å½•`)\r\n    }\r\n\r\n    u.getCookie = function() {\r\n        let pixivCookie = String(java.getCookie(\"https://www.pixiv.net/\", null))\r\n        if (isLogin()) cache.put(\"pixivCookie\", pixivCookie, 60*60)  // ç¼“å­˜1h\r\n    }\r\n\r\n    u.removeCookie = function() {\r\n        cookie.removeCookie('https://www.pixiv.net')\r\n        cookie.removeCookie('https://accounts.pixiv.net')\r\n        cookie.removeCookie('https://accounts.google.com')\r\n        cookie.removeCookie('https://api.weibo.com')\r\n        cache.delete(\"pixivCookie\")\r\n        cache.delete(\"pixiv:uid\")\r\n        cache.delete(\"csfrToken\")  // ä¸ç™»å½•è®¾å¤‡æœ‰å…³\r\n        cache.delete(\"headers\")\r\n    }\r\n\r\n    // è·å– Csrf Tokenï¼Œä»¥ä¾¿è¿›è¡Œæ”¶è—ç­‰è¯·æ±‚\r\n    // è·å–æ–¹æ³•æ¥è‡ªè„šæœ¬ Pixiv Previewer\r\n    // https://github.com/Ocrosoft/PixivPreviewer\r\n    // https://greasyfork.org/zh-CN/scripts/30766-pixiv-previewer/code\r\n    u.getCsrfToken = function() {\r\n        let csfrToken = cache.get(\"csfrToken\")\r\n        if (!csfrToken) {\r\n            let html = java.webView(null, \"https://www.pixiv.net/\", null)\r\n            try {\r\n                csfrToken = html.match(/token\\\\\":\\\\\"([a-z0-9]{32})/)[1]\r\n                cache.put(\"csfrToken\", csfrToken)  // ä¸ç™»å½•è®¾å¤‡æœ‰å…³ï¼Œæ— æ³•å­˜å‚¨ nul\r\n            } catch (e) {\r\n                csfrToken = null\r\n                cache.delete(\"csfrToken\")  // ä¸ç™»å½•è®¾å¤‡æœ‰å…³ï¼Œæ— æ³•å­˜å‚¨ nul\r\n                // sleepToast(\"âš ï¸ æœªç™»å½•è´¦å·(csfrToken)\")\r\n            }\r\n            java.log(`csfrToken:\\n${csfrToken}`)\r\n        }\r\n        return csfrToken\r\n    }\r\n\r\n    // å°†å¤šä¸ªé•¿ç¯‡å°è¯´è§£æä¸ºä¸€æœ¬ä¹¦\r\n    u.combineNovels = function(novels) {\r\n        return novels.filter(novel => {\r\n            // å•æœ¬ç›´æ¥è§£æä¸ºä¸€æœ¬ä¹¦\r\n            if (novel.seriesId === undefined || novel.seriesId === null) {\r\n                return true\r\n            }\r\n            // é›†åˆä¸­æ²¡æœ‰è¯¥ç³»åˆ—è§£æä¸ºä¸€æœ¬ä¹¦\r\n            if (!seriesSet.has(novel.seriesId)) {\r\n                seriesSet.add(novel.seriesId)\r\n                return true\r\n            }\r\n            return false\r\n        })\r\n    }\r\n\r\n    // å¤„ç† novels åˆ—è¡¨\r\n    u.handNovels = function(novels) {\r\n        novels.forEach(novel => {\r\n            // novel.id = novel.id\r\n            // novel.title = novel.title\r\n            // novel.userName = novel.userName\r\n            // novel.userId = novel.userId\r\n            // novel.tags = novel.tags\r\n            cache.put(`${novel.userName}`, novel.userId)  // åŠ å…¥ç¼“å­˜ï¼Œä¾¿äºæœç´¢ä½œè€…\r\n            if (novel.tags === undefined || novel.tags === null) {\r\n                novel.tags = []\r\n            }\r\n            // æœç´¢å•ç¯‡\r\n            if (novel.isOneshot === undefined) {\r\n                // novel.seriesId = novel.seriesId\r\n                // novel.seriesTitle = novel.seriesTitle\r\n                // novel.textCount = novel.textCount\r\n                // novel.description = novel.description\r\n                novel.coverUrl = novel.url\r\n                // novel.createDate = novel.createDate\r\n                // novel.updateDate = novel.updateDate\r\n            }\r\n\r\n            // æœç´¢ç³»åˆ—\r\n            if (novel.isOneshot !== undefined) {\r\n                if (novel.isOneshot === true) {\r\n                    novel.seriesId = undefined\r\n                    novel.id = novel.novelId  // è·å–çœŸæ­£çš„ novelId\r\n                    novel.seriesTitle = undefined\r\n                } else {\r\n                    novel.seriesId = novel.id\r\n                    novel.id = novel.novelId = novel.latestEpisodeId  // è·å–çœŸæ­£çš„ novelId\r\n                    novel.seriesTitle = novel.title\r\n                    // novel.isWatched = novel.isWatched  // æœç´¢ç³»åˆ—å¯è·å–\r\n                }\r\n                novel.textCount = novel.textLength\r\n                novel.description = novel.caption\r\n                novel.coverUrl = novel.cover.urls[\"480mw\"]\r\n                novel.createDate = novel.createDateTime\r\n                novel.updateDate = novel.updateDateTime\r\n            }\r\n\r\n            // å•ç¯‡æ­£æ–‡è¯¦æƒ…é¡µ\r\n            if (novel.content) {\r\n                novel.novelId = novel.id\r\n                novel.tags = novel.tags.tags.map(item => item.tag)\r\n                novel.textCount = novel.userNovels[`${novel.id}`].textCount\r\n                // novel.latestChapter = novel.title\r\n                // novel.description = novel.description\r\n                novel.coverUrl = novel.userNovels[`${novel.id}`].url\r\n                // novel.createDate = novel.createDate\r\n                novel.updateDate = novel.uploadDate\r\n\r\n                if (novel.seriesNavData) {\r\n                    novel.seriesId = novel.seriesNavData.seriesId\r\n                    novel.seriesTitle = novel.seriesNavData.title\r\n                }\r\n            }\r\n\r\n            // ç³»åˆ—è¯¦æƒ…\r\n            if (novel.firstNovelId) {\r\n                novel.seriesId = novel.id\r\n                novel.id = novel.novelId = novel.firstNovelId\r\n                novel.seriesTitle = novel.title\r\n                novel.coverUrl = novel.cover.urls[\"480mw\"]\r\n                // novel.isWatched = novel.isWatched  // æœç´¢ç³»åˆ—å¯è·å–\r\n            }\r\n\r\n            // å•ç¯‡åŠ æ›´å¤šä¿¡æ¯\r\n            if (!novel.seriesId) {\r\n                novel.tags.unshift(\"å•æœ¬\")\r\n                novel.latestChapter = novel.title\r\n                novel.detailedUrl = urlNovelDetailed(novel.id)\r\n                novel.total = 1\r\n                if (novel.bookmarkData) {\r\n                    novel.isBookmark = true\r\n                } else {\r\n                    novel.isBookmark = false\r\n                }\r\n            }\r\n            // ç³»åˆ—æ·»åŠ æ›´å¤šä¿¡æ¯\r\n            if (novel.seriesId) {\r\n                let series = getAjaxJson(urlSeriesDetailed(novel.seriesId)).body\r\n                novel.id = series.firstNovelId\r\n                novel.title = series.title\r\n                novel.tags = novel.tags.concat(series.tags)\r\n                novel.tags.unshift(\"é•¿ç¯‡\")\r\n                novel.textCount = series.publishedTotalCharacterCount\r\n                novel.description = series.caption\r\n                novel.coverUrl = series.cover.urls[\"480mw\"]\r\n                novel.detailedUrl = urlSeriesDetailed(novel.seriesId)\r\n                novel.createDate = series.createDate\r\n                novel.updateDate = series.updateDate\r\n                novel.total = series.publishedContentCount\r\n                novel.isWatched = series.isWatched\r\n\r\n                // å‘é€è¯·æ±‚è·å–ç¬¬ä¸€ç«  è·å–æ ‡ç­¾ä¸ç®€ä»‹\r\n                let firstNovel = {}\r\n                try {\r\n                    firstNovel = getAjaxJson(urlNovelDetailed(series.firstNovelId)).body\r\n                    novel.tags = novel.tags.concat(firstNovel.tags.tags.map(item => item.tag))\r\n                    if (firstNovel.bookmarkData) {\r\n                        firstNovel.isBookmark = true\r\n                    }\r\n                } catch (e) {  // é˜²æ­¢ç³»åˆ—é¦–ç¯‡æ— æƒé™è·å–\r\n                    try {\r\n                        firstNovel = getAjaxJson(urlSeriesNovels(novel.seriesId, 30, 0)).body.thumbnails.novel[0]\r\n                        novel.id = novel.firstNovelId = firstNovel.id\r\n                        novel.tags = novel.tags.concat(firstNovel.tags)\r\n                    } catch (e) { // é˜²æ­¢ç³»åˆ—é¦–ç¯‡æ— æƒé™è·å–\r\n                        firstNovel = {}\r\n                        firstNovel.description = \"\"\r\n                    }\r\n                }\r\n                novel.tags.unshift(\"é•¿ç¯‡\")\r\n                if (novel.description === \"\") {\r\n                    novel.description = firstNovel.description\r\n                }\r\n            }\r\n        })\r\n        util.debugFunc(() => {\r\n            java.log(`å¤„ç†å°è¯´å®Œæˆ`)\r\n        })\r\n        return novels\r\n    }\r\n\r\n    // å°è¯´ä¿¡æ¯æ ¼å¼åŒ–\r\n    u.formatNovels = function(novels) {\r\n        novels.forEach(novel => {\r\n            if (novel.title) novel.title = novel.title.trim()\r\n            if (!novel.userName.startsWith(\"@\")) novel.userName = `@${novel.userName}`\r\n            novel.coverUrl = urlCoverUrl(novel.coverUrl)\r\n            novel.readingTime = `${novel.readingTime / 60} åˆ†é’Ÿ`\r\n            novel.createDate = dateFormat(novel.createDate)\r\n            novel.updateDate = dateFormat(novel.updateDate)\r\n\r\n            novel.tags2 = []\r\n            for (let i in novel.tags) {\r\n                let tag = novel.tags[i]\r\n                if (tag.includes(\"/\")) {\r\n                    let tags = tag.split(\"/\")\r\n                    novel.tags2 = novel.tags2.concat(tags)\r\n                } else {\r\n                    novel.tags2.push(tag)\r\n                }\r\n            }\r\n            novel.tags = Array.from(new Set(novel.tags2))\r\n            novel.tags = novel.tags.join(\",\")\r\n            if (novel.seriesId) {\r\n                collectMsg = `è¿½æ›´ï¼š${util.checkStatus(novel.isWatched)}è¿½æ›´ç³»åˆ—`\r\n            } else {\r\n                collectMsg = `æ”¶è—ï¼š${util.checkStatus(novel.isBookmark)}åŠ å…¥æ”¶è—`\r\n            }\r\n\r\n            if (util.settings.MORE_INFORMATION) {\r\n                novel.description = `\\nç™»å½•ï¼š${util.checkStatus(isLogin())}ç™»å½•è´¦å·\r\n                ${collectMsg}\\nä¹¦åï¼š${novel.title}\\nä½œè€…ï¼š${novel.userName}\r\n                æ ‡ç­¾ï¼š${novel.tags}\\nâ¬†ï¸ ä¸Šä¼ ï¼š${novel.createDate}\r\n                æ›´æ–°ï¼š${novel.updateDate}\\nç®€ä»‹ï¼š${novel.description}`\r\n            } else {\r\n                novel.description = `\\nç™»å½•ï¼š${util.checkStatus(isLogin())}ç™»å½•è´¦å·\r\n                ${collectMsg}\\nä¸Šä¼ ï¼š${novel.createDate}\\næ›´æ–°ï¼š${novel.updateDate}\r\n                ç®€ä»‹ï¼š${novel.description}`\r\n            }\r\n        })\r\n        return novels\r\n    }\r\n\r\n    // æ­£æ–‡ï¼Œè¯¦æƒ…ï¼Œæœç´¢ï¼šä»ç½‘å€è·å–idï¼Œè¿”å›å•ç¯‡å°è¯´ resï¼Œç³»åˆ—è¿”å›é¦–ç¯‡å°è¯´ res\r\n    // pixiv é»˜è®¤åˆ†äº«ä¿¡æ¯ä¸­æœ‰#å·ï¼Œä¸ä¼šè¢«è¯†åˆ«æˆé“¾æ¥ï¼Œæ— æ³•ä½¿ç”¨æ·»åŠ ç½‘å€\r\n    u.getNovelRes = function(result) {\r\n        let novelId = 0, res = {\"body\": {}}\r\n        let isJson = isJsonString(result)\r\n        let isHtml = isHtmlString(result)\r\n\r\n        if (!isJson && isHtml) {\r\n            let id = baseUrl.match(new RegExp(\"\\\\d+\"))[0]\r\n            let pattern = \"(https?://)?(www\\\\.)?pixiv\\\\.net(/ajax)?/users?/\\\\d+\"\r\n            let isAuthor = baseUrl.match(new RegExp(pattern))\r\n            if (isAuthor) {\r\n                java.log(`ä½œè€…IDï¼š${id}`)\r\n                novelId = Object.keys(getAjaxJson(urlUserWorkLatest(id)).body.novels).reverse()[0]\r\n            }\r\n\r\n            pattern = \"(https?://)?(www\\\\.)?pixiv\\\\.net/novel/series/\\\\d+\"\r\n            let isSeries = baseUrl.match(new RegExp(pattern))\r\n            if (isSeries) {\r\n                java.log(`ç³»åˆ—IDï¼š${id}`)\r\n                try {\r\n                    novelId = getAjaxJson(urlSeriesDetailed(id)).body.firstNovelId\r\n                } catch (e) {\r\n                    novelId = getAjaxJson(urlSeriesNovels(id, 30, 0)).body.thumbnails.novel[0].id\r\n                }\r\n            } else {\r\n                let pattern = \"(https?://)?(www\\\\.)?pixiv\\\\.net/novel/(show\\\\.php\\\\?id=)?\\\\d+\"\r\n                let isNovel = baseUrl.match(new RegExp(pattern))\r\n                if (isNovel) {\r\n                    novelId = id\r\n                }\r\n            }\r\n        }\r\n        if (isJson) {\r\n            res = JSON.parse(result)\r\n        }\r\n\r\n        if (novelId) {\r\n            java.log(`åŒ¹é…å°è¯´IDï¼š${novelId}`)\r\n            res = getAjaxJson(urlNovelDetailed(novelId))\r\n        }\r\n        if (res.error === true) {\r\n            java.log(`æ— æ³•ä» Pixiv è·å–å½“å‰å°è¯´`)\r\n            java.log(JSON.stringify(res))\r\n        }\r\n        return res.body\r\n    }\r\n\r\n    // ç›®å½•ï¼šä»ç½‘å€è·å–idï¼Œå°½å¯èƒ½è¿”å›ç³»åˆ— resï¼Œå•ç¯‡å°è¯´è¿”å›å°è¯´ res\r\n    u.getNovelResSeries = function(result) {\r\n        let seriesId = 0, res = {\"body\": {}}\r\n        let isJson = isJsonString(result)\r\n        let isHtml = isHtmlString(result)\r\n\r\n        if (!isJson && isHtml) {\r\n            let id = baseUrl.match(new RegExp(\"\\\\d+\"))[0]\r\n            let pattern = \"(https?://)?(www\\\\.)?pixiv\\\\.net/novel/series/\\\\d+\"\r\n            let isSeries = baseUrl.match(new RegExp(pattern))\r\n            if (isSeries) {\r\n                seriesId = id\r\n            } else {\r\n                let pattern = \"(https?://)?(www\\\\.)?pixiv\\\\.net/novel/(show\\\\.php\\\\?id=)?\\\\d+\"\r\n                let isNovel = baseUrl.match(new RegExp(pattern))\r\n                if (isNovel) {\r\n                    java.log(`åŒ¹é…å°è¯´IDï¼š${id}`)\r\n                    res = getAjaxJson(urlNovelDetailed(id))\r\n                }\r\n            }\r\n        }\r\n        if (isJson) {\r\n            res = JSON.parse(result)\r\n        }\r\n\r\n        if (res.body && res.body.seriesNavData) {\r\n            seriesId = res.body.seriesNavData.seriesId\r\n        }\r\n        if (seriesId) {\r\n            java.log(`ç³»åˆ—IDï¼š${seriesId}`)\r\n            res = getAjaxJson(urlSeriesDetailed(seriesId))\r\n        }\r\n        if (res.error === true) {\r\n            java.log(`æ— æ³•ä» Pixiv è·å–å½“å‰å°è¯´`)\r\n            java.log(JSON.stringify(res))\r\n        }\r\n        return res.body\r\n    }\r\n\r\n    util = u\r\n    java.put(\"util\", objStringify(u))\r\n}\r\n\r\nfunction checkMessageThread(checkTimes) {\r\n    if (checkTimes === undefined) {\r\n        checkTimes = Number(cache.get(\"checkTimes\"))\r\n    }\r\n    if (checkTimes === 0 && isLogin()) {\r\n        let latestMsg = getAjaxJson(urlMessageThreadLatest(5))\r\n        if (latestMsg.error === true) {\r\n            java.log(JSON.stringify(latestMsg))\r\n        } else if (latestMsg.body.total >= 1) {\r\n            let msg = latestMsg.body.message_threads.filter(item => item.thread_name === \"pixiväº‹å‹™å±€\")[0]\r\n            if (msg && new Date().getTime()- 1000*msg.modified_at <= 3*24*60*60*1000) { // 3å¤©å†…è¿›è¡Œæç¤º\r\n                sleepToast(`æ‚¨äº ${timeFormat(1000*msg.modified_at)} è§¦å‘ Pixiv ã€è¿‡åº¦è®¿é—®ã€‘ï¼Œè¯·ä¿®æ”¹å¯†ç å¹¶é‡æ–°ç™»å½•ã€‚\\nå¦‚å·²ä¿®æ”¹è¯·å¿½ç•¥`, 3)\r\n                sleepToast(`${msg.latest_content}`, 5)\r\n                java.startBrowser(\"https://accounts.pixiv.net/password/change\",'ä¿®æ”¹å¯†ç ')\r\n            }\r\n        }\r\n    }\r\n    cache.put(\"checkTimes\", checkTimes + 1, 4*60*60)  // ç¼“å­˜4hï¼Œæ¯4hæé†’ä¸€æ¬¡\r\n    // cache.put(\"checkTimes\", checkTimes + 1, 60)  // æµ‹è¯•ç”¨ï¼Œç¼“å­˜60sï¼Œæ¯åˆ†é’Ÿæé†’ä¸€æ¬¡\r\n    // java.log(checkTimes + 1)\r\n}\r\n\r\n// è·å–è¯·æ±‚çš„user idæ–¹ä¾¿å…¶ä»–ajaxè¯·æ±‚æ„é€ \r\nfunction getPixivUid() {\r\n    let uid = cache.get(\"pixiv:uid\")\r\n    if (!uid || String(uid) === \"null\") {\r\n        let html = java.webView(null, \"https://www.pixiv.net/\", null)\r\n        try {\r\n            uid = html.match(/user_id:'(\\d+)'/)[1]\r\n        } catch (e) {\r\n            uid = null\r\n        }\r\n        cache.put(\"pixiv:uid\", String(uid))\r\n    }\r\n}\r\n\r\npublicFunc()\r\nif (result.code() === 200) {\r\n    getPixivUid(); util.getCsrfToken()\r\n    if (!util.FAST) checkMessageThread()   // æ£€æµ‹è¿‡åº¦è®¿é—®\r\n}\r\njava.getStrResponse(null, null)",
        "loginUi": "",
        "loginUrl": "",
        "respondTime": 180000,
        "ruleBookInfo": {
            "author": "userName",
            "canReName": "true",
            "coverUrl": "coverUrl",
            "init": "@js:\n@js:\r\nvar util = objParse(String(java.get(\"util\")))\r\n\r\nfunction objParse(obj) {\r\n    return JSON.parse(obj, (n, v) => {\r\n        if (typeof v == \"string\" && v.match(\"()\")) {\r\n            return eval(`(${v})`)\r\n        }\r\n        return v;\r\n    })\r\n}\r\n\r\nfunction novelHandler(novel){\r\n    novel = util.formatNovels(util.handNovels([novel]))[0]\r\n    if (novel.seriesId === undefined || novel.seriesId === null) {\r\n        book.bookUrl = novel.detailedUrl = urlNovelUrl(novel.id)\r\n        book.tocUrl = novel.catalogUrl = urlNovelDetailed(novel.id)\r\n    } else {\r\n        book.bookUrl = novel.detailedUrl = urlSeriesUrl(novel.seriesId)\r\n        book.tocUrl = novel.catalogUrl = urlSeriesDetailed(novel.seriesId)\r\n    }\r\n    return novel\r\n}\r\n\r\n(() => {\r\n    return novelHandler(util.getNovelRes(result))\r\n})()",
            "intro": "description",
            "kind": "tags",
            "lastChapter": "latestChapter",
            "name": "title",
            "tocUrl": "catalogUrl",
            "wordCount": "textCount"
        },
        "ruleContent": {
            "content": "@js:\n@js:\r\nvar util = objParse(String(java.get(\"util\")))\r\nlet emoji = {\r\n    \"normal\": 101, \"surprise\": 102, \"series\": 103, \"heaven\": 104, \"happy\": 105,\r\n    \"excited\": 106, \"sing\": 107, \"cry\": 108, \"normal2\": 201, \"shame2\": 202,\r\n    \"love2\": 203, \"interesting2\": 204, \"blush2\": 205, \"fire2\": 206, \"angry2\": 207,\r\n    \"shine2\": 208, \"panic2\": 209, \"normal3\": 301, \"satisfaction3\": 302, \"surprise3\": 303,\r\n    \"smile3\": 304, \"shock3\": 305, \"gaze3\": 306, \"wink3\": 307, \"happy3\": 308,\r\n    \"excited3\": 309, \"love3\": 310, \"normal4\": 401, \"surprise4\": 402, \"series4\": 403,\r\n    \"love4\": 404, \"shine4\": 405, \"sweet4\": 406, \"shame4\": 407, \"sleep4\": 408,\r\n    \"heart\": 501, \"teardrop\": 502, \"star\": 503\r\n}\r\n\r\nfunction objParse(obj) {\r\n    return JSON.parse(obj, (n, v) => {\r\n        if (typeof v == \"string\" && v.match(\"()\")) {\r\n            return eval(`(${v})`)\r\n        }\r\n        return v;\r\n    })\r\n}\r\n\r\nfunction getContent(res) {\r\n    let content = String(res.content)\r\n    // let content = \"undefined\"\r\n    if (content.includes(\"undefined\")) {\r\n        return checkContent()\r\n    }\r\n\r\n    // åœ¨æ­£æ–‡å†…éƒ¨æ·»åŠ å°è¯´æè¿°\r\n    if (util.settings.SHOW_CAPTIONS && res.description !== \"\") {\r\n        content = res.description + \"\\n\" + \"â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”\\n\".repeat(2) + content\r\n    }\r\n\r\n    // è·å– [uploadedimage:] çš„å›¾ç‰‡é“¾æ¥\r\n    let hasEmbeddedImages = res.textEmbeddedImages !== undefined && res.textEmbeddedImages !== null\r\n    if (hasEmbeddedImages) {\r\n        Object.keys(res.textEmbeddedImages).forEach((key) => {\r\n            content = content.replace(`[uploadedimage:${key}]`, `<img src=\"${urlCoverUrl(res.textEmbeddedImages[key].urls.original)}\">`)\r\n        })\r\n    }\r\n\r\n    // è·å– [pixivimage:] çš„å›¾ç‰‡é“¾æ¥ [pixivimage:1234] [pixivimage:1234-1]\r\n    let matched = content.match(RegExp(/\\[pixivimage:(\\d+)-?(\\d+)]/gm))\r\n    if (matched) {\r\n        matched.forEach(pixivimage => {\r\n            let matched2, illustId, order = 0\r\n            if (pixivimage.includes(\"-\")) {\r\n                matched2 = pixivimage.match(RegExp(\"(\\\\d+)-(\\\\d+)\"))\r\n                illustId = matched2[1]; order = matched2[2]\r\n            } else {\r\n                matched2 = pixivimage.match(RegExp(\"\\\\d+\"))\r\n                illustId = matched2[0];\r\n            }\r\n            content = content.replace(`${pixivimage}`, `<img src=\"${urlIllustOriginal(illustId, order)}\">`)\r\n        })\r\n    }\r\n\r\n    // æ›¿æ¢ Pixiv åˆ†é¡µæ ‡è®°ç¬¦å· [newpage]\r\n    matched = content.match(RegExp(/[ ã€€]*\\[newpage][ ã€€]*/gm))\r\n    if (matched) {\r\n        for (let i in matched) {\r\n            content = content.replace(`${matched[i]}`, `${\"<p>â€‹<p/>\".repeat(3)}`)\r\n        }\r\n    }\r\n\r\n    // æ›¿æ¢ Pixiv ç« èŠ‚æ ‡è®°ç¬¦å· [chapter:]\r\n    matched = content.match(RegExp(/\\[chapter:(.*?)]/gm))\r\n    if (matched) {\r\n        for (let i in matched) {\r\n            let matched2 = matched[i].match(/\\[chapter:(.*?)]/m)\r\n            let chapter = matched2[1].trim()\r\n            content = content.replace(`${matched[i]}`, `${chapter}<p>â€‹<p/>`)\r\n        }\r\n    }\r\n\r\n    // æ›¿æ¢ Pixiv è·³è½¬é¡µé¢æ ‡è®°ç¬¦å· [[jump:]]\r\n    matched = content.match(RegExp(/\\[jump:(\\d+)]/gm))\r\n    if (matched) {\r\n        for (let i in matched) {\r\n            let page = matched[i].match(/\\d+/)\r\n            content = content.replace(`${matched[i]}`, `\\n\\nè·³è½¬è‡³ç¬¬${page}èŠ‚`)\r\n        }\r\n    }\r\n\r\n    // æ›¿æ¢ Pixiv é“¾æ¥æ ‡è®°ç¬¦å· [[jumpuri: > ]]\r\n    matched = content.match(RegExp(/\\[\\[jumpuri:(.*?)>(.*?)]]/gm))\r\n    if (matched) {\r\n        for (let i in matched) {\r\n            let matched2 = matched[i].match(/\\[\\[jumpuri:(.*?)>(.*?)]]/m)\r\n            let matchedText = matched2[0]\r\n            let urlName = matched2[1].trim()\r\n            let urlLink = matched2[2].trim()\r\n            // é˜…è¯»ä¸æ”¯æŒè¶…é“¾æ¥\r\n            //content = content.replace(`${matchedText}`, `<a href=${urlLink}>${urlName}</a>`)\r\n            if (urlLink === urlName) {\r\n                content = content.replace(`${matchedText}`, `${urlName}`)\r\n            } else {\r\n                content = content.replace(`${matchedText}`, `${urlName}: ${urlLink}`)\r\n            }\r\n        }\r\n    }\r\n\r\n    // æ›¿æ¢ Pixiv æ³¨éŸ³æ ‡è®°ç¬¦å· [[rb: > ]]\r\n    matched = content.match(RegExp(/\\[\\[rb:(.*?)>(.*?)]]/gm))\r\n    if (matched) {\r\n        for (let i in matched) {\r\n            let matched2 = matched[i].match(/\\[\\[rb:(.*?)>(.*?)]]/m)\r\n            let matchedText = matched2[0]\r\n            let kanji = matched2[1].trim()\r\n            let kana = matched2[2].trim()\r\n\r\n            if (!util.settings.REPLACE_TITLE_MARKS) {\r\n                // é»˜è®¤æ›¿æ¢æˆï¼ˆæ‹¬å·ï¼‰\r\n                content = content.replace(`${matchedText}`, `${kanji}ï¼ˆ${kana}ï¼‰`)\r\n            } else {\r\n                let reg = RegExp(\"[\\\\u4E00-\\\\u9FFF]+\", \"g\");\r\n                if (reg.test(kana)) {\r\n                    // kanaä¸ºä¸­æ–‡ï¼Œåˆ™æ›¿æ¢å›ã€Šä¹¦åå·ã€‹\r\n                    content = content.replace(`${matchedText}`, `${kanji}ã€Š${kana}ã€‹`)\r\n                } else {\r\n                    // é˜…è¯»ä¸æ”¯æŒ <ruby> <rt> æ³¨éŸ³\r\n                    // content = content.replace(`${matchedText}`, `<ruby>${kanji}<rt>${kana}</rt></ruby>`)\r\n                    content = content.replace(`${matchedText}`, `${kanji}ï¼ˆ${kana}ï¼‰`)\r\n                }\r\n            }\r\n        }\r\n    }\r\n\r\n    // æ·»åŠ æŠ•ç¥¨\r\n    if (res.pollData) {\r\n        let poll = `ğŸ“ƒ æŠ•ç¥¨(âœ…${res.pollData.total}å·²æŠ•)ï¼š\\n${res.pollData.question}\\n`\r\n        res.pollData.choices.forEach(choice => {\r\n            poll += `é€‰é¡¹${choice.id}ï¼š${choice.text}(âœ…${choice.count})\\n`\r\n        })\r\n        content += \"\\n\" + \"â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”\\n\".repeat(2) + poll\r\n    }\r\n\r\n    // æ·»åŠ è¯„è®º\r\n    if (util.settings.SHOW_COMMENTS) {\r\n        return content + getComment(res)\r\n    } else {\r\n        return content\r\n    }\r\n}\r\n\r\nfunction getComment(res) {\r\n    // let resp = getAjaxJson(urlNovelComments(res.id, 0, res.commentCount), true)\r\n    const limit = 50  // æ¨¡æ‹Ÿ Pixiv è¯·æ±‚\r\n    let resp = {\"error\": false, \"message\": \"\", \"body\": {comments:[]} }\r\n    let maxPage = (res.commentCount / limit) + 1\r\n    for (let i = 0; i < maxPage; i++) {\r\n        let result = getAjaxJson(urlNovelComments(res.id, i*limit, 50), true)\r\n        if (result.error !== true && result.body.comments !== null) {\r\n            resp.body.comments = resp.body.comments.concat(result.body.comments)\r\n        }\r\n    }\r\n\r\n    // åˆ·æ–°æ—¶ï¼Œåˆ·æ–°è¯„è®ºï¼Œä¸æ›´æ–°æ­£æ–‡\r\n    let commentCount = resp.body.comments.length\r\n    java.log(`ã€${res.title}ã€‘(${res.id})ï¼Œå…±æœ‰${commentCount}æ¡è¯„è®ºï¼Œ${res.commentCount - commentCount}æ¡å›å¤`)\r\n    if (commentCount === 0) {\r\n        return \"\"\r\n    }\r\n\r\n    let comments = `ğŸ’¬ è¯„è®º(å…±è®¡${commentCount}æ¡)ï¼š\\n`\r\n    resp.body.comments.forEach(comment => {\r\n        if (comment.comment === \"\") {\r\n            comment.comment = `<img src=\"${urlStampUrl(comment.stampId)}\">`\r\n        }\r\n        if (Object.keys(emoji).includes(comment.comment.slice(1, -1))) {\r\n            comment.emojiId = emoji[comment.comment.slice(1, -1)]\r\n            comment.comment = `<img src=\"${urlEmojiUrl(comment.emojiId)}\">`\r\n        }\r\n        if (comment.userId === String(cache.get(\"pixiv:uid\"))) {\r\n            comments += `@${comment.userName}ï¼š${comment.comment}(${comment.commentDate})(${comment.id})\\n`\r\n        } else {\r\n            comments += `@${comment.userName}ï¼š${comment.comment}(${comment.commentDate})\\n`\r\n        }\r\n\r\n        // è·å–è¯„è®ºå›å¤\r\n        if (comment.hasReplies === true) {\r\n            let resp = getAjaxJson(urlNovelCommentsReply(comment.id, 1), true)\r\n            if (resp.error === true) return comments\r\n\r\n            resp.body.comments.reverse().forEach(reply => {\r\n                if (reply.comment === \"\") {\r\n                    reply.comment = `<img src=\"${urlStampUrl(reply.stampId)}\">`\r\n                }\r\n                if (Object.keys(emoji).includes(reply.comment.slice(1, -1))) {\r\n                    reply.emojiId = emoji[reply.comment.slice(1, -1)]\r\n                    reply.comment = `<img src=\"${urlEmojiUrl(reply.emojiId)}\">`\r\n                }\r\n                if (comment.userId === String(cache.get(\"pixiv:uid\"))) {\r\n                    comments += `@${reply.userName}(â¤´ï¸@${reply.replyToUserName})ï¼š${reply.comment}(${reply.commentDate})(${reply.id})\\n`\r\n                } else {\r\n                    comments += `@${reply.userName}(â¤´ï¸@${reply.replyToUserName})ï¼š${reply.comment}(${reply.commentDate})\\n`\r\n                }\r\n            })\r\n            comments += \"â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”\\n\"\r\n        }\r\n    })\r\n    if (comments) {\r\n        comments = \"\\n\" + \"â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”\\n\".repeat(2) + comments\r\n    }\r\n    return comments\r\n}\r\n\r\nfunction checkContent() {\r\n    let latestMsg = getAjaxJson(urlMessageThreadLatest(5))\r\n    if (latestMsg.error === true) {\r\n        java.log(JSON.stringify(latestMsg))\r\n\r\n    } else if (latestMsg.body.total >= 1) {\r\n        let msg = latestMsg.body.message_threads.filter(item => item.thread_name === \"pixiväº‹å‹™å±€\")[0]\r\n        if (msg === undefined) {\r\n            sleepToast(`æ‚¨äº ${java.timeFormat(new Date().getTime())} è§¦å‘ Pixiv ã€è¯·æ±‚é™åˆ¶ã€‘ï¼Œå»ºè®®ç¨å€™/é‡æ–°ç™»å½•å†ç»§ç»­`, 3)\r\n            // java.startBrowser(\"https://www.pixiv.net\", 'é€€å‡ºç™»å½•')\r\n            // java.startBrowser(\"https://www.pixiv.net/logout.php\",'é€€å‡ºç™»å½•')  // ä¸æ¸…é™¤ WebView ç¼“å­˜æ— æ³•é‡æ–°ç™»å½•\r\n\r\n        } else if (new Date().getTime()- 1000*msg.modified_at <= 3*24*60*60*1000) { // 3*24hå†…æé†’\r\n            sleepToast(`æ‚¨äº ${java.timeFormat(1000*msg.modified_at)} è§¦å‘ Pixiv ã€è¿‡åº¦è®¿é—®ã€‘ï¼Œè¯·ä¿®æ”¹å¯†ç å¹¶é‡æ–°ç™»å½•`, 3)\r\n            sleepToast(`${msg.latest_content}`, 5)\r\n            java.startBrowser(\"https://accounts.pixiv.net/password/change\",'ä¿®æ”¹å¯†ç ')\r\n        }\r\n    }\r\n}\r\n\r\n(() => {\r\n    return getContent(util.getNovelRes(result))\r\n})()",
            "imageStyle": "DEFAULT"
        },
        "ruleExplore": {
            "author": "userName",
            "bookList": "@js:\n@js:\r\nvar util = objParse(String(java.get(\"util\")))\r\nvar seriesSet = new Set();  // å­˜å‚¨seriesID æœ‰BUGæ— æ³•å¤„ç†ç¿»é¡µ\r\n\r\nfunction objParse(obj) {\r\n    return JSON.parse(obj, (n, v) => {\r\n        if (typeof v == \"string\" && v.match(\"()\")) {\r\n            return eval(`(${v})`)\r\n        }\r\n        return v;\r\n    })\r\n}\r\n\r\nfunction handlerFactory() {\r\n    if (baseUrl.includes(\"https://cdn.jsdelivr.net\")) {\r\n        return () => {updateSource(); return []}\r\n    }\r\n    if (!isLogin()) {\r\n        return handlerNoLogin()\r\n    }\r\n    if (baseUrl.includes(\"/bookmark\")) {\r\n        return handlerBookMarks()\r\n    }\r\n    if (baseUrl.includes(\"/top\")) {\r\n        return handlerRecommend()\r\n    }\r\n    if (baseUrl.includes(\"/follow_latest\")) {\r\n        return handlerFollowLatest()\r\n    }\r\n    if (baseUrl.includes(\"/watch_list\")) {\r\n        return handlerWatchList()\r\n    }\r\n    if (baseUrl.includes(\"/discovery\")) {\r\n        return handlerDiscovery()\r\n    }\r\n    if (baseUrl.includes(\"/new\")) {\r\n        return handlerDiscovery()\r\n    }\r\n    if (baseUrl.includes(\"/commission/\")) {\r\n        return handlerFollowLatest()\r\n    }\r\n    if (baseUrl.includes(\"/user_event/portal\")) {\r\n        return handlerFollowLatest()\r\n    }\r\n    if (baseUrl.includes(\"/genre\")) {\r\n        return handlerWatchList()\r\n    }\r\n    // æ­£åˆ™åŒ¹é…ç½‘å€å†…å®¹\r\n    if (baseUrl.includes(\"/ranking\")) {\r\n        return handlerRanking()\r\n    }\r\n    if (baseUrl.includes(\"/marker_all\")) {\r\n        return handlerRanking()\r\n    }\r\n    if (baseUrl.includes(\"/editors_picks\")) {\r\n        return handlerRanking()\r\n    }\r\n    if (baseUrl.startsWith(\"https://www.pixiv.net\")) {\r\n        return handlerRanking()\r\n    }\r\n    else {\r\n        return []\r\n    }\r\n}\r\n\r\nfunction handlerNoLogin() {\r\n    return () => {\r\n        sleepToast(\"ğŸ” å‘ç°ï¼š\\n\\nâš ï¸ å½“å‰æœªç™»å½•è´¦å·\\n\\nè¯·ç™»å½• Pixiv è´¦å·\", 1.5)\r\n        util.removeCookie(); util.login()\r\n        sleepToast(\"ğŸ” å‘ç°ï¼š\\n\\nç™»å½•æˆåŠŸåï¼Œè¯·é‡æ–°è¿›å…¥å‘ç°\", 2)\r\n        return []\r\n    }\r\n}\r\n\r\n// æ¨èå°è¯´\r\nfunction handlerRecommend() {\r\n    return () => {\r\n        let res = JSON.parse(result)\r\n        const recommend = res.body.page.recommend\r\n        const novels = res.body.thumbnails.novel\r\n        let nidSet = new Set(recommend.ids)\r\n        // java.log(nidSet.size)\r\n        let list = novels.filter(novel => nidSet.has(String(novel.id)))\r\n        // java.log(`è¿‡æ»¤ç»“æœ:${JSON.stringify(list)}`)\r\n        return util.formatNovels(util.handNovels(util.combineNovels(list)))\r\n    }\r\n}\r\n\r\n// æ”¶è—å°è¯´ï¼Œä»–äººæ”¶è—\r\nfunction handlerBookMarks() {\r\n    return () => {\r\n        let res = JSON.parse(result).body.works\r\n        if (res === undefined || res.length === 0) {\r\n            //æµç¨‹æ— æ³•æœ¬ç¯èŠ‚ä¸­æ­¢ åªèƒ½äº¤ç»™ä¸‹ä¸€æµç¨‹å¤„ç†\r\n            return []\r\n        }\r\n        return util.formatNovels(util.handNovels(res))\r\n    }\r\n}\r\n\r\n//å…³æ³¨ä½œè€…ï¼Œå°è¯´å§”æ‰˜ï¼Œå°è¯´ä¼åˆ’\r\nfunction handlerFollowLatest() {\r\n    return () => {\r\n        let res = JSON.parse(result)\r\n        return util.formatNovels(util.handNovels(util.combineNovels(res.body.thumbnails.novel)))\r\n    }\r\n}\r\n\r\n//æ¨èå°è¯´ï¼Œæœ€è¿‘å°è¯´\r\nfunction handlerDiscovery() {\r\n    return () => {\r\n        let res = JSON.parse(result)\r\n        return util.formatNovels(util.handNovels(util.combineNovels(res.body.novels)))\r\n    }\r\n}\r\n\r\n// è¿½æ›´åˆ—è¡¨ï¼Œçƒ­é—¨åˆ†ç±»\r\nfunction handlerWatchList() {\r\n    return () => {\r\n        let res = JSON.parse(result)\r\n        return util.formatNovels(util.handNovels(res.body.thumbnails.novelSeries))\r\n    }\r\n}\r\n\r\n// æ’è¡Œæ¦œï¼Œä¹¦ç­¾ï¼Œé¦–é¡µï¼Œç¼–è¾‘éƒ¨æ¨èï¼Œé¡ºåºç›¸åŒ\r\nfunction handlerRanking() {\r\n    if (util.settings.IS_LEGADO) return handlerRankingAjaxAll()\r\n    // else if (util.settings.IS_SOURCE_READ) return handlerRankingWebview()\r\n    else if (util.settings.IS_SOURCE_READ) return handlerRankingAjax()\r\n    else return []\r\n}\r\n\r\n// æ’è¡Œæ¦œï¼Œä¹¦ç­¾ï¼Œé¦–é¡µï¼Œç¼–è¾‘éƒ¨æ¨èï¼Œé¡ºåºç›¸åŒ\r\nfunction handlerRankingAjaxAll() {\r\n    return () => {\r\n        let  novelIds = [], novelUrls = []\r\n        // let result = result + java.ajax(`${baseUrl}&p=2`)  // æ­£åˆ™è·å–ç½‘å€ä¸­çš„ novelId\r\n        let matched = result.match(RegExp(/\\/novel\\/show\\.php\\?id=\\d{5,}/gm))\r\n        for (let i in matched) {\r\n            let novelId = matched[i].match(RegExp(/\\d{5,}/))[0]\r\n            if (novelIds.indexOf(novelId) === -1) {\r\n                novelIds.push(novelId)\r\n                novelUrls.push(urlNovelDetailed(novelId))\r\n            }\r\n        }\r\n        // java.log(JSON.stringify(novelIds))\r\n        let novels = getAjaxAllJson(novelUrls).map(resp => resp.body)\r\n        return util.formatNovels(util.handNovels(util.combineNovels(novels)))\r\n    }\r\n}\r\n\r\n// æ’è¡Œæ¦œï¼Œä¹¦ç­¾ï¼Œé¦–é¡µ\r\nfunction handlerRankingWebview() {\r\n    return () => {\r\n        let novelIds = []  // æ­£åˆ™è·å–ç½‘å€ä¸­çš„ novelId\r\n        // let result = result + java.ajax(`${baseUrl}&p=2`)  // æ­£åˆ™è·å–ç½‘å€ä¸­çš„ novelId\r\n        let matched = result.match(RegExp(/\\/novel\\/show\\.php\\?id=\\d{5,}/gm))\r\n        for (let i in matched) {\r\n            let novelId = matched[i].match(RegExp(/\\d{5,}/))[0]\r\n            if (novelIds.indexOf(novelId) === -1) {\r\n                novelIds.push(novelId)\r\n            }\r\n        }\r\n        // java.log(JSON.stringify(novelIds))\r\n        let userNovels = getWebviewJson(\r\n            urlNovelsDetailed(`${cache.get(\"pixiv:uid\")}`, novelIds), html => {\r\n                return (html.match(new RegExp(\">\\\\{.*?}<\"))[0].replace(\">\", \"\").replace(\"<\", \"\"))\r\n            }).body\r\n        return util.formatNovels(util.handNovels(util.combineNovels(Object.values(userNovels))))\r\n    }\r\n}\r\n\r\n// æ’è¡Œæ¦œï¼Œä¹¦ç­¾ï¼Œé¡ºåºç›¸åŒ\r\nfunction handlerRankingAjax() {\r\n    return () => {\r\n        let novels = [], novelIds = []\r\n        // let result = result + java.ajax(`${baseUrl}&p=2`)  // æ­£åˆ™è·å–ç½‘å€ä¸­çš„ novelId\r\n        let matched = result.match(RegExp(/\\/novel\\/show\\.php\\?id=\\d{5,}/gm))\r\n        for (let i in matched) {\r\n            let novelId = matched[i].match(RegExp(/\\d{5,}/))[0]\r\n            if (novelIds.indexOf(novelId) === -1) {\r\n                novelIds.push(novelId)\r\n                // java.log(urlNovelDetailed(novelId))\r\n                let res = getAjaxJson(urlNovelDetailed(novelId))\r\n                if (res.error !== true) {\r\n                    novels.push(res.body)\r\n                } else {\r\n                    java.log(JSON.stringify(res))\r\n                }\r\n            }\r\n        }\r\n        return util.formatNovels(util.handNovels(util.combineNovels(novels)))\r\n    }\r\n}\r\n\r\n(() => {\r\n    return handlerFactory()()\r\n})()",
            "bookUrl": "detailedUrl",
            "coverUrl": "coverUrl",
            "intro": "description",
            "kind": "tags",
            "lastChapter": "latestChapter",
            "name": "title",
            "wordCount": "textCount"
        },
        "ruleSearch": {
            "author": "userName",
            "bookList": "@js:\n@js:\r\nvar util = objParse(String(java.get(\"util\")))\r\n\r\nfunction objParse(obj) {\r\n    return JSON.parse(obj, (n, v) => {\r\n        if (typeof v == \"string\" && v.match(\"()\")) {\r\n            return eval(`(${v})`)\r\n        }\r\n        return v;\r\n    })\r\n}\r\n\r\nvar first = true;\r\n// å­˜å‚¨seriesID\r\nvar seriesSet = {\r\n    keywords: \"Pixiv:Search\",\r\n    has: (value) => {\r\n        let page = Number(java.get(\"page\"))\r\n        if (page === 1 && first) {\r\n            first = false\r\n            cache.deleteMemory(this.keywords)\r\n            return false\r\n        }\r\n\r\n        let v = cache.getFromMemory(this.keywords)\r\n        if (v === undefined || v === null) {\r\n            return false\r\n        }\r\n        let set = new Set(JSON.parse(v))\r\n        return set.has(value)\r\n    },\r\n\r\n    add: (value) => {\r\n        let v = cache.getFromMemory(this.keywords)\r\n        if (v === undefined || v === null) {\r\n            cache.putMemory(this.keywords, JSON.stringify([value]))\r\n\r\n        } else {\r\n            let arr = JSON.parse(v)\r\n            if (typeof arr === \"string\") {\r\n                arr = Array(arr)\r\n            }\r\n            arr.push(value)\r\n            cache.putMemory(this.keywords, JSON.stringify(arr))\r\n        }\r\n    },\r\n};\r\n\r\nfunction getUserNovels() {\r\n    if (!isLogin()) {\r\n        sleepToast(\"ğŸ‘¤ æœç´¢ä½œè€…\\n\\nâš ï¸ å½“å‰æœªç™»å½•è´¦å·\\nè¯·ç™»å½• Pixiv è´¦å·\", 1.5)\r\n        util.removeCookie(); util.login()\r\n        sleepToast(\"ğŸ‘¤ æœç´¢ä½œè€…\\n\\nç™»å½•æˆåŠŸåï¼Œè¯·é‡æ–°æœç´¢\", 2)\r\n        return []\r\n    }\r\n\r\n    let uidList = [], novels = []\r\n    let username = String(java.get(\"keyword\"))\r\n    let page = Number(java.get(\"page\"))\r\n\r\n    // cache.delete(username)\r\n    let userid = cache.get(username)\r\n    if (userid !== undefined && userid !== null) {\r\n        uidList = [userid]\r\n        java.log(`ğŸ‘¤ ç¼“å­˜ä½œè€…IDï¼š${userid}`)\r\n    } else {\r\n        html = java.ajax(urlSearchUser(username))\r\n        // java.log(html)\r\n        // ä»…åŒ¹é…æœ‰æŠ•ç¨¿ä½œå“çš„ç”¨æˆ·\r\n        let match = html.match(new RegExp(`\"userIds\":\\\\[(?:(?:\\\\d+,?)+)]`))\r\n        // java.log(JSON.stringify(match))\r\n        if (match === null || match.length === 0) {\r\n            return []\r\n        }\r\n\r\n        match = JSON.stringify(match).replace(\"\\\\\",\"\").split(\",\")\r\n        // java.log(JSON.stringify(match))\r\n        let regNumber = new RegExp(\"\\\\d+\")\r\n        uidList = match.map(v => {\r\n            return v.match(regNumber)[0]\r\n        })\r\n        java.log(`ğŸ‘¤ è·å–ä½œè€…IDï¼š${JSON.stringify(uidList)}`)\r\n    }\r\n\r\n    let tempUids = []\r\n    for (let i in uidList) {\r\n        let uid = uidList[i]\r\n        let resp = getAjaxJson(urlUserAllWorks(uid), true)\r\n        // java.log(urlUserAllWorks(id))\r\n        // java.log(JSON.stringify(resp))\r\n        if (resp.error === true) {\r\n            return []\r\n        }\r\n\r\n        // ä»…è·å–å‰3ä¸ªæœ‰å°è¯´çš„ä½œè€…\r\n        let novelIds = Object.keys(resp.body.novels)\r\n        // java.log(`${uid}-${novelIds.length}`)\r\n        if (novelIds.length >= 1) tempUids.push(uid)\r\n        if (tempUids.length === 3) {\r\n            java.log(`ğŸ‘¤ æ˜¾ç¤ºä½œè€…IDï¼š${JSON.stringify(tempUids)}`)\r\n            break\r\n        }\r\n\r\n        // è·å–ç³»åˆ—å°è¯´ï¼Œä¸ util.handnovels ç³»åˆ—è¯¦æƒ…å…¼å®¹\r\n        let seriesIds = []\r\n        if (resp.body.novelSeries.length >= 1) {\r\n            resp.body.novelSeries.forEach(novel =>{\r\n                seriesIds.push(novel.id)\r\n                novel.textCount = novel.publishedTotalCharacterCount\r\n                novel.description = novel.caption\r\n            })\r\n            novels = novels.concat(resp.body.novelSeries)\r\n        }\r\n\r\n        // è·å–æ‰€æœ‰ç³»åˆ—å†…éƒ¨çš„å°è¯´ ID\r\n        let seriesNovelIds = []\r\n        seriesIds.forEach(seriesId => {\r\n            let returnList = getAjaxJson(urlSeriesNovelsTitles(seriesId)).body\r\n            returnList.map(novel => {return seriesNovelIds.push(novel.id)})\r\n        })\r\n        // java.log(`æœ‰ç³»åˆ—çš„å°è¯´IDï¼š${JSON.stringify(seriesNovelIds)}`)\r\n        // java.log(JSON.stringify(seriesNovelIds.length))\r\n\r\n        // è·å–å•ç¯‡å°è¯´\r\n        if (novelIds.length >= 1 && util.settings.IS_LEGADO) {\r\n            novelIds = novelIds.filter(novelid => (!seriesNovelIds.includes(novelid)))\r\n            novelIds = novelIds.reverse().slice((page - 1) * 20, page * 20)\r\n            // java.log(`çœŸå•ç¯‡çš„å°è¯´IDï¼š${JSON.stringify(novelIds)}`)\r\n            // java.log(JSON.stringify(novelIds.length))\r\n            let novelUrls = novelIds.map(novelId => {return urlNovelDetailed(novelId)})\r\n            // java.log(JSON.stringify(novelUrls))\r\n            // cache.delete(novelUrls)\r\n            novels = novels.concat(getAjaxAllJson(novelUrls).map(resp => resp.body))\r\n        }\r\n\r\n        // // è·å–å•ç¯‡å°è¯´\r\n        if (novelIds.length >= 1 && util.settings.IS_SOURCE_READ) {\r\n            novelIds = novelIds.filter(novelid => (!seriesNovelIds.includes(novelid)))\r\n            // java.log(`çœŸå•ç¯‡çš„å°è¯´IDï¼š${JSON.stringify(novelIds)}`)\r\n            // java.log(JSON.stringify(novelIds.length))\r\n            novelIds = novelIds.reverse().slice((page - 1) * 20, page * 20)\r\n            novelIds.forEach(novelId => {\r\n                // java.log(urlNovelDetailed(novelId))\r\n                let res = getAjaxJson(urlNovelDetailed(novelId))\r\n                if (res.error !== true) {\r\n                    novels.push(res.body)\r\n                } else {\r\n                    java.log(JSON.stringify(res))\r\n                }\r\n            })\r\n        }\r\n    }\r\n    \r\n    util.debugFunc(() => {\r\n        java.log(`è·å–ç”¨æˆ·æœç´¢å°è¯´ç»“æŸ`)\r\n    })\r\n    return novels\r\n}\r\n\r\nfunction search(name, type, page) {\r\n    let resp = {}\r\n    if (type.includes(\"novel\")) {\r\n        resp = getAjaxJson(urlSearchNovel(name, page))\r\n        java.log(urlSearchNovel(name, page))\r\n    }\r\n    if (type.includes(\"series\")) {\r\n        resp = getAjaxJson(urlSearchSeries(name, page))\r\n        java.log(urlSearchSeries(name, page))\r\n    }\r\n    if (resp.error === true || resp.total === 0) {\r\n        return {\"data\": [], \"total\":0, \"lastPage\": 0}\r\n    }\r\n    return resp.body.novel\r\n}\r\n\r\nfunction getSeries() {\r\n    let novels = []\r\n    let name = String(java.get(\"keyword\"))\r\n    let maxPages = getFromCache(\"maxPages\")  // ä»…é»˜è®¤æœç´¢ä½¿ç”¨\r\n    if (!maxPages) {\r\n        maxPages = getFromCache(\"seriesMaxPages\")  // æœç´¢æ ‡ç­¾ä½¿ç”¨\r\n        if (!maxPages) maxPages = 1\r\n        putInCache(\"seriesMaxPages\", maxPages)\r\n    }\r\n    java.log(`ğŸ“„ æœç´¢ç³»åˆ—æœ€å¤§é¡µç ï¼š${maxPages}`)\r\n\r\n    if (JSON.parse(result).error === true) {\r\n        return []\r\n    }\r\n    let lastPage = JSON.parse(result).body.novel.lastPage\r\n    novels = novels.concat(JSON.parse(result).body.novel.data)\r\n    java.log(urlSearchSeries(name, 1))\r\n    cache.put(urlSearchSeries(name, 1), result, cacheSaveSeconds)  // åŠ å…¥ç¼“å­˜\r\n    for (let page = Number(java.get(\"page\")) + 1; page <= lastPage && page <= maxPages; page++) {\r\n        novels = novels.concat(search(name,\"series\", page).data)\r\n    }\r\n    return novels\r\n}\r\n\r\nfunction getNovels() {\r\n    let novels = []\r\n    let name = String(java.get(\"keyword\"))\r\n    let maxPages = getFromCache(\"maxPages\")  // ä»…é»˜è®¤æœç´¢ä½¿ç”¨\r\n    if (!maxPages) {\r\n        maxPages = getFromCache(\"novelsMaxPages\")  // æœç´¢æ ‡ç­¾ä½¿ç”¨\r\n        if (!maxPages) maxPages = 1\r\n        putInCache(\"novelsMaxPages\", maxPages)\r\n    }\r\n    java.log(`ğŸ“„ æœç´¢å•ç¯‡æœ€å¤§é¡µç ï¼š${maxPages}`)\r\n\r\n    let resp = search(name, \"novel\", 1)\r\n    novels = novels.concat(resp.data)\r\n    for (let page = Number(java.get(\"page\")) + 1; page <= resp.lastPage && page <= maxPages; page++) {\r\n        novels = novels.concat(search(name,\"novel\", page).data)\r\n    }\r\n    return util.combineNovels(novels)\r\n}\r\n\r\nfunction getConvertNovels() {\r\n    let novels = []\r\n    let novelName = String(java.get(\"keyword\"))\r\n    let name1 = String(java.s2t(novelName))\r\n    let name2 = String(java.t2s(novelName))\r\n    if (name1 !== novelName) novels = novels.concat(search(name1, \"novel\", 1).data)\r\n    if (name2 !== novelName) novels = novels.concat(search(name2, \"novel\", 1).data)\r\n    novels = util.combineNovels(novels)\r\n    if (name1 !== novelName) novels = novels.concat(search(name1, \"series\", 1).data)\r\n    if (name2 !== novelName) novels = novels.concat(search(name2, \"series\", 1).data)\r\n    return novels\r\n}\r\n\r\nfunction novelFilter(novels) {\r\n    let textCount = 0, tags = []\r\n    let limitedTextCount = String(java.get(\"limitedTextCount\")).replace(\"å­—æ•°\", \"\").replace(\"å­—æ•¸\", \"\")\r\n    // limitedTextCount = `3w 3k 3w5 3k5`.[0]\r\n    if (limitedTextCount.includes(\"w\") || limitedTextCount.includes(\"W\")) {\r\n        let num = limitedTextCount.toLowerCase().split(\"w\")\r\n        textCount = 10000 * num[0] + 1000 * num[1]\r\n    } else if (limitedTextCount.includes(\"k\") || limitedTextCount.includes(\"K\")) {\r\n        let num = limitedTextCount.toLowerCase().split(\"k\")\r\n        textCount = 1000 * num[0] + 100 * num[1]\r\n    }\r\n\r\n    let novels0 = novels.map(novel => novel.id)\r\n    if (textCount >= 1) {\r\n        novels = novels.filter(novel => novel.textCount >= textCount)\r\n        let novels1 = novels.map(novel => novel.id)\r\n        java.log(`ğŸ”¢ å­—æ•°é™åˆ¶ï¼š${limitedTextCount}`)\r\n        java.log(`â¬ å­—æ•°é™åˆ¶ï¼šè¿‡æ»¤å‰${novels0.length}ï¼›è¿‡æ»¤å${novels1.length}`)\r\n    }\r\n\r\n    let inputTags = String(java.get(\"inputTags\")).split(\" \")\r\n    for (let i in inputTags) {\r\n        let tag = inputTags[i].trim()\r\n        if (tag !== \"\") tags.push(`${tag}`)\r\n    }\r\n\r\n    if (tags.length >= 1) {\r\n        // ä»…ä¿ç•™å«æœ‰æ‰€æœ‰æ ‡ç­¾çš„å°è¯´\r\n        // novels = novels.filter(novel => {\r\n        //     // java.log(`${JSON.stringify(novel.tags)}\\n${tags.every(item => novel.tags.includes(item))}`)\r\n        //     return tags.every(item => novel.tags.includes(item))\r\n        // })\r\n        novels = novels.filter(novel => tags.every(item => novel.tags.includes(item)))\r\n        let novels2 = novels.map(novel => novel.id)\r\n        java.log(`#ï¸âƒ£ è¿‡æ»¤æ ‡ç­¾ï¼š${tags.join(\"ã€\")}`)\r\n        java.log(`#ï¸âƒ£ è¿‡æ»¤æ ‡ç­¾ï¼šè¿‡æ»¤å‰${novels0.length}ï¼›è¿‡æ»¤å${novels2.length}`)\r\n    }\r\n\r\n    let inputAuthor = String(java.get(\"inputAuthor\")).trim()\r\n    if (inputAuthor) {\r\n        // novels = novels.filter(novel => {\r\n        //     java.log(`${novel.userName}-${novel.userName.includes(inputAuthor)}`)\r\n        //     return novel.userName.includes(inputAuthor)\r\n        // })\r\n        novels = novels.filter(novel => novel.userName.includes(inputAuthor))\r\n        let novels2 = novels.map(novel => novel.id)\r\n        java.log(`ğŸ‘¤ è¿‡æ»¤ä½œè€…ï¼š${tags.join(\"ã€\")}`)\r\n        java.log(`ğŸ‘¤ è¿‡æ»¤ä½œè€…ï¼šè¿‡æ»¤å‰${novels0.length}ï¼›è¿‡æ»¤å${novels2.length}`)\r\n    }\r\n    return novels\r\n}\r\n\r\n(() => {\r\n    let novels = []\r\n    let keyword = String(java.get(\"keyword\"))\r\n    if (keyword.startsWith(\"@\") || keyword.startsWith(\"ï¼ \")) {\r\n        java.put(\"keyword\", keyword.slice(1))\r\n        novels = novels.concat(getUserNovels())\r\n    } else if (keyword.startsWith(\"#\") || keyword.startsWith(\"ï¼ƒ\")) {\r\n        java.put(\"keyword\", keyword.slice(1))\r\n        // åˆ é™¤é»˜è®¤æœç´¢æœ€å¤§é¡µç ï¼Œä½¿ç”¨å†…éƒ¨è®¾å®šçš„æœ€å¤§é¡µç \r\n        cache.delete(\"maxPages\")\r\n        novels = novels.concat(getSeries())\r\n        novels = novels.concat(getNovels())\r\n    } else {\r\n        // è®¾ç½®é»˜è®¤æœç´¢æœ€å¤§é¡µç \r\n        putInCache(\"maxPages\", 1)\r\n        novels = novels.concat(getSeries())\r\n        novels = novels.concat(getNovels())\r\n        if (util.settings.SEARCH_AUTHOR) novels = novels.concat(getUserNovels())\r\n        if (util.settings.CONVERT_CHINESE) novels = novels.concat(getConvertNovels())\r\n    }\r\n    // java.log(JSON.stringify(novels))\r\n    // è¿”å›ç©ºåˆ—è¡¨ä¸­æ­¢æµç¨‹\r\n    if (novels.length === 0) {\r\n        return []\r\n    }\r\n    return novelFilter(util.formatNovels(util.handNovels(novels)))\r\n})()",
            "bookUrl": "detailedUrl",
            "checkKeyWord": "æµ‹è¯•é¡µé¢",
            "coverUrl": "coverUrl",
            "intro": "description",
            "kind": "tags",
            "lastChapter": "latestChapter",
            "name": "title",
            "wordCount": "textCount"
        },
        "ruleToc": {
            "chapterList": "@js:\n@js:\r\nvar util = objParse(String(java.get(\"util\")))\r\n\r\nfunction objParse(obj) {\r\n    return JSON.parse(obj, (n, v) => {\r\n        if (typeof v == \"string\" && v.match(\"()\")) {\r\n            return eval(`(${v})`)\r\n        }\r\n        return v;\r\n    })\r\n}\r\n\r\nfunction urlNovel(novelId){\r\n    if (util.settings.SHOW_ORIGINAL_LINK) {\r\n        return urlNovelUrl(novelId)\r\n    } else {\r\n        return urlNovelDetailed(novelId)\r\n    }\r\n}\r\n\r\nfunction oneShotHandler(res) {\r\n    res.textCount = res.userNovels[`${res.id}`].textCount\r\n    res.createDate = timeTextFormat(res.createDate)\r\n    return [{\r\n        title: res.title.replace(RegExp(/^\\s+|\\s+$/g), \"\"),\r\n        chapterUrl: urlNovel(res.id),\r\n        chapterInfo: `${res.createDate}ã€€ã€€${res.textCount}å­—`\r\n    }]\r\n}\r\n\r\nfunction seriesHandler(res) {\r\n    const limit = 30\r\n    let returnList = [], seriesID = res.id, allChaptersCount = res.total\r\n    util.debugFunc(() => {\r\n        java.log(`æœ¬ç³»åˆ— ${seriesID} ä¸€å…±æœ‰${allChaptersCount}ç« `);\r\n    })\r\n\r\n    //å‘é€è¯·æ±‚è·å¾—ç›¸åº”æ•°é‡çš„ç›®å½•åˆ—è¡¨\r\n    function sendAjaxForGetChapters(lastIndex) {\r\n        let resp = getAjaxJson(urlSeriesNovels(seriesID, limit, lastIndex), true)\r\n        res = resp.body.thumbnails.novel\r\n        // res = resp.body.page.seriesContents\r\n        res.forEach(v => {\r\n            v.title = v.title.replace(RegExp(/^\\s+|\\s+$/g), \"\").replace(RegExp(/ï¼ˆ|ï¼‰|-/g), \"\")\r\n            v.chapterUrl = urlNovel(v.id)\r\n            if (v.updateDate !== undefined) {\r\n                v.updateDate = timeTextFormat(v.createDate)\r\n                v.chapterInfo = `${v.updateDate}ã€€ã€€${v.textCount}å­—`\r\n            } else {\r\n                v.updateDate = java.timeFormat(v.uploadTimestamp)\r\n                v.chapterInfo = `${v.updateDate}ã€€ã€€${v.textLength}å­—`\r\n            }\r\n            util.debugFunc(() => {\r\n                java.log(`${v.title}`)\r\n            })\r\n        })\r\n        return res;\r\n    }\r\n\r\n    if (!util.settings.SHOW_UPDATE_TIME) {\r\n        returnList = getAjaxJson(urlSeriesNovelsTitles(seriesID), true).body\r\n        returnList.forEach(v => {\r\n            v.title = v.title.replace(RegExp(/^\\s+|\\s+$/g), \"\").replace(RegExp(/ï¼ˆ|ï¼‰|-/g), \"\")\r\n            v.chapterUrl = urlNovel(v.id)\r\n        })\r\n    } else {\r\n        //é€»è¾‘æ§åˆ¶è€… ä¹Ÿå°±æ˜¯ä½¿ç”¨ä¸Šé¢å®šä¹‰çš„ä¸¤ä¸ªå‡½æ•°æ¥åšå¯¹åº”åŠŸèƒ½\r\n        //è¦çˆ¬å–çš„æ€»æ¬¡æ•°\r\n        let max = (allChaptersCount / limit) + 1\r\n        for (let i = 0; i < max; i++) {\r\n            //java.log(\"içš„å€¼:\"+i)\r\n            let list = sendAjaxForGetChapters(i * limit);\r\n            //å–å‡ºæ¯ä¸ªå€¼\r\n            returnList = returnList.concat(list)\r\n        }\r\n    }\r\n    // java.log(JSON.stringify(returnList))\r\n    return returnList\r\n}\r\n\r\n(function (res) {\r\n    res = util.getNovelResSeries(result)\r\n    if (res.firstNovelId === undefined || res.seriesNavData === null) {\r\n        return oneShotHandler(res)\r\n    } else {\r\n        return seriesHandler(res)\r\n    }\r\n})()",
            "chapterName": "title",
            "chapterUrl": "chapterUrl",
            "isPay": "",
            "isVip": "",
            "updateTime": "chapterInfo"
        },
        "searchUrl": "@js:\n@js:\r\njava.put(\"key\", key)\r\njava.put(\"page\", page)\r\nlet keyword = key.split(\" \")\r\nlet limitedTextCount\r\nif (key.includes(\"å­—æ•°\") || key.includes(\"å­—æ•¸\") ) {\r\n    limitedTextCount = keyword.pop()\r\n    keyword = keyword.join(\" \")\r\n} else {\r\n    limitedTextCount = \"\"\r\n    keyword = key\r\n}\r\njava.put(\"keyword\", keyword)\r\njava.put(\"limitedTextCount\", limitedTextCount)\r\n\r\nif (keyword.startsWith(\"@\") || keyword.startsWith(\"ï¼ \")) {\r\n    if (keyword.includes(\"#\") || keyword.includes(\"ï¼ƒ\")) {\r\n        let author = keyword.split(\" \")[0]\r\n        let tags = keyword.replace(author, \"\").trim().slice(1)\r\n        java.put(\"keyword\", author)\r\n        java.put(\"inputTags\", tags)\r\n        java.log(`ğŸ‘¤ æœç´¢ä½œè€…ï¼š${author} #ï¸âƒ£ è¿‡æ»¤æ ‡ç­¾ï¼š${tags.replace(\" \", \"ã€\")}`)\r\n    } else {\r\n        java.put(\"keyword\", keyword)\r\n        java.log(`ğŸ‘¤ æœç´¢ä½œè€…ï¼š${keyword.slice(1)}`)\r\n    }\r\n\r\n} else if (keyword.startsWith(\"#\") || keyword.startsWith(\"ï¼ƒ\")) {\r\n    keyword = keyword.slice(1)\r\n    if (keyword.includes(\"@\") || keyword.includes(\"ï¼ \")) {\r\n        let author = keyword.match(new RegExp(/[@ï¼ ](.*)/))\r\n        keyword = keyword.replace(author[0], \"\").trim()\r\n        java.put(\"inputAuthor\", author[1])\r\n        java.log(`#ï¸âƒ£ æœç´¢æ ‡ç­¾ï¼š${keyword} ğŸ‘¤ è¿‡æ»¤ä½œè€…ï¼š${author[1]}`)\r\n    } else {\r\n        java.log(`#ï¸âƒ£ æœç´¢æ ‡ç­¾ï¼š${keyword}`)\r\n    }\r\n    java.put(\"keyword\", `#${keyword}`)\r\n\r\n} else {\r\n    java.log(`ğŸ” æœç´¢å†…å®¹ï¼š${keyword}`)\r\n}\r\nurlSearchSeries(keyword, page)\r\n\r\n// åŒæ—¶æœç´¢å¤šä¸ªé“¾æ¥çš„æœç´¢ç»“æœ\r\n// let li = [\r\n//     urlSearchSeries(keyword, page),\r\n//     urlSearchNovel(keyword, page)\r\n// ]\r\n// // resp = getAjaxAllJson(li)\r\n// // resp = resp.map(res => JSON.stringify(res)).join(\",\")\r\n// resp = java.ajaxAll(li).map(resp => resp.body()).join(\",\")\r\n// resp = `[${resp}]`",
        "variableComment": "âš™ï¸ è‡ªå®šä¹‰ä¹¦æºè®¾ç½®ï¼š\r\nâš™ï¸ è‡ªå®šä¹‰è®¾ç½®ï¼šè¯·åœ¨åŸºæœ¬-å˜é‡è¯´æ˜å¤„ä¿®æ”¹ä»£ç \r\nâš™ï¸ è‡ªå®šä¹‰è®¾ç½®ï¼šå°† true æ”¹ä¸º falseï¼Œæˆ–ç›¸å\r\nâš ï¸ è®¾ç½®æºå˜é‡ã€æ— æ³•ã€‘æ›´æ”¹ä¹¦æºè‡ªå®šä¹‰è®¾ç½®\r\nâš ï¸ æ³¨æ„ä¸è¦æ·»åŠ æˆ–åˆ é™¤å°¾éšé€—å·\",\"\r\nâš ï¸ å‘ç°é¡µéœ€è¦é•¿æŒ‰\"Pixiv\"ï¼Œæ‰‹åŠ¨åˆ·æ–°\r\nä»¥ä¸‹å†…å®¹ä¸ºä¹¦æºè®¾ç½®ï¼š\r\n{\r\n\"CONVERT_CHINESE\":true,\r\n\"MORE_INFORMATION\": false,\r\n\"SHOW_ORIGINAL_LINK\": true,\r\n\r\n\"REPLACE_TITLE_MARKS\": true,\r\n\"SHOW_CAPTIONS\": true,\r\n\"SHOW_COMMENTS\": true,\r\n\r\n\"FAST\": false,\r\n\"DEBUG\": false,\r\n\r\n\"SHOW_GENERAL_NEW\": false,\r\n\"SHOW_GENERAL_RANK\": false,\r\n\"SHOW_R18_GENRE\": false,\r\n\"SHOW_GENERAL_GENRE\": false\r\n}\r\n\r\n// CONVERT_CHINESE\r\n// æœç´¢ï¼šæœç´¢æ—¶è¿›è¡Œç¹ç®€è½¬æ¢ï¼Œä½†æœç´¢ä¼šå˜æ…¢\r\n// MORE_INFORMATION\r\n// è¯¦æƒ…ï¼šä¹¦ç±ç®€ä»‹æ˜¾ç¤ºæ›´å¤šä¿¡æ¯\r\n// SHOW_ORIGINAL_LINK\r\n// ç›®å½•ï¼šæ˜¾ç¤ºæºé“¾æ¥ï¼Œä½†ä¼šå¢åŠ è¯·æ±‚æ¬¡æ•°\r\n\r\n// REPLACE_TITLE_MARKS\r\n// æ­£æ–‡ï¼šæ³¨éŸ³å†…å®¹ä¸ºæ±‰å­—æ—¶ï¼Œæ›¿æ¢ä¸ºä¹¦åå·\r\n// SHOW_CAPTIONS\r\n// æ­£æ–‡ï¼šç« é¦–æ˜¾ç¤ºå°è¯´æè¿°\r\n// SHOW_COMMENTS\r\n// æ­£æ–‡ï¼šç« å°¾æ˜¾ç¤ºå°è¯´è¯„è®º\r\n\r\n// FAST\r\n// å¿«é€Ÿæ¨¡å¼\r\n// DEBUG\r\n// è°ƒè¯•æ¨¡å¼\r\n\r\n// SHOW_GENERAL_NEW\r\n// å‘ç°ï¼šæœ€æ–°ã€ä¼åˆ’ã€çº¦ç¨¿æ˜¾ç¤ºä¸€èˆ¬å°è¯´\r\n// SHOW_GENERAL_RANK\r\n// å‘ç°ï¼šæ’è¡Œæ¦œæ˜¾ç¤ºä¸€èˆ¬å°è¯´\r\n// SHOW_R18_GENRE\r\n// å‘ç°ï¼šçƒ­é—¨åˆ†ç±»æ˜¾ç¤ºR18å°è¯´\r\n// SHOW_GENERAL_GENRE\r\n// å‘ç°ï¼šçƒ­é—¨åˆ†ç±»æ˜¾ç¤ºä¸€èˆ¬å°è¯´\r\n\r\n",
        "weight": 0
    },
    {
        "bookSourceComment": "ğŸ…¿ï¸ Pixiv æ¼«ç”»ï¼ˆæ›´æ–°ğŸ“†ï¼š2025-10-31ï¼‰\r\n\r\nä¹¦æºç‰ˆæœ¬ï¼š240\r\nå¯ç”¨åŠŸèƒ½ï¼šâœ…æœç´¢âœ…å‘ç°âœ…æ·»åŠ ç½‘å€âœ…è®¢é˜…æº\r\næœç´¢æ’ç”»ï¼šâœ…æ’ç”»âœ…æ¼«ç”»âœ…åŠ¨å›¾âœ…æ ‡ç­¾\r\nå‘ç°æ¼«ç”»ï¼šâœ…å…³æ³¨âœ…è¿½æ›´âœ…æ¨èâœ…å‘ç°âœ…æ”¶è—\r\næ·»åŠ ç½‘å€ï¼šâœ…æ’ç”»é“¾æ¥âœ…æ¼«ç”»ç›®å½•\r\nè®¢é˜…ç”¨æ³•ï¼šç‚¹å‡»è®¢é˜…æºæ‰“å¼€æ’ç”»/æ¼«ç”»ç›®å½•ï¼Œã€åˆ·æ–°ã€‘ï¼Œç‚¹å‡»ã€åŠ å…¥ä¹¦æ¶ã€‘æŒ‰é’®ï¼Œæ·»åŠ åˆ°ä¹¦æ¶\r\n\r\nä¹¦æºå‘å¸ƒï¼šå…½äººé˜…è¯»é¢‘é“ https://t.me/FurryReading\r\né¡¹ç›®åœ°å€ï¼šhttps://github.com/windyhusky/PixivSource\r\nä½¿ç”¨æ•™ç¨‹ï¼šhttps://github.com/windyhusky/PixivSource/blob/main/doc/Pixiv.md\r\n\r\næ—§ç‰ˆä¹¦æºï¼š\r\nhttps://cdn.jsdelivr.net/gh/windyhusky/PixivSource@191/pixiv.json\r\nhttps://raw.githubusercontent.com/windyhusky/PixivSource/191/pixiv.json\r\n\r\nè§„åˆ™è®¢é˜…ï¼šimport è®¢é˜…æº\r\nhttps://cdn.jsdelivr.net/gh/windyhusky/PixivSource@main/import.json\r\nhttps://raw.githubusercontent.com/windyhusky/PixivSource/main/import.json\r\n\r\nâš™ï¸ ä¹¦æºè®¾ç½®ï¼š\r\nä¹¦æºç®¡ç† - ç¼–è¾‘ä¹¦æº - åŸºæœ¬ - å˜é‡è¯´æ˜ - ä¿®æ”¹å¹¶ä¿å­˜",
        "bookSourceGroup": "ğŸ” Pixiv æ¼«ç”»",
        "bookSourceName": "ğŸ…¿ï¸ Pixiv æ¼«ç”»",
        "bookSourceType": 2,
        "bookSourceUrl": "https://www.pixiv.net/manga",
        "bookUrlPattern": "(https?://)?(www\\.)?pixiv\\.net/((artworks|user/\\d+/series)|ajax/(illust|series))/\\d+",
        "concurrentRate": "3/2000",
        "customButton": false,
        "customOrder": 2,
        "enabled": true,
        "enabledCookieJar": true,
        "enabledExplore": true,
        "eventListener": false,
        "exploreUrl": "@js:\n@js:\r\nlet SHOW_GENERAL_NEW, SHOW_GENERAL_RANK\r\ntry {\r\n    settings = JSON.parse(String(source.variableComment).match(RegExp(/{([\\s\\S]*?)}/gm)))\r\n    SHOW_GENERAL_NEW = settings.SHOW_GENERAL_NEW     // å‘ç°ï¼šæœ€æ–°ã€ä¼åˆ’ã€çº¦ç¨¿æ˜¾ç¤ºä¸€èˆ¬å°è¯´\r\n} catch (e) {\r\n    SHOW_GENERAL_NEW = false\r\n}\r\n\r\nli = [\r\n    {\"â­ï¸ å…³æ³¨\": \"https://www.pixiv.net/ajax/follow_latest/illust?p={{page}}&mode=all&lang=zh\"},\r\n    {\"ğŸ“ƒ è¿½æ›´\": \"https://www.pixiv.net/ajax/watch_list/manga?p={{page}}&new=1&lang=zh\"},\r\n    {\"ğŸ’¯ æ¨è\": \"https://www.pixiv.net/ajax/top/illust?mode=all&lang=zh\"},\r\n    {\"ğŸ” å‘ç°\": \"https://www.pixiv.net/ajax/illust/discovery?mode=all&lang=zh\"},\r\n    {\"â¤ï¸ æ”¶è—\": \"https://www.pixiv.net/ajax/user/{{cache.get(\\\"pixiv:uid\\\")}}/illusts/bookmarks?tag=&offset={{(page-1)*24}}&limit=24&rest=show&lang=zh\"},\r\n    {\"ãŠ™ï¸ æ”¶è—\": \"https://www.pixiv.net/ajax/user/{{cache.get(\\\"pixiv:uid\\\")}}/illusts/bookmarks?tag=&offset={{(page-1)*24}}&limit=24&rest=hide&lang=zh\"},\r\n    {\"ğŸ  é¦–é¡µ\": \"https://www.pixiv.net\"},\r\n    {\"ğŸ†™ æ›´æ–°\": \"https://cdn.jsdelivr.net/gh/windyhusky/PixivSource@main/pixiv.json\"}\r\n]\r\n\r\ngeneralNew = [\r\n    {\"ğŸ†• æœ€æ–° ä¼åˆ’ çº¦ç¨¿ ğŸ’°\": \"\"},\r\n    {\"ğŸ†• æœ€æ–°\": \"https://www.pixiv.net/ajax/illust/new?lastId=0&limit=20&type=manga&lang=zh\"},\r\n    {\"ğŸ“‘ ä¼åˆ’\": \"https://www.pixiv.net/ajax/user_event/portal/artworks?mode=all&p={{page}}&lang=zh\"},\r\n    {\"ğŸ’° çº¦ç¨¿\": \"https://www.pixiv.net/ajax/commission/page/request/complete/manga?mode=all&p={{page}}&lang=zh\"},\r\n    {\"ğŸ” å‘ç°\": \"https://www.pixiv.net/ajax/illust/discovery?mode=all&lang=zh\"}\r\n]\r\n\r\nr18Rank = [\r\n    {\"ğŸ‘‘ æ’è¡Œæ¦œå• ğŸ‘‘\": \"\"},\r\n    {\"ä»Šæ—¥\": \"https://www.pixiv.net/ranking.php?mode=daily_r18&p={{page}}&format=json\"},\r\n    {\"æœ¬å‘¨\": \"https://www.pixiv.net/ranking.php?mode=weekly_r18&p={{page}}&format=json\"},\r\n    {\"R18G\": \"https://www.pixiv.net/ranking.php?mode=r18g&p={{page}}&format=json\"},\r\n    {\"ç”·æ€§\": \"https://www.pixiv.net/ranking.php?mode=male_r18\"},\r\n    {\"å¥³æ€§\": \"https://www.pixiv.net/ranking.php?mode=female_r18\"}\r\n]\r\n\r\ngeneralRank = [\r\n    {\"ğŸ† æ’è¡Œæ¦œå• ğŸ†\": \"\"},\r\n    {\"ä»Šæ—¥\": \"https://www.pixiv.net/ranking.php?mode=daily&p={{page}}&format=json\"},\r\n    {\"æœ¬å‘¨\": \"https://www.pixiv.net/ranking.php?mode=weekly&p={{page}}&format=json\"},\r\n    {\"æœ¬æœˆ\": \"https://www.pixiv.net/ranking.php?mode=monthly&p={{page}}&format=json\"},\r\n    {\"æ–°äºº\": \"https://www.pixiv.net/ranking.php?mode=rookie&p={{page}}&format=json\"}\r\n]\r\n\r\nif (SHOW_GENERAL_RANK === true) {\r\n    li = li.concat(generalNew)\r\n}\r\nli = li.concat(r18Rank)\r\nli = li.concat(generalRank)\r\n\r\nli.forEach(item => {\r\n    item.title = Object.keys(item)[0]\r\n    item.url = Object.values(item)[0]\r\n    delete item[Object.keys(item)[0]]\r\n    item.style = {}\r\n    item.style.layout_flexGrow = 1\r\n    item.style.layout_flexShrink = 1\r\n    item.style.layout_alignSelf = \"auto\"\r\n    item.style.layout_wrapBefore = \"false\"\r\n    if (item.url === \"\") {\r\n        item.style.layout_flexBasisPercent = 1\r\n    } else {\r\n        item.style.layout_flexBasisPercent = -1\r\n    }\r\n})\r\n\r\nJSON.stringify(li)",
        "header": "{\"referer\":\"https://www.pixiv.net\"}",
        "jsLib": "var cacheSaveSeconds = 7*24*60*60  // é•¿æœŸç¼“å­˜æ—¶é—´ 7å¤©\r\nvar cacheTempSeconds = 10*60*1000  // çŸ­æœŸç¼“å­˜ 10min\r\n\r\nfunction cacheGetAndSet(cache, key, supplyFunc) {\r\n    let v = cache.get(key)\r\n    // ç¼“å­˜ä¿¡æ¯é”™è¯¯æ—¶ï¼Œä¿å­˜ 10min åé‡æ–°è¯·æ±‚\r\n    if (v && JSON.parse(v).error === true) {\r\n        if (new Date().getTime() >= JSON.parse(v).timestamp + cacheTempSeconds) {\r\n            cache.delete(key)\r\n            v = cache.get(key)\r\n        }\r\n    }\r\n    // æ— ç¼“å­˜ä¿¡æ¯æ—¶ï¼Œè¿›è¡Œè¯·æ±‚\r\n    if (v === undefined || v === null) {\r\n        v = supplyFunc()\r\n        v.timestamp = new Date().getTime()\r\n        v = JSON.stringify(v)\r\n        cache.put(key, v, cacheSaveSeconds)\r\n    }\r\n    return JSON.parse(v)\r\n}\r\n\r\nfunction isHtmlString(str) {\r\n    return str.startsWith(\"<!DOCTYPE html>\")\r\n}\r\nfunction isJsonString(str) {\r\n    try {\r\n        if (typeof JSON.parse(str) === \"object\") {\r\n            return true\r\n        }\r\n    } catch(e) {}\r\n    return false\r\n}\r\n\r\nfunction isLogin() {\r\n    const {java, cache} = this\r\n    return !!cache.get(\"csfrToken\")\r\n}\r\n\r\nfunction getAjaxJson(url, forceUpdate) {\r\n    const {java, cache} = this\r\n    let v = cache.get(url)\r\n    if (forceUpdate && v && new Date().getTime() >= JSON.parse(v).timestamp + cacheTempSeconds) cache.delete(url)\r\n    return cacheGetAndSet(cache, url, () => {\r\n        return JSON.parse(java.ajax(url))\r\n    })\r\n}\r\nfunction getAjaxAllJson(urls, forceUpdate) {\r\n    const {java, cache} = this\r\n    let v = cache.get(urls)\r\n    if (forceUpdate && v && new Date().getTime() >= JSON.parse(v).timestamp + cacheTempSeconds) cache.delete(urls)\r\n    return cacheGetAndSet(cache, urls, () => {\r\n        let result = java.ajaxAll(urls).map(resp => JSON.parse(resp.body()))\r\n        cache.put(urls, JSON.stringify(result), cacheSaveSeconds)\r\n        for (let i in urls) cache.put(urls[i], JSON.stringify(result[i]), cacheSaveSeconds)\r\n        return result\r\n    })\r\n}\r\nfunction getWebviewJson(url, parseFunc) {\r\n    const {java, cache} = this\r\n    return cacheGetAndSet(cache, url, () => {\r\n        let html = java.webView(null, url, null)\r\n        return JSON.parse(parseFunc(html))\r\n    })\r\n}\r\n\r\nfunction urlIllustUrl(illustId) {\r\n    return `https://www.pixiv.net/artworks/${illustId}`\r\n}\r\nfunction urlIllustDetailed(illustId) {\r\n    return `https://www.pixiv.net/ajax/illust/${illustId}?lang=zh`\r\n}\r\nfunction urlIllustsDetailed(userId, idList) {\r\n    return `https://www.pixiv.net/ajax/user/${userId}/illusts?${idList.map(v => \"ids[]=\" + v).join(\"&\")}`\r\n}\r\nfunction urlSeriesUrl(userId, seriesId) {\r\n    return `https://www.pixiv.net/user/${userId}/series/${seriesId}`\r\n}\r\nfunction urlSeriesDetailed(seriesId, page) {\r\n    if (page === undefined) page = 1\r\n    return `https://www.pixiv.net/ajax/series/${seriesId}?p=${page}&lang=zh`\r\n}\r\n\r\nfunction urlUserAllWorks(userId) {\r\n    return `https://www.pixiv.net/ajax/user/${userId}/profile/all?lang=zh`\r\n}\r\n\r\nfunction urlSearchArtwork(name, page) {\r\n    return `https://www.pixiv.net/ajax/search/artworks/${encodeURI(name)}?word=${encodeURI(name)}&order=date_d&mode=all&p=${page}&s_mode=s_tc&type=all&lang=zh`\r\n}\r\nfunction urlSearchIllust(name, page) {\r\n    return `https://www.pixiv.net/ajax/search/artworks/${encodeURI(name)}?word=${encodeURI(name)}&order=date_d&mode=all&p=${page}&s_mode=s_tc&type=illust&lang=zh`\r\n}\r\nfunction urlSearchManga(name, page) {\r\n    return `https://www.pixiv.net/ajax/search/artworks/${encodeURI(name)}?word=${encodeURI(name)}&order=date_d&mode=all&p=${page}&s_mode=s_tc&type=manga&lang=zh`\r\n}\r\nfunction urlSearchUgoira(name, page) {\r\n    return `https://www.pixiv.net/ajax/search/artworks/${encodeURI(name)}?word=${encodeURI(name)}&order=date_d&mode=all&p=${page}&s_mode=s_tc&type=ugoira&lang=zh`\r\n}\r\n// å®Œå…¨åŒ¹é…ç”¨æˆ·å\r\nfunction urlSearchUser(name) {\r\n    return `https://www.pixiv.net/search/users?nick=${encodeURI(name)}&s_mode=s_usr&nick_mf=1`\r\n}\r\n\r\nfunction urlCoverUrl(url) {\r\n    return `${url}, {\"headers\": {\"Referer\":\"https://www.pixiv.net/\"}}`\r\n}\r\n\r\nfunction dateFormat(str) {\r\n    let addZero = function (num) {\r\n        return num < 10 ? '0' + num : num;\r\n    }\r\n    let time = new Date(str);\r\n    let Y = time.getFullYear() + \"å¹´\";\r\n    let M = addZero(time.getMonth() + 1) + \"æœˆ\";\r\n    let D = addZero(time.getDate()) + \"æ—¥\";\r\n    return Y + M + D;\r\n}\r\nfunction timeFormat(str) {\r\n    let addZero = function (num) {\r\n        return num < 10 ? '0' + num : num;\r\n    }\r\n    let time = new Date(str);\r\n    let YY = time.getFullYear()\r\n    let MM = addZero(time.getMonth() + 1)\r\n    let DD = addZero(time.getDate())\r\n    let hh = addZero(time.getHours())\r\n    let mm = addZero(time.getMinutes())\r\n    let ss = addZero(time.getSeconds())\r\n    return `${YY}-${MM}-${DD} ${hh}:${mm}:${ss}`\r\n}\r\nfunction timeTextFormat(text) {\r\n    return `${text.slice(0, 10)} ${text.slice(11, 19)}`\r\n}\r\nfunction sleep(time) {\r\n    let endTime = new Date().getTime() + time\r\n    while(true){\r\n        if (new Date().getTime() > endTime){\r\n            return;\r\n        }\r\n    }\r\n}\r\nfunction sleepToast(text, second) {\r\n    const {java} = this\r\n    java.log(text)\r\n    java.longToast(text)\r\n    if (second === undefined || second <= 2) {second = 2}\r\n    sleep(1000*second)\r\n}\r\n\r\nfunction updateSource() {\r\n    const {java, source} = this\r\n    let onlineSource, comment, sourceName, sourceNameCapitalize, index = 0\r\n    if (source.bookSourceUrl.includes(\"pixiv\")) sourceName = \"pixiv\"\r\n    else if (source.bookSourceUrl.includes(\"furrynovel\")) sourceName = \"linpx\"\r\n    sourceNameCapitalize = sourceName[0].toUpperCase() + sourceName.substring(1)\r\n\r\n    if (source.bookSourceName.includes(\"å¤‡ç”¨\")) index = 1\r\n    else if (source.bookSourceName.includes(\"æ¼«ç”»\")) index = 2\r\n    if (source.bookSourceUrl.includes(\"furrynovel.com\")) {\r\n        sourceNameCapitalize = \"FurryNovel\"\r\n        index = 1\r\n    }\r\n\r\n    try {\r\n        let updateUrl = `https://cdn.jsdelivr.net/gh/windyhusky/PixivSource@main/${sourceName}.json`\r\n        onlineSource = JSON.parse(java.get(updateUrl,{'User-Agent': 'Mozilla/5.0 (Linux; Android 14)','X-Requested-With': 'XMLHttpRequest'}).body())[index]\r\n        comment = onlineSource.bookSourceComment.split(\"\\n\")\r\n    } catch (e) {\r\n        try {\r\n            let updateUrl = `https://raw.githubusercontent.com/windyhusky/PixivSource/main/${sourceName}.json`\r\n            onlineSource = JSON.parse(java.get(updateUrl,{'User-Agent': 'Mozilla/5.0 (Linux; Android 14)','X-Requested-With': 'XMLHttpRequest'}).body())[index]\r\n            comment = onlineSource.bookSourceComment.split(\"\\n\")\r\n        } catch (e) {\r\n            onlineSource = {lastUpdateTime: new Date().getTime()}\r\n            comment = source.bookSourceComment.split(\"\\n\")\r\n        }\r\n    }\r\n    // comment = source.bookSourceComment.split(\"\\n\")\r\n    let htm = `data:text/html; charset=utf-8,\r\n<html>\r\n<head>\r\n    <meta name=\"viewport\" content=\"width=device-width, initial-scale=1.0\">\r\n    <title>æ›´æ–° ${source.bookSourceName} ä¹¦æº</title>\r\n    <style> \r\n    table { text-align: center; margin: 0 auto; } .ann { display: flex; justify-content: center; align-items: center; height: 5vh; } \r\n    button { background-color: rgb(76, 175, 80); color: white; border: none; border-radius: 4px; height: 6vh; width: 30vw; overflow: hidden; } \r\n    button span { cursor: pointer; display: inline-block; position: relative; transition: 0.4s; } \r\n    button span:after { content: '>'; position: absolute; opacity: 0; top: 0; right: 30px; transition: 0.2s; } \r\n    button:active span { padding-right: 20px; } \r\n    button:active span:after { opacity: 1; right: -40px; }\r\n    </style>\r\n</head>\r\n\r\n<body>\r\n    <table border=\"1\" cellspacing=\"0\">\r\n        <th colspan=\"2\"> ${source.bookSourceName} ä¹¦æº <a href=\"https://github.com/windyhusky/PixivSource/blob/main/doc/FurryNovel.md\">ğŸ”° ä½¿ç”¨æŒ‡å—</a></th>\r\n        <tr>\r\n            <td>â˜ï¸ è¿œç¨‹ç‰ˆæœ¬ï¼š${onlineSource.bookSourceComment.split(\"\\n\")[2].replace(\"ä¹¦æºç‰ˆæœ¬ï¼š\", \"\")}</td>\r\n            <td>ğŸ“† æ›´æ–°ï¼š${timeFormat(onlineSource.lastUpdateTime)}</td>\r\n        </tr>\r\n        <tr>\r\n            <td>ğŸ“¥ æœ¬åœ°ç‰ˆæœ¬ï¼š${source.bookSourceComment.split(\"\\n\")[2].replace(\"ä¹¦æºç‰ˆæœ¬ï¼š\", \"\")}</td>\r\n            <td>ğŸ“† æ›´æ–°ï¼š${timeFormat(source.lastUpdateTime)}</td>\r\n        </tr> \r\n        <tr><td colspan=\"2\" style=\"text-align: left;\">${comment.slice(3, 8).join(\"<br>\")}</td></tr>\r\n        <tr><td colspan=\"2\" style=\"text-align: left;\">${comment.slice(comment.length-2, comment.length).join(\"<br>\")}</td></tr>\r\n    </table>\r\n    \r\n    <table border=\"0\" cellspacing=\"20\">\r\n        <th colspan=\"2\"> æ›´æ–° ${source.bookSourceName} ä¹¦æº </th>\r\n        <tr><td><div class=\"ann\">\r\n            <a href=\"legado://import/importonline?src=https://cdn.jsdelivr.net/gh/windyhusky/PixivSource@main/${sourceName}.json\">\r\n            <button><span>æ›´æ–°ä¹¦æº<br>(Jsdelivr CDN)</span></button>\r\n            </a></div></td>\r\n            \r\n            <td><div class=\"ann\">\r\n            <a href=\"legado://import/importonline?src=https://cdn.jsdelivr.net/gh/windyhusky/PixivSource@main/btsrk.json\">\r\n            <button><span>æ›´æ–°è®¢é˜…<br>(Jsdelivr CDN)</span></button>\r\n            </a></div></td>\r\n        </tr>\r\n        \r\n        <tr><td><div class=\"ann\">\r\n            <a href=\"legado://import/importonline?src=https://raw.githubusercontent.com/windyhusky/PixivSource/main/${sourceName}.json\">\r\n            <button><span>ä¹¦æºé“¾æ¥<br>(GitHub)</span></button>\r\n            </a></div></td>\r\n            \r\n            <td><div class=\"ann\">\r\n            <a href=\"legado://import/importonline?src=https://raw.githubusercontent.com/windyhusky/PixivSource/main/btsrk.json\">\r\n            <button><span>è®¢é˜…é“¾æ¥<br>(GitHub)</span></button>\r\n            </a></div></td>\r\n        </tr>\r\n        \r\n        <tr><td><div class=\"ann\">\r\n            <a href=\"legado://import/importonline?src=https://codeberg.org/DowneyRem/PixivSource/raw/branch/main/${sourceName}.json\">\r\n            <button><span>å¤‡ç”¨ä¹¦æºé“¾æ¥<br>(Codeberg)</span></button>\r\n            </a></div></td>\r\n            \r\n            <td><div class=\"ann\">\r\n            <a href=\"legado://import/importonline?src=https://codeberg.org/DowneyRem/PixivSource/raw/branch/main/btsrk.json\">\r\n            <button><span>å¤‡ç”¨è®¢é˜…é“¾æ¥<br>(Codeberg)</span></button>\r\n            </a></div></td>\r\n        </tr>\r\n    </table>\r\n</body>\r\n</html>`;\r\n    java.startBrowser(htm,'æ›´æ–°ä¹¦æº');\r\n    return []\r\n}",
        "lastUpdateTime": "1762442228251",
        "loginCheckJs": "var util = {}\r\n\r\nfunction objStringify(obj) {\r\n    return JSON.stringify(obj, (n, v) => {\r\n        if (typeof v == \"function\")\r\n            return v.toString();\r\n        return v;\r\n    });\r\n}\r\n\r\nfunction publicFunc() {\r\n    let u = {}, settings = {}\r\n    // è¾“å‡ºä¹¦æºä¿¡æ¯\r\n    java.log(`${source.bookSourceComment.split(\"\\n\")[0]}`)\r\n    java.log(`ğŸ“Œ ${source.bookSourceComment.split(\"\\n\")[2]}`)\r\n    java.log(`ğŸ“† æ›´æ–°æ—¶é—´ï¼š${timeFormat(source.lastUpdateTime)}`)\r\n\r\n    settings = JSON.parse(String(source.variableComment).match(RegExp(/{([\\s\\S]*?)}/gm)))\r\n    if (settings !== null) {\r\n        java.log(\"âš™ï¸ ä½¿ç”¨è‡ªå®šä¹‰è®¾ç½®\")\r\n    } else {\r\n        settings = {}\r\n        settings.CONVERT_CHINESE = true     // æœç´¢ï¼šæœç´¢æ—¶è¿›è¡Œç¹ç®€è½¬æ¢\r\n        settings.SHOW_ORIGINAL_LINK = true  // ç›®å½•å¤„æ˜¾ç¤ºæºé“¾æ¥ï¼Œä½†ä¼šå¢åŠ è¯·æ±‚æ¬¡æ•°\r\n        settings.DEBUG = false              // è°ƒè¯•æ¨¡å¼\r\n        java.log(\"âš™ï¸ ä½¿ç”¨é»˜è®¤è®¾ç½®ï¼ˆæ— è‡ªå®šä¹‰è®¾ç½® æˆ– è‡ªå®šä¹‰è®¾ç½®æœ‰è¯¯ï¼‰\")\r\n    }\r\n    u.CONVERT_CHINESE = settings.CONVERT_CHINESE\r\n    u.SHOW_ORIGINAL_LINK = settings.SHOW_ORIGINAL_LINK\r\n    u.DEBUG = settings.DEBUG\r\n\r\n    u.debugFunc = (func) => {\r\n        if (util.DEBUG === true) {\r\n            func()\r\n        }\r\n    }\r\n\r\n    // è·å– Csrf Tokenï¼Œä»¥ä¾¿è¿›è¡Œæ”¶è—ç­‰è¯·æ±‚\r\n    // è·å–æ–¹æ³•æ¥è‡ªè„šæœ¬ Pixiv Previewer\r\n    // https://github.com/Ocrosoft/PixivPreviewer\r\n    // https://greasyfork.org/zh-CN/scripts/30766-pixiv-previewer/code\r\n    u.getCsrfToken = function() {\r\n        let csfrToken = cache.get(\"csfrToken\")\r\n        if (!csfrToken) {\r\n            let html = java.webView(null, \"https://www.pixiv.net/\", null)\r\n            try {\r\n                csfrToken = html.match(/token\\\\\":\\\\\"([a-z0-9]{32})/)[1]\r\n                cache.put(\"csfrToken\", csfrToken)  // ä¸ç™»å½•è®¾å¤‡æœ‰å…³ï¼Œæ— æ³•å­˜å‚¨ nul\r\n            } catch (e) {\r\n                csfrToken = null\r\n                cache.delete(\"csfrToken\")  // ä¸ç™»å½•è®¾å¤‡æœ‰å…³ï¼Œæ— æ³•å­˜å‚¨ nul\r\n                // sleepToast(\"âš ï¸ æœªç™»å½•è´¦å·(csfrToken)\")\r\n            }\r\n            java.log(`csfrToken:\\n${csfrToken}`)\r\n        }\r\n        return csfrToken\r\n    }\r\n\r\n    u.handIllusts = function (illusts) {\r\n        illusts.forEach(illust => {\r\n            // illust.id = illust.id\r\n            // illust.title = illust.title\r\n            // illust.userName = illust.userName\r\n            // illust.tags = illust.tags\r\n            if (!(illust.tags instanceof Array)) {\r\n                illust.tags = illust.tags.tags.map(item => item.tag)\r\n                illust.coverUrl = illust.url = illust.urls.regular  // å…¼å®¹æ­£æ–‡æœç´¢\r\n                illust.updateDate = illust.uploadDate\r\n            }\r\n            illust.textCount = null\r\n            // illust.pageCount = illust.pageCount\r\n            // illust.description = illust.description\r\n            illust.coverUrl = illust.url\r\n            illust.detailedUrl = urlIllustDetailed(illust.id)\r\n            // illust.createDate = illust.createDate\r\n            // illust.updateDate = illust.updateDate\r\n            // illust.aiType = illust.aiType\r\n\r\n            if (illust.seriesNavData === undefined || illust.seriesNavData === null) {\r\n                illust.latestChapter = illust.title\r\n            } else {\r\n                illust.seriesId = illust.seriesNavData.seriesId\r\n                illust.title = illust.seriesNavData.title\r\n            }\r\n\r\n            if (illust.seriesId !== undefined) {\r\n                let resp = getAjaxJson(urlSeriesDetailed(illust.seriesId)).body\r\n                let series = resp.illustSeries.filter(item => item.id === illust.seriesId)[0]\r\n                // illust.title = illust.title\r\n                illust.tags = illust.tags.concat(series.tags)\r\n                illust.latestChapter = resp.thumbnails.illust.filter(item => item.id === series.latestIllustId)[0].title\r\n                illust.description = series.description\r\n                if (series.url === undefined) {\r\n                    let firstChapter = getAjaxJson(urlIllustDetailed(series.firstIllustId)).body\r\n                    illust.coverUrl = firstChapter.urls.regular\r\n                    illust.tags = illust.tags.concat(firstChapter.tags.tags.map(item => item.tag))\r\n                }\r\n                illust.createDate = series.createDate\r\n                illust.updateDate = series.updateDate\r\n                illust.total = series.total\r\n            }\r\n        })\r\n        return illusts\r\n    }\r\n\r\n    u.formatIllusts = function (illusts) {\r\n        illusts.forEach(illust => {\r\n            illust.title = illust.title.replace(RegExp(/^\\s+|\\s+$/g), \"\")\r\n            illust.tags = Array.from(new Set(illust.tags))\r\n            illust.tags = illust.tags.join(\",\")\r\n            illust.coverUrl = urlCoverUrl(illust.coverUrl)\r\n            illust.createDate = dateFormat(illust.createDate)\r\n            illust.updateDate = dateFormat(illust.updateDate)\r\n            if (util.MORE_INFORMATION) {\r\n                illust.description = `\\nä¹¦åï¼š${illust.title}\\nä½œè€…ï¼š${illust.userName}\\næ ‡ç­¾ï¼š${illust.tags}\\né¡µé¢ï¼š${illust.pageCount}\\nä¸Šä¼ ï¼š${illust.createDate}\\næ›´æ–°ï¼š${illust.updateDate}\\nç®€ä»‹ï¼š${illust.description}`\r\n            } else {\r\n                illust.description = `\\n${illust.title}ï¼Œå…±${illust.pageCount}é¡µ\\n${illust.description}\\nä¸Šä¼ æ—¶é—´ï¼š${illust.createDate}\\næ›´æ–°æ—¶é—´ï¼š${illust.updateDate}`\r\n            }\r\n        })\r\n        return illusts\r\n    }\r\n\r\n    u.getIllustRes = function (result) {\r\n        let illustId = 0, res = {}\r\n        let isJson = isJsonString(result)\r\n        let isHtml = result.startsWith(\"<!DOCTYPE html>\")\r\n        if (!isJson && isHtml) {\r\n            let pattern1 = \"(https?://)?(www\\\\.)?pixiv\\\\.net/(artworks|ajax/illust)/(\\\\d+)\"\r\n            let isIllust = baseUrl.match(new RegExp(pattern1))\r\n            let pattern2 = \"(https?://)?(www\\\\.)?pixiv\\\\.net/(user/\\\\d+|ajax)/series/(\\\\d+)\"\r\n            let isSeries = baseUrl.match(new RegExp(pattern2))\r\n\r\n            if (isIllust) {\r\n                illustId = isIllust[4]\r\n            } else if (isSeries) {\r\n                seriesId = isSeries[4]\r\n                java.log(`åŒ¹é…ç³»åˆ—IDï¼š${seriesId}`)\r\n                illustId = getAjaxJson(urlSeriesDetailed(seriesId)).body.page.series.reverse()[0].workId\r\n            }\r\n        }\r\n        if (isJson) {\r\n            res = JSON.parse(result)\r\n        }\r\n\r\n        if (illustId) {\r\n            java.log(`åŒ¹é…æ’ç”»IDï¼š${illustId}`)\r\n            res = getAjaxJson(urlIllustDetailed(illustId))\r\n        }\r\n        if (res.error) {\r\n            java.log(`æ— æ³•ä» Pixiv è·å–å½“å‰æ¼«ç”»`)\r\n            java.log(JSON.stringify(res))\r\n            return []\r\n        }\r\n        return res.body\r\n    }\r\n\r\n    util = u\r\n    java.put(\"util\", objStringify(u))\r\n}\r\n\r\n// è·å–è¯·æ±‚çš„user idæ–¹ä¾¿å…¶ä»–ajaxè¯·æ±‚æ„é€ \r\nfunction getPixivUid() {\r\n    let uid = cache.get(\"pixiv:uid\")\r\n    if (!uid || String(uid) === \"null\") {\r\n        let html = java.webView(null, \"https://www.pixiv.net/\", null)\r\n        try {\r\n            uid = html.match(/user_id:'(\\d+)'/)[1]\r\n        } catch (e) {\r\n            uid = null\r\n        }\r\n        cache.put(\"pixiv:uid\", String(uid))\r\n    }\r\n}\r\n\r\npublicFunc()\r\nif (result.code() === 200) {\r\n    getPixivUid(); util.getCsrfToken()\r\n}\r\njava.getStrResponse(null, null)",
        "loginUi": "",
        "loginUrl": "",
        "respondTime": 180000,
        "ruleBookInfo": {
            "author": "userName",
            "canReName": "true",
            "coverUrl": "coverUrl",
            "init": "@js:\n@js:\r\nvar util = objParse(String(java.get(\"util\")))\r\n\r\nfunction objParse(obj) {\r\n    return JSON.parse(obj, (n, v) => {\r\n        if (typeof v == \"string\" && v.match(\"()\")) {\r\n            return eval(`(${v})`)\r\n        }\r\n        return v;\r\n    })\r\n}\r\n\r\nfunction illustHandler(illust){\r\n    illust = util.formatIllusts(util.handIllusts([illust]))[0]\r\n    book.bookUrl = illust.detailedUrl = urlIllustUrl(illust.id)\r\n    book.tocUrl = illust.catalogUrl = urlIllustDetailed(illust.id)\r\n    return illust\r\n}\r\n\r\n(() => {\r\n    return illustHandler(util.getIllustRes(result))\r\n})()",
            "intro": "description",
            "kind": "tags",
            "lastChapter": "latestChapter",
            "name": "title",
            "tocUrl": "catalogUrl"
        },
        "ruleContent": {
            "content": "@js:\n@js:\r\nvar util = objParse(String(java.get(\"util\")))\r\n\r\nfunction objParse(obj) {\r\n    return JSON.parse(obj, (n, v) => {\r\n        if (typeof v == \"string\" && v.match(\"()\")) {\r\n            return eval(`(${v})`)\r\n        }\r\n        return v;\r\n    })\r\n}\r\n\r\nfunction getContent(res) {\r\n    let content = [\"\"]\r\n    // li = \"mini thumb small regular original\".split(\" \")\r\n    let illustLink = getAjaxJson(urlIllustDetailed(res.id)).body.urls.regular\r\n    for (let order = 0; order < res.pageCount; order++) {\r\n        content.push(`<img src=\"${illustLink}\">`)\r\n        illustLink = illustLink.replace(`_p${order}`, `_p${order + 1}`)\r\n    }\r\n    content = content.join(\"\\n\")\r\n    return content\r\n}\r\n\r\n(function () {\r\n    return getContent(util.getIllustRes(result))\r\n})()",
            "imageStyle": "FULL"
        },
        "ruleExplore": {
            "author": "userName",
            "bookList": "@js:\n@js:\r\nvar util = objParse(String(java.get(\"util\")))\r\nvar seriesSet = new Set();  // å­˜å‚¨seriesID æœ‰BUGæ— æ³•å¤„ç†ç¿»é¡µ\r\n\r\nfunction objParse(obj) {\r\n    return JSON.parse(obj, (n, v) => {\r\n        if (typeof v == \"string\" && v.match(\"()\")) {\r\n            return eval(`(${v})`)\r\n        }\r\n        return v;\r\n    })\r\n}\r\n\r\nfunction handlerFactory() {\r\n    if (baseUrl.includes(\"https://cdn.jsdelivr.net\")) {\r\n        return () => {updateSource(); return []}\r\n    }\r\n    if (!isLogin()) {\r\n        return handlerNoLogin()\r\n    }\r\n    if (baseUrl.includes(\"/follow_latest\")) {\r\n        return handlerFollowLatest()\r\n    }\r\n    if (baseUrl.includes(\"/watch_list\")) {\r\n        return handlerWatchList()\r\n    }\r\n    if (baseUrl.includes(\"/top\")) {\r\n        return handlerRecommend()\r\n    }\r\n    if (baseUrl.includes(\"/discovery\")) {\r\n        return handlerDiscovery()\r\n    }\r\n    if (baseUrl.includes(\"/bookmark\")) {\r\n        return handlerBookMarks()\r\n    }\r\n    if (baseUrl.includes(\"/new\")) {\r\n        return handlerDiscovery()\r\n    }\r\n    if (baseUrl.includes(\"/commission/\")) {\r\n        return handlerFollowLatest()\r\n    }\r\n    if (baseUrl.includes(\"/user_event/portal\")) {\r\n        return handlerFollowLatest()\r\n    }\r\n    // æ­£åˆ™åŒ¹é…ç½‘å€å†…å®¹\r\n    if (baseUrl.includes(\"/ranking\") && (baseUrl.endsWith(\"json\"))) {\r\n        return handlerRanking()\r\n    }\r\n    if (baseUrl.includes(\"/ranking\")) {\r\n        return handlerRegexIllusts()\r\n    }\r\n    else {\r\n        return []\r\n    }\r\n}\r\n\r\nfunction handlerNoLogin() {\r\n    return () => {\r\n        sleepToast(\"æ­¤åŠŸèƒ½éœ€è¦åœ¨ä¹¦æºç™»å½•åæ‰èƒ½ä½¿ç”¨\")\r\n        sleepToast('å‘ç° - é•¿æŒ‰\"Pixiv\" - ç™»å½• - ç™»å½•è´¦å·')\r\n        return []\r\n    }\r\n}\r\n\r\n//å…³æ³¨ä½œè€…ï¼Œæ¼«ç”»å§”æ‰˜ï¼Œæ¼«ç”»ä¼åˆ’\r\nfunction handlerFollowLatest() {\r\n    return () => {\r\n        let res = JSON.parse(result)\r\n        return util.formatIllusts(util.handIllusts(res.body.thumbnails.illust))\r\n    }\r\n}\r\n\r\n// è¿½æ›´åˆ—è¡¨\r\nfunction handlerWatchList() {\r\n    return () => {\r\n        let res = JSON.parse(result)\r\n        // li =  res.body.page.watchedSeriesIds\r\n        return util.formatIllusts(util.handIllusts(res.body.thumbnails.illust))\r\n    }\r\n}\r\n\r\n// æ¨èæ¼«ç”»\r\nfunction handlerRecommend() {\r\n    return () => {\r\n        let res = JSON.parse(result)\r\n        const recommend = res.body.page.recommend\r\n        const illusts = res.body.thumbnails.illust\r\n        let nidSet = new Set(recommend.ids)\r\n        // java.log(nidSet.size)\r\n        let list = illusts.filter(illust => nidSet.has(String(illust.id)))\r\n        // java.log(`è¿‡æ»¤ç»“æœ:${JSON.stringify(list)}`)\r\n        return util.formatIllusts(util.handIllusts(list))\r\n    }\r\n}\r\n\r\n//å‘ç°æ¼«ç”»\r\nfunction handlerDiscovery() {\r\n    return () => {\r\n        let res = JSON.parse(result)\r\n        return util.formatIllusts(util.handIllusts(res.body.illusts))\r\n    }\r\n}\r\n\r\n// æ”¶è—æ¼«ç”»\r\nfunction handlerBookMarks() {\r\n    return () => {\r\n        let res = JSON.parse(result).body.works\r\n        if (res === undefined || res.length === 0) {\r\n            //æµç¨‹æ— æ³•æœ¬ç¯èŠ‚ä¸­æ­¢ åªèƒ½äº¤ç»™ä¸‹ä¸€æµç¨‹å¤„ç†\r\n            return []\r\n        }\r\n        return util.formatIllusts(util.handIllusts(res))\r\n    }\r\n}\r\n\r\n// æ’è¡Œæ¦œï¼Œé¡ºåºç›¸åŒ\r\nfunction handlerRanking() {\r\n    return () => {\r\n        let res = JSON.parse(result)\r\n        res.contents.forEach(item =>{\r\n            item.id = item.illust_id\r\n            // item.title = item.title\r\n            item.userName = item.user_name\r\n            // item.tags = item.tags\r\n            item.latestChapter = item.title\r\n            item.description = null\r\n            item.coverUrl = item.url\r\n            item.detailedUrl = urlIllustDetailed(item.id)\r\n            item.createDate = item.updateDate = item.illust_upload_timestamp * 1000\r\n\r\n            if (item.illust_series !== false) {\r\n                let series = item.illust_series\r\n                item.seriesId = series.illust_series_id\r\n                item.order = series.illust_series_content_order\r\n                item.total = series.illust_series_content_count\r\n                if (item.order === item.total) item.latestChapter = item.title\r\n                item.title = series.illust_series_title\r\n                item.description = series.illust_series_caption\r\n                item.pageCount = series.illust_page_count\r\n                item.createDate = item.updateDate = series.illust_series_create_datetime\r\n            }\r\n        })\r\n        return util.formatIllusts(util.handIllusts(res.contents))\r\n    }\r\n}\r\n\r\n//é¦–é¡µï¼Œç¼–è¾‘éƒ¨æ¨èï¼Œé¡ºåºéšæœº\r\nfunction handlerRegexIllusts() {\r\n    return () => {\r\n        let illustIds = []  // æ­£åˆ™è·å–ç½‘å€ä¸­çš„ illustId\r\n        let matched = result.match(RegExp(/\\/artworks\\/\\d{5,}/gm))\r\n        for (let i in matched) {\r\n            let illustId = matched[i].match(RegExp(/\\d{5,}/))[0]\r\n            if (illustIds.indexOf(illustId) === -1) {\r\n                illustIds.push(illustId)\r\n            }\r\n        }\r\n        let userIllusts = getWebviewJson(\r\n            urlIllustsDetailed(`${cache.get(\"pixiv:uid\")}`, illustIds), html => {\r\n                return (html.match(new RegExp(\">\\\\{.*?}<\"))[0].replace(\">\", \"\").replace(\"<\", \"\"))\r\n            }).body\r\n        return util.formatIllusts(util.handIllusts(Object.values(userIllusts)))\r\n    }\r\n}\r\n\r\n(() => {\r\n    return handlerFactory()()\r\n})()",
            "bookUrl": "detailedUrl",
            "coverUrl": "coverUrl",
            "intro": "description",
            "kind": "tags",
            "lastChapter": "latestChapter",
            "name": "title",
            "wordCount": ""
        },
        "ruleSearch": {
            "author": "userName",
            "bookList": "@js:\n@js:\r\nvar util = objParse(String(java.get(\"util\")))\r\n\r\nfunction objParse(obj) {\r\n    return JSON.parse(obj, (n, v) => {\r\n        if (typeof v == \"string\" && v.match(\"()\")) {\r\n            return eval(`(${v})`)\r\n        }\r\n        return v;\r\n    })\r\n}\r\n\r\nfunction getArtwork() {\r\n    if (JSON.parse(result).error !== true) {\r\n        cache.put(urlSearchArtwork(java.get(\"key\"), java.get(\"page\")), result, cacheSaveSeconds)  // åŠ å…¥ç¼“å­˜\r\n        return JSON.parse(result).body.illustManga.data\r\n    } else {\r\n        return []\r\n    }\r\n}\r\n\r\nfunction search(name, page) {\r\n    let resp = getAjaxJson(urlSearchArtwork(name, page))\r\n    java.log(urlSearchArtwork(name, page))\r\n    if (resp.error === true || resp.total === 0) {\r\n        return {\"data\": [], \"total\":0, \"lastPage\": 0}\r\n    }\r\n    return resp.body.illustManga\r\n}\r\n\r\nfunction getConvertArtwork() {\r\n    let illusts = []\r\n    let name = String(java.get(\"key\"))\r\n    let name1 = String(java.s2t(name))\r\n    let name2 = String(java.t2s(name))\r\n    if (name1 !== name) illusts = illusts.concat(search(name1, 1).data)\r\n    if (name2 !== name) illusts = illusts.concat(search(name2, 1).data)\r\n    return illusts\r\n}\r\n\r\n(() => {\r\n    let artworks = []\r\n    artworks = artworks.concat(getArtwork())\r\n    if (util.CONVERT_CHINESE) artworks = artworks.concat(getConvertArtwork())\r\n    // java.log(JSON.stringify(artworks))\r\n    // è¿”å›ç©ºåˆ—è¡¨ä¸­æ­¢æµç¨‹\r\n    if (artworks.length === 0) {\r\n        return []\r\n    }\r\n    return util.formatIllusts(util.handIllusts(artworks))\r\n})()",
            "bookUrl": "detailedUrl",
            "checkKeyWord": "æµ‹è¯•",
            "coverUrl": "coverUrl",
            "intro": "description",
            "kind": "tags",
            "lastChapter": "latestChapter",
            "name": "title",
            "wordCount": ""
        },
        "ruleToc": {
            "chapterList": "@js:\n@js:\r\nvar util = objParse(String(java.get(\"util\")))\r\n\r\nfunction objParse(obj) {\r\n    return JSON.parse(obj, (n, v) => {\r\n        if (typeof v == \"string\" && v.match(\"()\")) {\r\n            return eval(`(${v})`)\r\n        }\r\n        return v;\r\n    })\r\n}\r\n\r\nfunction urlIllust(novelId){\r\n    if (util.SHOW_ORIGINAL_LINK) {\r\n        return urlIllustUrl(novelId)\r\n    } else {\r\n        return urlIllustDetailed(novelId)\r\n    }\r\n}\r\n\r\nfunction oneShotHandler(res) {\r\n    return [{\r\n        title: res.title.replace(RegExp(/^\\s+|\\s+$/g), \"\"),\r\n        chapterUrl: urlIllust(res.id),\r\n        chapterInfo: `${timeTextFormat(res.createDate)}`\r\n    }]\r\n}\r\n\r\nfunction seriesHandler(res) {\r\n    let limit = 12, total = 0, illusts = []\r\n    let seriesId = res.seriesNavData.seriesId\r\n    if (res.seriesId === undefined) {\r\n        total = getAjaxJson(urlSeriesDetailed(res.seriesNavData.seriesId)).body.page.total\r\n    } else {\r\n        total = res.total\r\n    }\r\n    util.debugFunc(() => {\r\n        java.log(`æœ¬ç³»åˆ— ${seriesId} ä¸€å…±æœ‰${total}ç« `);\r\n    })\r\n\r\n    //è¦çˆ¬å–çš„æ€»æ¬¡æ•°\r\n    let max = (total / limit) + 1\r\n    for (let page = 1; page < max; page++) {\r\n        // java.log(urlSeriesDetailed(seriesId, page))\r\n        res = getAjaxJson(urlSeriesDetailed(seriesId, page)).body\r\n        let illusts_id = res.page.series.map(item => item.workId)\r\n        illusts = illusts.concat(res.thumbnails.illust.filter(illust => illusts_id.includes(illust.id)))\r\n    }\r\n    illusts.reverse().forEach(illust => {\r\n        illust.title = illust.title.replace(RegExp(/^\\s+|\\s+$/g), \"\")\r\n        illust.chapterUrl = urlIllust(illust.id)\r\n        illust.chapterInfo = timeTextFormat(illust.createDate)\r\n    })\r\n    // java.log(JSON.stringify(illusts))\r\n    return illusts\r\n}\r\n\r\n(() => {\r\n    let res = util.getIllustRes(result)\r\n    if (res.seriesNavData !== null) {\r\n        return seriesHandler(res)\r\n    } else {\r\n        return oneShotHandler(res)\r\n    }\r\n})()",
            "chapterName": "title",
            "chapterUrl": "chapterUrl",
            "updateTime": "chapterInfo"
        },
        "searchUrl": "@js:\n@js:\r\njava.put(\"key\", key)\r\njava.put(\"page\", page)\r\njava.log(`ğŸ” æœç´¢å†…å®¹ï¼š${key}`)\r\nurlSearchArtwork(key, page)",
        "variableComment": "âš™ï¸ è‡ªå®šä¹‰ä¹¦æºè®¾ç½®ï¼š\r\nâš™ï¸ è‡ªå®šä¹‰è®¾ç½®ï¼šè¯·åœ¨åŸºæœ¬-å˜é‡è¯´æ˜å¤„ä¿®æ”¹ä»£ç \r\nâš™ï¸ è‡ªå®šä¹‰è®¾ç½®ï¼šå°† true æ”¹ä¸º falseï¼Œæˆ–ç›¸å\r\nâš ï¸ è®¾ç½®æºå˜é‡ã€æ— æ³•ã€‘æ›´æ”¹ä¹¦æºè‡ªå®šä¹‰è®¾ç½®\r\nâš ï¸ æ³¨æ„ä¸è¦æ·»åŠ æˆ–åˆ é™¤å°¾éšé€—å·\",\"\r\nâš ï¸ å‘ç°é¡µéœ€è¦é•¿æŒ‰\"Pixiv\"ï¼Œæ‰‹åŠ¨åˆ·æ–°\r\nä»¥ä¸‹å†…å®¹ä¸ºä¹¦æºè®¾ç½®ï¼š\r\n{\r\n\"CONVERT_CHINESE\": true,\r\n\"SHOW_GENERAL_NEW\": false,\r\n\"DEBUG\": false,\r\n\"SHOW_ORIGINAL_LINK\": true\r\n}\r\n\r\n// CONVERT_CHINESE\r\n// æœç´¢ï¼šæœç´¢æ—¶è¿›è¡Œç¹ç®€è½¬æ¢\r\n// SHOW_ORIGINAL_LINK\r\n// ç›®å½•ï¼šæ˜¾ç¤ºæºé“¾æ¥ï¼Œä½†ä¼šå¢åŠ è¯·æ±‚æ¬¡æ•°\r\n// DEBUG\r\n// è°ƒè¯•æ¨¡å¼\r\n// SHOW_GENERAL_NEW\r\n// å‘ç°ï¼šæœ€æ–°ã€ä¼åˆ’ã€çº¦ç¨¿æ˜¾ç¤ºä¸€èˆ¬æ¼«ç”»\r\n\r\n",
        "weight": 0
    }
]